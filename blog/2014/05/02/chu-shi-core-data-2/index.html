
 <!DOCTYPE HTML>
<html lang="zh-CN,en,default">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>初识Core Data(2) | yulingtianxia&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="杨萧玉">
    

    
    <meta name="description" content="本文内容：    自定义NSManagedObject 使用数据模型设计器 探究Core Data在SQLite中的实现    推荐先阅读上一篇文章：初识Core Data(1)   文章所使用的项目代码可以到这里下载   在下一篇文章里，我将会通过教程的方式，讲述如何用Swift结合CoreData的NSFetchedResultsController写一个小Demo-HardChoice">
<meta name="keywords" content="Objective-C,Core Data">
<meta property="og:type" content="article">
<meta property="og:title" content="初识Core Data(2)">
<meta property="og:url" content="http://yulingtianxia.com/blog/2014/05/02/chu-shi-core-data-2/index.html">
<meta property="og:site_name" content="yulingtianxia&#39;s blog">
<meta property="og:description" content="本文内容：    自定义NSManagedObject 使用数据模型设计器 探究Core Data在SQLite中的实现    推荐先阅读上一篇文章：初识Core Data(1)   文章所使用的项目代码可以到这里下载   在下一篇文章里，我将会通过教程的方式，讲述如何用Swift结合CoreData的NSFetchedResultsController写一个小Demo-HardChoice">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353399425.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353399917.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353400261.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353400282.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353400755.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353401739.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353401953.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353402308.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/14035340227.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353402879.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353402596.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/14035340286.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353403195.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353403982.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353403912.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353404264.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353404745.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/140353405697.png">
<meta property="og:updated_time" content="2019-05-26T10:08:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="初识Core Data(2)">
<meta name="twitter:description" content="本文内容：    自定义NSManagedObject 使用数据模型设计器 探究Core Data在SQLite中的实现    推荐先阅读上一篇文章：初识Core Data(1)   文章所使用的项目代码可以到这里下载   在下一篇文章里，我将会通过教程的方式，讲述如何用Swift结合CoreData的NSFetchedResultsController写一个小Demo-HardChoice">
<meta name="twitter:image" content="http://yulingtianxia.com/resources/140353399425.png">
<meta name="twitter:creator" content="@yulingtianxia">
<link rel="publisher" href="106642427004837273341">

    
    <link rel="alternative" href="/atom.xml" title="yulingtianxia&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.png">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="yulingtianxia&#39;s blog" title="yulingtianxia&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="yulingtianxia&#39;s blog">yulingtianxia&#39;s blog</a></h1>
				<h2 class="blog-motto">玉令天下的博客</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/tags">Tags</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Google" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2014/05/02/chu-shi-core-data-2/" title="初识Core Data(2)" itemprop="url">初识Core Data(2)</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/106642427004837273341?rel=author" title="杨萧玉" target="_blank" itemprop="author">杨萧玉</a>
		
  <p class="article-time">
    <time datetime="2014-05-02T12:17:04.000Z" itemprop="datePublished"> 发表于 2014-05-02</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义NSManagedObject"><span class="toc-number">1.</span> <span class="toc-text">自定义NSManagedObject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用数据模型设计器"><span class="toc-number">2.</span> <span class="toc-text">使用数据模型设计器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#探究Core-Data在SQLite中的实现"><span class="toc-number">3.</span> <span class="toc-text">探究Core Data在SQLite中的实现</span></a></li></ol>
		
		</div>
		
		<p>本文内容：  </p>
<ul>
<li>自定义NSManagedObject</li>
<li>使用数据模型设计器</li>
<li>探究Core Data在SQLite中的实现  </li>
</ul>
<p>推荐先阅读上一篇文章：<a href="http://yulingtianxia.com/blog/2014/05/01/chu-shi-core-data-1/">初识Core Data(1)</a>  </p>
<p><strong>文章所使用的项目代码可以到<a href="https://github.com/yulingtianxia/MyCDDemo" target="_blank" rel="noopener">这里</a>下载</strong>  </p>
<p>在<a href="http://yulingtianxia.com/blog/2014/07/03/chu-shi-core-data-3/">下一篇文章</a>里，我将会通过教程的方式，讲述如何用Swift结合CoreData的NSFetchedResultsController写一个小Demo-<a href="http://hardchoice.yulingtianxia.com" target="_blank" rel="noopener">HardChoice</a>  </p>
<a id="more"></a>

<h2 id="自定义NSManagedObject"><a href="#自定义NSManagedObject" class="headerlink" title="自定义NSManagedObject"></a>自定义NSManagedObject</h2><p>在上一篇教程中我们每条数据都是通过<code>NSManagedObject</code>对象装载，通过KVC方式使用<code>valueForKey：</code>方法访问对象属性，但是使用KVC要比使用访问器效率低一点。 只在必要时使用KVC，比如你需要动态选择key或keyPath。  </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[newEmployee setValue:@”Stig” forKey:firstName];</span><br><span class="line">[aDepartment setValue:@<span class="number">1000</span> forKeyPath:manager.salary];</span><br></pre></td></tr></table></figure>

<p>下面我们将自定义<code>NSManagedObject</code>类，通过对它的继承拓展，使得我们有自己的Event类，并通过访问器方法代替KVC方式来访问对象的属性。<br>按CMD+N或者在可视化建模工具下选择菜单中Editor-&gt;Create NSManagedObject Subclass：  </p>
<p><img src="http://yulingtianxia.com/resources/140353399425.png" alt>  </p>
<p><img src="http://yulingtianxia.com/resources/140353399917.png" alt>  </p>
<p>选中需要子类化的Entity（当然我们只有一个Event，自动勾选了）：  </p>
<p><img src="http://yulingtianxia.com/resources/140353400261.png" alt>  </p>
<p>最后点击Create，于是Event类就创建好了，可以看到属性timeStamp已经自动生成了，并且实现为<code>@dynamic</code>  </p>
<p>熟悉Objective-C语法的都知道<code>@synthesize</code>实际的意义就是自动生成属性的setter和getter方法。  </p>
<p><code>@dynamic</code>就是要告诉编译器，代码中用<code>@dynamic</code>修饰的属性，其getter和setter方法会在程序运行的时候或者用其他方式动态绑定，以便让编译器通过编译。其主要的作用就是用在<code>NSManagerObject</code>对象的属性声明上，由于此类对象的属性一般是从Core Data的属性中生成的，Core Data框架会在程序运行的时候为此类属性生成getter和setter方法。  </p>
<p>好的，下面我们改写以前的代码，这次我们将使用Event类的对象完成以前的任务：  </p>
<p>在MasterViewController.m文件中加入<code>#import &quot;Event.h&quot;</code>，然后将<code>insertNewObject:</code>方法替换如下  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)insertNewObject:(<span class="keyword">id</span>)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSManagedObjectContext</span> *context = [<span class="keyword">self</span>.fetchedResultsController managedObjectContext];</span><br><span class="line">    <span class="built_in">NSEntityDescription</span> *entity = [[<span class="keyword">self</span>.fetchedResultsController fetchRequest] entity];</span><br><span class="line">    Event *newManagedObject = [<span class="built_in">NSEntityDescription</span> insertNewObjectForEntityForName:[entity name] inManagedObjectContext:context];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// If appropriate, configure the new managed object.</span></span><br><span class="line">    <span class="comment">// Normally you should use accessor methods, but using KVC here avoids the need to add a custom class to the template.</span></span><br><span class="line"><span class="comment">//    [newManagedObject setValue:[NSDate date] forKey:@"timeStamp"];</span></span><br><span class="line">    newManagedObject.timeStamp = [<span class="built_in">NSDate</span> date];</span><br><span class="line">    <span class="comment">// Save the context.</span></span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (![context save:&amp;error]) &#123;</span><br><span class="line">         <span class="comment">// Replace this implementation with code to handle the error appropriately.</span></span><br><span class="line">         <span class="comment">// abort() causes the application to generate a crash log and terminate. You should not use this function in a shipping application, although it may be useful during development. </span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Unresolved error %@, %@"</span>, error, [error userInfo]);</span><br><span class="line">        abort();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>嗯，英文注释还告诉我们通常你应该用访问器方法呢，还说但是现在在这用KVC就避免了向模板添加自定义类的需求，真逗啊<br>依此类推，更改<code>prepareForSegue: sender:</code>方法：    </p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)prepareForSegue:(<span class="symbol">UIStoryboardSegue</span> *)segue sender:(id)sender</span><br><span class="line">&#123;</span><br><span class="line">    if ([[segue identifier] isEqualToString:@<span class="string">"showDetail"</span>]) &#123;</span><br><span class="line">        <span class="symbol">NSIndexPath</span> *indexPath = [self.tableView indexPathForSelectedRow];</span><br><span class="line">        <span class="symbol">Event</span> *object = [[self fetchedResultsController] objectAtIndexPath:indexPath];</span><br><span class="line">        [[segue destinationViewController] setDetailItem:object];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有<code>configureCell: atIndexPath:</code>方法：  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)<span class="string">configureCell:</span>(UITableViewCell *)cell <span class="string">atIndexPath:</span>(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    Event *object = [self.fetchedResultsController <span class="string">objectAtIndexPath:</span>indexPath];</span><br><span class="line"><span class="comment">//    cell.textLabel.text = [[object valueForKey:@"timeStamp"] description];</span></span><br><span class="line">    cell.textLabel.text = [object.timeStamp description];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相应地我们也可以针对<code>DetailViewController</code>进行改造：  </p>
<p>DetailViewController.h:  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Event</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DetailViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) Event *detailItem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *detailDescriptionLabel;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>DetailViewController.m:  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DetailViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Event.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DetailViewController</span> ()</span></span><br><span class="line">- (<span class="keyword">void</span>)configureView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DetailViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Managing the detail item</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setDetailItem:(Event *)newDetailItem</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_detailItem != newDetailItem) &#123;</span><br><span class="line">        _detailItem = newDetailItem;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update the view.</span></span><br><span class="line">        [<span class="keyword">self</span> configureView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)configureView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Update the user interface for the detail item.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.detailItem) &#123;</span><br><span class="line"><span class="comment">//        self.detailDescriptionLabel.text = [[self.detailItem valueForKey:@"timeStamp"] description];</span></span><br><span class="line">        <span class="keyword">self</span>.detailDescriptionLabel.text = [<span class="keyword">self</span>.detailItem.timeStamp description];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	<span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [<span class="keyword">self</span> configureView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>这部分比较简单，就不详细解释了，运行程序，跟以前一样（不截图了）  </p>
<p>如果想复用<code>MasterViewController</code>里面那些代码，需要做些大改动，具体可以参看<a href="http://objccn.io/issue-1-1/" target="_blank" rel="noopener">更轻量的 View Controllers</a>这篇文章  </p>
<h2 id="使用数据模型设计器"><a href="#使用数据模型设计器" class="headerlink" title="使用数据模型设计器"></a>使用数据模型设计器</h2><p>点击MyCDDemo.xcdatamodeld文件进入数据模型设计器，点击下方的加号（Add Enity），添加一个Enity，将其名字改为Person。然后添加name和sex属性，类型为string，需要注意的是属性名需要首字母小写，而且我们无需像往常给数据库建表一样为其添加ID字段，因为Core Data中你不需要任何类型的唯一标识Id，也不需要处理表连接。Core Data将在后台自动处理。你所需要做的就是定义对象间的关系。Core Data框架将在后台决定如何生成最佳的底层机制。  </p>
<p>与实体名一样，属性的命名也有很多的要求和约定。属性名不能以大写字母开头，不能包含空格，一般都是单数。对于Boolean类型属性，你应该遵循Objective-C实例变量的约定,比如指定一个CustomerOrder对象是否已经发货，那么应该命名属性为shipped，而不是isShipped、hasShipped等。</p>
<p>关于Core Data属性类型，我从网上摘抄了一段比较全面的解释：  </p>
<ul>
<li>Undefined选项值是新创建的属性的默认类型；如果属性类型为undefined，项目将无法通过编译。</li>
</ul>
<ul>
<li><p>Integer 16/32/64只表示整数，没有小数点。所以如果10除以3，你将会得到3，而余数1会丢失。Integer 16/32/64之间唯一的区别是所表示的数值范围不同。因为Core Data使用符号数，所以起始范围是负数，而不是0。</p>
<ul>
<li><p>Integer 16 数值范围：-32768~32767；</p>
</li>
<li><p>Integer 32 数值范围：-2147483648~2147483647；</p>
</li>
<li><p>Integer 64 数值范围：–9223372036854775808~9223372036854775807。</p>
<p>标准整型数的最大值和最小值可以在stdint.h中找到。在任何类文件中输入INT32_MAX,选中右击，然后选择Jump To Definition，你将看到许多最大值最小值定义。<strong>实体的属性的类型是Integer 16/32/64，当创建此实体对应的NSManagedObject子类时，属性最终的类型将会是NSNumber</strong>。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Double和Float可以认为是有小数部分的整数。它们都是基于二进制数值系统，在CPU运算时很可能会发生舍入误差。比如1/5，如果使用十进制数值系统，可以精确表示为0.2.但在二进制数值系统中，只能表示一个大概，在小数部分你会得到大量数字。<strong>所以不要使用Integer、Double、Float表示货币值。</strong>计算精度越高则越加趋于准确值，但内存占用也会越大。一个Float数使用32bit进行存储，一个Double数使用64bit。它们都使用科学计数法进行存储，所以一个数包含尾数和指数部分。</p>
<p>  在iOS中，最大的Float值是340282346638528859811704183484516925440.000000，最小的Float值是340282346638528859811704183484516925440.000000Double和Float都有一个符号位。而Double比Float的数值范围更大。</p>
<p>  当你决定该选择Float还是Double时，想一下你的属性是否真的需要超过Float提供的7位精度，如果不是，你应该选择Float，因为它更加匹配64bit的iPhone 5S底层处理器。除此之外，如果你想增加浮点数的计算速度而精度并没有严格要求，Float也是最佳选择。<strong>实体的属性的类型是Float或Double，当创建此实体对应的NSManagedObject子类时，属性最终的类型将会是NSNumber。</strong></p>
</li>
<li><p><strong>Decimal（十进制）是处理货币值和其他需要十进制场合下最佳选择</strong>，Decimal提供了优秀的计算精度，也消除了计算过程中的舍入误差。因为CPU的本地数制是二进制，所以CPU在处理十进制数时，开销会多一点。<strong>实体的属性的类型是Decimal，当创建此实体对应的NSManagedObject子类时，属性最终的类型将会是NSDecimalNumber。</strong>当你使用NSDecimalNumber执行计算时(如加减乘除计算)，为了保证计算精度，你只能使用它提供的内建方法。更多关于NSDecimalNumber可参见这里。</p>
</li>
<li><p>String类型和Objective-C中的NSString类似，用于保存字符数组。当生成实体对应的NSManagedObject子类时，String属性被表示为NSString。</p>
</li>
<li><p>Boolean数据类型被用于表示YES/NO值。当生成实体对应的NSManagedObject子类时，Boolean数据类型会被表示为NSNumber。所以为了获取布尔值，你需要想NSNumber对象发送boolValue消息。</p>
</li>
<li><p>Date类型是自解释类型。用来存储日期和时间。<strong>当生成实体对应的NSManagedObject子类时，Date类型会被表示为NSDate。</strong></p>
</li>
<li><p>Binary Data用来表示照片，音频，或一些BLOB类型数据(“Binary Large OBjects” such as image and sound data)。<strong>当生成实体对应的NSManagedObject子类时，Binary Data数据类型会被表示为NSData。</strong></p>
</li>
<li><p>Transformable属性类型用于存储一个Objective-C对象。该属性类型允许你存储任何类的实例，比如你使用Transformable属性表示UIColor。<strong>当生成NSManagedObject子类时，Transformable类型会被表示为id。</strong>对于id对象的保存和解档需要使用一个NSValueTransformer的实例或子类的实例。由该类负责属性值与NSData之间的转换。但这也相当的简单，尤其是当属性值的类型已经实现了NSCoding协议，此时系统会自动提供一个默认的NSValueTransformer实例来完成归档和解档。  </p>
</li>
</ul>
<p><img src="http://yulingtianxia.com/resources/140353400282.png" alt>  </p>
<p>选择一个属性，在右侧的Data Model Inspector中可以对属性进行更为详细的设置，而且这些设置项会根据你所设置的属性类型不同而不同，大致分为以下几类：  </p>
<ul>
<li>Transient（瞬时）选项表示属性不会存储到持久化存储文件中。Transient通常用在属性的值是由其他属性计算或合成而来（比如fullName属性是根据Persion类实例的firstName和lastName拼接而来）。</li>
<li>Optional（可选）选项表示当前属性的值允许为空。如果将属性指定为Optional，那么即使属性的值为空，实体的NSManagedObject实例也可被保存。如果该值是必选的（不选中Optional则为必选），如果属性值为空，NSManagedObject对象上下文将拒绝保存这个属性值不完整的NSManagedObject对象（当你尝试并保存上下文，你将接收到一个NSError对象）。所有的属性最初的状态都是Optinal。</li>
<li>Indexed选项表示底层的持久化存储文件应该为该属性生成一个索引；如果你使用基于多个属性的查询条件来提取对象，指定此类属性为Indexed，可以大幅提高提取速度。</li>
<li>Reg.Ex是Regular Expression的缩写，主要是用来验证属性值是否匹配特定的模式。此选项只对String类型有效。</li>
<li>Validation可以保证非法数据不被保存进持久化存储文件中。数值属性类型（Integer 16/32/64、Float、Double、Decimal）都有maximum和minimum最大值最小值设定。你也可以对String类型设置最大长度和最小长度。或对Date类型设置日期范围。不过最好的做法是当用户向UITextField中输入数据时就开始验证数据，而非等到向上下文发送save消息才验证数据。</li>
<li>除了Transformable和Binary Data类型以外，Default适用于所有属性类型。它被用来配置属性的默认值。</li>
<li>Allows External Storage允许大尺寸的二进制数据可以保存在持久化存储文件的外部。当你保存如照片，音频或视频时，建议是选中该选项， 这样Core Data就会对大于1MB的数据保存在持久化存储文件的外部。  </li>
</ul>
<p>如果你细心的话，会发现无论是属性还是实体等选项，右侧的Data Model Inspector经常会出现User Info一栏。<br>在managed object model中很多元素，比如entities, attributes,和 relationships，有一个相关联的用户信息字典。你可以在用户信息字典中以键值对的形式放入你想要的任何信息。这里常用的信息有实体的版本详情，还有fetched property中谓词（predicate）用到的值。  </p>
<p>说了一大堆，再添加两个实体吧：Teacher和Student，都继承自Person：  </p>
<p><img src="http://yulingtianxia.com/resources/140353400755.png" alt>  </p>
<p><img src="http://yulingtianxia.com/resources/140353401739.png" alt>  </p>
<p>点击右下方的Editor Style切换到Graph模式：  </p>
<p><img src="http://yulingtianxia.com/resources/140353401953.png" alt>  </p>
<p>选中Teacher，长按Add Attribute会弹出所有的选项（同样你也可以试试长按Add Enity），选择Add Relationship，添加一个关系，命名为students，Type为To Many，目标为Student（一个老师教很多学生）：  </p>
<p><img src="http://yulingtianxia.com/resources/140353402308.png" alt>  </p>
<p><img src="http://yulingtianxia.com/resources/14035340227.png" alt>  </p>
<p>我们再尝试一种添加关系的新方法：把以前在Teacher中建立的students删除，选中Student，按住Ctrl，鼠标拖至Teacher，这样一个双向的关系就建立起来了：  </p>
<p><img src="http://yulingtianxia.com/resources/140353402879.png" alt>  </p>
<p>分别编辑双方的关系，Tpye都是To Many：  </p>
<p><img src="http://yulingtianxia.com/resources/140353402596.png" alt>  </p>
<p>用上一节中提到的方法，建立这三个新建的Entity的<code>NSManagedObject</code>子类：  </p>
<p><img src="http://yulingtianxia.com/resources/14035340286.png" alt>  </p>
<p>因为创建顺序的问题，当Student创建的时候还不知道有<code>Teacher</code>类，于是其生成的一些方法将Teacher默认为<code>NSManagedObject</code>类：  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CoreData/CoreData.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">NSManagedObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSNumber</span> * grade;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSSet</span> *teachers;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> (<span class="title">CoreDataGeneratedAccessors</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addTeachersObject:(<span class="built_in">NSManagedObject</span> *)value;</span><br><span class="line">- (<span class="keyword">void</span>)removeTeachersObject:(<span class="built_in">NSManagedObject</span> *)value;</span><br><span class="line">- (<span class="keyword">void</span>)addTeachers:(<span class="built_in">NSSet</span> *)values;</span><br><span class="line">- (<span class="keyword">void</span>)removeTeachers:(<span class="built_in">NSSet</span> *)values;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>而Teacher类创建的时候已经有了<code>Student</code>类，就不会出现上面的问题：  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CoreData/CoreData.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Student</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Teacher</span> : <span class="title">NSManagedObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSString</span> * course;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSSet</span> *students;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Teacher</span> (<span class="title">CoreDataGeneratedAccessors</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addStudentsObject:(Student *)value;</span><br><span class="line">- (<span class="keyword">void</span>)removeStudentsObject:(Student *)value;</span><br><span class="line">- (<span class="keyword">void</span>)addStudents:(<span class="built_in">NSSet</span> *)values;</span><br><span class="line">- (<span class="keyword">void</span>)removeStudents:(<span class="built_in">NSSet</span> *)values;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>虽然<code>Teacher</code>类认识<code>Student</code>类，因为它已经创建了，但是此时Persion类还没有创建，于是此时<code>Student</code>类和<code>Teacher</code>类继承的依然是<code>NSManagedObject</code>，这不是我们想要的结果。<br>解决方法是重新生成下这三个Entity对应的<code>NSManagedObject</code>子类，并覆盖原有的文件：  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CoreData/CoreData.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Teacher</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSNumber</span> * grade;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSSet</span> *teachers;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> (<span class="title">CoreDataGeneratedAccessors</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addTeachersObject:(Teacher *)value;</span><br><span class="line">- (<span class="keyword">void</span>)removeTeachersObject:(Teacher *)value;</span><br><span class="line">- (<span class="keyword">void</span>)addTeachers:(<span class="built_in">NSSet</span> *)values;</span><br><span class="line">- (<span class="keyword">void</span>)removeTeachers:(<span class="built_in">NSSet</span> *)values;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>你会发现多了一个<code>CoreDataGeneratedAccessors</code>类别，这个类别中的方法是Core Data框架根据你在数据模式编辑器中设置的实体关系自动生成的，你不需要实现它们，Core Data会在运行时实现这些方法<br>如果你偏要想看看其实现机理，在右下方的代码片段库中选择“Core Data To-Many Relationship Accessors”并拖拽到代码中  </p>
<p><img src="http://yulingtianxia.com/resources/140353403195.png" alt>  </p>
<p>生成的代码如下：  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)add&lt;#CapitalizedRelationshipName#&gt;Object:(&lt;<span class="meta">#relationship destination class#&gt; *)value</span></span><br><span class="line">&#123;    </span><br><span class="line">    <span class="built_in">NSSet</span> *changedObjects = [<span class="built_in">NSSet</span> setWithObject:value];</span><br><span class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueUnionSetMutation</span> usingObjects:changedObjects];</span><br><span class="line">    [[<span class="keyword">self</span> primitiveValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span>] addObject:value];</span><br><span class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueUnionSetMutation</span> usingObjects:changedObjects];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)remove&lt;#CapitalizedRelationshipName#&gt;Object:(&lt;<span class="meta">#relationship destination class#&gt; *)value</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSSet</span> *changedObjects = [<span class="built_in">NSSet</span> setWithObject:value];</span><br><span class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueMinusSetMutation</span> usingObjects:changedObjects];</span><br><span class="line">    [[<span class="keyword">self</span> primitiveValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span>] removeObject:value];</span><br><span class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueMinusSetMutation</span> usingObjects:changedObjects];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)add&lt;#CapitalizedRelationshipName#&gt;:(<span class="built_in">NSSet</span> *)value</span><br><span class="line">&#123;    </span><br><span class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueUnionSetMutation</span> usingObjects:value];</span><br><span class="line">    [[<span class="keyword">self</span> primitiveValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span>] unionSet:value];</span><br><span class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueUnionSetMutation</span> usingObjects:value];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)remove&lt;#CapitalizedRelationshipName#&gt;:(<span class="built_in">NSSet</span> *)value</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueMinusSetMutation</span> usingObjects:value];</span><br><span class="line">    [[<span class="keyword">self</span> primitiveValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span>] minusSet:value];</span><br><span class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"&lt;#relationshipName#&gt;"</span> withSetMutation:<span class="built_in">NSKeyValueMinusSetMutation</span> usingObjects:value];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要将&lt;#Capitalized relationship name#&gt;, &lt;#Relationship destination class#&gt; 和 &lt;#Relationship name#&gt;替换为我们定义的连接名，对照下前面<code>CoreDataGeneratedAccessors</code>类别中的方法名，你就会明白了  </p>
<p>同样以前标记为<code>@dynamic</code>的属性，其实现原理如下：  </p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="variable">&lt;#propertyObjectType#&gt;</span> *)<span class="variable">&lt;#propertyName#&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="literal">self</span> willAccessValueForKey:@<span class="string">"&lt;#propertyName#&gt;"</span>];</span><br><span class="line">    <span class="variable">&lt;#propertyObjectType#&gt;</span> *value = [<span class="literal">self</span> primitiveValueForKey:@<span class="string">"&lt;#propertyName#&gt;"</span>];</span><br><span class="line">    [<span class="literal">self</span> didAccessValueForKey:@<span class="string">"&lt;#propertyName#&gt;"</span>];</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br><span class="line">            </span><br><span class="line">- (void)<span class="built_in">set</span><span class="variable">&lt;#CapitalizedPropertyName#&gt;</span>:(<span class="variable">&lt;#propertyObjectType#&gt;</span> *)value</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="literal">self</span> willChangeValueForKey:@<span class="string">"&lt;#propertyName#&gt;"</span>];</span><br><span class="line">    [<span class="literal">self</span> <span class="built_in">set</span>PrimitiveValue:value <span class="keyword">for</span>Key:@<span class="string">"&lt;#propertyName#&gt;"</span>];</span><br><span class="line">    [<span class="literal">self</span> didChangeValueForKey:@<span class="string">"&lt;#propertyName#&gt;"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们并不需要知道他们的实现方法是如何被动态生成的，估计是用到了block或者delegate。  </p>
<h2 id="探究Core-Data在SQLite中的实现"><a href="#探究Core-Data在SQLite中的实现" class="headerlink" title="探究Core Data在SQLite中的实现"></a>探究Core Data在SQLite中的实现</h2><p>在上一节中我们创建了<code>Person</code>，<code>Teacher</code>和<code>Student</code>三个Entity和对应的<code>NSManagedObject</code>子类，下面我们需要在代码中对其进行“实战部署”，并观察它们是如何在SQLite数据库中保存的，这样更有利于理解Core Data机制。  </p>
<p>为了简单测试，我直接在MasterViewController.m文件中的<code>insertNewObject:</code>方法中加入测试代码（其实关于测试应该利用好Xcode自带的单元测试工具<a href="http://yulingtianxia.com/blog/2014/04/28/iosdan-yuan-ce-shi-%5Bnil%5Dxctest/">XCTest</a>，我这里为了方便操作，用了以前添加数据的<code>insertNewObject:</code>方法，关于工程初始代码的讲解，请看我之前的一篇<a href="http://yulingtianxia.com/blog/2014/05/01/chu-shi-core-data-1/">教程</a>）  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)insertNewObject:(<span class="keyword">id</span>)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSManagedObjectContext</span> *context = [<span class="keyword">self</span>.fetchedResultsController managedObjectContext];</span><br><span class="line">    <span class="built_in">NSEntityDescription</span> *entity = [[<span class="keyword">self</span>.fetchedResultsController fetchRequest] entity];</span><br><span class="line">    Event *newManagedObject = [<span class="built_in">NSEntityDescription</span> insertNewObjectForEntityForName:[entity name] inManagedObjectContext:context];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// If appropriate, configure the new managed object.</span></span><br><span class="line">    <span class="comment">// Normally you should use accessor methods, but using KVC here avoids the need to add a custom class to the template.</span></span><br><span class="line"><span class="comment">//    [newManagedObject setValue:[NSDate date] forKey:@"timeStamp"];</span></span><br><span class="line">    newManagedObject.timeStamp = [<span class="built_in">NSDate</span> date];</span><br><span class="line">    <span class="comment">//新加的测试代码</span></span><br><span class="line">    Student *aStudent = [<span class="built_in">NSEntityDescription</span> insertNewObjectForEntityForName:<span class="string">@"Student"</span> inManagedObjectContext:context];</span><br><span class="line">    aStudent.name = <span class="string">@"LiLei"</span>;</span><br><span class="line">    aStudent.sex = <span class="string">@"male"</span>;</span><br><span class="line">    aStudent.grade = @<span class="number">1</span>;</span><br><span class="line">    Teacher *aTeacher = [<span class="built_in">NSEntityDescription</span> insertNewObjectForEntityForName:<span class="string">@"Teacher"</span> inManagedObjectContext:context];</span><br><span class="line">    aTeacher.name = <span class="string">@"MissGao"</span>;</span><br><span class="line">    aTeacher.sex = <span class="string">@"female"</span>;</span><br><span class="line">    aTeacher.course = <span class="string">@"English"</span>;</span><br><span class="line">    [aTeacher addStudentsObject:aStudent];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Save the context.</span></span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (![context save:&amp;error]) &#123;</span><br><span class="line">         <span class="comment">// Replace this implementation with code to handle the error appropriately.</span></span><br><span class="line">         <span class="comment">// abort() causes the application to generate a crash log and terminate. You should not use this function in a shipping application, although it may be useful during development. </span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Unresolved error %@, %@"</span>, error, [error userInfo]);</span><br><span class="line">        abort();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们建立了一名叫LiLei的一年级男生和一名叫MissGao的教英语的女教师，并将LiLei同学添加到高老师的学生名单中。  </p>
<p>运行程序，打开MyCDDemo.sqlite文件，查看表结构：  </p>
<p><img src="http://yulingtianxia.com/resources/140353403982.png" alt>  </p>
<p>你会发现虽然Student和Teacher继承Person，但是Person表里面竟然也有grade和course字段</p>
<p>点击程序中的加号来添加一条数据：  </p>
<p><img src="http://yulingtianxia.com/resources/140353403912.png" alt>  </p>
<p>查看ZPERSON，Z_3TEACHERS，Z_PRIMARYKEY表内容：  </p>
<p><img src="http://yulingtianxia.com/resources/140353404264.png" alt>  </p>
<p><img src="http://yulingtianxia.com/resources/140353404745.png" alt>  </p>
<p><img src="http://yulingtianxia.com/resources/140353405697.png" alt>  </p>
<p>这次一目了然了：   </p>
<p>ZPERSON表存储了子类所有字段数据，其Z_ENT字段标志着这条数据的类型，Z_ENT与类型名Z_NAME的映射关系储存在Z_PRIMARYKEY表中，而Z_3TEACHERS存储的则是ZPERSON表中数据项之间的关系，也就是之前我们建立的学生和老师的对应关系，其原理是将ZPERSON表中的Z_PK字段内容两个一组对应起来，这样就相当于把ZPERSON表中两条数据项关联起来了。之前我们在代码中只将LiLei同学添加到了MissGao老师的学生列表中，但是Core Data已经自动维护起了关系，让MissGao也存在于LiLei的老师列表中。Core Data把底层的数据库封装起来，通过简单的操作让程序员更高校的管理数据，所以SQLite这部分我们只是了解下就可以了。  </p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Objective-C/">Objective-C</a><a href="/tags/Core-Data/">Core Data</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yulingtianxia.com/blog/2014/05/02/chu-shi-core-data-2/" data-title="初识Core Data(2) | yulingtianxia&#39;s blog" data-tsina="1680627603" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/blog/2014/05/04/spritekitzuo-biao-xi/" title="SpriteKit坐标系">
  <strong>上一篇：</strong><br/>
  <span>
  SpriteKit坐标系</span>
</a>
</div>


<div class="next">
<a href="/blog/2014/05/02/github-page-build-warning/"  title="GitHub Page build warning">
 <strong>下一篇：</strong><br/> 
 <span>GitHub Page build warning
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义NSManagedObject"><span class="toc-number">1.</span> <span class="toc-text">自定义NSManagedObject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用数据模型设计器"><span class="toc-number">2.</span> <span class="toc-text">使用数据模型设计器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#探究Core-Data在SQLite中的实现"><span class="toc-number">3.</span> <span class="toc-text">探究Core Data在SQLite中的实现</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="yulingtianxia" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://fish.yulingtianxia.com" target="_blank" title="养小鱼的水塘">养小鱼的水塘</a>
            
          </li>
        
    </ul>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/ARC/" style="font-size: 10px;">ARC</a> <a href="/tags/Algorithm/" style="font-size: 12.31px;">Algorithm</a> <a href="/tags/App-Extensions/" style="font-size: 10px;">App Extensions</a> <a href="/tags/AppGroups/" style="font-size: 10px;">AppGroups</a> <a href="/tags/AppleScript/" style="font-size: 10px;">AppleScript</a> <a href="/tags/BlockHook/" style="font-size: 15.38px;">BlockHook</a> <a href="/tags/C/" style="font-size: 10.77px;">C</a> <a href="/tags/CocoaPods/" style="font-size: 10px;">CocoaPods</a> <a href="/tags/Core-Data/" style="font-size: 13.85px;">Core Data</a> <a href="/tags/Dart/" style="font-size: 16.92px;">Dart</a> <a href="/tags/DartNative/" style="font-size: 16.92px;">DartNative</a> <a href="/tags/Flutter/" style="font-size: 16.15px;">Flutter</a> <a href="/tags/GitHub/" style="font-size: 13.08px;">GitHub</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Machine-Leaning/" style="font-size: 11.54px;">Machine Leaning</a> <a href="/tags/Message-Forwarding/" style="font-size: 10.77px;">Message Forwarding</a> <a href="/tags/Messaging/" style="font-size: 10px;">Messaging</a> <a href="/tags/Metal/" style="font-size: 11.54px;">Metal</a> <a href="/tags/NodeJS/" style="font-size: 10.77px;">NodeJS</a> <a href="/tags/Objective-C/" style="font-size: 20px;">Objective-C</a> <a href="/tags/Octopress/" style="font-size: 10px;">Octopress</a> <a href="/tags/RAC/" style="font-size: 10.77px;">RAC</a> <a href="/tags/Reference-Counting/" style="font-size: 10px;">Reference Counting</a> <a href="/tags/Reverse-Engineering/" style="font-size: 10.77px;">Reverse Engineering</a> <a href="/tags/Runtime/" style="font-size: 17.69px;">Runtime</a> <a href="/tags/Social-Framework/" style="font-size: 10px;">Social Framework</a> <a href="/tags/SpriteKit/" style="font-size: 15.38px;">SpriteKit</a> <a href="/tags/Swift/" style="font-size: 18.46px;">Swift</a> <a href="/tags/UIKit-Dynamics/" style="font-size: 10px;">UIKit Dynamics</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/Xcode/" style="font-size: 13.08px;">Xcode</a> <a href="/tags/iCloud/" style="font-size: 10px;">iCloud</a> <a href="/tags/iOS/" style="font-size: 19.23px;">iOS</a> <a href="/tags/macOS/" style="font-size: 15.38px;">macOS</a> <a href="/tags/字体/" style="font-size: 10px;">字体</a> <a href="/tags/开发者大会/" style="font-size: 10px;">开发者大会</a> <a href="/tags/本地化/" style="font-size: 10px;">本地化</a> <a href="/tags/瞎折腾/" style="font-size: 11.54px;">瞎折腾</a> <a href="/tags/碰撞检测/" style="font-size: 10px;">碰撞检测</a> <a href="/tags/翻译/" style="font-size: 14.62px;">翻译</a> <a href="/tags/设计模式/" style="font-size: 13.08px;">设计模式</a> <a href="/tags/转载/" style="font-size: 10px;">转载</a>
    </div>
  </div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1680627603&verifier=c09974f5&dpc=1"></iframe>
</div>


  

<div class="doubanshow">
<p class="asidetitle">豆瓣秀</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/53279288/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Stay hungry, stay foolish <br/>
			Talk is cheap, show me the code.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1680627603" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yulingtianxia" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/2374982" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/yulingtianxia" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/yulingtianxia" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/yulingtianxia" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/53279288" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/yulingtianxia" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/106642427004837273341?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:yulingtianxia@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-nc-nd/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-nc-nd.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="杨萧玉">杨萧玉</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'yulingtianxia';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49704553-1', 'auto');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b5cb508df15ee6247a8c32c64eadb075";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
