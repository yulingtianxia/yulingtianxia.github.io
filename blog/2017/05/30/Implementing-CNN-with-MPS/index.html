
 <!DOCTYPE HTML>
<html lang="zh-CN,en,default">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Implementing CNN with MPS | yulingtianxia&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="æ¨è§ç‰">
    

    
    <meta name="description" content="æœ€è¿‘ä¸€ä¸ªæœˆä»é›¶å¼€å§‹è‡ªå­¦äº†ä¸‹æœ‰å…³ iOS ä¸Šçš„æœºå™¨å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œäº²èº«å®è·µäº†ä»æ•°æ®é‡‡é›†åˆ°è®­ç»ƒæ¨¡å‹å†åˆ°ç§»åŠ¨ç«¯é¢„æµ‹çš„æµç¨‹ã€‚ç†è®ºçŸ¥è¯†å­¦ä¹ è·¯å¾„ä¸ºï¼šæœºå™¨å­¦ä¹ -&amp;gt;æ·±åº¦å­¦ä¹ -&amp;gt;è¿ç§»å­¦ä¹ ï¼›å®è·µæ¡†æ¶å­¦ä¹ è·¯å¾„ä¸ºï¼šTensorFlow-&amp;gt;Keras-&amp;gt;MPS(iOS 10)ã€‚æœ€ç»ˆå®Œæˆä¸€ä¸ªç®€å•çš„æ‰‹åŠ¿å›¾åƒäº”åˆ†ç±»é—®é¢˜ï¼Œå¹¶é¢„æµ‹ iOS æ‘„åƒå¤´é‡‡é›†çš„å›¾ç‰‡ã€‚æœ€ç»ˆç»“æœï¼Œè®­ç»ƒé›†å‡†ç¡®ç‡ 96.26%ï¼Œäº¤å‰éªŒè¯é›†å‡†ç¡®ç‡">
<meta name="keywords" content="iOS,Machine Leaning,Metal">
<meta property="og:type" content="article">
<meta property="og:title" content="Implementing CNN with MPS">
<meta property="og:url" content="http://yulingtianxia.com/blog/2017/05/30/Implementing-CNN-with-MPS/index.html">
<meta property="og:site_name" content="yulingtianxia&#39;s blog">
<meta property="og:description" content="æœ€è¿‘ä¸€ä¸ªæœˆä»é›¶å¼€å§‹è‡ªå­¦äº†ä¸‹æœ‰å…³ iOS ä¸Šçš„æœºå™¨å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œäº²èº«å®è·µäº†ä»æ•°æ®é‡‡é›†åˆ°è®­ç»ƒæ¨¡å‹å†åˆ°ç§»åŠ¨ç«¯é¢„æµ‹çš„æµç¨‹ã€‚ç†è®ºçŸ¥è¯†å­¦ä¹ è·¯å¾„ä¸ºï¼šæœºå™¨å­¦ä¹ -&amp;gt;æ·±åº¦å­¦ä¹ -&amp;gt;è¿ç§»å­¦ä¹ ï¼›å®è·µæ¡†æ¶å­¦ä¹ è·¯å¾„ä¸ºï¼šTensorFlow-&amp;gt;Keras-&amp;gt;MPS(iOS 10)ã€‚æœ€ç»ˆå®Œæˆä¸€ä¸ªç®€å•çš„æ‰‹åŠ¿å›¾åƒäº”åˆ†ç±»é—®é¢˜ï¼Œå¹¶é¢„æµ‹ iOS æ‘„åƒå¤´é‡‡é›†çš„å›¾ç‰‡ã€‚æœ€ç»ˆç»“æœï¼Œè®­ç»ƒé›†å‡†ç¡®ç‡ 96.26%ï¼Œäº¤å‰éªŒè¯é›†å‡†ç¡®ç‡">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw1024/642c5793ly1ff5ornniluj21kw0u3tn2.jpg">
<meta property="og:image" content="http://yulingtianxia.com/resources/MachineLearning/training_data.png">
<meta property="og:image" content="http://yulingtianxia.com/resources/MachineLearning/AnimatedFileQueues.gif">
<meta property="og:image" content="http://yulingtianxia.com/resources/MachineLearning/HDFView.jpg">
<meta property="og:image" content="https://github.com/shu223/iOS-10-Sampler/blob/master/README_resources/imagerecog.gif?raw=true">
<meta property="og:image" content="https://docs-assets.developer.apple.com/published/48ad0af3fd/b6d1d091-162c-418d-bc2e-0b6f3105c126.png">
<meta property="og:updated_time" content="2019-05-26T10:08:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Implementing CNN with MPS">
<meta name="twitter:description" content="æœ€è¿‘ä¸€ä¸ªæœˆä»é›¶å¼€å§‹è‡ªå­¦äº†ä¸‹æœ‰å…³ iOS ä¸Šçš„æœºå™¨å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œäº²èº«å®è·µäº†ä»æ•°æ®é‡‡é›†åˆ°è®­ç»ƒæ¨¡å‹å†åˆ°ç§»åŠ¨ç«¯é¢„æµ‹çš„æµç¨‹ã€‚ç†è®ºçŸ¥è¯†å­¦ä¹ è·¯å¾„ä¸ºï¼šæœºå™¨å­¦ä¹ -&amp;gt;æ·±åº¦å­¦ä¹ -&amp;gt;è¿ç§»å­¦ä¹ ï¼›å®è·µæ¡†æ¶å­¦ä¹ è·¯å¾„ä¸ºï¼šTensorFlow-&amp;gt;Keras-&amp;gt;MPS(iOS 10)ã€‚æœ€ç»ˆå®Œæˆä¸€ä¸ªç®€å•çš„æ‰‹åŠ¿å›¾åƒäº”åˆ†ç±»é—®é¢˜ï¼Œå¹¶é¢„æµ‹ iOS æ‘„åƒå¤´é‡‡é›†çš„å›¾ç‰‡ã€‚æœ€ç»ˆç»“æœï¼Œè®­ç»ƒé›†å‡†ç¡®ç‡ 96.26%ï¼Œäº¤å‰éªŒè¯é›†å‡†ç¡®ç‡">
<meta name="twitter:image" content="http://wx3.sinaimg.cn/mw1024/642c5793ly1ff5ornniluj21kw0u3tn2.jpg">
<meta name="twitter:creator" content="@yulingtianxia">
<link rel="publisher" href="106642427004837273341">

    
    <link rel="alternative" href="/atom.xml" title="yulingtianxia&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.png">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="yulingtianxia&#39;s blog" title="yulingtianxia&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="yulingtianxia&#39;s blog">yulingtianxia&#39;s blog</a></h1>
				<h2 class="blog-motto">ç‰ä»¤å¤©ä¸‹çš„åšå®¢</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/tags">Tags</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Google" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2017/05/30/Implementing-CNN-with-MPS/" title="Implementing CNN with MPS" itemprop="url">Implementing CNN with MPS</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/106642427004837273341?rel=author" title="æ¨è§ç‰" target="_blank" itemprop="author">æ¨è§ç‰</a>
		
  <p class="article-time">
    <time datetime="2017-05-30T09:20:32.000Z" itemprop="datePublished"> å‘è¡¨äº 2017-05-30</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">æ–‡ç« ç›®å½•</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ç†è®ºåŸºç¡€"><span class="toc-number">1.</span> <span class="toc-text">ç†è®ºåŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹"><span class="toc-number">1.1.</span> <span class="toc-text">å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹"><span class="toc-number">1.2.</span> <span class="toc-text">å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¿ç§»å­¦ä¹ "><span class="toc-number">1.3.</span> <span class="toc-text">è¿ç§»å­¦ä¹ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ¡†æ¶é€‰æ‹©"><span class="toc-number">2.</span> <span class="toc-text">æ¡†æ¶é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ•°æ®é‡‡é›†"><span class="toc-number">3.</span> <span class="toc-text">æ•°æ®é‡‡é›†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inception-V3-pre-trained-network"><span class="toc-number">4.</span> <span class="toc-text">Inception V3 pre-trained network</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bottleneck-features"><span class="toc-number">4.1.</span> <span class="toc-text">bottleneck features</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fine-tuning"><span class="toc-number">4.2.</span> <span class="toc-text">Fine-tuning</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Convert-HDF5-to-binary-dat-files"><span class="toc-number">5.</span> <span class="toc-text">Convert HDF5 to binary .dat files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Metal-Performance-Shaders"><span class="toc-number">6.</span> <span class="toc-text">Metal Performance Shaders</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MPS-ç®€ä»‹"><span class="toc-number">6.1.</span> <span class="toc-text">MPS ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-MPS-æ„å»ºç½‘ç»œå¹¶é¢„æµ‹"><span class="toc-number">6.2.</span> <span class="toc-text">ä½¿ç”¨ MPS æ„å»ºç½‘ç»œå¹¶é¢„æµ‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">7.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">8.</span> <span class="toc-text">Reference</span></a></li></ol>
		
		</div>
		
		<p>æœ€è¿‘ä¸€ä¸ªæœˆä»é›¶å¼€å§‹è‡ªå­¦äº†ä¸‹æœ‰å…³ iOS ä¸Šçš„æœºå™¨å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œäº²èº«å®è·µäº†ä»æ•°æ®é‡‡é›†åˆ°è®­ç»ƒæ¨¡å‹å†åˆ°ç§»åŠ¨ç«¯é¢„æµ‹çš„æµç¨‹ã€‚ç†è®ºçŸ¥è¯†å­¦ä¹ è·¯å¾„ä¸ºï¼š<strong>æœºå™¨å­¦ä¹ -&gt;æ·±åº¦å­¦ä¹ -&gt;è¿ç§»å­¦ä¹ </strong>ï¼›å®è·µæ¡†æ¶å­¦ä¹ è·¯å¾„ä¸ºï¼š<strong>TensorFlow-&gt;Keras-&gt;MPS(iOS 10)</strong>ã€‚æœ€ç»ˆå®Œæˆä¸€ä¸ªç®€å•çš„æ‰‹åŠ¿å›¾åƒäº”åˆ†ç±»é—®é¢˜ï¼Œå¹¶é¢„æµ‹ iOS æ‘„åƒå¤´é‡‡é›†çš„å›¾ç‰‡ã€‚æœ€ç»ˆç»“æœï¼Œè®­ç»ƒé›†å‡†ç¡®ç‡ 96.26%ï¼Œäº¤å‰éªŒè¯é›†å‡†ç¡®ç‡ 73.86%ã€‚</p>
<a id="more"></a>

<h2 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h2><p>è™½ç„¶ç»“æœå¯¼å‘å¾ˆé‡è¦ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æƒ³ä»åŸºç¡€å­¦èµ·ï¼Œè€Œä¸æ˜¯å»æ€¥äºå»ç½‘ä¸Šæ‰¾ç°æˆçš„è§£å†³æ–¹æ¡ˆæ¥è°ƒå‚ã€‚æ¯•ç«Ÿæˆ‘çš„ç›®çš„æ˜¯æ‹“å®½çŸ¥è¯†é¢ï¼Œå¼€æ–°çš„æŠ€èƒ½æ ‘ã€‚</p>
<p>ç¬¬ä¸€å‘¨ä»é›¶å¼€å§‹å­¦ä¹ äº† Coursera ä¸Š Stanford Ng æ•™æˆçš„ <a href="https://www.coursera.org/learn/machine-learning/home" target="_blank" rel="noopener">Machine Learning</a> ç»å…¸è¯¾ç¨‹ï¼Œç”¨ Matlab ç¼–å†™äº†ä¸€äº› Demoï¼Œç”¨ä¸€å‘¨æ—¶é—´å®Œæˆäº†åŸæœ¬éœ€è¦ 11 å‘¨æ—¶é—´çš„æ‰€æœ‰è¯¾ç¨‹å’Œè€ƒè¯•ï¼Œå¯¹æœºå™¨å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†æœ‰äº†æŒæ¡ã€‚</p>
<p><img src="http://wx3.sinaimg.cn/mw1024/642c5793ly1ff5ornniluj21kw0u3tn2.jpg" alt></p>
<p>æœºå™¨å­¦ä¹ å¤§ä½“å¯ä»¥åˆ†ä¸ºæœ‰ç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ ã€‚å¸¦æ ‡ç­¾æ•°æ®çš„æœ‰ç›‘ç£å­¦ä¹ åŒ…å«ä»æœ€ç®€å•çš„çº¿æ€§å›å½’åˆ°é€»è¾‘å›å½’ï¼Œå†åˆ°ç¥ç»ç½‘ç»œå’Œ SVMï¼ˆæ”¯æŒå‘é‡æœºï¼‰ã€‚æ— ç›‘ç£å­¦ä¹ åŒ…å«å¤§å­¦ç«–ç›´çš„ K-means èšç±»ï¼ŒPCA(Principal Components Analysis) é™ç»´ã€‚ä»¥åŠå¸¦æ ‡ç­¾æ•°æ®çš„å¼‚å¸¸æ£€æµ‹ç®—æ³•ã€‚ä¸ºäº†ç¡®ä¿æœºå™¨å­¦ä¹ çš„æ•ˆæœï¼Œéœ€è¦é€šè¿‡çœ‹æ‡‚å­¦ä¹ æ›²çº¿å†³å®šä¸‹ä¸€æ­¥çš„å·¥ä½œï¼Œæ˜¯è§£å†³ overfit è¿˜æ˜¯ underfitã€‚ä½¿ç”¨äº¤å‰éªŒè¯é›†å’Œæµ‹è¯•é›†è¯„ä¼°æ¨¡å‹æ—¶ï¼Œå¦‚ä½•å¹³è¡¡å‡†ç¡®ç‡å’Œå¬å›ç‡ï¼Œæ¯”å¦‚ F1 Score æŒ‡æ ‡ã€‚åœ¨æ•°æ®é¢„å¤„ç†ä¸Šè¦äº†è§£ä¸€äº›æ•°æ®å½’ä¸€åŒ–æ ‡å‡†åŒ–çš„æ–¹æ³•ã€‚</p>
<p>å…‰æŒæ¡æœºå™¨å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†æ˜¾ç„¶ä¸å¤Ÿï¼Œå¤§è€Œå…¨ä¸å¦‚ä¸“è€Œç²¾ã€‚æ·±åº¦å­¦ä¹ åœ¨å›¾åƒè¯†åˆ«é¢†åŸŸå¤§æ”¾å¼‚å½©ï¼Œå…¶å®æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œè€Œæ·±åº¦å­¦ä¹ é¢†åŸŸæœ€è¿‘åœ¨å›¾åƒè¯†åˆ«ä¸Šåº”ç”¨æœ€ç«çš„å¯èƒ½å°±æ˜¯ CNN äº†ã€‚æ‰€ä»¥åœ¨ç‹‚å­¦æ·±åº¦å­¦ä¹ çš„æ—¶å€™é‡ç‚¹ç ”ç©¶äº†ä¸‹ CNNã€‚</p>
<h3 id="å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹"><a href="#å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹"></a>å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹</h3><p>å…¨è¿æ¥ç½‘ç»œæƒé‡è¿‡å¤šï¼Œè€Œå·ç§¯ç¥ç»ç½‘ç»œå¯ä»¥å®ç°æƒå€¼å…±äº«ï¼Œå¼•å…¥äº†æ·±åº¦ï¼Œæ•°æ®ä¸º 3D çš„ã€‚æ¨èæŸ¥çœ‹ Stanford çš„ <a href="http://cs231n.github.io/convolutional-networks/" target="_blank" rel="noopener">Convolutional Neural Networks (CNNs / ConvNets)</a>ï¼Œä¸­æ–‡ç¿»è¯‘ï¼š<a href="https://zhuanlan.zhihu.com/p/22038289" target="_blank" rel="noopener">CS231nè¯¾ç¨‹ç¬”è®°ç¿»è¯‘ï¼šå·ç§¯ç¥ç»ç½‘ç»œç¬”è®°</a>ã€‚</p>
<p>å·ç§¯æ ¸ä¸€èˆ¬ä¸ºå¥‡æ•°ï¼Œå¸¸ç”¨çš„éƒ½æ˜¯å°å·ç§¯æ ¸ï¼Œæ¯”å¦‚ 1x1,3x3,5x5ã€‚<a href="https://zh.wikipedia.org/wiki/å·ç§¯" target="_blank" rel="noopener">å·ç§¯</a>æ˜¯ä¸€ç§æ•°å­¦è¿ç®—ï¼Œå·ç§¯æ ¸åœ¨æ‰«ææ•°æ®çš„æ—¶å€™ï¼Œæ­£å¥½åšçš„å°±æ˜¯å·ç§¯è¿ç®—ã€‚å·ç§¯æ ¸å…¶å®å°±æ˜¯ä¸ªæ»¤æ³¢å™¨ï¼Œé€šè¿‡å¹³ç§»ç‚¹ç§¯è¿ç®—å¤„ç†æ•°æ®ã€‚ä¸€ä¸ªå·ç§¯å±‚å¯ä»¥æœ‰å¤šä¸ªå·ç§¯æ ¸ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ç§æ»¤æ³¢å™¨æ‰€ã€æ„Ÿå—ã€çš„å†…å®¹ä¸åŒï¼Œç»“æœä¹Ÿå¾ˆæœ‰æ„æ€ã€‚å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://blog.keras.io/how-convolutional-neural-networks-see-the-world.html" target="_blank" rel="noopener">How convolutional neural networks see the world</a>ã€‚</p>
<p>CNN ä¸­ä¸ä»…æœ‰ Convolutionï¼Œè¿˜æœ‰ Poolingï¼ŒActivationï¼ŒFully Connectedç­‰å±‚çº§ã€‚</p>
<p>Pooling å°±æ˜¯ downsamplingï¼Œå‡å°æ•°æ®å°ºå¯¸ï¼Œå¸¸ç”¨çš„æœ‰æœ‰ maxï¼Œaverage ç­‰è¿ç®—ã€‚<br>Activation å°±æ˜¯æ¿€æ´»å‡½æ•°ï¼Œå¸¸ç”¨çš„æœ‰ sigmoidï¼ŒReLU ç­‰ã€‚<br>Fully Connected ä¹Ÿå« Denseï¼Œå› ä¸ºå…¨è¿æ¥æƒé‡å¯†åº¦å¾ˆå¤§ã€‚å…¶å®å°±æ˜¯ä¸ªå·ç§¯æ ¸å®½é«˜ç­‰äºè¾“å…¥æ•°æ®å®½é«˜çš„ç‰¹æ®Šå·ç§¯å±‚ã€‚å·ç§¯å±‚å’Œå…¨è¿æ¥å±‚å¯ä»¥ç­‰æ•ˆè½¬æ¢ã€‚</p>
<p>å¦‚æœå·ç§¯æ ¸å°ºå¯¸ä¸æ˜¯ 1x1ï¼Œæˆ–å¹³ç§»çš„æ­¥é•¿ä¸æ˜¯ 1x1ï¼Œé‚£ä¹ˆå·ç§¯è¿ç®—åçš„ç»“æœè‚¯å®šæ¯”åŸå°ºå¯¸è¦å°ï¼Œæ‰€ä»¥padding è§„åˆ™å°±å¾ˆé‡è¦ã€‚ä¸€èˆ¬å¸¸ç”¨çš„ã€Sameã€è§„åˆ™å°±æ˜¯åœ¨æ•°æ®å‘¨å›´å¡«å……ä¸€äº› 0ï¼Œä½¿å¾—å·ç§¯è¿ç®—åçš„æ•°æ®å®½å’Œé«˜è·Ÿè¾“å…¥æ•°æ®ä¸€æ ·ã€‚</p>
<h3 id="å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹"><a href="#å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹" class="headerlink" title="å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹"></a>å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹</h3><p>å›¾ç‰‡åˆ†ç±»ä½¿ç”¨å·²ç»æ‰“å¥½æ ‡ç­¾çš„æ•°æ®åº“æ¥è¿›è¡Œæœ‰ç›‘ç£å­¦ä¹ ï¼Œ</p>
<table>
<thead>
<tr>
<th align="center">Dataset</th>
<th align="center">Training Set Size</th>
<th align="center">Testing Set Size</th>
<th align="center">Number of Classes</th>
<th align="center">Comments</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="https://www.cs.toronto.edu/~kriz/cifar.html" target="_blank" rel="noopener">Cifar10</a></td>
<td align="center">60k</td>
<td align="center">10k</td>
<td align="center">10</td>
<td align="center">32x32 color</td>
</tr>
<tr>
<td align="center"><a href="http://yann.lecun.com/exdb/mnist/" target="_blank" rel="noopener">MNIST</a></td>
<td align="center">60k</td>
<td align="center">10k</td>
<td align="center">10</td>
<td align="center">28x28 gray</td>
</tr>
<tr>
<td align="center"><a href="http://www.image-net.org/challenges/LSVRC/2012/" target="_blank" rel="noopener">ImageNet</a></td>
<td align="center">1.2M</td>
<td align="center">50k</td>
<td align="center">1000</td>
<td align="center">Various sizes</td>
</tr>
</tbody></table>
<p><a href="http://yann.lecun.com/exdb/mnist/" target="_blank" rel="noopener">MNIST</a> ç®—æ˜¯æ·±åº¦å­¦ä¹ é¢†åŸŸçš„ HelloWorld äº†ã€‚</p>
<p><a href="https://www.cs.toronto.edu/%7Ekriz/cifar.html" target="_blank" rel="noopener">CIFAR</a> å°å°ºå¯¸å›¾ç‰‡æ•°æ®åº“ï¼ŒåŒ…å« CIFAR10 å’Œ CIFAR100ã€‚</p>
<p>åœ¨å›¾åƒè¯†åˆ«é¢†åŸŸï¼Œ<a href="http://image-net.org" target="_blank" rel="noopener">ImageNet</a> æ˜¯éå¸¸æœ‰åçš„æ•°æ®åº“ï¼Œå†å¹´æŒ‘æˆ˜ä¸­éƒ½æœ‰æ–°çš„æ›´å¤æ‚çš„ç¥ç»ç½‘ç»œè·‘å‡ºæ›´å¥½çš„ç»“æœã€‚ä¸‹é¢çš„è¡¨æ˜¯ä¸€äº›ç½‘ç»œæ¨¡å‹åœ¨ <a href="http://image-net.org" target="_blank" rel="noopener">ImageNet</a> Challenge ä¸­çš„å‡†ç¡®ç‡ä»¥åŠ TF-Slim æºç å’Œ checkpoint æ–‡ä»¶ï¼Œæ•°æ®æ¥æºï¼š<a href="https://github.com/tensorflow/models/tree/master/slim" target="_blank" rel="noopener">TensorFlow-Slim image classification library</a></p>
<table>
<thead>
<tr>
<th align="center">Model</th>
<th align="center">TF-Slim File</th>
<th align="center">Checkpoint</th>
<th align="center">Top-1 Accuracy</th>
<th align="center">Top-5 Accuracy</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="http://arxiv.org/abs/1409.4842v1" target="_blank" rel="noopener">Inception V1</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/inception_v1.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/inception_v1_2016_08_28.tar.gz" target="_blank" rel="noopener">inception_v1_2016_08_28.tar.gz</a></td>
<td align="center">69.8</td>
<td align="center">89.6</td>
</tr>
<tr>
<td align="center"><a href="http://arxiv.org/abs/1502.03167" target="_blank" rel="noopener">Inception V2</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/inception_v2.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/inception_v2_2016_08_28.tar.gz" target="_blank" rel="noopener">inception_v2_2016_08_28.tar.gz</a></td>
<td align="center">73.9</td>
<td align="center">91.8</td>
</tr>
<tr>
<td align="center"><a href="http://arxiv.org/abs/1512.00567" target="_blank" rel="noopener">Inception V3</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/inception_v3.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/inception_v3_2016_08_28.tar.gz" target="_blank" rel="noopener">inception_v3_2016_08_28.tar.gz</a></td>
<td align="center">78.0</td>
<td align="center">93.9</td>
</tr>
<tr>
<td align="center"><a href="http://arxiv.org/abs/1602.07261" target="_blank" rel="noopener">Inception V4</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/inception_v4.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/inception_v4_2016_09_09.tar.gz" target="_blank" rel="noopener">inception_v4_2016_09_09.tar.gz</a></td>
<td align="center">80.2</td>
<td align="center">95.2</td>
</tr>
<tr>
<td align="center"><a href="http://arxiv.org/abs/1602.07261" target="_blank" rel="noopener">Inception-ResNet-v2</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/inception_resnet_v2.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/inception_resnet_v2_2016_08_30.tar.gz" target="_blank" rel="noopener">inception_resnet_v2.tar.gz</a></td>
<td align="center">80.4</td>
<td align="center">95.3</td>
</tr>
<tr>
<td align="center"><a href="https://arxiv.org/abs/1512.03385" target="_blank" rel="noopener">ResNet V1 50</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/resnet_v1.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/resnet_v1_50_2016_08_28.tar.gz" target="_blank" rel="noopener">resnet_v1_50.tar.gz</a></td>
<td align="center">75.2</td>
<td align="center">92.2</td>
</tr>
<tr>
<td align="center"><a href="https://arxiv.org/abs/1512.03385" target="_blank" rel="noopener">ResNet V1 101</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/resnet_v1.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/resnet_v1_101_2016_08_28.tar.gz" target="_blank" rel="noopener">resnet_v1_101.tar.gz</a></td>
<td align="center">76.4</td>
<td align="center">92.9</td>
</tr>
<tr>
<td align="center"><a href="https://arxiv.org/abs/1512.03385" target="_blank" rel="noopener">ResNet V1 152</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/resnet_v1.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/resnet_v1_152_2016_08_28.tar.gz" target="_blank" rel="noopener">resnet_v1_152.tar.gz</a></td>
<td align="center">76.8</td>
<td align="center">93.2</td>
</tr>
<tr>
<td align="center"><a href="https://arxiv.org/abs/1603.05027" target="_blank" rel="noopener">ResNet V2 50</a>^</td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/resnet_v2.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/resnet_v2_50_2017_04_14.tar.gz" target="_blank" rel="noopener">resnet_v2_50.tar.gz</a></td>
<td align="center">75.6</td>
<td align="center">92.8</td>
</tr>
<tr>
<td align="center"><a href="https://arxiv.org/abs/1603.05027" target="_blank" rel="noopener">ResNet V2 101</a>^</td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/resnet_v2.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/resnet_v2_101_2017_04_14.tar.gz" target="_blank" rel="noopener">resnet_v2_101.tar.gz</a></td>
<td align="center">77.0</td>
<td align="center">93.7</td>
</tr>
<tr>
<td align="center"><a href="https://arxiv.org/abs/1603.05027" target="_blank" rel="noopener">ResNet V2 152</a>^</td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/resnet_v2.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/resnet_v2_152_2017_04_14.tar.gz" target="_blank" rel="noopener">resnet_v2_152.tar.gz</a></td>
<td align="center">77.8</td>
<td align="center">94.1</td>
</tr>
<tr>
<td align="center"><a href="http://arxiv.org/abs/1409.1556.pdf" target="_blank" rel="noopener">VGG 16</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/vgg.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/vgg_16_2016_08_28.tar.gz" target="_blank" rel="noopener">vgg_16.tar.gz</a></td>
<td align="center">71.5</td>
<td align="center">89.8</td>
</tr>
<tr>
<td align="center"><a href="http://arxiv.org/abs/1409.1556.pdf" target="_blank" rel="noopener">VGG 19</a></td>
<td align="center"><a href="https://github.com/tensorflow/models/blob/master/slim/nets/vgg.py" target="_blank" rel="noopener">Code</a></td>
<td align="center"><a href="http://download.tensorflow.org/models/vgg_19_2016_08_28.tar.gz" target="_blank" rel="noopener">vgg_19.tar.gz</a></td>
<td align="center">71.1</td>
<td align="center">89.8</td>
</tr>
</tbody></table>
<p>æ¨èä¸€ä¸ªè¿˜ç®—ä¸é”™çš„æœºå™¨å­¦ä¹ çš„æ•°æ®ç½‘ç«™ï¼š<a href="https://www.kaggle.com" target="_blank" rel="noopener">kaggle</a></p>
<h3 id="è¿ç§»å­¦ä¹ "><a href="#è¿ç§»å­¦ä¹ " class="headerlink" title="è¿ç§»å­¦ä¹ "></a>è¿ç§»å­¦ä¹ </h3><p>ä»å¤´å¼€å§‹è®­ç»ƒä¸€ä¸ªå¤æ‚çš„ç½‘ç»œæ˜¯å¾ˆè´¹æ—¶è´¹åŠ›çš„ï¼Œéœ€è¦è·å–ç¬¦åˆç›®æ ‡çš„æµ·é‡çœŸå®æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ€§èƒ½æå¼ºçš„é›†ç¾¤æ¥è®­ç»ƒæ•°æ®ï¼Œå¹¶æœ‰è¶³å¤Ÿçš„è€å¿ƒç­‰å¾…è®­ç»ƒç»“æœã€‚ç¨æœ‰ä¸æ…ï¼Œè¿˜éœ€è¦ä¸æ–­è°ƒå‚ï¼Œé‡æ–°å†æ¥ã€‚è¿™æ˜¯ä¸ªæ¯ç‡¥ä¹å‘³çš„ä½“åŠ›æ´»ï¼Œå¹¶ä¸”æ˜¯åœ¨æœ‰ç¡¬ä»¶ç»æµå®åŠ›çš„åŸºç¡€ä¸Šæ‰åŠå¾—åˆ°çš„ã€‚æ€»ä¼šçœ‹åˆ°ä¸€äº›è®ºæ–‡é‡Œæè¿°è‡ªå·±çš„æ¨¡å‹ç”¨ Tesla KXX è·‘äº†å¤šä¹…æ‰è®­ç»ƒå‡ºäº†ç»“æœï¼Œå…¶å®åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸï¼ŒèŠ±è´¹åŠå¹´ç”šè‡³æ›´ä¹…çš„æ—¶é—´æ¥è°ƒå‚ä¼˜åŒ–æ¨¡å‹æ˜¯å¾ˆæ­£å¸¸çš„ã€‚</p>
<p>æ‰€ä»¥åŸºäºå·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°æ¥è¿›è¡Œ fine-tuning ååº”ç”¨åˆ°æ–°çš„æ¨¡å‹ä¸Šæ˜¯ä¸€ä¸ªçœæ—¶çœåŠ›çš„æ–¹æ¡ˆï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºè¿ç§»å­¦ä¹ ã€‚å¤§éƒ¨åˆ†æ•°æ®æ˜¯å­˜åœ¨ç›¸å…³æ€§çš„ï¼Œåœ¨å›¾ç‰‡åˆ†ç±»é—®é¢˜ä¸­ï¼Œå³ä¾¿ç°æœ‰æ¨¡å‹ä¸åŒ…å«æˆ‘ä»¬æƒ³è¦çš„åˆ†ç±»ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å·²ç»è®­ç»ƒå¥½çš„æƒé‡æ¥è¿›è¡Œ fine-tuningï¼Œä½¿å…¶å¯¹æ–°çš„ç±»åˆ«è¿›è¡Œåˆ†ç±»ã€‚</p>
<p>ä¸€èˆ¬çš„åšæ³•æ˜¯å°†å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡åŠ è½½ï¼Œé™¤å» top éƒ¨åˆ†ï¼ˆå…¨è¿æ¥å±‚å’Œ softmax åˆ†ç±»å™¨ç­‰ï¼‰ï¼Œå†»ç»“å‰é¢å±‚çº§çš„æƒé‡ï¼Œåªä¿ç•™æƒ³è¦ fine-tuning çš„å±‚çº§ï¼ˆä¸€èˆ¬æ˜¯åé¢çš„å·ç§¯å±‚ï¼‰ï¼Œæœ€åæ ¹æ®åˆ†ç±»ä¸ªæ•°è‡ªå·±æ·»åŠ å…¨è¿æ¥å±‚ã€‚è®­ç»ƒæ—¶åªæœ‰åé¢çš„å±‚çº§æƒé‡æ‰ä¼šè¢«ä¿®æ”¹ï¼Œå‰é¢å·²ç»è®­ç»ƒå¥½çš„æƒé‡ä¸ä¼šæ”¹å˜ã€‚è¿™æ ·ä¼šå¾ˆå¿«å°†æ­£ç¡®ç‡æé«˜åˆ° 90% ä»¥ä¸Šã€‚</p>
<p>è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š(<a href="https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html" target="_blank" rel="noopener">https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html</a>)</p>
<h2 id="æ¡†æ¶é€‰æ‹©"><a href="#æ¡†æ¶é€‰æ‹©" class="headerlink" title="æ¡†æ¶é€‰æ‹©"></a>æ¡†æ¶é€‰æ‹©</h2><p>æœ‰ä¸€äº›çŸ¥åçš„æ¡†æ¶å¯ä¾›é€‰æ‹©ï¼šTensorFlow, Torch, Caffee, Theano, Kerasâ€¦</p>
<p>ä¸åŒæ¡†æ¶æ‰€ä½¿ç”¨çš„æ•°æ®æ ¼å¼ä¸ä¸€æ ·ï¼Œä¸»è¦åŒºåˆ«åœ¨äº Channel  é€šé“çš„ä½ç½®æ˜¯åœ¨æœ€å‰è¿˜æ˜¯æœ€åã€‚æ¡†æ¶ä¹‹é—´çš„å­¦ä¹ æˆæœ¬éƒ½ä¸ä¸€æ ·ï¼Œå•æ‹¿ TensorFlow æ¥è¯´ï¼Œå…¶æœ€åŸºç¡€çš„è¯­æ³•éœ€è¦ä¸€ç‚¹ç‚¹æ„å»ºä¸€å¼ å›¾ï¼Œè€Œå…¶ <code>tf.contrib.learn</code> å’Œ <code>tf.contrib.layers</code> API æ˜¯æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œè¿˜æœ‰ TF-Slim è¿™ç§æ›´è½»é‡çº§çš„é«˜çº§å°è£…ï¼Œå‡ è¡Œä»£ç å°±èƒ½å¹²å¥½å¤šäº‹ï¼Œçœ‹èµ·æ¥æ›´å±Œã€‚ä½†å…¶å®ç›®å‰ç”±äº TensorFlow çš„å¿«é€Ÿè¿­ä»£ï¼Œå¯¼è‡´ä¸èƒ½å‘ä¸‹å…¼å®¹ï¼Œè€ä»£ç è¿è¡Œä¸èµ·æ¥ã€‚å•æ‹¿ TF-Slim æ¥è¯´ï¼Œå®˜ç½‘ API æ–‡æ¡£ç¼ºå¤±ï¼ŒGithub çš„æ•™ç¨‹ä»£ç è€æ—§æ— æ³•è¿è¡Œï¼Œè¿˜åœ¨ä½¿ç”¨ä» model åº“ merge åˆ° tensorflow ä¹‹å‰çš„è¯­æ³•ã€‚æˆ‘å½“æ—¶æœ¬æƒ³ç”¨ TF-Slim å¿«é€ŸéªŒè¯ä¸€äº›æ¨¡å‹ï¼Œç»“æœæ²¡æƒ³åˆ°åè€Œæµªè´¹äº†å¤§é‡æ—¶é—´ï¼Œå¾—ä¸å¿å¤±ã€‚</p>
<p>Keras åŸºäº TensorFlow æˆ– Theanoï¼Œé›†æˆäº†å¤§é‡åŠŸèƒ½ï¼Œæ˜¯ä¸€ç§æ–¹ä¾¿å¿«é€ŸéªŒè¯ idea çš„é«˜å±‚ APIã€‚ å†…ç½®å¤§é‡å¸¸ç”¨ç½‘ç»œï¼Œå¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œè¯­æ³•ç®€æ´ï¼ŒåŠŸèƒ½å¼ºå¤§åˆä¸å¤±å¯å®šåˆ¶æ€§ã€‚å¼ºåŠ›æ¨èï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://keras.io" target="_blank" rel="noopener">Keras Documentation</a>ï¼Œä¸­æ–‡æ–‡æ¡£ï¼š<a href="http://keras-cn.readthedocs.io/en/latest/" target="_blank" rel="noopener">Keras ä¸­æ–‡æ–‡æ¡£</a></p>
<p>æ— è®ºæ˜¯å“ªç§æ¡†æ¶ï¼Œå‡ ä¹éƒ½æ˜¯åŸºäºåˆ†å¸ƒå¼è®¾è®¡çš„æ€æƒ³ï¼Œå…ˆæè¿°å‡ºè®¡ç®—å›¾ï¼Œç„¶åå†å‘å›¾ä¸­å¡«å……æ•°æ®æµï¼Œä½¿å…¶è¿è½¬èµ·æ¥ï¼Œæœ€åå¾—åˆ°ç»“æœã€‚è™½ç„¶æ˜¯ä½¿ç”¨ Python è¯­è¨€æ¥æè¿°è®¡ç®—å›¾ï¼Œä½†æ˜¯çœŸæ­£ç¹é‡çš„å·¥ä½œéƒ½ä¼šæäº¤ç»™åº•å±‚çš„åç«¯å»å¤„ç†ã€‚ä½†è¿™æ ·ä¹Ÿç»™ debug å¸¦æ¥äº†å›°éš¾ï¼Œå› ä¸ºæè¿°è®¡ç®—å›¾çš„æ—¶å€™å¹¶ä¸èƒ½å¾—åˆ°æ•°æ®ç»“æœï¼Œåªèƒ½æ£€æŸ¥å‡ºæ•°æ®æ ¼å¼æ˜¯å¦åŒ¹é…ã€‚</p>
<blockquote>
<p>ç¬¼ç»Ÿçš„è¯´ï¼Œç¬¦å·ä¸»ä¹‰çš„è®¡ç®—é¦–å…ˆå®šä¹‰å„ç§å˜é‡ï¼Œç„¶åå»ºç«‹ä¸€ä¸ªâ€œè®¡ç®—å›¾â€ï¼Œè®¡ç®—å›¾è§„å®šäº†å„ä¸ªå˜é‡ä¹‹é—´çš„è®¡ç®—å…³ç³»ã€‚å»ºç«‹å¥½çš„è®¡ç®—å›¾éœ€è¦ç¼–è¯‘ä»¥ç¡®å®šå…¶å†…éƒ¨ç»†èŠ‚ï¼Œç„¶è€Œï¼Œæ­¤æ—¶çš„è®¡ç®—å›¾è¿˜æ˜¯ä¸€ä¸ªâ€œç©ºå£³å­â€ï¼Œé‡Œé¢æ²¡æœ‰ä»»ä½•å®é™…çš„æ•°æ®ï¼Œåªæœ‰å½“ä½ æŠŠéœ€è¦è¿ç®—çš„è¾“å…¥æ”¾è¿›å»åï¼Œæ‰èƒ½åœ¨æ•´ä¸ªæ¨¡å‹ä¸­å½¢æˆæ•°æ®æµï¼Œä»è€Œå½¢æˆè¾“å‡ºå€¼ã€‚<br>    å°±åƒç”¨ç®¡é“æ­å»ºä¾›æ°´ç³»ç»Ÿï¼Œå½“ä½ åœ¨æ‹¼æ°´ç®¡çš„æ—¶å€™ï¼Œé‡Œé¢æ˜¯æ²¡æœ‰æ°´çš„ã€‚åªæœ‰æ‰€æœ‰çš„ç®¡å­éƒ½æ¥å®Œäº†ï¼Œæ‰èƒ½é€æ°´ã€‚<br>    â€“ å¼•è‡ª <a href="http://keras-cn.readthedocs.io/en/latest/for_beginners/concepts/" target="_blank" rel="noopener">http://keras-cn.readthedocs.io/en/latest/for_beginners/concepts/</a></p>
</blockquote>
<h2 id="æ•°æ®é‡‡é›†"><a href="#æ•°æ®é‡‡é›†" class="headerlink" title="æ•°æ®é‡‡é›†"></a>æ•°æ®é‡‡é›†</h2><p>å› ä¸ºç½‘ä¸Šæä¾›çš„ä¸€äº›ç”¨äºè®­ç»ƒçš„æµ·é‡å›¾ç‰‡æ•°æ®éƒ½æ˜¯æ ¼å¼æ•´é½åƒç´ è¾ƒä½çš„å›¾ç‰‡ï¼Œæ¯”å¦‚28x28è¿™ç§ï¼Œä¸”ç‰¹å¾æ˜æ˜¾ï¼Œéƒ½ä¸ºæŸç§ç‰©ä½“ï¼Œè¿™ç§ä¸“ç”¨äºæ¯”èµ›æŒ‘æˆ˜çš„å›¾ç‰‡åˆ†ç±»æ•°é‡ä¸€èˆ¬éƒ½æ˜¯10ï¼Œ100ï¼Œ1000ç­‰ï¼Œæ›´ä¸“æ³¨äºç®—æ³•çš„å‡†ç¡®ç‡ï¼Œå¿½è§†äº†çœŸå®çš„åœºæ™¯ã€‚</p>
<p>ä¸ºäº†æ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼Œæˆ‘ä½¿ç”¨ Web ç¨‹åºè°ƒç”¨ iMac å‰ç½®æ‘„åƒå¤´é‡‡é›† 320x240 å°ºå¯¸çš„ç…§ç‰‡ã€‚ä¸ºäº†æ›´é«˜æ•ˆé‡‡é›†å›¾ç‰‡æ•°æ®ï¼Œæˆ‘é‡‡ç”¨è¿æ‹çš„æ–¹å¼æ‹æ‘„å¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ï¼š</p>
<p><img src="http://yulingtianxia.com/resources/MachineLearning/training_data.png" alt="å¸…æ˜¯æˆ‘çš„æ— å¥ˆ"></p>
<p>éœ€è¦å»é™¤å°‘é‡è¿‡äºæ¨¡ç³Šå’Œæ‰‹æŒ‡ä¸å°å¿ƒè·‘å‡ºå±å¹•å¤–çš„å›¾ç‰‡ï¼Œå°½å¯èƒ½æé«˜æ•°æ®çš„è´¨é‡ã€‚</p>
<p>å› ä¸ºä¸åŒå¹³å°å’Œæµè§ˆå™¨å¯¹ Html5 è§„èŒƒæ”¯æŒç¨‹åº¦ä¸åŒï¼Œå»ºè®®åœ¨ Mac ä¸Šä½¿ç”¨ Firefoxï¼ŒWindows ä¸Šåº”è¯¥ Chrome ä¹Ÿå¥½ä½¿ï¼Œä½†æ²¡è¯•è¿‡ã€‚</p>
<p>å›¾åƒé‡‡é›†çš„ä»£ç æ”¾åœ¨ <a href="https://github.com/yulingtianxia/HandGestureCNN/tree/master/captureImages" target="_blank" rel="noopener">captureImages</a> ç›®å½•é‡Œã€‚</p>
<h2 id="Inception-V3-pre-trained-network"><a href="#Inception-V3-pre-trained-network" class="headerlink" title="Inception V3 pre-trained network"></a>Inception V3 pre-trained network</h2><p>åœ¨ Keras Blog ä¸­ï¼Œ<a href="https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html" target="_blank" rel="noopener">Building powerful image classification models using very little data</a> å¾ˆå¥½åœ°ä»‹ç»äº†å¦‚ä½•é’ˆå¯¹å°æ•°æ®é›†åˆ©ç”¨ç°æœ‰çš„ VGG16 ç½‘ç»œ fine-tuningï¼Œå¹¶åœ¨ <a href="https://www.kaggle.com/c/dogs-vs-cats/data" target="_blank" rel="noopener">Dogs vs. Cats</a> æ•°æ®é›†ä¸Šå–å¾—äº† 94% çš„å‡†ç¡®ç‡ã€‚</p>
<p>VGG ç³»åˆ—ç½‘ç»œè™½ç„¶ç»“æ„ç®€å•æ˜“ç†è§£ï¼Œä½†æ— è®ºæ˜¯åŠ è½½æƒé‡çš„è€—æ—¶è¿˜æ˜¯é¢„æµ‹è€—æ—¶éƒ½è¦æ¯” Inception ç³»åˆ—ç½‘ç»œè¦é•¿ï¼Œè¿™æ˜¯å› ä¸ºå…¶æƒé‡æ•°æ®æ›´å¤šã€‚è™½ç„¶ Inception ç³»åˆ—æ›´å¤æ‚ï¼Œä½†é‰´äºå…¶ä¼˜ç§€çš„æ€§èƒ½å’Œæ›´èƒœä¸€ç­¹çš„å‡†ç¡®ç‡ï¼Œæˆ‘å†³å®šåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨ Inception è€Œé VGGã€‚</p>
<p>å…¶å®è‹¹æœçˆ¸çˆ¸å·²ç»å¸®æˆ‘ä»¬ç”¨ Swift å’Œ Metal Performance Shaders å®ç°äº†ä¸ªä½¿ç”¨ Inception V3 ç½‘ç»œé¢„æµ‹å›¾åƒç±»åˆ«çš„ Demo:<a href="https://developer.apple.com/library/content/samplecode/MetalImageRecognition/Introduction/Intro.html" target="_blank" rel="noopener">MetalImageRecognition: Performing Image Recognition with Inception_v3 Network using Metal Performance Shaders Convolutional Neural Network routines</a></p>
<p>æ‰€ä»¥æˆ‘å†³å®šä½¿ç”¨ <a href="https://arxiv.org/pdf/1512.00567v3.pdf" target="_blank" rel="noopener">Inception V3 Network</a> æ¥ fine-tuningï¼Œè¿™æ ·åœ¨åç»­çš„ MPS ä»£ç ç¼–å†™ä¸Šå°±ä¼šçœå¾ˆå¤šæ—¶é—´ã€‚TensorFlow å®˜æ–¹ä¹Ÿæœ‰ç›¸åº” <a href="https://www.tensorflow.org/tutorials/image_recognition#image-recognition" target="_blank" rel="noopener">æ•™ç¨‹</a>ã€‚</p>
<h3 id="bottleneck-features"><a href="#bottleneck-features" class="headerlink" title="bottleneck features"></a>bottleneck features</h3><p>ä¸‹å›¾å±•ç¤ºäº† Inception V3 ç½‘ç»œçš„ç»“æ„ï¼Œå…¶ä¸­çš„ top éƒ¨åˆ†å°±æ˜¯ Final part æ‰€æŒ‡çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ›¿æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å…¨è¿æ¥å±‚ï¼Œåˆ©ç”¨å‰é¢ Input é¢„æµ‹çš„ç»“æœæ¥ä½œä¸ºè¾“å…¥æ•°æ®ï¼Œè®­ç»ƒæˆ‘ä»¬è‡ªå·±çš„åˆ†ç±»å™¨ã€‚</p>
<p>![](<a href="http://yulingtianxia.com/resources/MachineLearning/Inception">http://yulingtianxia.com/resources/MachineLearning/Inception</a> V3.png)</p>
<blockquote>
<p>ä¸Šå›¾ä¸­çš„ Inception mudules ä½¿ç”¨çš„æ˜¯<a href="https://arxiv.org/pdf/1512.00567v3.pdf" target="_blank" rel="noopener">è®ºæ–‡</a>ä¸­æåˆ°çš„å›¾ 6 çš„ç»“æ„ï¼Œå®é™…ä»£ç ä¸­åˆ™ä½¿ç”¨çš„å›¾ 5ã€‚</p>
</blockquote>
<p>Keras æœ‰å¾ˆå¤šä½¿ç”¨ ImageNet é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œæˆ‘ä»¬è¿™é‡Œåªéœ€è¦ Inception V3 å»æ‰ Final part çš„å‰©ä½™éƒ¨åˆ†ï¼Œä¸€è¡Œä»£ç æå®šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = applications.InceptionV3(include_top=False, weights=&apos;imagenet&apos;)</span><br></pre></td></tr></table></figure>

<p>åœ¨ TensorFlow ä¸­è¯»å–æ–‡ä»¶æ•°æ®éœ€è¦é€šè¿‡ <code>QueueRunner</code> å’Œ <code>Coordinator</code> æ„é€ é˜Ÿåˆ—æ¥å®ç° data flowï¼Œæ¯”è¾ƒéº»çƒ¦ï¼š</p>
<p><img src="http://yulingtianxia.com/resources/MachineLearning/AnimatedFileQueues.gif" alt="å›¾ç‰‡æ¥æº TensorFlow"></p>
<p>Keras çœŸæ˜¯å¤ªæ–¹ä¾¿äº†ï¼Œç”¨ç”Ÿæˆå™¨æŠŠå›¾ç‰‡æ•°æ®æ ‡å‡†åŒ–ï¼Œä½¿ç”¨åŠ è½½å¥½çš„ <code>model</code> é¢„æµ‹å‡ºç»“æœï¼Œå¹¶ä¿å­˜åˆ° npy æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">datagen = ImageDataGenerator(rescale=1. / 255)</span><br><span class="line">generator = datagen.flow_from_directory(</span><br><span class="line">   train_data_dir,</span><br><span class="line">   target_size=(img_width, img_height),</span><br><span class="line">   batch_size=batch_size,</span><br><span class="line">   class_mode=None,</span><br><span class="line">   shuffle=False)</span><br><span class="line">bottleneck_features_train = model.predict_generator(</span><br><span class="line">   generator, nb_train_samples // batch_size)</span><br><span class="line">np.save(open(&apos;bottleneck_features_train.npy&apos;, &apos;w&apos;),</span><br><span class="line">       bottleneck_features_train)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¿å­˜çš„ç»“æœå¹¶ä¸æ˜¯ one-hot æ ¼å¼çš„åˆ†ç±»ç»“æœï¼Œåªæ˜¯ä½œä¸º Final part çš„è¾“å…¥ï¼Œæ‰€ä»¥å«åš bottleneck featuresã€‚</p>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯æ„å»ºè‡ªå·±çš„ Final partï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œæƒ³è¦åšä¸ªäº”åˆ†ç±»çš„æ¨¡å‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(Flatten(input_shape=train_data.shape[1:]))</span><br><span class="line">model.add(Dense(256, activation=&apos;relu&apos;))</span><br><span class="line">model.add(Dropout(0.5))</span><br><span class="line">model.add(Dense(5, activation=&apos;softmax&apos;))</span><br></pre></td></tr></table></figure>

<p><code>Flatten</code> å’Œ <code>Dropout</code> å±‚å¹¶ä¸ä¼šæ”¹å˜æ•°æ®ï¼Œæ˜¯æ²¡æœ‰æƒé‡çš„å±‚ã€‚æ‰€ä»¥è¿™é‡Œæœ‰ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼Œæœ€åä¸€å±‚æœ‰äº”ä¸ªèŠ‚ç‚¹ï¼Œè¾“å‡ºä¸€ä¸ªé•¿åº¦ä¸º 5 çš„ one-hot æ ¼å¼å‘é‡ã€‚</p>
<p>è¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨ bottleneck features ä½œä¸ºè¾“å…¥æ•°æ®æ¥è¿›è¡Œè®­ç»ƒï¼Œæ˜¯ä¸ºäº†èŠ‚çœè¿ç®—èµ„æºã€‚å¦‚æœé‡‡ç”¨å†»ç»“å‰é¢éƒ¨åˆ†ç½‘ç»œçš„æ–¹å¼ï¼Œè™½ç„¶è¢«å†»ç»“çš„ç½‘ç»œæƒé‡ä¸ä¼šå˜ï¼Œä½†æ¯è·‘ä¸€æ¬¡çš„è¿ç®—é‡éƒ½å¾ˆå¤§ï¼Œè€Œä¸”ç»“æœæ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥é‡‡å–é¢„æµ‹ä¸€æ¬¡ bottleneck featuresï¼Œç¦»çº¿ä¿å­˜çš„æ–¹å¼ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­å‡å°‘ loss æå‡å‡†ç¡®ç‡å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯æ¢¯åº¦ä¸‹é™æ³•ï¼Œå®é™…åº”ç”¨ä¸­ä½¿ç”¨ mini-batch æ¢¯åº¦ä¸‹é™æ³•æ¥å¹³è¡¡è®¡ç®—æ€§èƒ½å’Œ loss æ”¶æ•›æ•ˆæœã€‚è¿™é‡Œçš„ batch_size å°±æ˜¯æ¯æ¬¡ä¸‹é™æ‰€ä½¿ç”¨æ•°æ®æ‰¹æ¬¡çš„æ•°é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer=optimizers.SGD(lr=1e-4, momentum=0.9),</span><br><span class="line">             loss=&apos;categorical_crossentropy&apos;, metrics=[&apos;accuracy&apos;])</span><br><span class="line"></span><br><span class="line">model.fit(train_data, train_labels,</span><br><span class="line">         epochs=epochs,</span><br><span class="line">         batch_size=batch_size,</span><br><span class="line">         validation_data=(validation_data, validation_labels))</span><br><span class="line">model.save_weights(top_model_weights_path)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè®­ç»ƒçš„æ˜¯æˆ‘ä»¬è‡ªå·±æ·»åŠ çš„ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼Œä»¥ä¾¿äºæ‹Ÿåˆæˆ‘ä»¬è‡ªå·±çš„æ•°æ®ã€‚</p>
<p>è¿™éƒ¨åˆ†çš„æºç æ”¾åœ¨ <a href="https://github.com/yulingtianxia/HandGestureCNN/blob/master/Train/bottleneck_features_train_inceptionv3.py" target="_blank" rel="noopener">bottleneck_features_train_inceptionv3.py</a></p>
<h3 id="Fine-tuning"><a href="#Fine-tuning" class="headerlink" title="Fine-tuning"></a>Fine-tuning</h3><p>ä¸ºäº†è¾¾åˆ°æ›´å¥½çš„æ•ˆæœï¼Œå¯ä»¥è§£å†»åé¢å‡ å±‚ã€‚çœ‹äº†ä¸‹ Inception V3 çš„ç½‘ç»œç»“æ„ï¼Œæœ€åä¸€ä¸ª tower æ‹¥æœ‰ 9 ä¸ªå·ç§¯å±‚ï¼Œæ¯”è¾ƒå¤æ‚ã€‚è™½ç„¶ç†è®ºä¸Š fine-tuneing æ•´ä¸ª tower æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯è®¡ç®—å¼€é”€å¾ˆå¤§ï¼Œç”¨æˆ‘çš„ iMac 4 GHz Intel Core i7 å…«æ ¸è·‘ä¸€ä¸ªæœˆéƒ½ä¸è¡Œã€‚</p>
<p>ç°åœ¨éœ€è¦åŠ è½½é¢„è®­ç»ƒç½‘ç»œçš„æƒé‡åˆ° <code>base_model</code> ä¸­ï¼Œå¹¶å°†å…¶ä¸ <code>top_model</code> æ‹¼åœ¨ä¸€èµ·ã€‚Keras ä¸­æœ‰ä¸¤ç§æè¿°æ¨¡å‹ï¼Œä¸€ç§æ˜¯ <code>Sequential</code>ï¼Œå¦ä¸€ç§æ˜¯å¸¦æœ‰å‡½æ•°å¼ API çš„ <code>Model</code>ã€‚å‰è€…å±‚ä¸å±‚ä¹‹å‰è¿æ¥çš„å…¥åº¦å’Œå‡ºåº¦éƒ½ä¸º 1ï¼Œåè€…å°±å¾ˆçµæ´»å¾ˆéšæ„äº†ã€‚è¿™é‡Œæ„å»º <code>top_model</code> ä½¿ç”¨çš„ <code>Sequential</code>ï¼Œç„¶åä½¿ç”¨ <code>Model</code> ç»Ÿä¸€è¾“å…¥å’Œè¾“å‡ºï¼Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚æœ€åé€šè¿‡è®¾ç½® <code>trainable</code> å±æ€§æ¥å†»ç»“éƒ¨åˆ†ç½‘ç»œã€‚ä¸ºäº†è®©å‡†ç¡®ç‡æ›´é«˜ï¼Œä¼šå°†ä¸Šä¸€æ­¥ bottleneck features è®­ç»ƒå¥½çš„æƒé‡ä½œä¸º <code>top_model</code> çš„åˆå§‹æƒé‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># build the InceptionV3 network</span><br><span class="line">input_tensor = Input(shape=(img_height, img_width, 3))</span><br><span class="line">base_model = applications.InceptionV3(weights=&apos;imagenet&apos;, include_top=False, input_tensor=input_tensor)</span><br><span class="line">print(&apos;Model loaded.&apos;)</span><br><span class="line"></span><br><span class="line"># build a classifier model to put on top of the convolutional model</span><br><span class="line">top_model = Sequential()</span><br><span class="line">top_model.add(Flatten(input_shape=base_model.output_shape[1:]))</span><br><span class="line">top_model.add(Dense(256, activation=&apos;relu&apos;))</span><br><span class="line">top_model.add(Dropout(0.5))</span><br><span class="line">top_model.add(Dense(5, activation=&apos;softmax&apos;))</span><br><span class="line"></span><br><span class="line"># note that it is necessary to start with a fully-trained</span><br><span class="line"># classifier, including the top classifier,</span><br><span class="line"># in order to successfully do fine-tuning</span><br><span class="line">top_model.load_weights(top_model_weights_path)</span><br><span class="line"></span><br><span class="line"># add the model on top of the convolutional base</span><br><span class="line">model = Model(inputs=base_model.input, outputs=top_model(base_model.output))</span><br><span class="line"></span><br><span class="line"># set the first xx layers (up to the last conv block)</span><br><span class="line"># to non-trainable (weights will not be updated)</span><br><span class="line"></span><br><span class="line">for layer in model.layers[:len(base_model.layers)-5]:</span><br><span class="line">    layer.trainable = False</span><br></pre></td></tr></table></figure>

<p>æœ‰å…³ Keras ä¸¤ç§æ¨¡å‹çš„æ¦‚å¿µå¯ä»¥æŸ¥çœ‹ <a href="https://keras.io/models/about-keras-models/" target="_blank" rel="noopener">About Keras models</a>ã€‚</p>
<p>å¯ä»¥é€šè¿‡è®¾ç½®æ•°æ®ç”Ÿæˆå™¨çš„ä¸€äº›å‚æ•°æ¥æå‡æ•°æ®çš„éšæœºæ€§ï¼Œé™ä½è¿‡æ‹Ÿåˆã€‚<code>ImageDataGenerator</code> é’ˆå¯¹å›¾ç‰‡æœ‰å¾ˆå¤šé¢„è®¾çš„å¤„ç†æ–¹å¼ï¼Œä¾‹å¦‚å¹³ç§»ï¼Œæ—‹è½¬ï¼Œç¼©æ”¾ï¼Œåè½¬ç­‰ã€‚TensorFlow ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„å›¾ç‰‡é¢„å¤„ç†åŠŸèƒ½ï¼Œä½† API ä½¿ç”¨ä¸Šæ²¡ Keras ä¾¿åˆ©ã€‚æœ‰å…³å›¾ç‰‡é¢„å¤„ç†çš„å†…å®¹å¯ä»¥å‚è€ƒæ–‡æ¡£ <a href="https://keras.io/preprocessing/image/" target="_blank" rel="noopener">Image Preprocessing</a>ï¼Œè¿™é‡Œä»…é’ˆå¯¹æŸäº›æ–¹å¼è¿›è¡Œéšæ„é¢„å¤„ç†ï¼Œæå‡æ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">train_datagen = ImageDataGenerator(</span><br><span class="line">	rescale=1./255,</span><br><span class="line">  	rotation_range=40,</span><br><span class="line">  	width_shift_range=0.2,</span><br><span class="line">  	height_shift_range=0.2,</span><br><span class="line">  	shear_range=0.2,</span><br><span class="line">  	zoom_range=0.2,</span><br><span class="line">  	horizontal_flip=True,</span><br><span class="line">  	fill_mode=&apos;nearest&apos;)</span><br></pre></td></tr></table></figure>

<p>Keras å¯ä»¥æ ¹æ®æ•°æ®çš„æ–‡ä»¶å¤¹è‡ªåŠ¨åˆ†ç±»æ‰“æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘å°†å›¾ç‰‡æŒ‰æ–‡ä»¶å¤¹å½’ç±»å°±å¯ä»¥äº†ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p>
<p>æˆ‘ä¸€å…±ä½¿ç”¨äº† 1808 å¼ å›¾ç‰‡ä½œä¸ºè®­ç»ƒé›†ï¼Œ192 å¼ å›¾ç‰‡ä½œä¸ºäº¤å‰éªŒè¯é›†ã€‚ç»è¿‡äº† 50 ä¸ª epoch åï¼Œè®­ç»ƒé›†å‡†ç¡®ç‡ 96.26%ï¼Œäº¤å‰éªŒè¯é›†å‡†ç¡®ç‡ 73.86%ã€‚</p>
<p>è¿™éƒ¨åˆ†æºç æ”¾åœ¨ <a href="https://github.com/yulingtianxia/HandGestureCNN/blob/master/Train/finetune_inceptionv3.py" target="_blank" rel="noopener">finetune_inceptionv3.py</a></p>
<h2 id="Convert-HDF5-to-binary-dat-files"><a href="#Convert-HDF5-to-binary-dat-files" class="headerlink" title="Convert HDF5 to binary .dat files"></a>Convert HDF5 to binary .dat files</h2><blockquote>
<p>HDFï¼ˆè‹±è¯­ï¼šHierarchical Data Formatï¼‰æŒ‡ä¸€ç§ä¸ºå­˜å‚¨å’Œå¤„ç†å¤§å®¹é‡ç§‘å­¦æ•°æ®è®¾è®¡çš„æ–‡ä»¶æ ¼å¼åŠç›¸åº”åº“æ–‡ä»¶ã€‚HDFæœ€æ—©ç”±NCSAå¼€å‘ï¼Œç›®å‰åœ¨éç›ˆåˆ©ç»„ç»‡ HDF å°ç»„ç»´æŠ¤ä¸‹ç»§ç»­å‘å±•ã€‚å½“å‰æµè¡Œçš„ç‰ˆæœ¬æ˜¯HDF5ã€‚<br>    â€“ ç»´åŸºç™¾ç§‘</p>
</blockquote>
<p><a href="https://www.hdfgroup.org" target="_blank" rel="noopener">HDF Group</a> æä¾›äº†å¯è§†åŒ–æŸ¥çœ‹ HDF æ–‡ä»¶çš„å·¥å…·ï¼š<a href="https://support.hdfgroup.org/products/java/release/download.html" target="_blank" rel="noopener">HDFView</a>ï¼Œå› ä¸ºæ˜¯ç”¨ java å†™çš„ï¼Œæ‰€ä»¥æ˜¯è·¨å¹³å°çš„ã€‚Mac ç‰ˆæœ¬æœ‰ä¸ªå·²çŸ¥çš„ bugï¼šåŒå‡»ä¸€ä¸ª <code>.h5</code> æ–‡ä»¶å HDFView ç•Œé¢æ˜¯ç©ºçš„ï¼Œéœ€è¦æŠŠ <code>.h5</code> æ–‡ä»¶æ‹–åŠ¨åˆ° HDFView å·¦è¾¹æ æ‰èƒ½æ‰“å¼€ã€‚</p>
<p><img src="http://yulingtianxia.com/resources/MachineLearning/HDFView.jpg" alt></p>
<p>Keras å¯ä»¥å°†è®­ç»ƒå¤„çš„æƒé‡ç»“æœé«˜å­˜æˆ HDF5 æ ¼å¼ï¼Œä½†è‹¹æœæä¾›çš„ Demo ä½¿ç”¨çš„æƒé‡æ–‡ä»¶æ˜¯ memory-mapped äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¯å±‚ç½‘ç»œéƒ½å¯¹åº”ä¸€ä¸ª <code>.dat</code> æ–‡ä»¶ã€‚</p>
<p><a href="https://support.hdfgroup.org/products/hdf5_tools/index.html" target="_blank" rel="noopener">SOFTWARE USING HDF5</a> åˆ—ä¸¾äº†å¾ˆå¤šç”¨äºæ“ä½œ HDF æ–‡ä»¶å’Œæ ¼å¼è½¬æ¢çš„å·¥å…·ã€‚å¯ä»¥ç”¨ä¸€äº›å·¥å…·å°†å­˜æœ‰æƒé‡çš„ HDF æ–‡ä»¶å…ˆè½¬åŒ–æˆè‹¥å¹² <code>.dat</code> æ–‡ä»¶ï¼Œç„¶åå†æ‰“åŒ…åˆ° iOS App ä¸­ã€‚è¿˜æœ‰ä¸€ç§åšæ³•æ˜¯å°† HDF æ–‡ä»¶æ‰“åŒ…åˆ° iOS App ä¸­ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯å®Œæˆæ ¼å¼å¯¼å‡ºã€‚<a href="https://github.com/aleph7/HDF5Kit" target="_blank" rel="noopener">HDF5Kit</a> æ˜¯å¯¹ <a href="https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/" target="_blank" rel="noopener">HDF æºç </a>çš„ Swift å°è£…ï¼Œä¸è¿‡è¿˜æœ‰äº› crashã€‚æˆ‘é‡‡ç”¨äº†ç¬¬äºŒç§åšæ³•ï¼Œå› ä¸ºæˆ‘æ‡’ï¼Œæ›¿æ¢æƒé‡æ–‡ä»¶çš„æ—¶å€™åªéœ€è¦ä¸€ä¸ª HDF æ–‡ä»¶ï¼Œä¸ç”¨æ›¿æ¢ä¸€å † <code>.dat</code> æ–‡ä»¶ğŸ™„ã€‚å®é™…åº”ç”¨ä¸­åƒä¸‡åˆ«è¿™ä¹ˆå¹²ã€‚</p>
<p>å¯ä»¥æ ¹æ®ä¸Šå›¾ä¸­ HDFView å±•ç¤ºçš„æ ‘çŠ¶å±‚çº§é€’å½’éå† Groupï¼Œå¹¶æ‹¼æ¥å¥½æ­£ç¡®çš„åç§°ã€‚æ¯”å¦‚ â€œbias:0â€ å’Œ â€œkernel:0â€ã€‚å°† HDF5 è½¬æ¢æˆäºŒè¿›åˆ¶æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">// Read parameters from HDF5 file and store to dat file in Tmp directory</span><br><span class="line">func extractHDF5(h5Name: String) &#123;</span><br><span class="line">    // MARK: Parse HDF5 file</span><br><span class="line">    guard let path = Bundle.main.path(forResource: h5Name, ofType: &quot;h5&quot;) else &#123;</span><br><span class="line">        fatalError(&quot;Failed to get a path&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    guard let file = File.open(path, mode: .readOnly) else &#123;</span><br><span class="line">        fatalError(&quot;Failed to open file at \(path)&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    guard let layerNamesStringAttribute = file.openStringAttribute(&quot;layer_names&quot;) else &#123;</span><br><span class="line">        fatalError(&quot;Failed to open attribute &apos;layer_names&apos;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    guard let layerNames = try? layerNamesStringAttribute.read() else &#123;</span><br><span class="line">        fatalError(&quot;Failed to get layer names&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // count used for file name later</span><br><span class="line">    var countOfConvLayer = 0</span><br><span class="line">    var countOfFcLayer   = 0</span><br><span class="line">    var partOfFileName = &quot;&quot;</span><br><span class="line">    </span><br><span class="line">    for layerName in layerNames &#123;</span><br><span class="line">        guard let layerGroup = file.openGroup(layerName) else &#123;</span><br><span class="line">            fatalError(&quot;Failed to open group of \(layerName)&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        for objectName in layerGroup.objectNames() &#123;</span><br><span class="line">            </span><br><span class="line">            // only the layer that has parameters remain</span><br><span class="line">            guard let wtDataset = layerGroup.openFloatDataset(objectName + &quot;/kernel:0&quot;) else &#123;</span><br><span class="line">                fatalError(&quot;Failed to open data set of \(objectName)/kernel:0&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">            guard let bsDataset = layerGroup.openFloatDataset(objectName + &quot;/bias:0&quot;) else &#123;</span><br><span class="line">                fatalError(&quot;Failed to open data set of \(objectName)/bias:0&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            var dimension = wtDataset.space.dims</span><br><span class="line">            guard var wtArray = try? wtDataset.read() else &#123;</span><br><span class="line">                fatalError(&quot;Failed to read data set of \(objectName)/kernel:0&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">            guard var bsArray = try? bsDataset.read() else &#123;</span><br><span class="line">                fatalError(&quot;Failed to read data set of \(objectName)/bias:0&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            let wtLength = wtArray.count</span><br><span class="line">            let bsLength = bsArray.count</span><br><span class="line">            </span><br><span class="line">            if dimension.count == 4 &#123;</span><br><span class="line">                // weights for convolution layer</span><br><span class="line">                wtArray = SwapAxes.for4dFlatArray(originalArray: wtArray, axis1: 2, axis2: 3, dimensionOfArray: &amp;dimension)</span><br><span class="line">                wtArray = SwapAxes.for4dFlatArray(originalArray: wtArray, axis1: 1, axis2: 2, dimensionOfArray: &amp;dimension)</span><br><span class="line">                wtArray = SwapAxes.for4dFlatArray(originalArray: wtArray, axis1: 0, axis2: 1, dimensionOfArray: &amp;dimension)</span><br><span class="line">                </span><br><span class="line">                countOfConvLayer += 1</span><br><span class="line">                partOfFileName = &quot;conv&quot; + String(countOfConvLayer)</span><br><span class="line">                </span><br><span class="line">            &#125; else if dimension.count == 2 &#123;</span><br><span class="line">                // weights for fully connected layer</span><br><span class="line">                wtArray = SwapAxes.for2dFlatArray(originalArray: wtArray, axis1: 0, axis2: 1, dimensionOfArray: &amp;dimension)</span><br><span class="line">                </span><br><span class="line">                countOfFcLayer += 1</span><br><span class="line">                partOfFileName = &quot;fc&quot; + String(countOfFcLayer)</span><br><span class="line">                </span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                fatalError(&quot;Dataset&apos;s dimension is neither 4 (convolution layer) nor 2 (fully connected layer)&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            let wtData = NSData(bytes: &amp;wtArray, length: wtLength * MemoryLayout&lt;Float&gt;.size)</span><br><span class="line">            let bsData = NSData(bytes: &amp;bsArray, length: bsLength * MemoryLayout&lt;Float&gt;.size)</span><br><span class="line">            </span><br><span class="line">            // å†™å…¥æ•°æ®åˆ°æ–‡ä»¶...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Metal-Performance-Shaders"><a href="#Metal-Performance-Shaders" class="headerlink" title="Metal Performance Shaders"></a>Metal Performance Shaders</h2><h3 id="MPS-ç®€ä»‹"><a href="#MPS-ç®€ä»‹" class="headerlink" title="MPS ç®€ä»‹"></a>MPS ç®€ä»‹</h3><p>Metal Performance Shaders ç®€ç§° MPSï¼Œå¯ä»¥ä¸ºä½¿ç”¨ Metal æŠ€æœ¯çš„ App æä¾›åº•å±‚é«˜æ€§èƒ½ GPU è¿ç®—æ¥å£ã€‚æœ€åˆè‹¹æœæä¾›çš„ Shader è¯­è¨€æœ¬æ¥æ˜¯å¾ˆåº•å±‚å¾ˆç”Ÿæ¶©çš„ï¼Œåæ¥ä¸º iOS æä¾›äº†åŸç”Ÿæ”¯æŒçš„ APIï¼Œå¯ä»¥ç”¨ Swift æˆ– OC æ¥è°ƒç”¨åº•å±‚æ¥å£äº†ã€‚iOS 9 çš„ MPS æä¾›äº†å›¾ç‰‡ç‰¹æ•ˆå¤„ç†å’Œ Metal çº¹ç†ç›¸å…³çš„ APIï¼ŒiOS 10 çš„ MPS æ–°å¢äº†æœ‰å…³ CNN å’ŒçŸ©é˜µä¹˜æ³•çš„ APIã€‚ä¸è¿‡ç›®å‰è‹¹æœåªå¼€æ”¾äº† CNN çš„é¢„æµ‹åŠŸèƒ½ï¼Œå¦‚æœæƒ³è¦åœ¨ iOS 10 ä¸Šè®­ç»ƒä¸€ä¸ª CNNï¼Œé‚£å°±åªèƒ½å€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·äº†ã€‚</p>
<p>è‹¹æœçš„ BNNS åŒæ ·æä¾›äº†åˆ›å»º CNN çš„ APIï¼Œè€Œä¸”ä¹Ÿåªèƒ½ä½¿ç”¨è®­ç»ƒå¥½çš„æƒé‡è¿›è¡Œé¢„æµ‹ã€‚ä½†ä»…ä»…æ˜¯å¯¹ CPU è¿›è¡Œäº†ä¼˜åŒ–ã€‚å› ä¸º OpenGL çš„é™åˆ¶ï¼Œå…¶æ€§èƒ½ä¸ Metal ç›¸æ¯”å¹¶ä¸å ä¼˜åŠ¿ã€‚OpenCL åœ¨ iOS ä¸Šæ˜¯ç§æœ‰æ¡†æ¶ã€‚æ‰€ä»¥è¯´ç›®å‰çœ‹æ¥ï¼Œä¸è€ƒè™‘ç³»ç»Ÿå…¼å®¹æ€§(iOS 10)å’Œèµ„æºé™åˆ¶(arm64)ï¼ŒMetal æŠ€æœ¯æ˜¯å‘æŒ¥ GPU è¿ç®—ä¼˜åŠ¿çš„æœ€å¥½é€‰æ‹©ã€‚</p>
<p>MPS ç³»ç»ŸåŸç”Ÿæ”¯æŒä¸ç”¨æ‹…å¿ƒå®‰è£…åŒ…å¢é‡é—®é¢˜ï¼Œå¹¶ä¸”ä½¿ç”¨ Metal æŠ€æœ¯ä½¿ç”¨ GPU åŠ é€Ÿè¿ç®—ï¼ŒåŠŸè€—å‘çƒ­å°‘ã€‚MPS ç›®å‰çš„ç¼ºç‚¹æ˜¯ä¸æ”¯æŒç½‘ç»œçš„è®­ç»ƒå’Œå¿…é¡» HardCode ç½‘ç»œç»“æ„ï¼Œä½†é¢å¯¹å¤æ‚åº¦è¾ƒä½çš„ç¥ç»ç½‘ç»œæ—¶è¿˜æ˜¯å¾ˆå®ç”¨çš„ã€‚æ¯•ç«Ÿ TensorFlow åœ¨ iOS ä¸Šåªèƒ½ç”¨ CPU è®¡ç®—ï¼Œä¸”ç¼–è¯‘è´¹æ—¶è´¹åŠ›ï¼Œå®‰è£…åŒ…å¢é‡å·¨å¤§ã€‚</p>
<p>MPS åœ¨æˆ‘çš„ iPhone 6s Plus ä¸Šæ€§èƒ½å¾ˆå¥½ï¼Œå‘çƒ­ä¹Ÿå°‘ï¼Œå¯ä»¥é€šè¿‡ç¥ç»ç½‘ç»œå®æ—¶é¢„æµ‹å‡ºç»“æœã€‚è¿™æ˜¯ <a href="https://github.com/shu223/iOS-10-Sampler" target="_blank" rel="noopener">iOS-10-Sampler</a> é¡¹ç›®çš„æ•ˆæœï¼Œå®ƒæ˜¯åœ¨è‹¹æœå®˜æ–¹ Demo <a href="https://developer.apple.com/library/content/samplecode/MetalImageRecognition/Introduction/Intro.html" target="_blank" rel="noopener">MetalImageRecognition</a> åŸºç¡€ä¸Šç¨å¾®æ”¹è¿›æ‹æ‘„åŠŸèƒ½çš„ç”¨æˆ·ä½“éªŒï¼ŒMPS çš„éƒ¨åˆ†æœªåšä»»ä½•æ”¹åŠ¨ã€‚æˆ‘åŸºäºå®ƒå’Œ <a href="https://github.com/kazoo-kmt/MPSCNNfeeder" target="_blank" rel="noopener">MPSCNNfeeder</a> å®ç°äº† <a href="https://github.com/yulingtianxia/HandGestureCNN/tree/master/HandGestureCNN" target="_blank" rel="noopener">HandGestureCNN</a>ã€‚</p>
<p><img src="https://github.com/shu223/iOS-10-Sampler/blob/master/README_resources/imagerecog.gif?raw=true" alt></p>
<p>è‹¹æœç»™äº†ä¸€ä¸ª MPS çš„ HelloWorldï¼š <a href="https://developer.apple.com/library/content/samplecode/MPSCNNHelloWorld/Introduction/Intro.html" target="_blank" rel="noopener">MPSCNNHelloWorld: Simple Digit Detection Convolution Neural Networks (CNN)</a>ï¼Œæ°å¥½å¯¹åº”ç€æœºå™¨å­¦ä¹ é¢†åŸŸçš„ HelloWorld MNISTã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹è¿™ä¸ª Demo çš„æºç æ¥å¿«é€Ÿä¸Šæ‰‹ MPS çš„ç”¨æ³•ã€‚</p>
<p>å…¶å®æ€»ä½“æ¥è¯´å¹¶ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä½†æœ‰å‡ ä¸ªé‡è¦çš„åœ°æ–¹éœ€è¦æˆ‘ä»¬è‡ªå·±å»è§£å†³ï¼š</p>
<ol>
<li><p>æ•°æ®å¤„ç†ï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹æ–‡ä»¶çš„æ•°æ®æ ¼å¼éœ€è¦è‡ªå·±å»è§£æã€‚ä¸åŒæ·±åº¦å­¦ä¹ æ¡†æ¶å¯¼å‡ºçš„æ¨¡å‹æƒé‡æ–‡ä»¶æ ¼å¼éƒ½ä¸ä¸€æ ·ï¼Œä¼šæ¶‰åŠåˆ°æ¯”è¾ƒåº•å±‚çš„ä½è¯»å†™ã€‚è¿™é‡Œæœ‰ä¸€å®šå·¥ä½œé‡ã€‚</p>
</li>
<li><p>ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œé¢„æµ‹æ¨¡å‹çš„æ—¶å€™ï¼Œä¼šæ¶‰åŠåˆ° paddingï¼Œè¿™éƒ¨åˆ†éœ€è¦è‡ªå·±è®¡ç®—ã€‚è¾“å‡ºæ•°æ®ä½“åœ¨ç©ºé—´ä¸Šçš„å°ºå¯¸å¯ä»¥é€šè¿‡è¾“å…¥æ•°æ®ä½“å°ºå¯¸ï¼ˆWï¼‰ï¼Œå·ç§¯å±‚ä¸­ç¥ç»å…ƒçš„æ„Ÿå—é‡å°ºå¯¸ï¼ˆFï¼‰ï¼Œæ­¥é•¿ï¼ˆSï¼‰å’Œé›¶å¡«å……çš„æ•°é‡ï¼ˆPï¼‰çš„å‡½æ•°æ¥è®¡ç®—ã€‚è¾“å‡ºæ•°æ®ä½“çš„ç©ºé—´å°ºå¯¸ä¸º (W-F +2P)/S+1ã€‚è¿™é‡Œè¯´çš„æ˜¯æŸä¸ªç»´åº¦ï¼Œå•æŒ‡å®½æˆ–é•¿ã€‚</p>
</li>
<li><p><code>MPSImage</code> æ˜¯ä¸ºäº†çªç ´ <code>MTLTexture</code> æœ€å¤§ç»´åº¦ä¸º 4 ï¼ˆRGBAï¼‰çš„é™åˆ¶ï¼Œæäº†ä¸ª workaroundï¼Œå°±æ˜¯ç”¨å¤šä¸ªåˆ‡ç‰‡æ¨¡æ‹Ÿå¤šç»´åº¦ã€‚å¦‚æœæœ‰ N ä¸ªç»´åº¦ï¼Œé‚£ä¹ˆåˆ‡ç‰‡æ•°é‡ä¸º (N+3)/4ã€‚æ¯”å¦‚ä¸‹å›¾ä¸º N = 9 çš„æƒ…å†µã€‚æ‰€ä»¥æ¶‰åŠåˆ°æ•°æ®å¯¹é½çš„äº‹æƒ…ï¼Œé¢„æµ‹åçš„æ•°æ®éœ€è¦å¤„ç†ä¸‹ã€‚</p>
<p> <img src="https://docs-assets.developer.apple.com/published/48ad0af3fd/b6d1d091-162c-418d-bc2e-0b6f3105c126.png" alt></p>
</li>
</ol>
<p>å¥½åœ¨è‹¹æœæä¾›çš„ Demo é‡Œå·²ç»å¯¹äºåä¸¤ä¸ªé—®é¢˜æœ‰äº†å¯ä»¥å‚è€ƒçš„ä»£ç ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å…¶å®æ˜¯ä¸ªçŸ©é˜µè½¬æ¢çš„æ“ä½œã€‚ TensorFlow å·ç§¯æ ¸æƒé‡çš„é¡ºåºä¸º [kH kW iC oC]ï¼Œè€Œ MPS æ¥å—çš„æƒé‡ä¸º [oC kH kW iC] å½¢å¼ã€‚è€Œæˆ‘ä½¿ç”¨ Keras çš„æ—¶å€™å°† TensorFlow ä½œä¸ºåç«¯ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸‹æƒé‡æ ¼å¼ã€‚çŸ©é˜µè½¬æ¢åœ¨ python é‡Œå¾ˆå®¹æ˜“ï¼Œè¿˜å¥½æˆ‘æ‰¾åˆ°äº† Swift ç‰ˆæœ¬çš„å®ç°ï¼š<a href="https://github.com/kazoo-kmt/MPSCNNfeeder/blob/master/swapaxes.swift" target="_blank" rel="noopener">SwapAxes</a>ï¼Œç›´æ¥æ‹¿è¿‡æ¥ç”¨äº†ã€‚</p>
<blockquote>
<p>PS: ç§‘æ™®ä¸‹ï¼Œ[oC kH kW iC] æ˜¯å››ç»´æ•°ç»„ï¼ˆçŸ©é˜µï¼‰ [outputChannels][kernelHeight][kernelWidth][inputChannels/groups] çš„ shapeã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨-MPS-æ„å»ºç½‘ç»œå¹¶é¢„æµ‹"><a href="#ä½¿ç”¨-MPS-æ„å»ºç½‘ç»œå¹¶é¢„æµ‹" class="headerlink" title="ä½¿ç”¨ MPS æ„å»ºç½‘ç»œå¹¶é¢„æµ‹"></a>ä½¿ç”¨ MPS æ„å»ºç½‘ç»œå¹¶é¢„æµ‹</h3><p>MPS é¢„æµ‹çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>è·å–å¯ç”¨çš„ device</li>
<li>ä» <code>device</code> è·å– <code>commandQueue</code>ï¼Œä» <code>commandQueue</code> è·å– <code>commandBuffer</code></li>
<li>æ„å»ºç½‘ç»œæ¨¡å‹å’Œè¾“å…¥æ•°æ®çš„ <code>MSPImage</code> å¯¹è±¡</li>
<li>è°ƒç”¨ç½‘ç»œæ¯å±‚çš„ <code>encode</code> æ–¹æ³•ï¼Œè¾“å…¥ä¸º <code>commandBuffer</code> å’Œä¸Šä¸€å±‚ç½‘ç»œè¾“å‡ºçš„ <code>MSPImage</code> å¯¹è±¡ã€‚</li>
<li>æäº¤ <code>commandBuffer</code></li>
<li>ç­‰å¾…è¾“å‡ºç»“æœï¼Œå¹¶å¤„ç†æˆ one-hot æ ¼å¼ã€‚</li>
</ol>
<p>å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯ä¿®æ”¹å·¥ç¨‹ä¸­çš„ <code>Inception3Net.swift</code> æ–‡ä»¶ï¼Œä½¿å…¶ç½‘ç»œç»“æ„ä¸æˆ‘ä»¬ç”¨ Keras æ­å»ºçš„ç½‘ç»œç»“æ„ä¸€æ ·å³å¯ã€‚å‰é¢æåˆ°è¿‡ï¼Œ<code>Flatten</code> å’Œ <code>Dropout</code> æ²¡æœ‰æƒé‡ï¼Œä¸æ”¹å˜æ•°æ®ã€‚<code>Flatten</code> å…¶å®å°±æ˜¯ <code>reshape</code> æ“ä½œï¼Œåœ¨ MPS ä¸­ä¸éœ€è¦ç‰¹æ„åš <code>reshape</code> æ“ä½œä¹Ÿæ²¡æœ‰ <code>Flatten</code> å±‚ï¼Œ<code>MPSImage</code> è¢«æè¿°æˆä»€ä¹ˆ shapeï¼Œæ•°æ®å°±ä¼šè¢«æ’åˆ—æˆé‚£ä¸ª shapeã€‚<code>Dropout</code> å±‚åœ¨è®­ç»ƒçš„æ—¶å€™æŒ‰ä¸€å®šå‡ ç‡ä¸¢å¼ƒç»“æœï¼Œåœ¨é¢„æµ‹æ¨¡å‹çš„æ—¶å€™æ ¹æœ¬ç”¨ä¸åˆ°ã€‚</p>
<p>å›é¡¾ä¸‹ä¹‹å‰ç”¨ Keras å†™çš„å…¨è¿æ¥å±‚ç»“æ„çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(Flatten(input_shape=train_data.shape[1:]))</span><br><span class="line">model.add(Dense(256, activation=&apos;relu&apos;))</span><br><span class="line">model.add(Dropout(0.5))</span><br><span class="line">model.add(Dense(5, activation=&apos;softmax&apos;))</span><br></pre></td></tr></table></figure>

<p>è½¬æ¢æˆ MPS çš„ä»£ç åå·®ä¸å¤šæ˜¯è¿™ä¸ªæ ·å­ï¼ˆçœç•¥æ— å…³ä»£ç ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">let device = inputCommandQueue.device</span><br><span class="line">let relu = MPSCNNNeuronReLU(device: device!, a: 0)</span><br><span class="line">let softmax = MPSCNNSoftMax(device: device!)</span><br><span class="line">let sftid = MPSImageDescriptor(channelFormat: textureFormat, width: 1  , height: 1  , featureChannels: 5)</span><br><span class="line">// logits</span><br><span class="line">let fc0 = SlimMPSCNNFullyConnected(kernelWidth: 8,</span><br><span class="line">                             kernelHeight: 8,</span><br><span class="line">                             inputFeatureChannels: 2048,</span><br><span class="line">                             outputFeatureChannels: 256,</span><br><span class="line">                             neuronFilter: relu,</span><br><span class="line">                             device: device,</span><br><span class="line">                             kernelParamsBinaryName: &quot;fc1&quot;)</span><br><span class="line">   </span><br><span class="line">let fc1 = SlimMPSCNNFullyConnected(kernelWidth: 1,</span><br><span class="line">                             kernelHeight: 1,</span><br><span class="line">                             inputFeatureChannels: 256,</span><br><span class="line">                             outputFeatureChannels: 5,</span><br><span class="line">                             neuronFilter: nil,</span><br><span class="line">                             device: device,</span><br><span class="line">                             kernelParamsBinaryName: &quot;fc2&quot;)</span><br><span class="line">...</span><br><span class="line">let image10 = ...</span><br><span class="line">let sftImage    = MPSImage(device: device!, imageDescriptor: sftid)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">// MPSImageDescriptor for final logits generating layers</span><br><span class="line">let fc0id = MPSImageDescriptor(channelFormat: textureFormat, width: 1, height: 1, featureChannels: 256)</span><br><span class="line">    </span><br><span class="line">var fc0Image, fc1Image : MPSTemporaryImage!</span><br><span class="line">    </span><br><span class="line">func logits_layer(commandBuffer: MTLCommandBuffer)&#123;</span><br><span class="line">   // These images are only needed in this layer and will not be read by the CPU or</span><br><span class="line">   // outside of the command bufer, so we can allocate them as MPSTemporaryImages and</span><br><span class="line">   // save the CPU cost and memory size of allocating reserved storage for them.</span><br><span class="line">   //</span><br><span class="line">   // These objects can not be reused outside of the command buffer, which is why</span><br><span class="line">   // we did not make them in the init(withDevice:commandQueue:) call.</span><br><span class="line">   //</span><br><span class="line">   // Temporary images are designed to be efficiently created as needed, used a few times</span><br><span class="line">   // and thrown away almost immediately</span><br><span class="line">   </span><br><span class="line">   fc0Image     = MPSTemporaryImage(commandBuffer: commandBuffer, imageDescriptor: fc0id)</span><br><span class="line">   fc1Image     = MPSTemporaryImage(commandBuffer: commandBuffer, imageDescriptor: sftid)</span><br><span class="line">   </span><br><span class="line">   // encode layers to metal commandBuffer</span><br><span class="line">   fc0.encode    (commandBuffer: commandBuffer, sourceImage: image10, destinationImage: fc0Image)</span><br><span class="line">   fc1.encode    (commandBuffer: commandBuffer, sourceImage: fc0Image, destinationImage: fc1Image)</span><br><span class="line">   softmax.encode(commandBuffer: commandBuffer, sourceImage: fc1Image, destinationImage: sftImage)</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ˜¯ä¸€ç¯‡è¡Œå¤–äººçœ‹ä¸æ‡‚ï¼Œè¡Œå†…äººè§‰å¾—æ°´ï¼Œæˆ‘è‡ªå·±è§‰å¾—æ”¶è·æ»¡æ»¡çš„å®è·µç¬”è®°ã€‚å¹¶æ²¡æœ‰èŠ±å¤§é‡ç¯‡å¹…æ€»ç»“Machine Learning çš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿæ²¡æœ‰é€ä¸ªè®²è¿°æ¡†æ¶ API çš„ä½¿ç”¨ï¼Œæ›´æ²¡æœ‰åˆ—ä¸€å †å…¬å¼å’Œæ•°å­¦å®šä¹‰ã€‚ã€‚ã€‚å› ä¸ºè¿™ç§çŸ¥è¯†ä½“ç³»å¤§è€Œå…¨çš„æ–‡ç« ï¼Œç½‘ä¸Šä¸èƒœæšä¸¾ï¼Œè€Œä¸”è‚¯å®šæ¯”æˆ‘æ€»ç»“çš„å¥½ã€‚æœ¬ç€ä¸€ä¸ªå°ç™½å»æ¢ç´¢ä¸–ç•Œçš„å¿ƒæ€ï¼ŒæŠŠè‡ªå·±ä»ç†è®ºå­¦ä¹ åˆ°è®­ç»ƒæ¨¡å‹å†åˆ° iOS ä¸Šçš„é¢„æµ‹çš„å®è·µæµç¨‹è®°å½•ä¸‹æ¥ã€‚å¾ˆå¤šæ¯ç‡¥è€—æ—¶çš„å­¦ä¹  MLã€TF å’Œé…ç½®ç¯å¢ƒçš„è¿‡ç¨‹éƒ½çœç•¥æ‰äº†ã€‚</p>
<p>æœ€åå»ºè®®å¦‚æœæœ‰æ¡ä»¶çš„è¯ï¼Œè¿˜æ˜¯ç”¨é…ç½®è¾ƒé«˜çš„é›†ç¾¤æˆ–è€…äº‘æœåŠ¡æ¥è®­ç»ƒæ¨¡å‹ï¼ŒèŠ‚çœç¨‹åºå‘˜å®è´µçš„æ—¶é—´ã€‚å¦‚æœä¸èƒ½åšåˆ°è‡ªå·±æå‡ºåˆ›æ–°æœ‰æ•ˆçš„ç½‘ç»œæ¨¡å‹ï¼Œå…¶å®æ·±åº¦å­¦ä¹ çš„å¤§é‡å·¥ä½œå°±æ˜¯è°ƒå‚ã€é‡‡é›†æ•°æ®ã€çœ‹åˆ«äººè®ºæ–‡å¦‚ä½•æ”¹å‚æ•°å’Œç½‘ç»œç»“æ„ï¼Œç„¶åç­‰å¾…æœºå™¨è®­ç»ƒç»“æœã€‚ã€‚ã€‚åå¤å¾ªç¯ã€‚ã€‚ã€‚</p>
<p>ç¥ç»ç½‘ç»œä¸æ˜¯çœŸçš„æ¨¡æ‹Ÿå‡ºäººè„‘çš„ç”Ÿç‰©ç‰¹å¾ï¼ŒCNN è·Ÿäººçœ¼æ‰«è§†ä¸–ç•Œæˆ–äººè„‘è¾¨åˆ«ç‰©ä½“å…¶å®å·®å¾ˆå¤šï¼Œæ·±åº¦å­¦ä¹ åªæ˜¯å°½åŠ›è®©æœºå™¨æ‹Ÿåˆå‡ºæƒ³è¦çš„ç»“æœç½¢äº†ï¼Œç¦»çœŸæ­£çš„äººå·¥æ™ºèƒ½è¿˜å·®è¿œäº†ã€‚æ‰€ä»¥ä¸è¦è¢«é“ºå¤©ç›–åœ°çš„å¹å˜˜æ´—è„‘äº†ï¼Œä¸€ä¸ª AlphaGo å°±èƒ½åˆè®©ä¸€å¤§å †æ‰€è°“çš„ç§‘æŠ€åª’ä½“é«˜æ½®å‡ºæœºå™¨å¿«è¦ç»Ÿæ²»äººç±»äº†ï¼Œä¸è¦è€æƒ³æä¸ªå¤§æ–°é—»ï¼</p>
<p>æ·±åº¦å­¦ä¹ å‘å±•å¾ˆå¿«ï¼Œè¦å­¦ä¹ çš„å†…å®¹è¿˜æœ‰å¾ˆå¤šã€‚å­¦ä¹ å¾—è¶Šå¤šï¼Œå°±å‘ç°è‡ªå·±è¶Šæ˜¯æ— çŸ¥ï¼Œä»¥è‡³äºæ€€ç–‘è‡ªå·±çš„æ™ºå•†å’Œç²¾åŠ›äº†ã€‚</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.coursera.org/learn/machine-learning/home" target="_blank" rel="noopener">Coursera Machine Learning</a><br><a href="https://www.tensorflow.org" target="_blank" rel="noopener">TensorFlow</a><br><a href="http://keras-cn.readthedocs.io/en/latest/" target="_blank" rel="noopener">Keras ä¸­æ–‡æ–‡æ¡£</a><br><a href="https://keras.io" target="_blank" rel="noopener">Keras Documentation</a><br><a href="http://image-net.org" target="_blank" rel="noopener">ImageNet</a><br><a href="https://www.kaggle.com" target="_blank" rel="noopener">kaggle</a><br><a href="http://cs231n.stanford.edu" target="_blank" rel="noopener">CS231n: Convolutional Neural Networks for Visual Recognition</a><br><a href="http://cs231n.github.io/convolutional-networks/" target="_blank" rel="noopener">Convolutional Neural Networks (CNNs / ConvNets)</a><br><a href="http://machinethink.net/blog/convolutional-neural-networks-on-the-iphone-with-vggnet/" target="_blank" rel="noopener">Convolutional neural networks on the iPhone with VGGNet</a><br><a href="https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html" target="_blank" rel="noopener">Building powerful image classification models using very little data</a><br><a href="https://www.hdfgroup.org" target="_blank" rel="noopener">HDF Group</a><br><a href="https://developer.apple.com/reference/metalperformanceshaders" target="_blank" rel="noopener">MetalPerformanceShaders</a><br><a href="https://developer.apple.com/reference/accelerate/bnns" target="_blank" rel="noopener">BNNS</a><br><a href="https://github.com/aleph7/HDF5Kit" target="_blank" rel="noopener">HDF5Kit</a><br><a href="https://github.com/shu223/iOS-10-Sampler" target="_blank" rel="noopener">iOS-10-Sampler</a><br><a href="https://github.com/kazoo-kmt/MPSCNNfeeder" target="_blank" rel="noopener">MPSCNNfeeder</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/iOS/">iOS</a><a href="/tags/Machine-Leaning/">Machine Leaning</a><a href="/tags/Metal/">Metal</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yulingtianxia.com/blog/2017/05/30/Implementing-CNN-with-MPS/" data-title="Implementing CNN with MPS | yulingtianxia&#39;s blog" data-tsina="1680627603" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/blog/2017/06/19/Core-ML-and-Vision-Framework-on-iOS-11/" title="Core ML and Vision Framework on iOS 11">
  <strong>ä¸Šä¸€ç¯‡ï¼š</strong><br/>
  <span>
  Core ML and Vision Framework on iOS 11</span>
</a>
</div>


<div class="next">
<a href="/blog/2017/04/17/Objective-C-Method-Swizzling/"  title="Objective-C Method Swizzling">
 <strong>ä¸‹ä¸€ç¯‡ï¼š</strong><br/> 
 <span>Objective-C Method Swizzling
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ç†è®ºåŸºç¡€"><span class="toc-number">1.</span> <span class="toc-text">ç†è®ºåŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹"><span class="toc-number">1.1.</span> <span class="toc-text">å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹"><span class="toc-number">1.2.</span> <span class="toc-text">å›¾ç‰‡åˆ†ç±»å¸¸ç”¨çš„æ•°æ®å’Œé¢„è®¾ç½‘ç»œæ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¿ç§»å­¦ä¹ "><span class="toc-number">1.3.</span> <span class="toc-text">è¿ç§»å­¦ä¹ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ¡†æ¶é€‰æ‹©"><span class="toc-number">2.</span> <span class="toc-text">æ¡†æ¶é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ•°æ®é‡‡é›†"><span class="toc-number">3.</span> <span class="toc-text">æ•°æ®é‡‡é›†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inception-V3-pre-trained-network"><span class="toc-number">4.</span> <span class="toc-text">Inception V3 pre-trained network</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bottleneck-features"><span class="toc-number">4.1.</span> <span class="toc-text">bottleneck features</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fine-tuning"><span class="toc-number">4.2.</span> <span class="toc-text">Fine-tuning</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Convert-HDF5-to-binary-dat-files"><span class="toc-number">5.</span> <span class="toc-text">Convert HDF5 to binary .dat files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Metal-Performance-Shaders"><span class="toc-number">6.</span> <span class="toc-text">Metal Performance Shaders</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MPS-ç®€ä»‹"><span class="toc-number">6.1.</span> <span class="toc-text">MPS ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-MPS-æ„å»ºç½‘ç»œå¹¶é¢„æµ‹"><span class="toc-number">6.2.</span> <span class="toc-text">ä½¿ç”¨ MPS æ„å»ºç½‘ç»œå¹¶é¢„æµ‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">7.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">8.</span> <span class="toc-text">Reference</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="éšè—ä¾§è¾¹æ "></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github åç‰‡</p>
<div class="github-card" data-github="yulingtianxia" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  

  <div class="linkslist">
  <p class="asidetitle">å‹æƒ…é“¾æ¥</p>
    <ul>
        
          <li>
            
            	<a href="http://pbxproj.yulingtianxia.com" target="_blank" title="pbxprojHelper">pbxprojHelper</a>
            
          </li>
        
          <li>
            
            	<a href="http://similarimagehunter.yulingtianxia.com" target="_blank" title="SimilarImageHunter">SimilarImageHunter</a>
            
          </li>
        
          <li>
            
            	<a href="http://spiral.yulingtianxia.com" target="_blank" title="Spiral">Spiral</a>
            
          </li>
        
          <li>
            
            	<a href="http://coloratom.yulingtianxia.com" target="_blank" title="ColorAtom">ColorAtom</a>
            
          </li>
        
          <li>
            
            	<a href="http://fish.yulingtianxia.com" target="_blank" title="å…»å°é±¼çš„æ°´å¡˜">å…»å°é±¼çš„æ°´å¡˜</a>
            
          </li>
        
          <li>
            
            	<a href="http://resume.yulingtianxia.com" target="_blank" title="æˆ‘çš„ç®€å†">æˆ‘çš„ç®€å†</a>
            
          </li>
        
    </ul>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">æ ‡ç­¾äº‘</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/ARC/" style="font-size: 10px;">ARC</a> <a href="/tags/Algorithm/" style="font-size: 12.73px;">Algorithm</a> <a href="/tags/App-Extensions/" style="font-size: 10px;">App Extensions</a> <a href="/tags/AppGroups/" style="font-size: 10px;">AppGroups</a> <a href="/tags/AppleScript/" style="font-size: 10px;">AppleScript</a> <a href="/tags/BlockHook/" style="font-size: 15.45px;">BlockHook</a> <a href="/tags/C/" style="font-size: 10.91px;">C</a> <a href="/tags/CocoaPods/" style="font-size: 10px;">CocoaPods</a> <a href="/tags/Core-Data/" style="font-size: 14.55px;">Core Data</a> <a href="/tags/Dart/" style="font-size: 10px;">Dart</a> <a href="/tags/GitHub/" style="font-size: 13.64px;">GitHub</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Machine-Leaning/" style="font-size: 11.82px;">Machine Leaning</a> <a href="/tags/Message-Forwarding/" style="font-size: 10.91px;">Message Forwarding</a> <a href="/tags/Messaging/" style="font-size: 10px;">Messaging</a> <a href="/tags/Metal/" style="font-size: 11.82px;">Metal</a> <a href="/tags/Objective-C/" style="font-size: 20px;">Objective-C</a> <a href="/tags/Octopress/" style="font-size: 10px;">Octopress</a> <a href="/tags/RAC/" style="font-size: 10.91px;">RAC</a> <a href="/tags/Reference-Counting/" style="font-size: 10px;">Reference Counting</a> <a href="/tags/Reverse-Engineering/" style="font-size: 10.91px;">Reverse Engineering</a> <a href="/tags/Runtime/" style="font-size: 17.27px;">Runtime</a> <a href="/tags/Social-Framework/" style="font-size: 10px;">Social Framework</a> <a href="/tags/SpriteKit/" style="font-size: 16.36px;">SpriteKit</a> <a href="/tags/Swift/" style="font-size: 18.18px;">Swift</a> <a href="/tags/UIKit-Dynamics/" style="font-size: 10px;">UIKit Dynamics</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/Xcode/" style="font-size: 13.64px;">Xcode</a> <a href="/tags/iCloud/" style="font-size: 10px;">iCloud</a> <a href="/tags/iOS/" style="font-size: 19.09px;">iOS</a> <a href="/tags/macOS/" style="font-size: 16.36px;">macOS</a> <a href="/tags/å­—ä½“/" style="font-size: 10px;">å­—ä½“</a> <a href="/tags/æœ¬åœ°åŒ–/" style="font-size: 10px;">æœ¬åœ°åŒ–</a> <a href="/tags/çæŠ˜è…¾/" style="font-size: 11.82px;">çæŠ˜è…¾</a> <a href="/tags/ç¢°æ’æ£€æµ‹/" style="font-size: 10px;">ç¢°æ’æ£€æµ‹</a> <a href="/tags/ç¿»è¯‘/" style="font-size: 15.45px;">ç¿»è¯‘</a> <a href="/tags/è®¾è®¡æ¨¡å¼/" style="font-size: 13.64px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/è½¬è½½/" style="font-size: 10px;">è½¬è½½</a>
    </div>
  </div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS è®¢é˜…</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">æ–°æµªå¾®åš</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1680627603&verifier=c09974f5&dpc=1"></iframe>
</div>


  

<div class="doubanshow">
<p class="asidetitle">è±†ç“£ç§€</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/53279288/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Stay hungry, stay foolish <br/>
			Talk is cheap, show me the code.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1680627603" target="_blank" class="icon-weibo" title="å¾®åš"></a>
		
		
		<a href="https://github.com/yulingtianxia" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/2374982" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/yulingtianxia" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/yulingtianxia" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/yulingtianxia" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/53279288" target="_blank" class="icon-douban" title="è±†ç“£"></a>
		
		
		<a href="http://www.zhihu.com/people/yulingtianxia" target="_blank" class="icon-zhihu" title="çŸ¥ä¹"></a>
		
		
		<a href="https://plus.google.com/106642427004837273341?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:yulingtianxia@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-nc-nd/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-nc-nd.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> Â© 2019 
		
		<a href="/about" target="_blank" title="æ¨è§ç‰">æ¨è§ç‰</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="å¾®ä¿¡"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="äººäºº"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="å¾®åš"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'yulingtianxia';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49704553-1', 'auto');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b5cb508df15ee6247a8c32c64eadb075";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="è¿”å›é¡¶éƒ¨"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
