<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>yulingtianxia&#39;s blog</title>
  <subtitle>ç‰ä»¤å¤©ä¸‹çš„åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yulingtianxia.com/"/>
  <updated>2016-10-18T16:48:04.000Z</updated>
  <id>http://yulingtianxia.com/</id>
  
  <author>
    <name>æ¨è§ç‰</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Let&#39;s Talk About project.pbxproj</title>
    <link href="http://yulingtianxia.com/blog/2016/09/28/Let-s-Talk-About-project-pbxproj/"/>
    <id>http://yulingtianxia.com/blog/2016/09/28/Let-s-Talk-About-project-pbxproj/</id>
    <published>2016-09-28T14:58:19.000Z</published>
    <updated>2016-10-18T16:48:04.000Z</updated>
    
    <content type="html">&lt;p&gt;project.pbxproj æ–‡ä»¶è¢«åŒ…å«äº Xcode å·¥ç¨‹æ–‡ä»¶ *.xcodeproj ä¹‹ä¸­ï¼Œå­˜å‚¨ç€ Xcode å·¥ç¨‹çš„å„é¡¹é…ç½®å‚æ•°ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ—§é£æ ¼çš„ Property List æ–‡ä»¶ï¼Œå†å²å¯è¿½æº¯åˆ° NeXT çš„ OpenStepã€‚å…¶å¯è¯»æ€§ä¸å¦‚ xml å’Œ jsonï¼Œè‹¹æœå´ä¸€ç›´æ²¿ç”¨è‡³ä»Šï¼Œä½œä¸ºä¸€å®¶ä»¥åˆ›æ–°é—»åçš„å…¬å¸å¯èƒ½è¿™é‡Œå‰©ä¸‹çš„å°±æ˜¯æƒ…æ€€å§ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡è°ˆäº†ä¸‹ project.pbxproj çš„çŸ¥è¯†ï¼Œå¹¶æ€»ç»“äº†ä¸€äº›æ“ä½œå·¥ç¨‹æ–‡ä»¶çš„ä¼˜ç§€è½®å­ï¼Œå¹¶åœ¨æœ€åç»™å‡ºäº†è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ &lt;a href=&quot;https://github.com/yulingtianxia/pbxprojHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pbxprojHelper&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;Property-List-çš„å†å²&quot;&gt;&lt;a href=&quot;#Property-List-çš„å†å²&quot; class=&quot;headerlink&quot; title=&quot;Property List çš„å†å²&quot;&gt;&lt;/a&gt;Property List çš„å†å²&lt;/h2&gt;&lt;p&gt;æƒ³äº†è§£ project.pbxproj æ–‡ä»¶æ ¼å¼ï¼Œå°±éœ€è¦å…ˆäº†è§£ Property Listã€‚&lt;/p&gt;
&lt;p&gt;Property List æœ‰å¾ˆå¤šç§è¡¨ç°æ–¹å¼ï¼Œæœ€å¤è€çš„æ ¼å¼å°±æ˜¯ä¹‹å‰æåˆ°çš„ NeXTSTEP æ‰€ä½¿ç”¨çš„æ ¼å¼ã€‚é‚£æ—¶è¿˜ç®—æ˜¯å¯è¯»æ€§å¾ˆå¼ºçš„ï¼Œä»éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ã€‚ä¸ json æœ€æ˜æ˜¾çš„å·®åˆ«æ˜¯ï¼šæ•°ç»„ç”¨å°æ‹¬å·æ‹¬èµ·æ¥å¹¶ç”¨é€—å·éš”å¼€å…ƒç´ ï¼›å­—å…¸ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥å¹¶ç”¨åˆ†å·éš”å¼€é”®å€¼å¯¹ï¼Œé”®å€¼ä¹‹é—´ç”¨ç­‰å·è¿æ¥ï¼›äºŒè¿›åˆ¶æ•°æ®ç”¨å°–æ‹¬å· &lt;code&gt;&amp;lt;&amp;gt;&lt;/code&gt; æ‹¬èµ·æ¥ï¼š&lt;/p&gt;
&lt;p&gt;æ•°ç»„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;( &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;3&quot;&lt;/span&gt; )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å­—å…¸ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;key&quot;&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ project.pbxproj æ–‡ä»¶ä¸­æ‰€ä½¿ç”¨çš„æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;åæ¥å‡ºç°çš„ GNUstep æ²¿ç”¨äº† NeXTSTEP æ ¼å¼ï¼Œå¹¶æ·»åŠ äº†å¯¹ &lt;code&gt;NSValue&lt;/code&gt; å’Œ &lt;code&gt;NSDate&lt;/code&gt; å¯¹è±¡çš„æ”¯æŒã€‚åˆ°äº†è‹¹æœçš„ Mac OS X 10.0 æ¨å‡ºäº†æ–°çš„ XML æ ¼å¼ï¼Œæ—§çš„ NeXTSTEP è¢«åºŸå¼ƒï¼Œåªæ”¯æŒè¯»ä¸æ”¯æŒå†™ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨ &lt;code&gt;plutil&lt;/code&gt; å‘½ä»¤æˆ–è€… Cocoa çš„ &lt;code&gt;NSPropertyListSerialization&lt;/code&gt; å†™å…¥ OpenStep æ ¼å¼æ—¶ä¼šæŠ¥é”™ï¼š&lt;em&gt;Property list format kCFProperty ListOpenStepFormat not supported for writing&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸º XML è¯­æ³•å•°å—¦å¾ˆå ç©ºé—´ï¼Œè‹¹æœåœ¨ Mac OS X 10.2 åˆæ¨å‡ºäº†ä¸€ç§æ–°æ ¼å¼ï¼Œå°† Property List å­˜å‚¨äºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚è™½ç„¶åœ¨ Mac OS X 10.7 JSON æ ¼å¼å‡ºç°äº†ï¼Œä½†æ˜¯è·Ÿ Property List ä¸å…¼å®¹ã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯ä¹ Property List åœ¨è‹¹æœå®¶æ—çš„å†å²ä¸Šå­˜åœ¨ä¸‰ç§æ ¼å¼ï¼šOpenStepï¼ŒXML å’Œ Binaryã€‚&lt;strong&gt;é™¤äº† OpenStep è¢«åºŸå¼ƒä¸æ”¯æŒå†™å…¥ä»¥å¤–ï¼Œå…¶ä½™æ ¼å¼éƒ½æä¾› API æ”¯æŒè¯»å†™ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ“ä½œ-Property-List-çš„é€”å¾„&quot;&gt;&lt;a href=&quot;#æ“ä½œ-Property-List-çš„é€”å¾„&quot; class=&quot;headerlink&quot; title=&quot;æ“ä½œ Property List çš„é€”å¾„&quot;&gt;&lt;/a&gt;æ“ä½œ Property List çš„é€”å¾„&lt;/h2&gt;&lt;p&gt;Unix çš„ &lt;code&gt;plutil&lt;/code&gt; å·¥å…·æä¾›äº†å¤„ç† Property list æ–‡ä»¶çš„èƒ½åŠ›ã€‚ æ¯”å¦‚å°† Property list æ–‡ä»¶è½¬æˆ XML æ ¼å¼: &lt;/p&gt;
&lt;figure class=&quot;highlight crmsh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;plutil -convert xml1 -s -r -o project.pbxproj.&lt;span class=&quot;keyword&quot;&gt;xml&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;project&lt;/span&gt;.pbxproj&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;-convert&lt;/code&gt; é€‰é¡¹å¯ä»¥ä¼ å…¥çš„å‚æ•°æœ‰ï¼š xml1, binary1 å’Œ jsonã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ Cocoa çš„ &lt;code&gt;NSPropertyListSerialization&lt;/code&gt; ä¹Ÿæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ›´é¢å‘å¯¹è±¡ã€‚å…¶å® &lt;code&gt;plutil&lt;/code&gt; å’Œ &lt;code&gt;NSPropertyListSerialization&lt;/code&gt; åº•å±‚éƒ½æ˜¯è°ƒç”¨ &lt;code&gt;CoreFoundation&lt;/code&gt; çš„&lt;code&gt;CFPropertyList&lt;/code&gt; ç›¸å…³çš„ APIï¼Œæ‰€ä»¥åŠŸèƒ½ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;NSPropertyListSerialization&lt;/code&gt; è¯»å…¥ project.pbxproj æ–‡ä»¶æ—¶ï¼Œå­—å…¸ä¸­é”®å€¼å¯¹çš„é¡ºåºä¼šè·Ÿæ–‡ä»¶ä¸­åŸå§‹çš„é¡ºåºä¸ä¸€è‡´ã€‚è¿™æ˜¯å› ä¸ºå­—å…¸ä¸ºäº†å®ç°å¿«é€ŸæŸ¥æ‰¾ä¼šå°† key æŒ‰åºå­˜å‚¨ï¼ˆæ¯”å¦‚å­—å…¸åºæˆ–ç”¨çº¢é»‘æ ‘æ’åºï¼‰ã€‚ç”¨ &lt;code&gt;plutil&lt;/code&gt; å‘½ä»¤å°† project.pbxproj æ–‡ä»¶è½¬æˆ xml æˆ– json ä¹Ÿä¼šå¦‚æ­¤ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œ&lt;code&gt;plutil&lt;/code&gt; å‘½ä»¤ä¹Ÿæ”¯æŒå¯¹æŸä¸ª &lt;code&gt;keypath&lt;/code&gt; çš„å¢ã€åˆ ã€æ”¹æ“ä½œã€‚&lt;code&gt;NSPropertyListSerialization&lt;/code&gt; å°±æ›´ä¸ç”¨è¯´äº†ï¼Œåœ¨ç¨‹åºä¸­éšæ„æã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰æåˆ°è¿‡ä¸æ”¯æŒ OpenStep å†™å…¥çš„é—®é¢˜ï¼Œæ‰€ä»¥å³ä¾¿æˆ‘ä»¬èƒ½åœ¨å†…å­˜ä¸­æ“ä½œ project.pbxproj æ–‡ä»¶ï¼Œä¾ç„¶ä¸èƒ½ç›´æ¥ä¿å­˜ã€‚&lt;strong&gt;å¦‚æœè‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ª OpenStep æ ¼å¼ç”Ÿæˆç¨‹åºï¼Œä¾ç„¶æ— æ³•å‡†ç¡®è¿˜åŸå­—å…¸ä¸­é”®å€¼å¯¹çš„é¡ºåºã€‚&lt;/strong&gt;æ›´ä½•å†µ project.pbxproj æ–‡ä»¶ä¸­è¿˜æ’å…¥äº†å¤§é‡å¢å¼º human-readable çš„æ³¨é‡Šï¼Œè¿™äº›æ³¨é‡Šçš„ç”Ÿæˆæ˜¯æœ‰ç‰¹æ®Šé€»è¾‘çš„ï¼Œè¿™ä¸ªåœ¨åé¢ä¼šè®²ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç®€è¦è§£æ-project-pbxproj-æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#ç®€è¦è§£æ-project-pbxproj-æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;ç®€è¦è§£æ project.pbxproj æ–‡ä»¶&quot;&gt;&lt;/a&gt;ç®€è¦è§£æ project.pbxproj æ–‡ä»¶&lt;/h2&gt;&lt;p&gt;æ—¢ç„¶è¡¨é¢ä¸Šæ— æ³•å°†ä¿®æ”¹è¿‡çš„å·¥ç¨‹æ–‡ä»¶æ•°æ®è¿˜åŸä¸º OpenStep æ ¼å¼ï¼ŒXcode åˆæ˜¯å¦‚ä½•ã€å¼€æŒ‚ã€åšåˆ°çš„å‘¢ï¼Ÿè¿™å°±å¾—ä» project.pbxproj æ–‡ä»¶å†…å®¹è¯´èµ·äº†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å†…å®¹è§„åˆ™&quot;&gt;&lt;a href=&quot;#å†…å®¹è§„åˆ™&quot; class=&quot;headerlink&quot; title=&quot;å†…å®¹è§„åˆ™&quot;&gt;&lt;/a&gt;å†…å®¹è§„åˆ™&lt;/h3&gt;&lt;p&gt;project.pbxproj ä½¿ç”¨ UUID ä½œä¸ºäº¤å‰å¼•ç”¨çš„ç´¢å¼•ï¼Œä¿è¯æ¯ä¸ªé…ç½®ä¿¡æ¯å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚å› ä¸º UUID æ ¹æ®æœºå™¨ç¡¬ä»¶å’Œæ—¶é—´æˆ³ç”Ÿæˆï¼Œé¿å…äº†å¤šäººåœ¨åŒä¸€æ—¶é—´æ®µæ“ä½œä¿®æ”¹å·¥ç¨‹æ–‡ä»¶å¸¦æ¥çš„é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´å·¥ç¨‹ä¸­æ¯é¡¹é…ç½®å¯¹è±¡éƒ½æœ‰ä¸ªå”¯ä¸€çš„ UUIDï¼Œç„¶åå…¶ä»–é…ç½®å¯¹è±¡æƒ³å¼•ç”¨æŸä¸ªé…ç½®å¯¹è±¡ç›´æ¥ä½¿ç”¨å®ƒçš„ UUID å³å¯ã€‚è¿™å°±è·Ÿæˆ‘ä»¬ç¼–ç¨‹æ—¶ä½¿ç”¨æŒ‡é’ˆæŒ‡å‘æŸä¸ªå¯¹è±¡çš„åœ°å€ä¸€æ ·ï¼Œå…¶ä»–å¯¹è±¡çš„å±æ€§æƒ³å¼•ç”¨å®ƒï¼Œåªéœ€è¦ç»™å±æ€§ä¼ ä¸ªæŒ‡é’ˆåœ°å€å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥æŠŠæ•´ä¸ªæ–‡ä»¶çš„å†…å®¹æƒ³è±¡æˆä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸ä¸­çš„ Key æŒ‰ç…§å­—å…¸åºæ¥æ’åˆ—ã€‚å­—å…¸çš„ç¬¬ä¸€å±‚çº§æ€»å…±æœ‰ 5 ä¸ªé”®å€¼å¯¹ï¼ŒKey åˆ†åˆ«ä¸ºï¼š&lt;code&gt;archiveVersion&lt;/code&gt;ï¼Œ&lt;code&gt;classes&lt;/code&gt;ï¼Œ&lt;code&gt;objectVersion&lt;/code&gt;ï¼Œ&lt;code&gt;objects&lt;/code&gt; å’Œ &lt;code&gt;rootObject&lt;/code&gt;ã€‚å…¶ä¸­é‡è¦çš„ Key æ˜¯ &lt;code&gt;objects&lt;/code&gt; å’Œ &lt;code&gt;rootObject&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„é…ç½®å¯¹è±¡éƒ½æ”¾åœ¨ &lt;code&gt;objects&lt;/code&gt; å¯¹åº”çš„ Value ä¸­ï¼ŒåŒ…æ‹¬è·Ÿå¯¹è±¡ï¼ˆ&lt;code&gt;rootObject&lt;/code&gt;ï¼‰ã€‚ &lt;code&gt;objects&lt;/code&gt; å¯¹åº”çš„ Value ä¹Ÿæ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒKey éƒ½ä¸º UUIDï¼ŒValue ä¾ç„¶æ˜¯ä¸ªå­—å…¸ã€‚å¯ä»¥å°† &lt;code&gt;rootObject&lt;/code&gt; çš„å€¼ï¼ˆæ˜¯ä¸€ä¸ª UUIDï¼‰ä½œä¸º Key åœ¨ &lt;code&gt;objects&lt;/code&gt; å¯¹åº”çš„å­—å…¸ä¸­æ‰¾åˆ°æ ¹å¯¹è±¡ã€‚è¿™ä¸ªæ ¹å¯¹è±¡çš„ &lt;code&gt;isa&lt;/code&gt; å±æ€§ä¸º &lt;code&gt;PBXProject&lt;/code&gt;ï¼ˆ&lt;code&gt;isa = PBXProject&lt;/code&gt;ï¼‰ã€‚&lt;strong&gt;è¯»æ‡‚ project.pbxproj çš„æœ€å¥½æ–¹å¼å°±æ˜¯é¡ºç€ &lt;code&gt;rootObject&lt;/code&gt; çš„å„ä¸ªå±æ€§å¯¹åº”çš„ UUID åœ¨ &lt;code&gt;objects&lt;/code&gt; ä¸­æ‰¾åˆ°å¯¹åº”çš„å¯¹è±¡ï¼Œç„¶åä¸€å±‚å±‚çœ‹ä¸‹å»ã€‚&lt;/strong&gt;è¿™æ ·æ•´ä¸ªæ–‡ä»¶çš„é…ç½®ä¿¡æ¯å­˜æ”¾æ–¹å¼å°±æ…¢æ…¢æ‘¸æ¸…äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;objects&lt;/code&gt; ä¸­çš„é”®å€¼å¯¹è¢«åˆ†æˆäº†è‹¥å¹²ä¸ª sectionï¼Œè™½ç„¶ section çš„é¡ºåºæ˜¯ Xcode ç§æœ‰ API é’¦å®šçš„ï¼Œä½†æ¯ä¸ª section å†…éƒ¨çš„é”®å€¼å¯¹ä¼šæ ¹æ® Key çš„å­—å…¸åºæ’åˆ—ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸ªå¯¹è±¡å†…éƒ¨çš„å±æ€§ï¼ˆä¹Ÿæ˜¯é”®å€¼å¯¹ï¼‰ä¼šæŠŠ &lt;code&gt;isa&lt;/code&gt; æ’åœ¨æœ€å‰é¢ï¼Œå…¶ä½™çš„æŒ‰ç…§å­—å…¸åºæ’åˆ—ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ•°ç»„å†…éƒ¨çš„é¡ºåºå®Œå…¨æŒ‰ç…§å…ƒç´ å†…å®¹çš„å­—å…¸åºæ’åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ &lt;code&gt;objects&lt;/code&gt; ä¸­ &lt;code&gt;PBXNativeTarget&lt;/code&gt; section çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ„Ÿå—ä¸€ä¸‹æ ¼å¼ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* Begin PBXNativeTarget section */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		A450185D1D9D68D60002869D &lt;span class=&quot;comment&quot;&gt;/* projectTest */&lt;/span&gt; = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			isa = PBXNativeTarget&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;buildConfigurationList &lt;/span&gt;= A45018751D9D68D60002869D &lt;span class=&quot;comment&quot;&gt;/* Build configuration list for PBXNativeTarget &quot;projectTest&quot; */&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;buildPhases &lt;/span&gt;= (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				A450185A1D9D68D60002869D &lt;span class=&quot;comment&quot;&gt;/* Sources */&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				A&lt;span class=&quot;number&quot;&gt;450185B&lt;/span&gt;1D9D68D60002869D &lt;span class=&quot;comment&quot;&gt;/* Frameworks */&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				A450185C1D9D68D60002869D &lt;span class=&quot;comment&quot;&gt;/* Resources */&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;buildRules &lt;/span&gt;= (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			dependencies = (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			name = projectTest&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			productName = projectTest&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			productReference = A450185E1D9D68D60002869D &lt;span class=&quot;comment&quot;&gt;/* projectTest.app */&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			productType = &lt;span class=&quot;string&quot;&gt;&quot;com.apple.product-type.application&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* End PBXNativeTarget section */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥æ ¹æ® &lt;code&gt;A45018751D9D68D60002869D&lt;/code&gt; æ‰¾åˆ°å¯¹åº”çš„ &lt;code&gt;buildConfigurationList&lt;/code&gt; å¯¹è±¡çš„å†…å®¹ï¼Œæ‰€ä»¥è¯´ project.pbxproj ä½¿ç”¨ UUID ä½œä¸ºäº¤å‰å¼•ç”¨çš„ç´¢å¼•ã€‚é€šè¿‡è¿™ç§å…³ç³»ï¼Œå¯ä»¥é€’å½’æ„å»ºä¸€å¼ æœ‰å‘å›¾ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å†…å®¹ç±»å‹&quot;&gt;&lt;a href=&quot;#å†…å®¹ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;å†…å®¹ç±»å‹&quot;&gt;&lt;/a&gt;å†…å®¹ç±»å‹&lt;/h3&gt;&lt;p&gt;åœ¨ Xcode ä¸­èƒ½çœ‹è§æ‰€æœ‰çš„å…¬å…±é…ç½®ä¿¡æ¯éƒ½å­˜åœ¨äº project.pbxproj ä¸­ã€‚ä¸»è¦åŒ…å«è·Ÿæ–‡ä»¶ç›¸å…³çš„ BuildFileï¼ŒGroup å’Œ FileReferenceï¼›è·Ÿç¼–è¯‘ç›¸å…³çš„ BuildPhase å’Œ Build Configurationï¼ˆListï¼‰ï¼›ä»¥åŠä¸€äº›åˆ— Target å’Œ TargetDependencyã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;objects&lt;/code&gt; çš„é”®å€¼å¯¹æ ¹æ®å†…å®¹ç±»å‹è¢«åˆ†æˆäº†è‹¥å¹²ä¸ª sectionï¼Œé‡‡ç”¨æ³¨é‡Šçš„æ–¹å¼åˆ†èŠ‚ä¹Ÿä½¿å¾—å¯è¯»æ€§æ›´å¼ºã€‚section çš„æ•°é‡è·Ÿå·¥ç¨‹æœ‰å…³ï¼Œå°¤å…¶æ˜¯æ¯ä¸ªå·¥ç¨‹çš„ BuildPhase å’Œ Target å·®åˆ«éƒ½å¾ˆå¤§ã€‚ä¸‹é¢åˆ—å‡ºäº†ä¸€ä¸ªsection åˆ—è¡¨ï¼ˆéå®Œæ•´ï¼‰ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;PBXBuildFile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXAppleScriptBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PB&lt;span class=&quot;built_in&quot;&gt;XCopyFilesBuildPhase&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXFrameworksBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXHeadersBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXResourcesBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXShellScriptBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXSourcesBuildPhase&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PB&lt;span class=&quot;built_in&quot;&gt;XContainerItemProxy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXFileElement&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXFileReference&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXVariantGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXTarget&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXAggregateTarget&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXLegacyTarget&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXNativeTarget&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXProject&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PBXTargetDependency&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;XCBuildConfiguration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;XCConfigurationList&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¯ä¸ª section ä¸­çš„å¯¹è±¡ç±»å‹éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¯¹è±¡çš„ç±»å‹æ˜¯é  &lt;code&gt;isa&lt;/code&gt; çš„å€¼åŒºåˆ†çš„ã€‚å¯¹è±¡å†…éƒ¨çš„å±æ€§ç±»å‹ä»¥åŠå«ä¹‰å¯ä»¥å‚ç…§è¿™ç¯‡æ–‡ç« æä¾›çš„å¯¹ç…§è¡¨ï¼š&lt;a href=&quot;http://www.monobjc.net/xcode-project-file-format.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xcode Project File Format&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ“ä½œ-project-pbxproj-æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#æ“ä½œ-project-pbxproj-æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;æ“ä½œ project.pbxproj æ–‡ä»¶&quot;&gt;&lt;/a&gt;æ“ä½œ project.pbxproj æ–‡ä»¶&lt;/h2&gt;&lt;p&gt;æˆ‘æ”¶é›†äº†ä¸€äº›å¯ä»¥æ“ä½œ project.pbxproj æ–‡ä»¶çš„ä¼˜ç§€è½®å­ï¼ŒåŸç†å¤§éƒ½æ˜¯ç”¨ &lt;code&gt;plutil&lt;/code&gt; è½¬æˆ json æˆ– xml åè¿›è¡Œå¤„ç†ï¼Œä¸ä»…åŠŸèƒ½éå¸¸å±€é™ï¼Œä¸”éƒ½æ— æ³•å®Œç¾è¿˜åŸä¸º OpenStep æ ¼å¼çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/CocoaPods/Xcodeproj&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xcodeproj&lt;/a&gt; CocoaPods å†™çš„ Ruby è§£æåº“ï¼Œç”¨äºä¿®æ”¹å¼•å…¥ CocoaPods çš„å·¥ç¨‹æ–‡ä»¶å¹¶ä¿å­˜ä¸º XML æ ¼å¼ã€‚CocoaPods æœ¬èº«æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œè¿˜å¯ä»¥ç”¨æ¥æ“ä½œ Xcode workspaces (.xcworkspace), configuration files (.xcconfig) å’Œ Xcode Scheme files (.xcscheme).&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kronenthaler/mod-pbxproj&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mod-pbxproj&lt;/a&gt; å¼ºå¤§çš„ Python è§£æåº“ï¼Œæ”¯æŒä¸€å®šçš„ä¿®æ”¹æ“ä½œï¼Œå¯è¾“å‡º OpenStep æ ¼å¼ï¼Œä½†æ˜¯é¡ºåºå’Œæ³¨é‡Šå†…å®¹æ— æ³•å®Œç¾è¿˜åŸï¼Œæœ‰äº›é¸¡è‚‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/truebit/xUnique&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;xUnique&lt;/a&gt; ç”¨ Python å†™çš„ç»Ÿä¸€å¤šè®¾å¤‡ç”Ÿæˆçš„ UUID çš„å·¥å…·ï¼Œä¸»è¦ç”¨é€”æ˜¯ç»Ÿä¸€å·¥ç¨‹åœ¨å¤šè®¾å¤‡ä¸Šç”Ÿæˆçš„ UUIDï¼Œé¿å…å·¥ç¨‹æ–‡ä»¶å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mjmsmith/pbxplorer&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pbxplorer&lt;/a&gt;  Ruby å†™çš„è§£æåº“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/alunny/node-xcode&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;node-xcode&lt;/a&gt; Cordova åŸºäºå®ƒç®¡ç† Xcode å·¥ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸è¿‡ &lt;strong&gt;Xcode å¯ä»¥æ‰“å¼€ XML æ ¼å¼çš„ project.pbxprojï¼Œä¸€æ—¦åœ¨ Xcode ç•Œé¢ä¸Šä¿®æ”¹å·¥ç¨‹é…ç½®å°±ä¼šé‡æ–°å°† project.pbxproj è½¬æˆ OpenStep é£æ ¼ã€‚è§£é“ƒè¿˜é¡»ç³»é“ƒäººï¼Œç»è¿‡å¤šç•ªå¯¹æ¯”ä¹‹åå‘ç°æœ€ç»ˆè¿˜æ˜¯ Xcode è‡ªå·±æ‰èƒ½å°† XML å®Œç¾è¿˜åŸæˆåŸæ¥çš„ OpenStep æ ¼å¼ï¼Œä¸” &lt;code&gt;diff&lt;/code&gt; å¯¹æ¯”æ¯«æ— å·®é”™ã€‚&lt;/strong&gt;åŸå› å¾ˆç®€å•ï¼ŒXcode ä½¿ç”¨çš„ç§æœ‰ API çš„å¯¼å‡ºç»“æœæ˜¯ä¸ªé»‘ç›’ï¼Œå¤–ç•Œæ— è®ºæ€ä¹ˆçŒœéƒ½ä¼šæœ‰ç‘•ç–µã€‚æ‰€ä»¥è¿˜æ˜¯å¯¼å‡ºä¸º XML åæ‰‹åŠ¨åœ¨ Xcode ç•Œé¢ä¸­è§¦å‘ä¸‹å§ã€‚æ—¢ç„¶è¿™æ ·çš„è¯ï¼Œå¦‚æœèƒ½å¤Ÿç®€å•é«˜æ•ˆåœ°ç”Ÿæˆå‡º XML æ–‡ä»¶ä½œä¸ºå·¥ç¨‹æ–‡ä»¶å°±å¥½äº†ã€‚åŸºäºæ­¤æƒ³æ³•æˆ‘å¼€å‘äº†ä¸€æ¬¾å«åš &lt;a href=&quot;https://github.com/yulingtianxia/pbxprojHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pbxprojHelper&lt;/a&gt; çš„ Mac Appï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/yulingtianxia/pbxprojHelper/blob/master/images/MainWindow@2x.png?raw=true&quot; alt=&quot;Main Window&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ“ä½œç®€å•ç²—æš´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€‰æ‹©ä¸€ä¸ªå·¥ç¨‹æ–‡ä»¶ç„¶åå†…å®¹ä¼šè‡ªåŠ¨è§£æåœ¨ä¸‹é¢çš„ Outline åˆ—è¡¨ä¸­ï¼ŒFilter è¾“å…¥æ¡†ä¾¿äºè¿‡æ»¤æŸ¥çœ‹å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;å•å‡» Outline åˆ—è¡¨ä¸­çš„æ–‡å­—å³å¯å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿ï¼ŒåŒå‡»å¤åˆ¶æ•´ä¸ªkeypathï¼ &lt;/li&gt;
&lt;li&gt;å¯¹ project.pbxproj æ–‡ä»¶çš„å¢åˆ æ”¹æ“ä½œéƒ½é…ç½®åœ¨ json æ–‡ä»¶ä¸­ï¼Œæ¯æ¬¡æƒ³å¯¹å·¥ç¨‹è¿›è¡Œä¿®æ”¹åªéœ€é€‰æ‹©å¯¹åº”çš„ json é…ç½®æ–‡ä»¶ç„¶åç‚¹å‡» â€œApplyâ€ å³å¯å®Œæˆå†™å…¥æ›¿æ¢å“¦ï¼&lt;/li&gt;
&lt;li&gt;ä¸å°å¿ƒè¯¯æ“ä½œçš„è¯è¿˜å¯ä»¥ç‚¹ â€œRevertâ€ å›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬å“¦ï¼&lt;/li&gt;
&lt;li&gt;ä»€ä¹ˆï¼Ÿæ‡’å¾—å†™ json é…ç½®æ–‡ä»¶ï¼Ÿä¸‹é¢è¿™ä¸ªé™„å¸¦çš„ json é…ç½®ç”Ÿæˆå™¨å¯ä»¥å¸®ä½ ç›´æ¥ç”Ÿæˆä¸€ä¸ªå“¦ï¼ä½¿ç”¨ â‡§âŒ˜0 å¿«æ·é”®å³å¯å¬å”¤æ­¤ç¥å™¨ï¼é€‰æ‹©ä¸¤ä¸ªå·¥ç¨‹æ–‡ä»¶å’Œ json ä¿å­˜è·¯å¾„åè½»è½»ä¸€ç‚¹ â€œGenerateâ€ å°±æå®šå’¯ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/yulingtianxia/pbxprojHelper/blob/master/images/GeneratorWindow@2x.png?raw=true&quot; alt=&quot;Generator Window&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¤„ç†å·¥ç¨‹æ–‡ä»¶çš„æ­£ç¡®å§¿åŠ¿æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‹·è´å‡ºä¸€ä»½åŸå§‹çš„ project.pbxproj æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;åœ¨ Xcode ç•Œé¢ä¸Šä¿®æ”¹å·¥ç¨‹é…ç½®ï¼Œæ¯”å¦‚ä¿®æ”¹ç¼–è¯‘é€‰é¡¹ï¼Œä½¿ç”¨è‡ªå·±çš„è¯ä¹¦ç­‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ pbxprojHelper çš„ JSON Configuration Generator æ¥å¯¹æ¯”ä¿®æ”¹åçš„å·¥ç¨‹æ–‡ä»¶å’ŒåŸå§‹çš„å·¥ç¨‹æ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆ JSON é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ä»¥åæƒ³è¦åœ¨å·¥ç¨‹æ–‡ä»¶ä¸Šæ–½åŠ è‡ªå·±çš„ä¿®æ”¹æ—¶ï¼Œåªéœ€è¦åº”ç”¨ä¹‹å‰ç”Ÿæˆå¥½çš„ JSON é…ç½®æ–‡ä»¶å³å¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;pbxprojHelper çš„&lt;strong&gt;ä¼˜åŠ¿åœ¨äºå¯ä»¥è‡ªç”±åœ°å¢åˆ æ”¹æŸ¥ä»»æ„å±æ€§ï¼ŒåŸç”Ÿ UI é™ä½äº†ä½¿ç”¨é—¨æ§›ã€‚åŠŸèƒ½å¼ºå¤§çš„åŒæ—¶äººæ€§åŒ–çš„è®¾è®¡ä½¿å¾—æ›´å¿«æ·æµè§ˆå·¥ç¨‹æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚æ— éœ€å†™ä»»ä½•ä»£ç å³å¯ä¸€é”®é…ç½®è‡ªå·±æƒ³è¦çš„å·¥ç¨‹æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­¤å¤–è¿˜æä¾›äº†å‘½ä»¤è¡Œå·¥å…· &lt;code&gt;pbxproj&lt;/code&gt;, å®ƒå…·æœ‰ pbxprojHelper.app å…·æœ‰çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Usage: pbxproj [command_option] &lt;span class=&quot;built_in&quot;&gt;file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Command options are (-convert &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; default):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-compare modified_file -o path          compare modified &lt;span class=&quot;keyword&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; generate a json &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;given&lt;/span&gt; path&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-apply json_file                        apply a json &lt;span class=&quot;built_in&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-revert                                 revert &lt;span class=&quot;keyword&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; latest backup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-convert                                rewrite &lt;span class=&quot;keyword&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;list&lt;/span&gt; files &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; xml format&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ &lt;code&gt;pbxproj&lt;/code&gt; æ­é… DevToolsCore ç§æœ‰ framework æ¥å®Œæˆä¿®æ”¹å·¥ç¨‹æ–‡ä»¶å¹¶è½¬åŒ–æˆ OpenStep æ ¼å¼çš„ä¸€æ¡é¾™è‡ªåŠ¨åŒ–ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨ GitHub ä¸Šä¸‹è½½æœ€æ–°çš„ &lt;a href=&quot;https://github.com/yulingtianxia/pbxprojHelper/releases/latest&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Release&lt;/a&gt; ç‰ˆã€‚æˆ–è€…åœ¨ App Store ä¸­ä¸‹è½½ï¼š&lt;a href=&quot;https://itunes.apple.com/cn/app/pbxprojhelper/id1160801848?mt=12&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://itunes.apple.com/cn/app/pbxprojhelper/id1160801848?mt=12&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬é¡¹ç›®å®Œå…¨æ‰‹æ’¸ï¼Œæ²¡ä¾èµ–ä¸Šé¢æåˆ°çš„ä»»ä½•è½®å­ğŸ˜ƒã€‚&lt;/strong&gt;ä½†ç”±äºä½¿ç”¨ Swift 3 æ¥å¼€å‘ï¼Œæ‰€ä»¥æœ€ä½åªèƒ½æ”¯æŒ macOS 10.12 ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æƒ³äº†è§£æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ GitHub ä¸»é¡µï¼š&lt;a href=&quot;https://github.com/yulingtianxia/pbxprojHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/pbxprojHelper&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Property_list&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://en.wikipedia.org/wiki/Property_list&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.monobjc.net/xcode-project-file-format.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.monobjc.net/xcode-project-file-format.html&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/1452707/library-to-read-write-pbxproj-xcodeproj-files&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://stackoverflow.com/questions/1452707/library-to-read-write-pbxproj-xcodeproj-files&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/CocoaPods/Xcodeproj/issues/52&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/CocoaPods/Xcodeproj/issues/52&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;project.pbxproj æ–‡ä»¶è¢«åŒ…å«äº Xcode å·¥ç¨‹æ–‡ä»¶ *.xcodeproj ä¹‹ä¸­ï¼Œå­˜å‚¨ç€ Xcode å·¥ç¨‹çš„å„é¡¹é…ç½®å‚æ•°ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ—§é£æ ¼çš„ Property List æ–‡ä»¶ï¼Œå†å²å¯è¿½æº¯åˆ° NeXT çš„ OpenStepã€‚å…¶å¯è¯»æ€§ä¸å¦‚ xml å’Œ jsonï¼Œè‹¹æœå´ä¸€ç›´æ²¿ç”¨è‡³ä»Šï¼Œä½œä¸ºä¸€å®¶ä»¥åˆ›æ–°é—»åçš„å…¬å¸å¯èƒ½è¿™é‡Œå‰©ä¸‹çš„å°±æ˜¯æƒ…æ€€å§ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡è°ˆäº†ä¸‹ project.pbxproj çš„çŸ¥è¯†ï¼Œå¹¶æ€»ç»“äº†ä¸€äº›æ“ä½œå·¥ç¨‹æ–‡ä»¶çš„ä¼˜ç§€è½®å­ï¼Œå¹¶åœ¨æœ€åç»™å‡ºäº†è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ &lt;a href=&quot;https://github.com/yulingtianxia/pbxprojHelper&quot;&gt;pbxprojHelper&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Xcode" scheme="http://yulingtianxia.com/tags/Xcode/"/>
    
      <category term="macOS" scheme="http://yulingtianxia.com/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>å¤„ç†æ‰‹åŠ¿å†²çªå’Œé”™ä¹±çš„ä¸€ç‚¹ç»éªŒ</title>
    <link href="http://yulingtianxia.com/blog/2016/08/29/Some-Experience-of-Gesture/"/>
    <id>http://yulingtianxia.com/blog/2016/08/29/Some-Experience-of-Gesture/</id>
    <published>2016-08-29T02:53:51.000Z</published>
    <updated>2016-10-18T16:48:04.000Z</updated>
    
    <content type="html">&lt;p&gt;å¦‚æœä¸€ä¸ªé¡µé¢ä¸ŠåŒ…å«ç€å¾ˆå¤šè§†å›¾ï¼Œè€Œä¸”ç•Œé¢ä¸Šä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆæ‰‹åŠ¿å“åº”å†²çªæˆ–è€…é”™ä¹±å¾ˆå®¹æ˜“å‘ç”Ÿã€‚è¿™æ—¶å°±å¾—çŒ¥çç‚¹å•¦ï¼Œè§æ‹›æ‹†æ‹›ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;å¤„ç†ç•Œé¢å¤šå˜å¼•å‘çš„æ‰‹åŠ¿å†²çª&quot;&gt;&lt;a href=&quot;#å¤„ç†ç•Œé¢å¤šå˜å¼•å‘çš„æ‰‹åŠ¿å†²çª&quot; class=&quot;headerlink&quot; title=&quot;å¤„ç†ç•Œé¢å¤šå˜å¼•å‘çš„æ‰‹åŠ¿å†²çª&quot;&gt;&lt;/a&gt;å¤„ç†ç•Œé¢å¤šå˜å¼•å‘çš„æ‰‹åŠ¿å†²çª&lt;/h2&gt;&lt;h3 id=&quot;åˆ†æé—®é¢˜&quot;&gt;&lt;a href=&quot;#åˆ†æé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æé—®é¢˜&quot;&gt;&lt;/a&gt;åˆ†æé—®é¢˜&lt;/h3&gt;&lt;p&gt;ç•Œé¢å˜åŒ–å¤šæ„å‘³ç€ä»€ä¹ˆï¼Ÿè´Ÿè´£çš„ä¸šåŠ¡é€»è¾‘ï¼Ÿä¸åŒæœºå‹é€‚é…ï¼Ÿè¿™éƒ½ä¸æ˜¯æˆ‘è¦é¦–å…ˆå»é‡ç‚¹è€ƒè™‘çš„ï¼Œä½†æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼Œé‚£å°±æ˜¯è¦æœ‰ä¸€ä¸ªå®Œå–„çš„çŠ¶æ€æœºï¼è¦é€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼šæ‰‹åŠ¿å†²çªçš„åŸå› ï¼Ÿéš¾é“æ˜¯å› ä¸ºé‚£å‡ ä¸ª &lt;code&gt;UIGestureRecognizerDelegate&lt;/code&gt; æ–¹æ³•çš„å®ç°æœ‰é—®é¢˜ï¼Ÿæˆ–è€…æ˜¯å› ä¸ºè·¨å±‚çº§ä¼ é€’äº‹ä»¶åœ¨ &lt;code&gt;hitTest:withEvent:&lt;/code&gt; é‡Œçš„ä¸šåŠ¡é€»è¾‘å¤ªå¤æ‚æ²¡ç†æ¸…ï¼Ÿå…¶å®è¿™äº›å°±ç®—éƒ½èƒ½å¼„å¾—å¾ˆæ˜ç™½ï¼Œç•Œé¢å†…å®¹ä¸€å˜åŒ–å°±å®¹æ˜“å‡ºé—®é¢˜ã€‚æ›´æœ‰å¯èƒ½ä¸ºäº†å¿«é€Ÿå“åº”ç”¨æˆ·çš„æ“ä½œè€Œè®©ä¸€äº›è§†å›¾å¸¸é©»å†…å­˜ï¼Œè€Œä¸æ˜¯æ¯æ¬¡é‡æ–°åˆ›å»ºå’Œæ·»åŠ ï¼Œè¿™å¢åŠ äº†ç•Œé¢å†…å®¹çš„å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªæ —å­ï¼Œæˆ‘æƒ³è®©ç”¨æˆ·å‘å›¾ç‰‡å‰å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œç¼–è¾‘ï¼Œæ¯”å¦‚åŠ æ®µæ–‡å­—ã€è´´çº¸ã€æ»¤é•œã€æ¶‚é¸¦ä¹‹ç±»çš„ï¼Œç”šè‡³å¯ä»¥è£å‰ªå’ŒåŠ èƒŒæ™¯éŸ³ä¹ã€‚æš‚ä¸”ä¸è¯´å¦‚ä½•å±•ç¤ºç¼–è¾‘åçš„å›¾ç‰‡ï¼Œä½†å°±ç¼–è¾‘çš„ç•Œé¢å°±å¾ˆå¤æ‚ï¼Œæ¯•ç«Ÿå¥½å¤šç§ç¼–è¾‘æ¨¡å¼è¦åœ¨åŒä¸€ä¸ªç•Œé¢ä¸­å®Œæˆã€‚è¿™å°‘ä¸äº†å„ç§ç¼–è¾‘æ¨¡å¼å…¥å£çš„æŒ‰é’®ï¼Œä¹Ÿå°‘ä¸äº†æ¯ç§ç¼–è¾‘æ¨¡å¼å¯¹ç•Œé¢è§†å›¾å±‚çº§çš„å åŠ ã€‚èµ·ç æ»¤é•œè¦å•ç‹¬ä¸€å±‚å§ï¼Œæ¯ä¸ªè´´çº¸å’Œæ–‡å­—éƒ½æ˜¯ä¸ªè§†å›¾ï¼Œæ¶‚é¸¦ä¹Ÿè¦ä¸€å±‚è§†å›¾ã€‚è£å‰ªæ—¶æ•´ä¸ªå›¾ç‰‡åŒ…æ‹¬ç¼–è¾‘æ—¶æ·»åŠ çš„å†…å®¹éƒ½è¦è·Ÿç€ä¸€èµ·ç¼©æ”¾å’Œæ—‹è½¬ï¼Œåˆ‡æ¢æ»¤é•œéœ€è¦æ»‘åŠ¨ï¼Œæ–‡å­—å’Œè´´çº¸éƒ½è¦ç¼©æ”¾å¹³ç§»æ—‹è½¬ç­‰æ“ä½œã€‚æ›´åˆ«ææ·»åŠ æ–‡å­—ã€è´´çº¸å’ŒèƒŒæ™¯éŸ³ä¹æ—¶è¦è¦†ç›–ä¸€ä¸ªå…¨å±çš„ç•Œé¢ï¼ˆä¸ç”¨æ–°çš„ controllerï¼Œè€Œæ˜¯æ·»åŠ è§†å›¾ï¼‰ï¼Œè®©ç”¨æˆ·ç¼–è¾‘æ–‡å­—æˆ–é€‰æ‹©ç´ æã€‚è¿™äº›ä¸šåŠ¡éƒ½åœ¨ä¸€ä¸ª controller é‡Œæ”¾ç€ï¼Œå¥½å¤šå±‚è§†å›¾å åŠ ï¼Œè€Œä¸”å˜å¹»è«æµ‹ã€‚åœ¨ä»€ä¹ˆæ—¶åˆ»è¯¥å“åº”å“ªä¸ªè§†å›¾çš„å“ªä¸ªæ‰‹åŠ¿ï¼Œé ä»€ä¹ˆåˆ¤æ–­ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼š&lt;strong&gt;çŠ¶æ€æœº&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çŠ¶æ€æœºèƒ½è§£å†³çš„æ›´å¤šçš„æ˜¯ç•Œé¢é”™ä¹±çš„é—®é¢˜ï¼Œä½†ç•Œé¢ä¸€æ—¦é”™ä¹±å¿…å°†å¯¹æ‰‹åŠ¿åˆ¤æ–­å¸¦æ¥è‡´å‘½å½±å“ã€‚å°±ç®—ç•Œé¢ä¸é”™ä¹±ï¼Œä¹Ÿéœ€è¦åœ¨ &lt;code&gt;UIGestureRecognizerDelegate&lt;/code&gt; æ–¹æ³•æˆ– &lt;code&gt;hitTest:withEvent:&lt;/code&gt; ä¸­çŸ¥æ™“å½“å‰ç•Œé¢å¤„äºä½•ç§çŠ¶æ€ï¼Œç„¶åæ‰èƒ½å‡†ç¡®åˆ¤æ–­é€‰æ‹©å“ªä¸ªæ‰‹åŠ¿æˆ–å“ªä¸ªè§†å›¾ã€‚è¿™é‡Œå±•å¼€å™è¿°ä¸‹æˆ‘å¯¹æœªæ¥å¯ä»¥ä½¿ç”¨çŠ¶æ€æœºè§£å†³ UI é”™ä¹±ä»¥åŠå› æ­¤è€Œå¼•å‘æ‰‹åŠ¿å†²çªçš„æ„æƒ³ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä½¿ç”¨çŠ¶æ€æœºçš„æ„æƒ³æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨çŠ¶æ€æœºçš„æ„æƒ³æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨çŠ¶æ€æœºçš„æ„æƒ³æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;ä½¿ç”¨çŠ¶æ€æœºçš„æ„æƒ³æ–¹æ¡ˆ&lt;/h3&gt;&lt;p&gt;å¯ä»¥è®¤ä¸ºæ¯ç§ç¼–è¾‘æ¨¡å¼ä¸‹éƒ½æ˜¯ä¸€ç§çŠ¶æ€ï¼Œç¼–è¾‘å®Œæˆä¹‹åä¹Ÿæ˜¯ç§çŠ¶æ€ã€‚è¿˜è¦è€ƒè™‘åˆ°åˆå§‹çŠ¶æ€æˆ–è€…æ— çŠ¶æ€çš„æƒ…å†µã€‚ç”¨æˆ·å¯¹å›¾ç‰‡ä¸Šçš„è´´çº¸å’Œæ–‡å­—ç­‰å…ƒç´ è¿›è¡Œæ“ä½œæ—¶è‚¯å®šä¹Ÿè¦è®¾å®šä¸€ç§çŠ¶æ€ã€‚æ€»ä¹‹çŠ¶æ€ä¸æ±‚å¤šï¼Œä½†ä¸€å®šè¦é¢é¢ä¿±åˆ°æ— é—æ¼ï¼Œè¦æ ¹æ®å½“å‰ç•Œé¢æ“ä½œè®¾è®¡çŠ¶æ€ã€‚æŸç§çŠ¶æ€ä¸‹å¯èƒ½è¿˜ä¼šæœ‰å­çŠ¶æ€ï¼Œæ¯”å¦‚æ¶‚é¸¦æ¨¡å¼ä¸‹å¯èƒ½ä¼šæœ‰ç”»ç¬”ã€æ©¡çš®æ“¦ã€é©¬èµ›å…‹ï¼Œå¹¶èƒ½é€‰æ‹©ç²—ç»†ä¹‹ç±»çš„åŠŸèƒ½ã€‚è¿™äº›éƒ½å±äºæ¶‚é¸¦æ¨¡å¼ä¸‹ç•Œé¢ä¸­çš„å…¶ä»–å°åŠŸèƒ½ï¼Œå¦‚æœæŠŠè¿™äº›åŠŸèƒ½çš„å¯¹åº”çš„çŠ¶æ€è·Ÿå…¶ä»–å‡ ç§ç¼–è¾‘æ¨¡å¼å¯¹åº”çš„çŠ¶æ€æ”¾åœ¨ä¸€èµ·ï¼Œèƒ½ä¿è¯å”¯ä¸€æ€§çš„è¯å€’ä¸æ˜¯è¯´ä¸å¯ä»¥ï¼Œä½†å¾ˆä¸åˆé€‚ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ç§çŠ¶æ€éƒ½è¦è§„å®šå®ƒçš„ã€ä¸‹ä¸€ä¸ªçŠ¶æ€ã€çš„é›†åˆï¼Œæ¯”å¦‚æ¶‚é¸¦æ¨¡å¼ä¸‹å¯èƒ½ä¼šè¿›å…¥åˆ°ç¼–è¾‘å®ŒæˆçŠ¶æ€ï¼Œä¹Ÿå¯èƒ½è¿”å›åˆ°åˆå§‹çŠ¶æ€ï¼Œä¹Ÿå¯èƒ½è¿›å…¥åˆ°è£å‰ªçŠ¶æ€ã€‚ã€‚ã€‚è¿™äº›è§„åˆ™è¦ç…§ç€äº§å“ç»ç†æŒ‡å®šçš„ä¸šåŠ¡é€»è¾‘æ¥ï¼Œåšåˆ°è°ƒç†æ¸…æ™°ã€‚åˆ¶å®šå¥½æ¯ç§çŠ¶æ€çš„ã€ä¸‹ä¸€ä¸ªçŠ¶æ€ã€çš„é›†åˆåï¼Œä¸€å¼ æœ‰å‘å›¾å°±ä¼šå±•ç°å‡ºæ¥äº†ï¼Œè§„åˆ™å®šäº†å°±å¥½åŠäº†ã€‚ä¸è¦æŠŠè¿™äº›çŠ¶æ€ç®€å•ç†è§£æˆã€ä¸€ä¸ªæšä¸¾ã€ï¼Œè¦ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³æ¥å®ç°ã€‚æ¯”å¦‚å¯ä»¥å»ºç«‹ä¸ªè¡¨ç¤ºçŠ¶æ€çš„åŸºç±»ï¼Œå†å¼„ä¸ª &lt;code&gt;isValidNextState:&lt;/code&gt; æ–¹æ³•æ¥åˆ¤æ–­è¾“å…¥çš„çŠ¶æ€æ˜¯å¦èƒ½å½“åšæ­¤çŠ¶æ€çš„ã€ä¸‹ä¸€ä¸ªçŠ¶æ€ã€ã€‚è‹¹æœçš„ &lt;code&gt;GameplayKit&lt;/code&gt; ä¸­çš„çŠ¶æ€æœºï¼ˆ&lt;code&gt;GKStateMachine&lt;/code&gt;ï¼‰å°±æ˜¯ä¸ªå¾ˆä¸é”™çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥å°±æ˜¯çŠ¶æ€çš„å“åº”ï¼Œåœ¨çŠ¶æ€è½¬æ¢æ—¶é©±åŠ¨ç•Œé¢å…ƒç´ çš„å˜åŒ–ã€‚ä»€ä¹ˆï¼Ÿä¸æ˜¯åº”è¯¥åœ¨ç‚¹å‡»æŒ‰é’®æ—¶å¯¹ç•Œé¢åšå˜æ›´ä¹ˆï¼Ÿè¿™ç§æ€ç»´å¾ˆå±€é™ï¼Œä¹Ÿæ˜¯å¯¼è‡´ä»£ç å¤ç”¨ä¸é«˜å’Œ bug é¢‘å‡ºçš„åŸå› ã€‚èƒ½å¤Ÿæ”¹å˜ç¼–è¾‘æ¨¡å¼çš„ä¸ä¸€å®šåªæœ‰æŒ‰é’®ç‚¹å‡»ï¼Œè¿™è¦æ ¹æ®äº§å“çš„ä¸šåŠ¡ã€‚æ‰€ä»¥åº”è¯¥è®©ç•Œé¢å˜æ›´ä¾èµ–äºçŠ¶æ€çš„å˜åŒ–ï¼Œè¿™æ ·æ›´é›†ä¸­ç»Ÿä¸€ï¼Œä¸å®¹æ˜“å‡ºå·®é”™ã€‚ï¼ˆä½†è¿™æ ·çš„ç¼ºç‚¹å¯èƒ½å°±æ˜¯äº§å“ç»ç†è¦æ±‚ä¸ŠæŠ¥ç”¨æˆ·è¡Œä¸ºæ—¶æ— æ³•è·çŸ¥ç”¨æˆ·ä½•ç§æ“ä½œå¯¼è‡´çŠ¶æ€å˜åŒ–ï¼Œè¿™é‡Œåªèƒ½é€šè¿‡åœ¨çŠ¶æ€ç±»ä¸­åŠ æ ‡å¿—ä½åˆ¤æ–­äº†ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;æœ€å…³é”®çš„æ˜¯åœ¨æ­£ç¡®çš„ä½ç½®æ·»åŠ çŠ¶æ€åˆ‡æ¢çš„ä»£ç ï¼Œä¸€å®šè¦è¦†ç›–å…¨é¢æ¯«æ— é—æ¼ã€‚è¿™æ˜¯ä¿è¯æ•´ä¸ªçŠ¶æ€æœºè¿è¡Œçš„å…³é”®ï¼&lt;/p&gt;
&lt;p&gt;è¯´äº†è¿™ä¹ˆå¤šï¼Œä¹Ÿæ²¡çœ‹å‡ºçŠ¶æ€æœºè·Ÿæ‰‹åŠ¿æœ‰å¤šå¤§å…³ç³»å•Šï¼Ÿç›´è§‚ç‚¹è®²ï¼Œåœ¨æ¶‚é¸¦çŠ¶æ€ä¸‹æ˜¯ä¸ä¼šå“åº”åŒæŒ‡æ“ä½œçš„æ‰‹åŠ¿çš„ï¼Œå› ä¸ºåªæœ‰å•ä¸ªæ‰‹æŒ‡çš„ Pan å’Œ Tap æ‰‹åŠ¿ï¼›è€Œåœ¨æ“ä½œæ–‡å­—å’Œè´´çº¸çš„çŠ¶æ€ä¸‹ Pinchã€Rotation å’Œ Pan æ˜¯å¯ä»¥åŒæ—¶å“åº”çš„ï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥æ—‹è½¬ç¼©æ”¾è§†å›¾çš„åŒæ—¶æŒªåŠ¨è§†å›¾ä½ç½®ï¼Œè€Œ Tap æ‰‹åŠ¿æ­¤æ—¶å¯èƒ½è¿˜ä¼šèµ‹æœ‰å…¶ä»–çš„åŠŸèƒ½ã€‚æ€»ä¹‹çŠ¶æ€æœºå°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‰€å¯¹åº”çš„æ‰‹åŠ¿æ“ä½œåˆ’åˆ†å¼€ï¼Œæä¾›äº†å‡†ç¡®å”¯ä¸€çš„åˆ¤æ–­ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸ä½¿ç”¨çŠ¶æ€æœºï¼Œï¼ˆæ‰“ä¸ªæ¯”æ–¹ï¼‰è€Œæ˜¯æ ¹æ®ç•Œé¢ä¸ŠæŸä¸ªæŒ‰é’®çš„ &lt;code&gt;selected&lt;/code&gt; æˆ–è€…æŸä¸ªè§†å›¾çš„ &lt;code&gt;hidden&lt;/code&gt; å±æ€§æ¥åˆ¤æ–­ä¸‹ä¸€æ­¥çš„æ“ä½œï¼Œé‚£è‚¯å®šä¼šå‡ºå¤§ä¹±å­ã€‚å› ä¸º UI æ§ä»¶çš„çŠ¶æ€ä¸å¯é ï¼Œèƒ½å¤Ÿæ”¹å˜å®ƒä»¬çš„å› ç´ å¾ˆå¤šï¼Œè€Œä¸”ä¼šæœ‰å¤šä¸ª UI çŠ¶æ€åŒæ—¶å­˜åœ¨å¯¼è‡´å†²çªã€‚å”¯æœ‰çŠ¶æ€æœºç‰¢ç‰¢æŠŠæˆ‘åœ¨ç¨‹åºå‘˜çš„æ‰‹é‡Œï¼Œå”¯ä¸€ä¸”å‡†ç¡®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¤„ç†ç•Œé¢å¤æ‚å¼•å‘çš„æ‰‹åŠ¿é”™ä¹±&quot;&gt;&lt;a href=&quot;#å¤„ç†ç•Œé¢å¤æ‚å¼•å‘çš„æ‰‹åŠ¿é”™ä¹±&quot; class=&quot;headerlink&quot; title=&quot;å¤„ç†ç•Œé¢å¤æ‚å¼•å‘çš„æ‰‹åŠ¿é”™ä¹±&quot;&gt;&lt;/a&gt;å¤„ç†ç•Œé¢å¤æ‚å¼•å‘çš„æ‰‹åŠ¿é”™ä¹±&lt;/h2&gt;&lt;h3 id=&quot;æƒ…æ™¯è¿˜åŸ&quot;&gt;&lt;a href=&quot;#æƒ…æ™¯è¿˜åŸ&quot; class=&quot;headerlink&quot; title=&quot;æƒ…æ™¯è¿˜åŸ&quot;&gt;&lt;/a&gt;æƒ…æ™¯è¿˜åŸ&lt;/h3&gt;&lt;p&gt;ã€ä½ çœ‹è´´çº¸è¿™ä¹ˆå¤šæ‰‹æŒ‡åˆå¤ªå¤§ç¼©æ”¾ä¸çµæ•çœŸä¸æ€ªæˆ‘å•Šï¼Œè‡£å¦¾çœŸçš„åŠä¸åˆ°å•Šï¼ã€&lt;/p&gt;
&lt;p&gt;ã€å“å‘€ï¼Œæœ¬æ¥æƒ³æ—‹è½¬æŸä¸ªè´´çº¸çš„ï¼Œç»“æœä¸¤ä¸ªæ‰‹æŒ‡åˆ†åˆ«åœ¨å¦å¤–ä¸¤ä¸ªè´´çº¸ä¸Šã€‚è¿™ä¹ˆå¤šå°è´´çº¸æ”¾è¿™ä¹ˆå¯†ç”¨æˆ·å¥½å˜æ€å•Šï¼ã€&lt;/p&gt;
&lt;p&gt;ã€‚ã€‚ã€‚çœŸæ˜¯ä¹±ï¼Œæƒ³æ“ä½œ A è§†å›¾å´æ„å¤–æ“ä½œäº† B è§†å›¾ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h3 id=&quot;åˆ†æé—®é¢˜-1&quot;&gt;&lt;a href=&quot;#åˆ†æé—®é¢˜-1&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æé—®é¢˜&quot;&gt;&lt;/a&gt;åˆ†æé—®é¢˜&lt;/h3&gt;&lt;h4 id=&quot;å¯¹æ‰‹åŠ¿ç»Ÿä¸€å¤„ç†å’Œåˆ†å‘&quot;&gt;&lt;a href=&quot;#å¯¹æ‰‹åŠ¿ç»Ÿä¸€å¤„ç†å’Œåˆ†å‘&quot; class=&quot;headerlink&quot; title=&quot;å¯¹æ‰‹åŠ¿ç»Ÿä¸€å¤„ç†å’Œåˆ†å‘&quot;&gt;&lt;/a&gt;å¯¹æ‰‹åŠ¿ç»Ÿä¸€å¤„ç†å’Œåˆ†å‘&lt;/h4&gt;&lt;p&gt;è¦æ˜¯ç»™æ¯ä¸ªè§†å›¾å†…å®¹éƒ½å•ç‹¬æ·»åŠ ä¸€å¥— Tapã€Panã€LongPressã€Pinchã€Rotation æ‰‹åŠ¿é‚£çœŸæ˜¯æ‰¾æ­»å•Šï¼Œæ‰‹åŠ¿ä¸é”™ä¹±æ‰æ€ªå‘¢ï¼åˆ«å†æŠŠæ‰‹åŠ¿é”™ä¹±å½’ç»“äºç•Œé¢ä¸Šè§†å›¾å¤šï¼Œè¦æ€ªå°±æ€ªæ·»åŠ æ‰‹åŠ¿çš„å§¿åŠ¿ä¸å¯¹ï¼&lt;/p&gt;
&lt;p&gt;å½“ç•Œé¢å†…å®¹æ•°é‡è¾ƒå¤šæ—¶è¿˜æ˜¯è¦å°Šå´‡å¤§ä¸€ç»Ÿçš„æ€æƒ³ï¼ŒæŠŠå„ç§æ‰‹åŠ¿å…¨éƒ½æ·»åŠ åˆ°åº•å±‚çš„å…¨å±è§†å›¾ä¸Šï¼Œç„¶åç»Ÿä¸€å¤„ç†å’Œåˆ†å‘ç»“æœã€‚å› ä¸ºæ¯ç§æ‰‹åŠ¿åªæœ‰ä¸€ä¸ªä¸”éƒ½åŠ åœ¨äº†åº•å±‚è§†å›¾ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿä¸åŒè§†å›¾é—´çš„æ‰‹åŠ¿é”™ä¹±ã€‚è€Œä¸åŒç§æ‰‹åŠ¿ä¹‹é—´çš„å†²çªå°±éœ€è¦åœ¨ &lt;code&gt;UIGestureRecognizerDelegate&lt;/code&gt; ä¸­æ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥è§£å†³äº†ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè¯¥å¦‚ä½•åˆ¤æ–­å“ªä¸ªè§†å›¾å“åº”äº†æ‰‹åŠ¿çš„æ“ä½œå‘¢ï¼Ÿç”¨æˆ·æœ€å¸Œæœ›çš„è‚¯å®šæ˜¯æœ€é¡¶å±‚çš„ä¸”è·ç¦»æ‰‹æŒ‡æœ€è¿‘çš„è§†å›¾ã€‚è¿™é‡Œéš¾åœ¨å¦‚ä½•é€‰æ‹©è·ç¦»æ‰‹æŒ‡æœ€è¿‘çš„è§†å›¾ã€‚&lt;/p&gt;
&lt;h4 id=&quot;è®¡ç®—å“åº”æ‰‹åŠ¿çš„è§†å›¾&quot;&gt;&lt;a href=&quot;#è®¡ç®—å“åº”æ‰‹åŠ¿çš„è§†å›¾&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç®—å“åº”æ‰‹åŠ¿çš„è§†å›¾&quot;&gt;&lt;/a&gt;è®¡ç®—å“åº”æ‰‹åŠ¿çš„è§†å›¾&lt;/h4&gt;&lt;p&gt;å¯ä»¥é€šè¿‡ &lt;code&gt;locationInView:&lt;/code&gt; è·å–æ‰‹åŠ¿çš„åæ ‡ï¼Œä½†è¿™é‡Œå†³ä¸èƒ½ç®€å•åœ°è®¡ç®—æ‰‹åŠ¿åæ ‡åˆ°è§†å›¾ &lt;code&gt;center&lt;/code&gt; çš„è·ç¦»å¹¶é€‰å–æœ€è¿‘çš„è§†å›¾ã€‚è¿™é‡Œéœ€è¦æ£€æµ‹æ‰‹åŠ¿åæ ‡å¤„äºå“ªä¸ªè§†å›¾çš„&lt;strong&gt;èŒƒå›´&lt;/strong&gt;å†…ï¼ŒåŒ…æ‹¬ã€åœ¨è§†å›¾åŒºåŸŸå†…ã€ï¼ˆçº¢è‰²ï¼‰å’Œã€åœ¨è§†å›¾å‘¨å›´åŒºåŸŸã€ï¼ˆæ©™è‰²ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/SomeExperienceofGesture/WhichViewShouldResponseToGesture.png&quot; alt=&quot;é€‰æ‹©å“åº”æ‰‹åŠ¿çš„è§†å›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç­–ç•¥æ˜¯å…ˆçœ‹æ‰‹åŠ¿åæ ‡å¤„äºå“ªäº›è§†å›¾çš„ã€è§†å›¾åŒºåŸŸã€ä¸­ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±å†æ‰©å¤§æŸ¥æ‰¾èŒƒå›´è‡³ã€å‘¨å›´åŒºåŸŸã€ã€‚æœ€åå¦‚æœæœ‰å¤šä¸ªè§†å›¾æ»¡è¶³è¦æ±‚ï¼Œå°±é€‰æ‹©æœ€é¡¶å±‚çš„è§†å›¾ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•è§†å›¾æ»¡è¶³è¦æ±‚ï¼Œå¯ä»¥ä¸åšä»»ä½•å¤„ç†ï¼›ä¹Ÿå¯ä»¥æ ¹æ®äº§å“ç­–ç•¥å¯¹ç•Œé¢ä¸Šå”¯ä¸€çš„è§†å›¾è¿›è¡Œæ“ä½œã€‚è¿™é‡Œå°±çœ‹ä¸šåŠ¡æ€ä¹ˆè§„å®šçš„äº†ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºã€å‘¨å›´åŒºåŸŸã€è¯¥å¦‚ä½•åˆ’å®šï¼Œå…·ä½“å‚æ•°å°±çœ‹äº§å“åˆ¶å®šçš„ç­–ç•¥è¿›è¡Œå¾®è°ƒäº†ã€‚æ€»ä¹‹ä¼ å…¥ä¸€ä¸ª &lt;code&gt;UIEdgeInsets&lt;/code&gt; å°±èƒ½æå®šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç”¨ä»£ç å®ç°çš„æ—¶å€™å¯ä»¥ä¼˜åŒ–é€»è¾‘æ¥å‡å°‘éå†çš„æ—¶é—´å¤æ‚åº¦ï¼šä»æœ€é¡¶å±‚è§†å›¾åˆ°æœ€åº•å±‚è§†å›¾å¼€å§‹éå†ï¼Œå¦‚æœæ‰‹åŠ¿åæ ‡å‘½ä¸­ã€è§†å›¾åŒºåŸŸã€å†…ï¼Œåˆ™ç›´æ¥å¾—å‡ºç»“æœã€‚å¦åˆ™å¦‚æœæ‰‹åŠ¿åæ ‡å‘½ä¸­ã€å‘¨å›´åŒºåŸŸã€å†…ï¼Œå°±è®¡ç®—æ‰‹åŠ¿åˆ°è§†å›¾ä¸­å¿ƒè·ç¦»å¹¶åœ¨éå†å®Œæˆåå¾—åˆ°è·ç¦»æœ€è¿‘çš„è§†å›¾ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è§£å†³é—®é¢˜&quot;&gt;&lt;a href=&quot;#è§£å†³é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³é—®é¢˜&quot;&gt;&lt;/a&gt;è§£å†³é—®é¢˜&lt;/h3&gt;&lt;h4 id=&quot;å¤„ç†-Pinch-æ‰‹åŠ¿&quot;&gt;&lt;a href=&quot;#å¤„ç†-Pinch-æ‰‹åŠ¿&quot; class=&quot;headerlink&quot; title=&quot;å¤„ç† Pinch æ‰‹åŠ¿&quot;&gt;&lt;/a&gt;å¤„ç† Pinch æ‰‹åŠ¿&lt;/h4&gt;&lt;p&gt;åœ¨è§†å›¾è¢«ç¼©æ”¾æ—¶ï¼Œä¸€èˆ¬æ˜¯æ”¹å˜ &lt;code&gt;transform&lt;/code&gt; å±æ€§ã€‚å…³äº &lt;code&gt;CGAffineTransform&lt;/code&gt; çš„çŸ¥è¯†è¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;h5 id=&quot;åˆ†è¾¨ç‡&quot;&gt;&lt;a href=&quot;#åˆ†è¾¨ç‡&quot; class=&quot;headerlink&quot; title=&quot;åˆ†è¾¨ç‡&quot;&gt;&lt;/a&gt;åˆ†è¾¨ç‡&lt;/h5&gt;&lt;p&gt;å½“å¯¹å«æœ‰çŸ¢é‡å†…å®¹çš„è§†å›¾è¿›è¡Œç¼©æ”¾æ—¶ä¼šæœ‰æ¨¡ç³Šå’Œé”¯é½¿å‡ºç°ï¼Œè¿™æ—¶é€’å½’éœ€è¦æ”¹å˜ &lt;code&gt;UIView&lt;/code&gt; çš„ &lt;code&gt;contentScaleFactor&lt;/code&gt; å’Œ &lt;code&gt;CALayer&lt;/code&gt; çš„ &lt;code&gt;contentsScale&lt;/code&gt; å±æ€§ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)updateForZoomScale:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)zoomScale &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; screenAndZoomScale = zoomScale * [&lt;span class=&quot;built_in&quot;&gt;UIScreen&lt;/span&gt; mainScreen].scale;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Walk the layer and view hierarchies separately. We need to reach all tiled layers.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; applyScale:screenAndZoomScale toView:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; applyScale:screenAndZoomScale toLayer:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.layer];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)applyScale:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)scale toView:(&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *)view &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    view.contentScaleFactor = scale;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *subview &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; view.subviews) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; applyScale:scale toView:subview];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)applyScale:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)scale toLayer:(&lt;span class=&quot;built_in&quot;&gt;CALayer&lt;/span&gt; *)layer &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    layer.contentsScale = scale;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;CALayer&lt;/span&gt; *sublayer &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; layer.sublayers) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; applyScale:scale toLayer:sublayer];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;åæ ‡&quot;&gt;&lt;a href=&quot;#åæ ‡&quot; class=&quot;headerlink&quot; title=&quot;åæ ‡&quot;&gt;&lt;/a&gt;åæ ‡&lt;/h5&gt;&lt;p&gt;è§†å›¾çš„ &lt;code&gt;transform&lt;/code&gt; å±æ€§æ˜¯ä¸ä¼šä¿®æ”¹è§†å›¾çš„ &lt;code&gt;bounds&lt;/code&gt; çš„ï¼Œä½† &lt;code&gt;frame&lt;/code&gt; ä½œä¸ºè®¡ç®—å±æ€§è¿˜æ˜¯ä¼šå˜åŒ–çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºè§†å›¾æ”¾å¤§äº†å¤šå°‘å€ï¼Œè§†å›¾å†…éƒ¨çš„å­è§†å›¾çš„ &lt;code&gt;frame&lt;/code&gt; ä¸ä¼šå˜ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œ&lt;code&gt;transform&lt;/code&gt; å±æ€§æ”¹å˜çš„æ˜¯è§†å›¾çš„ &lt;code&gt;frame&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;bounds&lt;/code&gt; å’Œå­è§†å›¾çš„ &lt;code&gt;frame&lt;/code&gt; éƒ½ä¸ä¼šå˜ã€‚ä¹Ÿå°±æ˜¯&lt;strong&gt;è§†å›¾å†…éƒ¨çš„åæ ‡ç³»ä¸ä¼šæ”¹å˜&lt;/strong&gt;ã€‚è®°ä½è¿™ç‚¹ï¼Œå¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/SomeExperienceofGesture/transform%E5%AF%B9%E6%AF%94%E5%9D%90%E6%A0%87.png&quot; alt=&quot;æ”¹å˜ transform åçš„åæ ‡ç³»&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾å±•ç¤ºçš„æ˜¯ç¼©æ”¾åçš„åæ ‡å˜æ¢ï¼Œä¹ŸåŒæ ·é€‚ç”¨äºæ—‹è½¬ã€‚éƒ½æ˜¯ç›¸å¯¹åæ ‡ç³»çš„çŸ¥è¯†ç½¢äº†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;å¤„ç†-Rotation-æ‰‹åŠ¿&quot;&gt;&lt;a href=&quot;#å¤„ç†-Rotation-æ‰‹åŠ¿&quot; class=&quot;headerlink&quot; title=&quot;å¤„ç† Rotation æ‰‹åŠ¿&quot;&gt;&lt;/a&gt;å¤„ç† Rotation æ‰‹åŠ¿&lt;/h4&gt;&lt;p&gt;ä¹‹å‰ä¸€ç›´ç”¨ã€è§†å›¾åŒºåŸŸã€è€Œä¸ç›´æ¥ç”¨ &lt;code&gt;frame&lt;/code&gt; æ¥æè¿°æ‰‹åŠ¿åˆ¤æ–­ä¾æ®ï¼Œæ˜¯å› ä¸ºå½“è§†å›¾æ—‹è½¬ï¼ˆ90Â°å€æ•°é™¤å¤–ï¼‰ä¹‹å &lt;code&gt;frame&lt;/code&gt; å¹¶ä¸ç­‰äºã€è§†å›¾åŒºåŸŸã€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/SomeExperienceofGesture/Rotation%E5%8C%BA%E5%9F%9F%E5%88%A4%E6%96%AD.png&quot; alt=&quot;æ—‹è½¬åçš„è§†å›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å¦‚æœæŒ‰ç…§ &lt;code&gt;frame&lt;/code&gt; æ¥åˆ¤æ–­ã€è§†å›¾åŒºåŸŸã€æ˜¯åå¤§çš„ï¼Œä¼šé®æŒ¡ä½å…¶ä»–è§†å›¾ã€‚æ‰€ä»¥æˆ‘ä¸“é—¨å†™äº†ä¸ªæ–¹æ³•ç”¨äºåˆ¤æ–­æŸä¸ªç‚¹æ˜¯å¦åœ¨ã€è§†å›¾åŒºåŸŸã€å†…ï¼Œè¿˜æä¾›äº† &lt;code&gt;UIEdgeInsets&lt;/code&gt; å‚æ•°ç”¨äºæ»¡è¶³åˆ¤æ–­ã€å‘¨å›´åŒºåŸŸã€çš„è¦æ±‚ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  åˆ¤æ–­æŸä¸ªç‚¹æ˜¯å¦åœ¨è§†å›¾åŒºåŸŸå†…ï¼Œé’ˆå¯¹ transform åšäº†è½¬æ¢è®¡ç®—ï¼Œå¹¶æä¾› UIEdgeInsets ç¼©æ”¾åŒºåŸŸçš„å‚æ•°&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param point  è¦åˆ¤æ–­çš„ç‚¹åæ ‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param view   ä¼ å…¥çš„è§†å›¾ï¼Œä¸€å®šè¦ä¸æœ¬è§†å›¾å¤„äºåŒä¸€è§†å›¾æ ‘ä¸­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param insets UIEdgeInsetså‚æ•°å¯ä»¥è°ƒæ•´åˆ¤æ–­çš„è¾¹ç•Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @return BOOLç±»å‹ï¼Œè¿”å›ç‚¹åæ ‡æ˜¯å¦ä½äºè§†å›¾å†…&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)checkPoint:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;) point inView:(&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *)view withInsets:(&lt;span class=&quot;built_in&quot;&gt;UIEdgeInsets&lt;/span&gt;)insets&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 &lt;span class=&quot;comment&quot;&gt;// å°†ç‚¹åæ ‡è½¬åŒ–ä¸ºè§†å›¾å†…åæ ‡ç³»çš„ç‚¹ï¼Œæ¶ˆé™¤ transform å¸¦æ¥çš„å½±å“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt; convertedPoint = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; convertPoint:point toView:view];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGAffineTransform&lt;/span&gt; viewTransform = view.transform;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è®¡ç®—è§†å›¾ç¼©æ”¾æ¯”ä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; scale = sqrt(viewTransform.a * viewTransform.a + viewTransform.c * viewTransform.c);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å°† UIEdgeInsets é™¤ä»¥ç¼©æ”¾æ¯”ä¾‹ï¼Œä»¥ä¾¿å¾—åˆ°çœŸå®çš„ã€å‘¨å›´åŒºåŸŸã€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIEdgeInsets&lt;/span&gt; scaledInsets = (&lt;span class=&quot;built_in&quot;&gt;UIEdgeInsets&lt;/span&gt;)&amp;#123;insets.top/scale,insets.left/scale,insets.bottom/scale,insets.right/scale&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGRect&lt;/span&gt; resultRect = &lt;span class=&quot;built_in&quot;&gt;UIEdgeInsetsInsetRect&lt;/span&gt;(view.bounds, scaledInsets);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// åˆ¤æ–­ç»™å®šåæ ‡ç‚¹æ˜¯å¦åœ¨åŒºåŸŸå†…&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;CGRectContainsPoint&lt;/span&gt;(resultRect, convertedPoint)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç»è¿‡æ­¤æ–¹æ³•å¤„ç†åä¼šä½¿å¾—åŒºåŸŸåˆ¤æ–­æ›´å‡†ç¡®ï¼Œé‚£äº›æ—‹è½¬è¿‡çš„è§†å›¾å¸¦æ¥çš„æ‰‹åŠ¿å¤±æ•ˆä¹Ÿå¾—ä»¥è§£å†³ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;å…¶å®å¦‚æœæ‰€æœ‰æ‰‹åŠ¿éƒ½äº¤ç»™ä¸€ä¸ªåº•å±‚è§†å›¾ç»Ÿä¸€å¤„ç†çš„è¯ï¼Œä¸Šå±‚é‚£ä¸€å¨è§†å›¾æ˜¯ä¸éœ€è¦å“åº”è§¦æ‘¸äº‹ä»¶çš„ï¼Œæœ‰äº›ç”šè‡³å¯ä»¥ç”¨ Layer æ¥åšã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;UIGestureRecognizerDelegate&lt;/code&gt; å’Œ &lt;code&gt;hitTest:withEvent:&lt;/code&gt; çš„ç”¨æ³•å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¯¦ç»†é˜è¿°ï¼Œèƒ½å¤Ÿè§£å†³æ‰‹åŠ¿é—®é¢˜çš„å‰ææ˜¯ç†Ÿæ‚‰æ–‡æ¡£ï¼Œç„¶åæ‰æ˜¯ä¸€äº›æ€æƒ³å’Œæ¶æ„å±‚é¢çš„è§£å†³æ–¹æ¡ˆã€‚æ¯”å¦‚ Tap æ‰‹åŠ¿è¦å…ˆè®© Pan æ‰‹åŠ¿å¤±è´¥ä¹‹ç±»çš„æ‰‹åŠ¿å†²çªå°±å¯ä»¥ç”¨ &lt;code&gt;UIGestureRecognizerDelegate&lt;/code&gt; å¤„ç†ï¼Œä¸å†åˆ—ä¸¾ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç¢°åˆ°çš„åº”ç”¨åœºæ™¯æœ‰é™ï¼Œç»éªŒä¸å¤Ÿå¤šï¼Œè¿˜è¯·å¤§å®¶è¡¥å……ç»éªŒï¼ &lt;/p&gt;
&lt;h2 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/5927223/scaling-uitextview-using-contentscalefactor-property&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://stackoverflow.com/questions/5927223/scaling-uitextview-using-contentscalefactor-property&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœä¸€ä¸ªé¡µé¢ä¸ŠåŒ…å«ç€å¾ˆå¤šè§†å›¾ï¼Œè€Œä¸”ç•Œé¢ä¸Šä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆæ‰‹åŠ¿å“åº”å†²çªæˆ–è€…é”™ä¹±å¾ˆå®¹æ˜“å‘ç”Ÿã€‚è¿™æ—¶å°±å¾—çŒ¥çç‚¹å•¦ï¼Œè§æ‹›æ‹†æ‹›ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªåˆ¶ä¸€æ¬¾å¼ºå¤§çš„ ActionSheet</title>
    <link href="http://yulingtianxia.com/blog/2016/07/18/TBActionSheet/"/>
    <id>http://yulingtianxia.com/blog/2016/07/18/TBActionSheet/</id>
    <published>2016-07-18T04:36:15.000Z</published>
    <updated>2016-07-17T16:38:38.000Z</updated>
    
    <content type="html">&lt;p&gt;iOS ç³»ç»Ÿè‡ªå¸¦çš„ &lt;code&gt;UIActionSheet&lt;/code&gt; æ— æ³•æ»¡è¶³å¼€å‘ä¸­é«˜åº¦ä¸ªæ€§åŒ–çš„ UI é£æ ¼å’Œä»£ç é£æ ¼ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œäºæ˜¯ &lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;TBActionSheet&lt;/code&gt;&lt;/a&gt; è¯ç”Ÿäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/yulingtianxia/TBActionSheet/blob/master/images/demo.gif?raw=true&quot; width=&quot;50%&quot; height=&quot;50%&quot;&gt;&lt;/p&gt;
&lt;p&gt;Githubï¼š&lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/TBActionSheet&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;TBActionSheet&lt;/code&gt;&lt;/a&gt; ä¸ä»…è¿˜åŸäº† &lt;code&gt;UIActionSheet&lt;/code&gt; çš„å‡ ä¹æ‰€æœ‰åŠŸèƒ½å’Œ APIï¼Œè¿˜åœ¨æ­¤åŸºç¡€ä¸Šæ”¯æŒå¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;block è¯­æ³•&lt;/li&gt;
&lt;li&gt;æ’å…¥è‡ªå®šä¹‰çš„ Header è§†å›¾&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰å­—ä½“ã€é¢œè‰²ã€å°ºå¯¸ã€åœ†è§’ç­‰&lt;/li&gt;
&lt;li&gt;å°†æ¯›ç»ç’ƒæ•ˆæœæ”¯æŒåˆ°äº† iOS7ï¼Œä¸”å¯ä»¥å®šä¹‰é¢œè‰²&lt;/li&gt;
&lt;li&gt;æ”¯æŒ Cocoapods å’Œ Carthage&lt;/li&gt;
&lt;li&gt;æ”¯æŒåœ¨ Title ä¸‹é¢è®¾ç½® Message&lt;/li&gt;
&lt;li&gt;æ”¯æŒç‚¹å‡»èƒŒæ™¯å…³é—­&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨æ˜¾ç¤ºååŠ¨æ€æ›´æ–° UI&lt;/li&gt;
&lt;/ol&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;ä¸ºä½•è¦é€ è¿™ä¸ªè½®å­&quot;&gt;&lt;a href=&quot;#ä¸ºä½•è¦é€ è¿™ä¸ªè½®å­&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä½•è¦é€ è¿™ä¸ªè½®å­&quot;&gt;&lt;/a&gt;ä¸ºä½•è¦é€ è¿™ä¸ªè½®å­&lt;/h1&gt;&lt;p&gt;å¯èƒ½ä¸Šåˆè§†è§‰åŒå­¦è¦æ±‚æ‰€æœ‰ç³»ç»Ÿç‰ˆæœ¬çš„ ActionSheet éƒ½è¦åšæˆ iOS9 çš„åœ†è§’æ ·å¼ï¼Œä¸‹åˆå°±æ¨ç¿»åšæˆè·Ÿå¾®ä¿¡ä¸€æ¨¡ä¸€æ ·ï¼Œæ™šä¸Šåˆè§‰å¾—å¾®ä¿¡çš„å¥½ä¸‘é£æ ¼ä¸æ­ã€‚ã€‚ã€‚å¦‚ä½•ä»¥ä¸å˜åº”ä¸‡å˜ï¼Ÿè‡ªå·±é€ ä¸ªä¸‡èƒ½è½®å­ï¼&lt;/p&gt;
&lt;p&gt;å…¶å®æœ‰ä¸€äº›å¼€æºçš„ ActionSheetï¼Œä½†éƒ½ä¸æ»¡è¶³æˆ‘çš„è¦æ±‚ï¼š&lt;strong&gt;é«˜åº¦ä¸ªæ€§åŒ–ï¼Œç§äººå®šåˆ¶&lt;/strong&gt;ï¼Œè€Œä¸”&lt;strong&gt;å‡ ä¹å…¶ä»–å¼€æºçš„ ActionSheet éƒ½ä¸æ”¯æŒè‡ªåŠ¨æ—‹è½¬ï¼Œåªæ”¯æŒç«–å±ä¸èƒ½æ¨ªå±&lt;/strong&gt;ã€‚è€Œç³»ç»Ÿçš„ &lt;code&gt;UIActionSheet&lt;/code&gt; æ˜¯æ”¯æŒè¿™ä¸ªåŠŸèƒ½çš„ã€‚&lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;TBActionSheet&lt;/code&gt;&lt;/a&gt; åšåˆ°åœ¨ iOS8+ ä¸Šçš„æ—‹è½¬å±å¹•é€‚é…ï¼Œä¹‹æ‰€ä»¥ä¸å…¼å®¹ iOS7+ æ˜¯å› ä¸º iOS7 å’Œ iOS8+ çš„æ—‹è½¬æœºåˆ¶å’Œåæ ‡ä½“ç³»æœ‰è¾ƒå¤§å·®åˆ«ï¼Œæ€»ç»“ä¸ºä¸€ä¸ªå­—ï¼š&lt;strong&gt;æ‡’&lt;/strong&gt;ï¼&lt;/p&gt;
&lt;p&gt;å…¶å®é€ è¿™ä¸ªè½®å­çš„åŸå› è¿˜çœŸå°±æ˜¯å› ä¸º&lt;strong&gt;æ‡’&lt;/strong&gt;ï¼å› ä¸ºè§†è§‰åŒå­¦ç»å¸¸ä¼šè°ƒæ•´é£æ ¼ï¼Œæ”¹æ¥æ”¹å»çœŸçš„ä¼šäº§ç”Ÿå¤§é‡åºŸå¼ƒçš„å†—ä½™ä»£ç ï¼Œå› ä¸ºæ€•æœªæ¥æŸä¸ªæ—¶é—´ç‚¹åˆè¢«æ”¹å›å»ï¼Œæ‰€ä»¥ä¸æ•¢åˆ ä»£ç åªå¥½æ³¨é‡Šæ‰ã€‚&lt;strong&gt;æˆ‘å°±æ˜¯è¦åšä¸ªé«˜åº¦ä¸ªæ€§åŒ–çš„ç»„ä»¶ï¼Œæ¯æ¬¡ä¿®æ”¹ UI åªéœ€è¦ä¿®æ”¹å‡ ä¸ªå±æ€§å°±å¯ä»¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ä¸Šé¢åŠŸèƒ½åˆ—è¡¨åˆ—å‡ºçš„ç¬¬ 1 æ¡å’Œç¬¬ 6 æ¡ï¼Œç³»ç»Ÿçš„ &lt;code&gt;UIAlertController&lt;/code&gt; ä¹Ÿå¯ä»¥åŠå¾—åˆ°ï¼Œä½†ç¼ºç‚¹æ˜¯åªèƒ½åœ¨ iOS8+ ä½¿ç”¨ã€‚è€Œ &lt;code&gt;UIActionSheet&lt;/code&gt; å’Œ &lt;code&gt;UIAlertView&lt;/code&gt; å´åœ¨ iOS8.3 è¢«åºŸå¼ƒï¼Œè¿™æ˜¯ä¸ªé’é»„ä¸æ¥çš„å¹´ä»£ï¼Œä¸ºæ­¤æˆ‘æ›¾ç»å¼€å‘äº† &lt;code&gt;TBAlertController&lt;/code&gt; æ¥å…¼å®¹é«˜ä½å„ç§ç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œå®ç°åŸç†åœ¨ &lt;a href=&quot;http://yulingtianxia.com/blog/2015/11/13/Summary-of-the-first-month-in-the-internship-of-Tencent/&quot;&gt;è…¾è®¯å®ä¹ ç¬¬ä¸€ä¸ªæœˆå·¥ä½œæ€»ç»“&lt;/a&gt; æœ‰è¯¦ç»†è®²è§£ã€‚&lt;code&gt;TBAlertController&lt;/code&gt; ä½¿ç”¨çš„éƒ½æ˜¯ç³»ç»Ÿæ§ä»¶ï¼Œä¸å¯å®šåˆ¶ï¼Œä½†ä¹Ÿè¢«æˆ‘é›†æˆåˆ°äº† &lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;TBActionSheet&lt;/code&gt;&lt;/a&gt; é¡¹ç›®ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åšåˆ°åŠŸèƒ½å¼ºå¤§é«˜åº¦ä¸ªæ€§åŒ–çš„åŒæ—¶ä¹Ÿè¦æ³¨é‡å¯¹ç³»ç»Ÿæ§ä»¶åŸæœ‰ API çš„æœ€å¤§è¿˜åŸï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹åªéœ€è¦å°†ä»£ç ä¸­çš„ &lt;code&gt;UI&lt;/code&gt; æ›¿æ¢æˆ &lt;code&gt;TB&lt;/code&gt; å³å¯ï¼Œé™ä½æ”¹åŠ¨æˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ç•Œé¢ç»„æˆ&quot;&gt;&lt;a href=&quot;#ç•Œé¢ç»„æˆ&quot; class=&quot;headerlink&quot; title=&quot;ç•Œé¢ç»„æˆ&quot;&gt;&lt;/a&gt;ç•Œé¢ç»„æˆ&lt;/h1&gt;&lt;p&gt;ä» UI ä¸Šå¤§è‡´åˆ’åˆ†æˆå‡ ä¸ªåŒºåŸŸï¼Œå®ƒä»¬éƒ½åœ¨ &lt;code&gt;TBActionSheet&lt;/code&gt; çš„è§†å›¾å±‚çº§æ ‘ä¸­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;TBActionBackground&lt;/code&gt; ä¸ºåŠé€æ˜èƒŒæ™¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TBActionContainer&lt;/code&gt; æ˜¯å®¹çº³ Sheet è§†å›¾çš„å®¹å™¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;titleLabel&lt;/code&gt; å’Œ &lt;code&gt;messageLabel&lt;/code&gt; å±æ€§æ˜¯æ ‡é¢˜å’Œæ¶ˆæ¯ï¼Œç±»å‹ä¸º &lt;code&gt;UILabel&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;customView&lt;/code&gt; å±æ€§æ˜¯ä¸ªæ™®é€šçš„ &lt;code&gt;UIView&lt;/code&gt;ï¼Œä¾›ä½¿ç”¨è€…ä¼ å…¥è‡ªå®šä¹‰è§†å›¾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TBActionButton&lt;/code&gt; æ˜¯å¯¹åº”ç€æ¯ä¸ª Action çš„æŒ‰é’®&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/TBActionSheet/overview.jpg&quot; alt=&quot;è§†å›¾å±‚çº§&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„åæ ‡å’Œå°ºå¯¸éƒ½æ˜¯ä»£ç è®¡ç®—å‡ºæ¥çš„ï¼Œæ²¡æœ‰ç”¨è‡ªåŠ¨å¸ƒå±€ï¼Œå®¹å™¨çš„å¤§å°æ˜¯æ ¹æ®å…¶å­è§†å›¾çš„ frame å†³å®šçš„ï¼Œè¿™å…¶ä¸­åŒ…å«å¾ˆå¤šè®¡ç®—ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…ä½¿ç”¨æ—¶åªéœ€ä½¿ç”¨ &lt;code&gt;TBActionSheet&lt;/code&gt; å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ä¸Šé¢æåˆ°çš„ç±»éƒ½æ˜¯å¹•åå·¥ä½œè€…ã€‚æˆ‘å°†ä¼šè®²è¿°æ¯éƒ¨åˆ†å…·ä½“å®ç°å’Œä¸€äº›åŠŸèƒ½ç‚¹çš„å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;èƒŒæ™¯æ˜¯ &lt;code&gt;TBActionSheet&lt;/code&gt; çš„å­è§†å›¾ä¸­æœ€åº•å±‚çš„è§†å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionBackground&lt;/code&gt; ç»§æ‰¿äº &lt;code&gt;UIImageView&lt;/code&gt;ï¼Œè™½ç„¶ç›®å‰åªæ˜¯ä¸ªæ‹¥æœ‰åŠé€æ˜é»‘è‰²çš„å¯ç›¸åº”ç‚¹å‡»äº‹ä»¶çš„è§†å›¾ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ‹“å±•æ€§ï¼Œå…è®¸ä½¿ç”¨è€…åœ¨èƒŒæ™¯ä¸Šè®¾ç½®å›¾ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»èƒŒæ™¯åä¼šè°ƒç”¨çˆ¶è§†å›¾ &lt;code&gt;TBActionSheet&lt;/code&gt; çš„ &lt;code&gt;close&lt;/code&gt; æ–¹æ³•å…³é—­ï¼Œåç»­ä¼šæœ‰è¯¦è¿°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®¹å™¨&quot;&gt;&lt;a href=&quot;#å®¹å™¨&quot; class=&quot;headerlink&quot; title=&quot;å®¹å™¨&quot;&gt;&lt;/a&gt;å®¹å™¨&lt;/h2&gt;&lt;p&gt;æˆ‘åœ¨å®ç°çš„æ—¶å€™æ²¡æœ‰ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€ï¼Œè€Œæ˜¯è‡ªå·±è®¡ç®— frameã€‚å®¹å™¨çš„ä½œç”¨æ˜¯æŠŠä¸€ç³»åˆ—å†…å®¹åŒ…è£…èµ·æ¥ï¼Œæ–¹ä¾¿è®¡ç®— frameã€‚&lt;code&gt;TBActionContainer&lt;/code&gt; å®¹çº³äº†æ•´ä¸ª ActionSheet çš„ä¸»ä½“åŠŸèƒ½è§†å›¾ï¼Œç³»ç»Ÿçš„æ¯›ç»ç’ƒæ•ˆæœä¹Ÿæ˜¯åœ¨è¿™æ·»åŠ çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionSheet&lt;/code&gt; ä¸­å¥½å¤šå±æ€§å…¶å®å¹¶ä¸æ˜¯ä½œä¸º &lt;code&gt;TBActionSheet&lt;/code&gt; çš„å­è§†å›¾ï¼Œè€Œæ˜¯ &lt;code&gt;TBActionContainer&lt;/code&gt; çš„å­è§†å›¾ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;titleLabel&lt;/code&gt;ã€&lt;code&gt;messageLabel&lt;/code&gt;ã€&lt;code&gt;customView&lt;/code&gt; ä»¥åŠ&lt;code&gt;buttons&lt;/code&gt; æ•°ç»„ä¸­çš„ &lt;code&gt;TBActionButton&lt;/code&gt; å¯¹è±¡ã€‚æ—¢ç„¶è¿™äº›è§†å›¾éƒ½æ˜¯å®¹å™¨çš„å­è§†å›¾ï¼Œä¸ºä½•ä¸åœ¨å®¹å™¨ä¸­å£°æ˜å¯¹åº”çš„å±æ€§å‘¢ï¼Ÿç›®çš„æ˜¯å°½é‡å°†è§†å›¾æš´éœ²ç»™ &lt;code&gt;TBActionSheet&lt;/code&gt; ä¸Šé›†ä¸­å¤„ç†ï¼Œä¹Ÿæ–¹ä¾¿å¯¹å¤–é›†ä¸­æä¾›å±æ€§å’Œæ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionContainer&lt;/code&gt; ä¸­æœ‰å¯¹ &lt;code&gt;TBActionSheet&lt;/code&gt; çš„å¼±å¼•ç”¨ï¼Œç›®çš„æ˜¯ä¾¿äºè·å–ä¸€äº›å±æ€§å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸º &lt;code&gt;header&lt;/code&gt;ï¼Œ&lt;code&gt;custom&lt;/code&gt;ï¼Œ&lt;code&gt;footer&lt;/code&gt; ä»¥åŠ &lt;code&gt;buttons&lt;/code&gt; å’Œ &lt;code&gt;separators&lt;/code&gt; æ•°ç»„ã€‚Separator æŒ‡çš„æ˜¯æŒ‰é’®ä¹‹é—´çš„ç©ºéš™ï¼Œå¯ä»¥è®¾ç½®èƒŒæ™¯é¢œè‰²ã€‚ä¹Ÿå°±æ˜¯è¯´å®¹å™¨ä¸‹é¢è¿˜æœ‰å‡ ä¸ªå°å®¹å™¨ï¼Œæ¯”å¦‚ &lt;code&gt;header&lt;/code&gt; å®¹çº³æ ‡é¢˜å’Œæ¶ˆæ¯ï¼Œ&lt;code&gt;custom&lt;/code&gt; å®¹çº³è‡ªå®šä¹‰è§†å›¾ï¼Œè€Œ &lt;code&gt;footer&lt;/code&gt; ç›®å‰æ˜¯ç©ºçš„ï¼Œä»…ä½œä¸ºæ‹“å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionContainer&lt;/code&gt; ç»§æ‰¿äº &lt;code&gt;UIImageView&lt;/code&gt;ï¼Œ&lt;code&gt;header&lt;/code&gt;ï¼Œ&lt;code&gt;custom&lt;/code&gt;ï¼Œ&lt;code&gt;footer&lt;/code&gt; ç±»å‹ä¹Ÿéƒ½æ˜¯ &lt;code&gt;UIImageView&lt;/code&gt;ã€‚è¿™æ˜¯ä¸ºäº†å®ç°æ¯›ç»ç’ƒæ•ˆæœï¼Œåç»­ä¼šæœ‰è¯¦è¿°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ ‡é¢˜-amp-æ¶ˆæ¯&quot;&gt;&lt;a href=&quot;#æ ‡é¢˜-amp-æ¶ˆæ¯&quot; class=&quot;headerlink&quot; title=&quot;æ ‡é¢˜&amp;amp;æ¶ˆæ¯&quot;&gt;&lt;/a&gt;æ ‡é¢˜&amp;amp;æ¶ˆæ¯&lt;/h2&gt;&lt;p&gt;ç³»ç»Ÿçš„ &lt;code&gt;UIActionSheet&lt;/code&gt; åªæ”¯æŒæ ‡é¢˜æ²¡æœ‰æ¶ˆæ¯ï¼Œä½†å¯ä»¥é€šè¿‡æ¢è¡Œçš„æ–¹å¼ä¼ªè£…ä¸‹æ ‡é¢˜å’Œæ¶ˆæ¯ã€‚æˆ‘è¿™é‡Œå½“ç„¶æ˜¯ç”¨ä¸¤ä¸ª &lt;code&gt;UILabel&lt;/code&gt; æ¥å®ç°æ ‡é¢˜å’Œæ¶ˆæ¯çš„å•¦ï¼Œå­—ä½“é¢œè‰²ä¹Ÿå°½é‡è¿˜åŸ &lt;code&gt;UIAlertController&lt;/code&gt; çš„æ ·å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionSheet&lt;/code&gt; çš„ &lt;code&gt;titleLabel&lt;/code&gt; å’Œ &lt;code&gt;messageLabel&lt;/code&gt; å±æ€§æ˜¯ &lt;code&gt;readonly&lt;/code&gt; çš„ï¼Œå®ƒä»¬éƒ½æ˜¯ &lt;code&gt;TBActionContainer&lt;/code&gt; çš„ &lt;code&gt;header&lt;/code&gt; å±æ€§çš„å­è§†å›¾ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è‡ªå®šä¹‰è§†å›¾&quot;&gt;&lt;a href=&quot;#è‡ªå®šä¹‰è§†å›¾&quot; class=&quot;headerlink&quot; title=&quot;è‡ªå®šä¹‰è§†å›¾&quot;&gt;&lt;/a&gt;è‡ªå®šä¹‰è§†å›¾&lt;/h2&gt;&lt;p&gt;&lt;code&gt;TBActionSheet&lt;/code&gt; çš„ &lt;code&gt;customView&lt;/code&gt; å±æ€§å¯ä¾›ä½¿ç”¨è€…ä¼ å…¥ä¸€ä¸ª &lt;code&gt;UIView&lt;/code&gt; å¯¹è±¡ï¼Œå®ƒæ˜¯ &lt;code&gt;TBActionContainer&lt;/code&gt; çš„ &lt;code&gt;custom&lt;/code&gt; å±æ€§çš„å­è§†å›¾ã€‚è‡ªå®šä¹‰è§†å›¾èƒ½å¤Ÿæ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æŒ‰é’®&quot;&gt;&lt;a href=&quot;#æŒ‰é’®&quot; class=&quot;headerlink&quot; title=&quot;æŒ‰é’®&quot;&gt;&lt;/a&gt;æŒ‰é’®&lt;/h2&gt;&lt;p&gt;æ‰€æœ‰çš„æŒ‰é’®éƒ½å­˜å‚¨äº &lt;code&gt;TBActionSheet&lt;/code&gt; çš„ &lt;code&gt;buttons&lt;/code&gt; æ•°ç»„ä¸­ï¼Œç±»å‹ä¸º &lt;code&gt;TBActionButton&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionButton&lt;/code&gt; ç»§æ‰¿äº &lt;code&gt;UIButton&lt;/code&gt;ï¼Œæœ‰ä¸‰ç§ &lt;code&gt;style&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef &lt;span class=&quot;type&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;TBActionButtonStyle&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBActionButtonStyleDefault&lt;/span&gt; = 0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBActionButtonStyleCancel&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBActionButtonStyleDestructive&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;TBActionButton&lt;/code&gt; è¿˜æä¾›äº† &lt;code&gt;normalColor&lt;/code&gt; å’Œ &lt;code&gt;highlightedColor&lt;/code&gt; å±æ€§ï¼Œç”¨äºè®¾ç½®æŒ‰é’®ä¸åŒçŠ¶æ€ä¸‹çš„é¢œè‰²ã€‚å¦‚æœå¼€å¯äº†æ¯›ç»ç’ƒæ•ˆæœä¸”è®© Container çš„èƒŒæ™¯é€æ˜ï¼Œé‚£å°±éœ€è¦ä¸ºå®¹å™¨ä¸­æ¯ä¸ªå•ç‹¬çš„è§†å›¾æ·»åŠ æ¯›ç»ç’ƒæ•ˆæœï¼Œæ‰€ä»¥æ¯ä¸ªæŒ‰é’®èƒŒåéƒ½éœ€è¦åˆ†åˆ«æ”¾ç½®ä¸€ä¸ªåŒç­‰å¤§å°çš„è§†å›¾ç”¨äºæ¯›ç»ç’ƒæ•ˆæœå’Œå˜æ¢é¢œè‰²ã€‚&lt;code&gt;behindColorView&lt;/code&gt; å±æ€§å°±æ˜¯è®¾ç½®é¢œè‰²çš„è§†å›¾ã€‚åœ¨æŒ‰é’®é«˜äº®æ—¶å®ƒçš„ &lt;code&gt;alpha&lt;/code&gt; ä¼šè¢«è®¾æˆ 0.5ã€‚æœ‰å…³æ¯›ç»ç’ƒæ•ˆæœå…·ä½“å®ç°ç»†èŠ‚åç»­ä¼šè¯¦è¿°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ”¯æŒ block è¯­æ³•ï¼Œ&lt;code&gt;TBActionButton&lt;/code&gt; å†…éƒ¨ä¿ç•™äº†ä¸€ä¸ªåªè¯»çš„ block å±æ€§ &lt;code&gt;handler&lt;/code&gt;ï¼Œè€Œè®¾ç½® block åªèƒ½é€šè¿‡å®ƒçš„å·¥å‚æ–¹æ³•ï¼Œå®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;instancetype)buttonWithTitle:(NSString &lt;/span&gt;*)title style:(TBActionButtonStyle)style handler:(void (^ __nullable)( TBActionButton * _Nonnull &lt;span class=&quot;keyword&quot;&gt;button))handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TBActionButton *&lt;span class=&quot;keyword&quot;&gt;button &lt;/span&gt;= [TBActionButton &lt;span class=&quot;keyword&quot;&gt;buttonWithType:UIButtonTypeCustom];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    &lt;span class=&quot;keyword&quot;&gt;button.style &lt;/span&gt;= style&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;button.handler &lt;/span&gt;= handler&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;button.clipsToBounds &lt;/span&gt;= YES&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;button &lt;/span&gt;setTitle:title forState:UIControlStateNormal]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;button &lt;/span&gt;setBackgroundColor:[UIColor clearColor]]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;button.titleLabel &lt;/span&gt;setFont:[UIFont systemFontOfSize:&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;]]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &lt;span class=&quot;keyword&quot;&gt;button;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é™¤äº†è¿™ä¸ªç‰ˆæœ¬çš„å·¥å‚æ–¹æ³•ï¼Œè¿˜æœ‰ä¸ªä¸æä¾› &lt;code&gt;handler&lt;/code&gt; å‚æ•°çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (instance&lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt;)buttonWithTitle:(&lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *)title style:(&lt;span class=&quot;type&quot;&gt;TBActionButtonStyle&lt;/span&gt;)style;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è‡³äº block çš„å±æ€§å†…å­˜ç®¡ç†è¯­ä¹‰æ˜¯ç”¨ &lt;code&gt;strong&lt;/code&gt; è¿˜æ˜¯ &lt;code&gt;copy&lt;/code&gt;ï¼Œå…¶å®è¿™æ˜¯ä¸ªå†å²é—®é¢˜ï¼Œåœ¨ MRC æ—¶ä»£æ˜¯éœ€è¦ç”¨ &lt;code&gt;copy&lt;/code&gt; çš„ï¼Œå› ä¸º ARC ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œ &lt;code&gt;copy&lt;/code&gt;ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ &lt;code&gt;strong&lt;/code&gt; ä¹Ÿå¯ä»¥ã€‚è‹¹æœå®˜æ–¹çš„æ€åº¦æ¯”è¾ƒæ¢æ—§ï¼Œå»ºè®®ä»ç„¶ä½¿ç”¨ &lt;code&gt;copy&lt;/code&gt;ï¼Œè™½ç„¶è¿™å¹¶æ²¡ä»€ä¹ˆä¹±ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæŒ‰é’®çš„æ•°é‡æ¯•ç«Ÿæœ‰é™ï¼Œå¯¹äºæŒ‰é’®åœ†è§’çš„å®ç°å°±ä¸éœ€è¦è€ƒè™‘æ€§èƒ½é—®é¢˜äº†ã€‚æœ‰å…³åœ†è§’çš„è¿™éƒ¨åˆ†åç»­ä¼šæœ‰ä¸“é—¨ä¸€èŠ‚å™è¿°ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ¥å£å®ç°&quot;&gt;&lt;a href=&quot;#æ¥å£å®ç°&quot; class=&quot;headerlink&quot; title=&quot;æ¥å£å®ç°&quot;&gt;&lt;/a&gt;æ¥å£å®ç°&lt;/h1&gt;&lt;p&gt;&lt;code&gt;TBActionSheet&lt;/code&gt; å…·æœ‰ &lt;code&gt;UIActionSheet&lt;/code&gt; çš„&lt;strong&gt;å‡ ä¹&lt;/strong&gt;æ‰€æœ‰æ¥å£å’Œå±æ€§ï¼Œå¯ä»¥è¯´å‰è€…æ˜¯åè€…çš„è¶…é›†ã€‚ä¹‹æ‰€ä»¥è¯´ã€å‡ ä¹ã€ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨ &lt;code&gt;UIWindow&lt;/code&gt; ä¸Šæ¨¡æ€æ˜¾ç¤º ActionSheetï¼Œç›¸å½“äº &lt;code&gt;UIAlertController&lt;/code&gt; çš„åšæ³•ï¼Œäºæ˜¯ä»¥ä¸‹ &lt;code&gt;UIActionSheet&lt;/code&gt; çš„æ¥å£æˆ‘ç›®å‰å¹¶æ²¡æœ‰å®ç°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight erlang&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(void)&lt;/span&gt;showFromToolbar:&lt;span class=&quot;params&quot;&gt;(UIToolbar *)&lt;/span&gt;view;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(void)&lt;/span&gt;showFromTabBar:&lt;span class=&quot;params&quot;&gt;(UITabBar *)&lt;/span&gt;view;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(void)&lt;/span&gt;showFromBarButtonItem:&lt;span class=&quot;params&quot;&gt;(UIBarButtonItem *)&lt;/span&gt;item animated:&lt;span class=&quot;params&quot;&gt;(BOOL)&lt;/span&gt;animated ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(void)&lt;/span&gt;showFromRect:&lt;span class=&quot;params&quot;&gt;(CGRect)&lt;/span&gt;rect inView:&lt;span class=&quot;params&quot;&gt;(UIView *)&lt;/span&gt;view animated:&lt;span class=&quot;params&quot;&gt;(BOOL)&lt;/span&gt;animated;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(void)&lt;/span&gt;showInView:&lt;span class=&quot;params&quot;&gt;(UIView *)&lt;/span&gt;view;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤– &lt;code&gt;UIActionSheet&lt;/code&gt; çš„å±æ€§å’Œæ¥å£åœ¨ &lt;code&gt;TBActionSheet&lt;/code&gt; éƒ½æœ‰å±±å¯¨ï¼Œåªæ˜¯æŠŠ &lt;code&gt;UI&lt;/code&gt; æ¢æˆäº† &lt;code&gt;TB&lt;/code&gt;ï¼Œæ¯”å¦‚ &lt;code&gt;delegate&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@&lt;span class=&quot;keyword&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;) id&amp;lt;TBActionSheetDelegate&amp;gt; delegate;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;TBActionSheetDelegate&lt;/code&gt; ä¸­çš„æ–¹æ³•è·Ÿ &lt;code&gt;UIActionSheetDelegate&lt;/code&gt; ä¸­çš„æ–¹æ³• selector å®Œå…¨ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#åˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;åˆå§‹åŒ–&quot;&gt;&lt;/a&gt;åˆå§‹åŒ–&lt;/h2&gt;&lt;p&gt;åˆå§‹åŒ–æ–¹æ³•çš„è®¾è®¡å»¶ç»­äº† &lt;code&gt;UIActionSheet&lt;/code&gt; çš„æ¥å£ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿˜åŠ äº†ä¸ªå¸¦æœ‰ &lt;code&gt;message&lt;/code&gt; å‚æ•°çš„æ–¹æ³•ã€‚&lt;strong&gt;ä¸ºäº†å‡å°‘å†—ä½™ä»£ç ï¼Œå®ç°é«˜å†…èšä½è€¦åˆçš„è®¾è®¡æ¨¡å¼ï¼Œä¸€èˆ¬ä¼šå†™ä¸€ä¸ªå‚æ•°æœ€å¤šåŠŸèƒ½æœ€å…¨çš„æ–¹æ³•ï¼Œå…¶ä»–å‚æ•°å°‘çš„æ–¹æ³•å»è°ƒç”¨å‰è€…&lt;/strong&gt;ã€‚è¿™ç§å±‚å±‚ Forward å‚æ•°çš„æ–¹å¼åœ¨ API è®¾è®¡ä¸­å¾ˆå¸¸è§ã€‚ç”±äºè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¸¦æœ‰å¯å˜å‚æ•°ï¼Œä¸”&lt;strong&gt;ä¸èƒ½åœ¨ä¸€ä¸ªå¸¦æœ‰å¯å˜å‚æ•°çš„æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªå¸¦æœ‰å¯å˜å‚æ•°çš„æ–¹æ³•&lt;/strong&gt;ã€‚å› ä¸ºå‡½æ•°å‚æ•°å…¥æ ˆæˆ–è€…å­˜å…¥å¯„å­˜å™¨çš„æ–¹å¼éƒ½æ˜¯æœ‰è§„å¯å¾ªçš„ï¼Œæˆ‘ä¹Ÿæ›¾å°è¯•è¿‡åœ¨ x86-64 ä¸‹æ‰¾å‡ºæŒ‡é’ˆå›ºå®šçš„åç§»é‡ï¼Œéµå¾ª x86-64 calling convention ä¸‹çš„å¯å˜å‚æ•°è°ƒç”¨ä»è€Œä¿®æ­£ &lt;code&gt;va_list&lt;/code&gt; ç»“æ„ä½“çš„å€¼ã€‚x86 ä¸‹ &lt;code&gt;va_list&lt;/code&gt; æ˜¯ä¸ª &lt;code&gt;char *&lt;/code&gt;ï¼Œè€Œ x86-64 æ¶æ„ä¸‹ &lt;code&gt;va_list&lt;/code&gt; æ˜¯ä¸ªç»“æ„ä½“ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; gp_offset;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; fp_offset;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *overflow_arg_area;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *reg_save_area;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; va_list[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘å½“æ—¶æ­£æ˜¯ç»™ç»“æ„ä½“ä¸­çš„æ•°æ®åŠ ä¸Šä¸€æ®µä½ç§»ï¼Œä½¿å…¶åœ¨å¯å˜å‚æ•°å‡½æ•°ä¹‹é—´è°ƒç”¨æ—¶ä¸ crashï¼Œä½†è¿™æ ·æ„ä¹‰ä¸å¤§ã€‚å…³äº &lt;code&gt;va_list&lt;/code&gt; ä¸ calling convention çš„ç»†èŠ‚å¯ä»¥å‚è€ƒ &lt;a href=&quot;http://blog.csdn.net/videosender/article/details/6425671&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;c/c++ é‡Œé¢çš„å˜é•¿å‚æ•°çš„å®ç°&lt;/a&gt; å’Œ &lt;a href=&quot;http://stackoverflow.com/questions/4958384/what-is-the-format-of-the-x86-64-va-list-structure&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;System V Application Binary Interface&lt;/a&gt; ç¬¬52é¡µï¼Œè¿™é‡Œä¸å†åšå»¶ä¼¸ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•çš„åšæ³•æ˜¯å†™ä¸€ä¸ªæ–¹æ³•æ¥å—å‚æ•°ç±»å‹ä¸º &lt;code&gt;va_list&lt;/code&gt;ï¼Œå°†å¤§éƒ¨åˆ†å…¬å…±é€»è¾‘å†™åœ¨é‡Œé¢ã€‚è¿™äº›å…¬å…±é€»è¾‘åŒ…æ‹¬è°ƒç”¨ &lt;code&gt;init&lt;/code&gt;ï¼Œç»™ &lt;code&gt;title&lt;/code&gt;ã€&lt;code&gt;message&lt;/code&gt; å’Œ &lt;code&gt;delegate&lt;/code&gt;å±æ€§èµ‹å€¼ï¼Œæ·»åŠ  Cancel å’Œ Destructive æŒ‰é’®ï¼Œéå† &lt;code&gt;va_list&lt;/code&gt; æ·»åŠ æŒ‰é’®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)initWithTitle:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)title message:(nullable &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)message delegate:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;TBActionSheetDelegate&amp;gt;)delegate cancelButtonTitle:(nullable &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)cancelButtonTitle destructiveButtonTitle:(nullable &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)destructiveButtonTitle firstOtherButtonTitle:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)firstOtherButtonTitle titleList:(va_list)argList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _title = title;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _message = message;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _delegate = delegate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (destructiveButtonTitle) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _destructiveButtonIndex = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addButtonWithTitle:destructiveButtonTitle style:TBActionButtonStyleDestructive];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (firstOtherButtonTitle) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// ç¬¬ä¸€ä¸ªå‚æ•° firstOtherButtonTitle æ˜¯ä¸å±äºå‚æ•°åˆ—è¡¨çš„,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addButtonWithTitle:firstOtherButtonTitle style:TBActionButtonStyleDefault];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt;* eachArg;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; ((eachArg = va_arg(argList, &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt;*))) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// ä» args ä¸­éå†å‡ºå‚æ•°ï¼ŒNSString* æŒ‡æ˜ç±»å‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addButtonWithTitle:eachArg style:TBActionButtonStyleDefault];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (cancelButtonTitle) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _cancelButtonIndex = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addButtonWithTitle:cancelButtonTitle style:TBActionButtonStyleCancel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¸åŒ…å«åœ¨ &lt;code&gt;va_list&lt;/code&gt; ä¸­ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ã€‚&lt;code&gt;va_arg (va_list ap, type)&lt;/code&gt; åƒä¸ªè¿­ä»£å™¨ä¸€æ ·æ¯æ¬¡æ ¹æ® &lt;code&gt;type&lt;/code&gt; è®¡ç®—ä½ç§»è·å–å‚æ•°å¹¶æ›´æ–° &lt;code&gt;va_list&lt;/code&gt;ã€‚ &lt;code&gt;va_list&lt;/code&gt; çš„åˆå§‹åŒ–æ˜¯ç”¨ &lt;code&gt;va_start&lt;/code&gt; å®åˆå§‹åŒ–çš„ï¼Œå¹¶ä»¥ &lt;code&gt;va_end&lt;/code&gt; å®ç»“æŸã€‚æœ‰å…³è¿™äº›å®çš„å®šä¹‰ï¼Œè¯¦è§ &lt;a href=&quot;http://www.cplusplus.com/reference/cstdarg/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;stdarg.h&lt;/a&gt; å’Œ &lt;a href=&quot;http://blog.csdn.net/edonlii/article/details/8497704&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯é‚£ä¸¤ä¸ªå¯å˜å‚æ•°çš„åˆå§‹åŒ–æ–¹æ³•ä»£ç å¤§å¤§å‡å°‘ï¼Œè°ƒç”¨ä¸Šé¢çš„æ–¹æ³•å°±å¯ä»¥ã€‚è¿™æ ·å…ˆå°†å¯å˜å‚æ•°å†…å®¹åˆå§‹åŒ–åˆ° &lt;code&gt;va_list&lt;/code&gt; ä¸­å†ä¼ å‚è°ƒåŠ¨çš„æ–¹å¼é¿å…äº† calling convention çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)&lt;span class=&quot;string&quot;&gt;initWithTitle:&lt;/span&gt;(NSString *)title &lt;span class=&quot;string&quot;&gt;delegate:&lt;/span&gt;(id&amp;lt;TBActionSheetDelegate&amp;gt;)delegate &lt;span class=&quot;string&quot;&gt;cancelButtonTitle:&lt;/span&gt;(nullable NSString *)cancelButtonTitle &lt;span class=&quot;string&quot;&gt;destructiveButtonTitle:&lt;/span&gt;(nullable NSString *)destructiveButtonTitle &lt;span class=&quot;string&quot;&gt;otherButtonTitles:&lt;/span&gt;(nullable NSString *)otherButtonTitles, ... NS_REQUIRES_NIL_TERMINATION&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    va_list argList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä» otherButtonTitles å¼€å§‹éå†å‚æ•°ï¼Œä¸åŒ…æ‹¬ otherButtonTitles æœ¬èº«.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    va_start(argList, otherButtonTitles);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self = [self &lt;span class=&quot;string&quot;&gt;initWithTitle:&lt;/span&gt;title &lt;span class=&quot;string&quot;&gt;message:&lt;/span&gt;nil &lt;span class=&quot;string&quot;&gt;delegate:&lt;/span&gt;delegate &lt;span class=&quot;string&quot;&gt;cancelButtonTitle:&lt;/span&gt;cancelButtonTitle &lt;span class=&quot;string&quot;&gt;destructiveButtonTitle:&lt;/span&gt;destructiveButtonTitle &lt;span class=&quot;string&quot;&gt;firstOtherButtonTitle:&lt;/span&gt;otherButtonTitles &lt;span class=&quot;string&quot;&gt;titleList:&lt;/span&gt;argList];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    va_end(argList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)&lt;span class=&quot;string&quot;&gt;initWithTitle:&lt;/span&gt;(NSString *)title &lt;span class=&quot;string&quot;&gt;message:&lt;/span&gt;(nullable NSString *)message &lt;span class=&quot;string&quot;&gt;delegate:&lt;/span&gt;(id&amp;lt;TBActionSheetDelegate&amp;gt;)delegate &lt;span class=&quot;string&quot;&gt;cancelButtonTitle:&lt;/span&gt;(nullable NSString *)cancelButtonTitle &lt;span class=&quot;string&quot;&gt;destructiveButtonTitle:&lt;/span&gt;(nullable NSString *)destructiveButtonTitle &lt;span class=&quot;string&quot;&gt;otherButtonTitles:&lt;/span&gt;(nullable NSString *)otherButtonTitles, ... NS_REQUIRES_NIL_TERMINATION&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    va_list argList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä» otherButtonTitles å¼€å§‹éå†å‚æ•°ï¼Œä¸åŒ…æ‹¬ otherButtonTitles æœ¬èº«.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    va_start(argList, otherButtonTitles);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self = [self &lt;span class=&quot;string&quot;&gt;initWithTitle:&lt;/span&gt;title &lt;span class=&quot;string&quot;&gt;message:&lt;/span&gt;message &lt;span class=&quot;string&quot;&gt;delegate:&lt;/span&gt;delegate &lt;span class=&quot;string&quot;&gt;cancelButtonTitle:&lt;/span&gt;cancelButtonTitle &lt;span class=&quot;string&quot;&gt;destructiveButtonTitle:&lt;/span&gt;destructiveButtonTitle &lt;span class=&quot;string&quot;&gt;firstOtherButtonTitle:&lt;/span&gt;otherButtonTitles &lt;span class=&quot;string&quot;&gt;titleList:&lt;/span&gt;argList];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    va_end(argList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘å†—ä½™ä»£ç æˆ‘ä¹Ÿæ˜¯æ‹¼äº†ã€‚ã€‚ã€‚ä¸‹é¢ç»§ç»­è¯´ &lt;code&gt;init&lt;/code&gt; æ–¹æ³•ã€‚ä¸»è¦å·¥ä½œæ˜¯å¯¹ä¸€äº›å±æ€§çš„åˆå§‹åŒ–å·¥ä½œï¼Œå¹¶å°†èƒŒæ™¯å’Œå®¹å™¨ä¾æ¬¡æ·»åŠ ä¸ºå­è§†å›¾ï¼Œè¿˜æœ‰ç›‘å¬çŠ¶æ€æ æœå‘å˜åŒ–çš„é€šçŸ¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; initWithFrame:[&lt;span class=&quot;built_in&quot;&gt;UIScreen&lt;/span&gt; mainScreen].bounds];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.backgroundColor = [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; clearColor];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _background = [[TBActionBackground alloc] initWithFrame:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.bounds];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addSubview:_background];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _actionContainer = [[TBActionContainer alloc] initWithSheet:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addSubview:_actionContainer];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _buttons = [&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; array];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _separators = [&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; array];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//set default values&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _cancelButtonIndex = &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _destructiveButtonIndex = &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; selector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(statusBarDidChangeOrientation:) name:&lt;span class=&quot;built_in&quot;&gt;UIApplicationDidChangeStatusBarOrientationNotification&lt;/span&gt; object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;æ·»åŠ æŒ‰é’®&quot;&gt;&lt;a href=&quot;#æ·»åŠ æŒ‰é’®&quot; class=&quot;headerlink&quot; title=&quot;æ·»åŠ æŒ‰é’®&quot;&gt;&lt;/a&gt;æ·»åŠ æŒ‰é’®&lt;/h2&gt;&lt;p&gt;æ·»åŠ æŒ‰é’®çš„å®ç°å°±æ˜¯è°ƒç”¨ &lt;code&gt;TBActionButton&lt;/code&gt; çš„å·¥å‚æ–¹æ³•æ–°å»ºä¸€ä¸ªæŒ‰é’®ï¼Œç„¶åå°†å…¶è®¾ç½®å¥½ç‚¹å‡»äº‹ä»¶å¤„ç†çš„æ–¹æ³•åï¼Œå°†æŒ‰é’®å®ä¾‹æ·»åŠ åˆ° &lt;code&gt;buttons&lt;/code&gt; æ•°ç»„ä¸­ã€‚é’ˆå¯¹æŒ‰é’®ä¸åŒçš„é£æ ¼ï¼Œä¼šæ›´æ–° &lt;code&gt;cancelButtonIndex&lt;/code&gt; å’Œ &lt;code&gt;destructiveButtonIndex&lt;/code&gt;ï¼Œè¿™é‡Œåšäº†ä¸ªå…¼å®¹æ€§çš„å¦¥åï¼š&lt;code&gt;UIActionSheet&lt;/code&gt; æä¾›çš„æ¥å£åªèƒ½è‡³å¤šæœ‰ä¸€ä¸ª &lt;code&gt;cancelButtonTitle&lt;/code&gt; æˆ– &lt;code&gt;destructiveButtonTitle&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;UIAlertController&lt;/code&gt; çš„æ¥å£å´æ”¯æŒå¤šä¸ªã€‚&lt;code&gt;TBActionSheet&lt;/code&gt; æ”¯æŒå¤šä¸ª &lt;code&gt;cancelButtonTitle&lt;/code&gt; æˆ– &lt;code&gt;destructiveButtonTitle&lt;/code&gt;ï¼Œä½† &lt;code&gt;cancelButtonIndex&lt;/code&gt; å’Œ &lt;code&gt;destructiveButtonIndex&lt;/code&gt; æ€»æ˜¯è¢«æ›´æ–°ä¸ºæœ€åä¸€ä¸ªæ·»åŠ çš„å¯¹åº”é£æ ¼æŒ‰é’®çš„ Indexï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (NSInteger)&lt;span class=&quot;string&quot;&gt;addButtonWithTitle:&lt;/span&gt;(nullable NSString *)title &lt;span class=&quot;string&quot;&gt;style:&lt;/span&gt;(TBActionButtonStyle)style &lt;span class=&quot;string&quot;&gt;handler:&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^ __nullable)( TBActionButton * _Nonnull button))handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TBActionButton *button = [TBActionButton &lt;span class=&quot;string&quot;&gt;buttonWithTitle:&lt;/span&gt;title &lt;span class=&quot;string&quot;&gt;style:&lt;/span&gt;style &lt;span class=&quot;string&quot;&gt;handler:&lt;/span&gt;handler];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [button &lt;span class=&quot;string&quot;&gt;addTarget:&lt;/span&gt;self &lt;span class=&quot;string&quot;&gt;action:&lt;/span&gt;&lt;span class=&quot;meta&quot;&gt;@selector&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;buttonTapped:&lt;/span&gt;) &lt;span class=&quot;string&quot;&gt;forControlEvents:&lt;/span&gt;UIControlEventTouchUpInside];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.buttons &lt;span class=&quot;string&quot;&gt;addObject:&lt;/span&gt;button];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSInteger index = self.buttons.count - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (style) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;TBActionButtonStyleDefault:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;TBActionButtonStyleCancel:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.cancelButtonIndex = index;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;TBActionButtonStyleDestructive:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.destructiveButtonIndex = index;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;        default:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; index;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ·»åŠ æŒ‰é’®æ—¶æŠŠä¼ å…¥çš„ &lt;code&gt;style&lt;/code&gt; å’Œ &lt;code&gt;handler&lt;/code&gt; å†æ¬¡ä¼ ç»™äº† &lt;code&gt;TBActionButton&lt;/code&gt; çš„å·¥å‚æ–¹æ³•ã€‚æ­¤å¤–è¿˜æœ‰ä¸¤ä¸ªå‚æ•°æ›´ç®€æ´çš„æ–¹æ³•å¯ä¾›é€‰æ‹©ï¼Œå®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (NSInteger)&lt;span class=&quot;selector-tag&quot;&gt;addButtonWithTitle&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(NSString&lt;/span&gt; *)&lt;span class=&quot;selector-tag&quot;&gt;title&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &lt;span class=&quot;selector-attr&quot;&gt;[self addButtonWithTitle:title style:TBActionButtonStyleDefault]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (NSInteger)&lt;span class=&quot;selector-tag&quot;&gt;addButtonWithTitle&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(NSString&lt;/span&gt; *)&lt;span class=&quot;selector-tag&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(TBActionButtonStyle)style&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &lt;span class=&quot;selector-attr&quot;&gt;[self addButtonWithTitle:title style:style handler:nil]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯é¡ºåº”äº†ä¹‹å‰çš„è®¾è®¡ï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚&lt;/p&gt;
&lt;h2 id=&quot;show&quot;&gt;&lt;a href=&quot;#show&quot; class=&quot;headerlink&quot; title=&quot;show&quot;&gt;&lt;/a&gt;show&lt;/h2&gt;&lt;p&gt;åœ¨è°ƒç”¨ &lt;code&gt;show&lt;/code&gt; æ–¹æ³•ä¹‹å‰ï¼Œä½¿ç”¨è€…å¯èƒ½ä¼šä¿®æ”¹ä¸€äº›å±æ€§çš„å€¼ï¼Œæ‰€ä»¥å¤§é‡çš„ç»˜åˆ¶å’Œè®¡ç®—éƒ½æ˜¯åœ¨ &lt;code&gt;show&lt;/code&gt; æ–¹æ³•è°ƒç”¨æ—¶æ‰§è¡Œçš„ã€‚åœ¨æ˜¾ç¤º ActionSheet çš„æ—¶å€™éœ€è¦æœ‰ä¸€ç»„åŠ¨ç”»æ•ˆæœï¼šå°†èƒŒæ™¯é¢œè‰²ç”±é€æ˜è®¾æˆåŠé€æ˜é»‘è‰²ï¼Œå¹¶å°†å®¹å™¨ä»å±å¹•å¤–ç”±ä¸‹è‡³ä¸Šå¹³ç§»è‡³å±å¹•åº•éƒ¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)show&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(willPresentAlertView:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate willPresentActionSheet:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setupNewWindow];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setupLayout];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setupStyle];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//å¼¹å‡º ActionSheet åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;(^animations)(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) = ^() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.background.backgroundColor = [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; colorWithWhite:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; alpha:&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setupContainerFrame];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;(^completion)(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; finished) = ^(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; finished) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(didPresentActionSheet:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate didPresentActionSheet:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.visible = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (kiOS7Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; animateWithDuration:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.animationDuration delay:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; usingSpringWithDamping:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.animationDampingRatio initialSpringVelocity:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.animationVelocity options:&lt;span class=&quot;built_in&quot;&gt;UIViewAnimationOptionCurveEaseInOut&lt;/span&gt; animations:animations completion:completion];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; animateWithDuration:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.animationDuration delay:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; options:&lt;span class=&quot;built_in&quot;&gt;UIViewAnimationOptionCurveEaseInOut&lt;/span&gt; animations:animations completion:completion];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨åŠ¨ç”»å¼€å§‹ä¹‹å‰æœ€å…³é”®çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è®¾ç½®æ–°çš„ &lt;code&gt;UIWindow&lt;/code&gt;ï¼š&lt;code&gt;setupNewWindow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¸ƒå±€ï¼š&lt;code&gt;setupLayout&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è®¾ç½®æ¯›ç»ç’ƒæ•ˆæœã€åœ†è§’ã€èƒŒæ™¯é¢œè‰²ç­‰é£æ ¼ï¼š&lt;code&gt;setupStyle&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;setupNewWindow&quot;&gt;&lt;a href=&quot;#setupNewWindow&quot; class=&quot;headerlink&quot; title=&quot;setupNewWindow&quot;&gt;&lt;/a&gt;setupNewWindow&lt;/h3&gt;&lt;p&gt;&lt;code&gt;setupNewWindow&lt;/code&gt; çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setupNewWindow&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isVisible]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.previousKeyWindow = [&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; sharedApplication].keyWindow;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.previousKeyWindow interruptGesture];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TBActionSheetController *actionSheetVC = [[TBActionSheetController alloc] initWithNibName:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; bundle:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    actionSheetVC.actionSheet = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window = [[&lt;span class=&quot;built_in&quot;&gt;UIWindow&lt;/span&gt; alloc] initWithFrame:[&lt;span class=&quot;built_in&quot;&gt;UIScreen&lt;/span&gt; mainScreen].bounds];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.autoresizingMask = &lt;span class=&quot;built_in&quot;&gt;UIViewAutoresizingFlexibleWidth&lt;/span&gt; | &lt;span class=&quot;built_in&quot;&gt;UIViewAutoresizingFlexibleHeight&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.opaque = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.rootViewController = actionSheetVC;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window makeKeyAndVisible];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨æŠŠæ–°çš„ &lt;code&gt;UIWindow&lt;/code&gt; æ¬åˆ°å±å¹•ä¸Šä¹‹å‰å…ˆç”¨ &lt;code&gt;previousKeyWindow&lt;/code&gt; å±æ€§è®°å½•ä¸‹å½“å‰çš„ &lt;code&gt;keyWindow&lt;/code&gt;ï¼Œå› ä¸ºä»¥åä¼šç»å¸¸ç”¨åˆ°å®ƒã€‚ä¸‹é¢ä¼šè¯¦ç»†å±•å¼€è®²è¿° &lt;code&gt;setupNewWindow&lt;/code&gt; æ–¹æ³•éƒ½å¹²äº†å•¥ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Autorotation&quot;&gt;&lt;a href=&quot;#Autorotation&quot; class=&quot;headerlink&quot; title=&quot;Autorotation&quot;&gt;&lt;/a&gt;Autorotation&lt;/h4&gt;&lt;p&gt;ä¹‹å‰è¯´è¿‡ &lt;code&gt;TBActionSheet&lt;/code&gt; æ˜¯åœ¨ &lt;code&gt;UIWindow&lt;/code&gt; ä¸Šæ¨¡æ€å±•ç¤ºï¼Œå…¶å®è¿™ä¹ˆåšçš„å¦ä¸€ä¸ªåŸå› æ˜¯ä¸ºäº†æ›´æ–¹ä¾¿åœ°å®ç°è‡ªåŠ¨æ—‹è½¬ã€‚æ—‹è½¬äº‹ä»¶çš„ä¼ é€’è·¯å¾„ä¸ºï¼š&lt;code&gt;UIApplication&lt;/code&gt; -&amp;gt; &lt;code&gt;UIWindow&lt;/code&gt; -&amp;gt; &lt;code&gt;rootViewController&lt;/code&gt; -&amp;gt; &lt;code&gt;rootViewController.view&lt;/code&gt;ã€‚æ‰€ä»¥éœ€è¦å°† &lt;code&gt;TBActionSheet&lt;/code&gt; ä½œä¸º &lt;code&gt;rootViewController.view&lt;/code&gt; çš„å­è§†å›¾ï¼Œè¿™æ ·è®©å…¶è·Ÿç€å±å¹•ä¸€èµ·æ—‹è½¬ã€‚è€Œåœ¨ iOS7 æ—¶ä»£ï¼Œ&lt;code&gt;UIWindow&lt;/code&gt; æ˜¯ä¸ä¼šè·Ÿç€ä¸€èµ·æ—‹è½¬çš„ï¼Œå…¶ &lt;code&gt;bounds&lt;/code&gt; æ˜¯ä¸å˜çš„ï¼Œåæ ‡ç³»è®¡ç®—è·Ÿ iOS8 ä¹‹åçš„ä¸åŒï¼Œæ‰€ä»¥ &lt;code&gt;TBActionSheet&lt;/code&gt; è‡ªåŠ¨æ—‹è½¬ç›®å‰ä»…æ”¯æŒ iOS8+ã€‚ä¸ºäº†æ–¹ä¾¿åœ¨æ§åˆ¶å™¨ä¸­å¤„ç†æ—‹è½¬äº‹ä»¶ï¼Œæˆ‘å†™äº†ä¸ª &lt;code&gt;TBActionSheetController&lt;/code&gt;ï¼Œå®ƒå¯¹ &lt;code&gt;TBActionSheet&lt;/code&gt; æœ‰ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ä¸€äº›æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å®ç°è‡ªåŠ¨æ—‹è½¬çš„ä¸»è¦æµç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ–°å»ºä¸€ä¸ª &lt;code&gt;TBActionSheetController&lt;/code&gt; å®ä¾‹ &lt;code&gt;actionSheetVC&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–°å»ºä¸€ä¸ª &lt;code&gt;UIWindow&lt;/code&gt; å®ä¾‹ &lt;code&gt;window&lt;/code&gt; å¹¶èµ‹å€¼ç»™ &lt;code&gt;window&lt;/code&gt; å±æ€§&lt;/li&gt;
&lt;li&gt;&lt;code&gt;window.rootViewController = actionSheetVC&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[actionSheetVC.view addSubview: YOUR_VIEW]&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;YOUR_VIEW&lt;/code&gt; å°±æ˜¯æƒ³è¦è‡ªåŠ¨æ—‹è½¬çš„è§†å›¾ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ &lt;code&gt;TBActionSheet&lt;/code&gt; å®ä¾‹å•¦ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæˆäº†ä»¥ä¸Šæµç¨‹åï¼Œè¿˜éœ€è¦åœ¨ &lt;code&gt;TBActionSheet&lt;/code&gt; æ¥å—åˆ°æœå‘å˜åŒ–çš„é€šçŸ¥åæ‰‹åŠ¨æ›´æ–° &lt;code&gt;frame&lt;/code&gt; å’Œ &lt;code&gt;bounds&lt;/code&gt;ã€‚PSï¼šå› ä¸ºæˆ‘ä»¬æ²¡ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€ï¼Œè€Œæ˜¯æ‰‹åŠ¨è°ƒæ•´ &lt;code&gt;frame&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)statusBarDidChangeOrientation:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.bounds = [&lt;span class=&quot;built_in&quot;&gt;UIScreen&lt;/span&gt; mainScreen].bounds;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.background.frame = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.bounds;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setupContainerFrame];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;setupContainerFrame&lt;/code&gt; æ–¹æ³•åœ¨åé¢ä¼šè®²åˆ°ã€‚&lt;/p&gt;
&lt;h4 id=&quot;interruptGesture&quot;&gt;&lt;a href=&quot;#interruptGesture&quot; class=&quot;headerlink&quot; title=&quot;interruptGesture&quot;&gt;&lt;/a&gt;interruptGesture&lt;/h4&gt;&lt;p&gt;å¦‚æœä½œç”¨äº &lt;code&gt;previousKeyWindow&lt;/code&gt; ä¸Šçš„æ‰‹åŠ¿è§¦å‘äº† ActionSheet çš„æ˜¾ç¤ºï¼Œä½†æ­¤æ—¶è¿™ä¸ªæ‰‹åŠ¿æ²¡æœ‰ç»ˆæ­¢ï¼ˆæ¯”å¦‚ Pan æ‰‹åŠ¿ä¸€ç›´åœ¨æ•è·ï¼‰ï¼Œè¿™æ—¶å°±ä¼šå¼•å‘ä¸€ç³»åˆ—é—®é¢˜ï¼ˆæµ‹è¯•çš„åŒå­¦åŠŸä¸å¯æ²¡ï¼‰ï¼Œå¿…é¡»ä¸­æ–­å…¶ä»–çª—å£æ­£åœ¨æ•è·çš„æ‰‹åŠ¿ã€‚æ€è·¯æ˜¯é€’å½’éå†å­è§†å›¾æ ‘ä¸­çš„æ‰€æœ‰æ‰‹åŠ¿å¯¹è±¡ï¼Œé’ˆå¯¹ Tap å’Œ Pan è¿™ä¸¤ç§æ‰‹åŠ¿åšä¸­æ–­å¤„ç†ã€‚ä¸­æ–­çš„æ–¹æ³•å°±æ˜¯å°† &lt;code&gt;enabled&lt;/code&gt; è®¾ä¸º &lt;code&gt;NO&lt;/code&gt; å†è®¾ä¸º &lt;code&gt;YES&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)interruptGesture&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;UIGestureRecognizer&lt;/span&gt; *gesture &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.gestureRecognizers) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (([gesture isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UITapGestureRecognizer&lt;/span&gt; class]] || [gesture isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UIPanGestureRecognizer&lt;/span&gt; class]]) &amp;amp;&amp;amp; gesture.enabled == &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gesture.enabled = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gesture.enabled = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *subview &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.subviews) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [subview interruptGesture];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;TBActionSheetController&quot;&gt;&lt;a href=&quot;#TBActionSheetController&quot; class=&quot;headerlink&quot; title=&quot;TBActionSheetController&quot;&gt;&lt;/a&gt;TBActionSheetController&lt;/h4&gt;&lt;p&gt;ä¸ºäº†è®© ActionSheet è‡ªåŠ¨æ—‹è½¬ï¼Œè¿˜éœ€è¦è¦†å†™ &lt;code&gt;TBActionSheetController&lt;/code&gt; çš„ &lt;code&gt;shouldAutorotate&lt;/code&gt; æ–¹æ³•å¹¶è¿”å› &lt;code&gt;YES&lt;/code&gt;ï¼Œä»¥åŠåœ¨ &lt;code&gt;supportedInterfaceOrientations&lt;/code&gt; æ–¹æ³•ä¸­è¿”å›æƒ³è¦æ—‹è½¬çš„æœå‘ Maskã€‚ä¸ºäº†è®© &lt;code&gt;TBActionSheetController&lt;/code&gt; çš„çŠ¶æ€æ é£æ ¼å’Œ Hidden çŠ¶æ€ä¸ ActionSheet å±•ç°ä¹‹å‰ç›¸åŒï¼Œè¿˜éœ€è¦è¦†å†™ &lt;code&gt;preferredStatusBarStyle&lt;/code&gt; å’Œ &lt;code&gt;prefersStatusBarHidden&lt;/code&gt; è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚é€šè¿‡ &lt;code&gt;previousKeyWindow&lt;/code&gt; å¯ä»¥é€’å½’æ‰¾åˆ°æœ€é¡¶å±‚çš„æ§åˆ¶å™¨ï¼Œå¹¶é€’å½’è°ƒç”¨ &lt;code&gt;childViewControllerForStatusBarXXX&lt;/code&gt; æ–¹æ³•å‘å…¶è·å–å¯ä»¥ä»£è¡¨çŠ¶æ€æ é£æ ¼æˆ– Hidden çš„æ§åˆ¶å™¨ã€‚è¿™é‡Œç”¨åˆ°äº†ä¸€äº›å…³äº &lt;code&gt;UIWindow&lt;/code&gt; çš„è¾…åŠ©æ–¹æ³•ï¼Œå…·ä½“å®ç°åœ¨ &lt;code&gt;UIWindow (TBAdditions)&lt;/code&gt; ç±»åˆ«ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&quot;setupLayout&quot;&gt;&lt;a href=&quot;#setupLayout&quot; class=&quot;headerlink&quot; title=&quot;setupLayout&quot;&gt;&lt;/a&gt;setupLayout&lt;/h3&gt;&lt;p&gt;å› ä¸ºæ²¡æœ‰ç”¨è‡ªåŠ¨å¸ƒå±€ï¼Œæ‰€ä»¥éœ€è¦åœ¨å®¹å™¨ä¸­ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ’åˆ—è§†å›¾ï¼Œå®½åº¦ç”± &lt;code&gt;sheetWidth&lt;/code&gt; å±æ€§å¾—çŸ¥ï¼Œåªéœ€è®¡ç®—å¥½å½“å‰çš„çºµåæ ‡ã€‚çºµåæ ‡æ˜¯æ ¹æ®å„ç»„ä»¶é«˜åº¦ç´¯åŠ è®¡ç®—çš„ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯å¯¹é«˜åº¦çš„è®¡ç®—ã€‚&lt;code&gt;titleLabel&lt;/code&gt; å’Œ &lt;code&gt;messageLabel&lt;/code&gt; çš„é«˜åº¦å¯æ ¹æ®å­—ä½“å’Œæ–‡å­—å†…å®¹è®¡ç®—å‡ºæ¥ã€‚&lt;code&gt;customView&lt;/code&gt; æ˜¯ç”±è°ƒç”¨æ–¹æä¾›ï¼Œé«˜åº¦ä¹Ÿå¯ä»¥è·å¾—ã€‚æŒ‰é’®çš„é«˜åº¦ç”± &lt;code&gt;buttonHeight&lt;/code&gt; å±æ€§å†³å®šã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰è§†å›¾ä¹‹é—´çš„ç©ºéš™ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å°çš„ç©ºéš™ï¼ŒCancel æŒ‰é’®ä¸Šä¸‹éƒ½æ˜¯å¤§ç©ºéš™ã€‚æˆ‘å°†å¤§å°ç©ºéš™çš„é«˜åº¦åˆ†åˆ«ã€é’¦å®šã€ä¸º 8point å’Œ 0.5pointï¼Œå¹¶æ²¡æä¾›å±æ€§ç”¨äºä¸ªæ€§åŒ–ã€‚å…¶å®è¿™é‡Œå«ã€ç©ºéš™ã€ä¸å‡†ç¡®ï¼Œåº”è¯¥æ˜¯ã€éš”æ¿ï¼ˆSeparatorï¼‰ã€ï¼Œå› ä¸ºæˆ‘åœ¨æ§ä»¶ä¹‹é—´åŠ äº†é€æ˜çš„ &lt;code&gt;UIView&lt;/code&gt;ï¼Œå®ƒå¯ä»¥æ ¹æ®éœ€æ±‚å˜æ¢èƒŒæ™¯é¢œè‰²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;setupLayout&lt;/code&gt; æ–¹æ³•çš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼ˆå¿½ç•¥åˆ›å»ºå’Œæ·»åŠ  Separatorï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¹æ® &lt;code&gt;title&lt;/code&gt; å’Œ &lt;code&gt;message&lt;/code&gt; å±æ€§ä¾æ¬¡ä¸º &lt;code&gt;titleLabel&lt;/code&gt; å’Œ &lt;code&gt;messageLabel&lt;/code&gt; åˆ›å»ºå®ä¾‹ï¼Œå¹¶æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼ˆ&lt;code&gt;actionContainer.header&lt;/code&gt;ï¼‰ï¼Œè®¡ç®— &lt;code&gt;frame&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¤„ç†è°ƒç”¨è€…ä¼ å…¥çš„ &lt;code&gt;customView&lt;/code&gt;ï¼Œæ·»åŠ åˆ°å®¹å™¨ä¸­ï¼ˆ&lt;code&gt;actionContainer.custom&lt;/code&gt;ï¼‰ï¼Œè®¡ç®— &lt;code&gt;customView&lt;/code&gt; çš„ &lt;code&gt;frame&lt;/code&gt;ã€‚ &lt;/li&gt;
&lt;li&gt;éå† &lt;code&gt;buttons&lt;/code&gt; æ•°ç»„å‘å®¹å™¨ä¸­ï¼ˆ&lt;code&gt;actionContainer&lt;/code&gt;ï¼‰æ·»åŠ æŒ‰é’®ï¼Œè®¡ç®—æŒ‰é’®çš„ &lt;code&gt;frame&lt;/code&gt;ï¼Œå¹¶æ ¹æ®æŒ‰é’®æ ·å¼è°ƒæ•´æ–‡å­—é¢œè‰²å’Œ Separator é«˜åº¦ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ® &lt;code&gt;offsetY&lt;/code&gt; å±æ€§è®¡ç®—å®¹å™¨ä¸‹æ–¹éœ€è¦ã€ç©ºã€å‡ºæ¥çš„é«˜åº¦ã€‚&lt;code&gt;offsetY&lt;/code&gt; ä¸º ActionSheet ä¸‹æ–¹çš„ y è½´ä½ç§»ï¼Œå‘ä¸‹ä¸ºæ­£ï¼Œéè´Ÿå€¼æ— æ•ˆï¼Œé»˜è®¤å€¼ä¸º -8ã€‚æœ€åè®¡ç®—å®¹å™¨çš„ &lt;code&gt;frame&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™éƒ¨åˆ†çš„è®¡ç®—ç•¥å¤æ‚ï¼Œåªæ˜¯é˜è¿°ä¸‹æ€æƒ³ã€‚ä½†è¿™è¿˜ä¸æ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;setupStyle&quot;&gt;&lt;a href=&quot;#setupStyle&quot; class=&quot;headerlink&quot; title=&quot;setupStyle&quot;&gt;&lt;/a&gt;setupStyle&lt;/h3&gt;&lt;p&gt;æ­¤æ–¹æ³•ä¸»è¦æ˜¯è®¾ç½®é£æ ¼ï¼Œæ¯”å¦‚æ¯›ç»ç’ƒæ•ˆæœã€åœ†è§’å’Œé¢œè‰²ç­‰ï¼Œä¾èµ–äº &lt;code&gt;setupLayout&lt;/code&gt; çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;å¾®ä¿¡çš„æ ·å¼æ˜¯æ•´ä¸ªå®¹å™¨èƒŒæ™¯å…¨å¸¦æ¯›ç»ç’ƒæ•ˆæœï¼Œä¸”æ²¡æœ‰åœ†è§’ï¼›ç³»ç»Ÿæ ·å¼ä¸­ iOS9 å’Œ iOS8 åªæœ‰æŒ‰é’®å’Œæ ‡é¢˜éƒ¨åˆ†å¸¦æ¯›ç»ç’ƒæ•ˆæœï¼Œå…¶ä½™åœ°æ–¹é•‚ç©ºé€æ˜çš„ï¼Œä¸” iOS9 çš„åœ†è§’æ›´å¤§äº›ã€‚iOS7 æ²¡æœ‰æ¯›ç»ç’ƒæ•ˆæœã€‚&lt;code&gt;TBActionSheet&lt;/code&gt; æœ‰å‡ ä¸ªå±æ€§ç”¨æ¥è°ƒèŠ‚è¿™äº›å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;backgroundTransparentEnabled&lt;/code&gt; æ˜¯å¦è®© ActionSheet èƒŒæ™¯é€æ˜ï¼ˆé•‚ç©ºï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;blurEffectEnabled&lt;/code&gt; æ˜¯å¦å¯ç”¨æ¯›ç»ç’ƒæ•ˆæœ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rectCornerRadius&lt;/code&gt; çŸ©å½¢åœ†è§’åŠå¾„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ambientColor&lt;/code&gt; ActionSheet çš„ç¯å¢ƒè‰²&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;BlurEffect-amp-Separator&quot;&gt;&lt;a href=&quot;#BlurEffect-amp-Separator&quot; class=&quot;headerlink&quot; title=&quot;BlurEffect &amp;amp; Separator&quot;&gt;&lt;/a&gt;BlurEffect &amp;amp; Separator&lt;/h4&gt;&lt;p&gt;&lt;code&gt;UIVisualEffectView&lt;/code&gt; åªæ”¯æŒ iOS8+ï¼Œä¸ºäº†å…¼å®¹ iOS7 åŠæ›´ä½ç‰ˆæœ¬ï¼Œæˆ‘çš„ç­–ç•¥æ˜¯å°†å±å¹•ä¸Šå®¹å™¨åŒºåŸŸçŸ©å½¢è¿›è¡Œæˆªå›¾ï¼Œå¹¶åšä¸‰æ¬¡ Box æ¨¡ç³Šå¤„ç†ï¼Œå¹¶å°†å›¾ç‰‡è®¾ç½®ä¸ºå®¹å™¨çš„å›¾ç‰‡ï¼ˆä½†æ„¿ä½ è¿˜è®°å¾—å®ƒä»¬éƒ½æ˜¯ &lt;code&gt;UIImageView&lt;/code&gt;ï¼‰ï¼Œæ¨¡æ‹Ÿæ¯›ç»ç’ƒæ•ˆæœã€‚è‹¹æœåœ¨ WWDC2013 ç»™å‡ºäº†å¼€æºå®ç°ï¼Œä½¿ç”¨çš„æ˜¯ CI æ¡†æ¶çš„ Box æ¨¡ç³Šå‡½æ•°ï¼Œæ•ˆç‡æ¯”é«˜æ–¯æ¨¡ç³Šè¦é«˜ï¼š&lt;a href=&quot;https://developer.apple.com/downloads/download.action?path=wwdc_2013/wwdc_2013_sample_code/ios_uiimageeffects.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ios_uiimageeffects.zip&lt;/a&gt;ã€‚é’ˆå¯¹å®¹å™¨é•‚ç©ºçš„æƒ…å†µï¼Œä¸èƒ½å°†å®¹å™¨çŸ©å½¢æ•´ä½“æˆªå›¾ï¼Œéœ€è¦å°†éé•‚ç©ºæ§ä»¶çš„æ¯ä¸€éƒ¨åˆ†å•ç‹¬æˆªå›¾å¹¶åšæ¨¡ç³Šå¤„ç†ï¼Œç„¶åå°†å¤„ç†å¥½çš„å›¾ç‰‡è®¾ç½®ä¸ºæ§ä»¶çš„å›¾ç‰‡ï¼ˆå› ä¸ºå®¹å™¨ä¸­çš„æ§ä»¶éƒ½æ˜¯ &lt;code&gt;UIImageView&lt;/code&gt; æˆ– &lt;code&gt;UIButton&lt;/code&gt;ï¼Œä¸åŒ…å« Separatorï¼‰ã€‚è€Œä½¿ç”¨ &lt;code&gt;UIVisualEffectView&lt;/code&gt; çš„æ—¶å€™ä¹ŸåŒæ ·éµå¾ªè¿™ä¸ªé“ç†ã€‚ &lt;code&gt;UIVisualEffectView&lt;/code&gt; çš„ä¼˜ç‚¹æ˜¯é’ˆå¯¹å˜åŒ–çš„èƒŒæ™¯å¯ä»¥å®æ—¶æ¸²æŸ“å‡ºæ¯›ç»ç’ƒæ•ˆæœï¼Œè€Œæˆªå›¾æ‰‹åŠ¨ Box æ¨¡ç³Šå°±åšä¸åˆ°è¿™ç‚¹ï¼›ç¼ºç‚¹æ˜¯é™¤éä½¿ç”¨ &lt;code&gt;UIVisualEffectView&lt;/code&gt; çš„ç§æœ‰æ¥å£å¦åˆ™ä¸èƒ½è°ƒèŠ‚æ¨¡ç³ŠåŠå¾„ï¼Œè€Œ CI æ¡†æ¶æä¾›çš„å‡½æ•°å¯ä»¥åšåˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œéœ€è¦åšä¸¤ä¸ªåˆ¤æ–­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯›ç»ç’ƒæ•ˆæœç­–ç•¥ï¼šiOS8+ ç”¨ &lt;code&gt;UIVisualEffectView&lt;/code&gt;ï¼›å¦åˆ™ç”¨æˆªå›¾å’Œ Box æ¨¡ç³Šï¼›å¦‚æœä¸å¼€å¯æ¯›ç»ç’ƒæ•ˆæœåˆ™ä½¿ç”¨åŠé€æ˜ï¼ˆalpha=0.5ï¼‰çš„èƒŒæ™¯è‰²ï¼ˆ&lt;code&gt;ambientColor&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ActionSheet èƒŒæ™¯æ˜¯å¦é•‚ç©ºï¼šä¸é•‚ç©ºåˆ™å¯¹å®¹å™¨çŸ©å½¢æ•´ä½“æˆªå›¾ï¼Œé•‚ç©ºåˆ™åªå¯¹å®¹å™¨å†…çš„æ§ä»¶ï¼ˆ&lt;code&gt;header&lt;/code&gt;,&lt;code&gt;custom&lt;/code&gt; å’ŒæŒ‰é’®ï¼‰çŸ©å½¢æˆªå›¾ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸º iOS7 ä¸‹çš„æ¯›ç»ç’ƒæ•ˆæœä½¿ç”¨çš„æ˜¯æˆªå›¾ï¼Œæ‰€ä»¥éœ€è¦åœ¨è®¾å¤‡å±å¹•æ—‹è½¬æ—¶åˆ·æ–°ä¸‹ UIï¼Œå†æ¬¡è°ƒç”¨ &lt;code&gt;setupStyle&lt;/code&gt; æ–¹æ³•ã€‚éœ€è¦è¦†å†™ &lt;code&gt;TBActionSheetController&lt;/code&gt; ä¸­ä¸‹é¢çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (void)&lt;span class=&quot;selector-tag&quot;&gt;didRotateFromInterfaceOrientation&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(UIInterfaceOrientation)fromInterfaceOrientation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;if&lt;/span&gt; (self.actionSheet.blurEffectEnabled &amp;amp;&amp;amp; !kiOS8Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-attr&quot;&gt;[self.actionSheet setupStyle]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;æˆªå±&quot;&gt;&lt;a href=&quot;#æˆªå±&quot; class=&quot;headerlink&quot; title=&quot;æˆªå±&quot;&gt;&lt;/a&gt;æˆªå±&lt;/h5&gt;&lt;p&gt;æˆªå±å°±æ˜¯åœ¨å±å¹•ä¸Šçš„è¿›è¡Œæˆªå›¾ï¼Œè¡¨é¢ä¸Šçœ‹ä¸Šå»å¾ˆç®€å•ï¼Œä½†å®è·µçš„æ—¶å€™ä¹Ÿä¼šç¢°åˆ°å‘ã€‚é¦–å…ˆæˆ‘è¦æˆªå–çš„è‚¯å®šæ˜¯ ActionSheet å‡ºç°ä¹‹å‰çš„å±å¹•ï¼Œæ‰€ä»¥ä¹‹å‰æåˆ°è¿‡çš„ &lt;code&gt;previousKeyWindow&lt;/code&gt; å±æ€§å°±åˆæ´¾ä¸Šç”¨åœºäº†ï¼Œå®ƒæ˜¯ ActionSheet å±•ç°å‰çš„çª—å£ï¼Œé€šè¿‡å®ƒå¯ä»¥è·å–åˆ°æœ€é¡¶å±‚çš„æ§åˆ¶å™¨ï¼Œç„¶åè·å–æ§åˆ¶å™¨ç®¡ç†çš„ &lt;code&gt;view&lt;/code&gt;ï¼Œæ¥ç€å°±æ˜¯ç”¨ UIKit é‚£å¥—å‡½æ•°æˆªå›¾ã€‚è¿™é‡Œéœ€è¦åŒºåˆ†ä¸‹ iOS6 å’Œ iOS7+ æ¸²æŸ“è§†å›¾å±‚çº§è¦è°ƒç”¨ä¸åŒçš„æ¥å£ï¼Œå¹¶æ³¨æ„ä¸€ä¸ªä»…ä»…å‘ç”Ÿåœ¨ iOS7 ä¸Šçš„ crashï¼š&lt;strong&gt;å¦‚æœæˆªå±åŒºåŸŸçš„é•¿æˆ–å®½è¿‡å°æ—¶å°†ä¼šå¼•å‘ crashï¼Œè¿™æ˜¯ iOS7 ç³»ç»Ÿçš„ bug&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  ä»åŒºåŸŸæˆªå±&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param aRect åŒºåŸŸ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param view  æˆªå–çš„ view&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @return  æˆªå–çš„å›¾ç‰‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)screenShotRect:(&lt;span class=&quot;built_in&quot;&gt;CGRect&lt;/span&gt;)aRect&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è·å–æœ€ä¸Šå±‚çš„ UIViewController&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; *topController = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.previousKeyWindow currentViewController];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *view = topController.view;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIGraphicsBeginImageContext&lt;/span&gt;(view.bounds.size);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([view respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(drawViewHierarchyInRect:afterScreenUpdates:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; crashMagicNumber = &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;;&lt;span class=&quot;comment&quot;&gt;// size å°äº0.3 åœ¨ iOS7 ä¸Šä¼šå¯¼è‡´ crash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (view.frame.size.width &amp;gt;= crashMagicNumber &amp;amp;&amp;amp; view.frame.size.height &amp;gt;= crashMagicNumber ) &amp;#123; &lt;span class=&quot;comment&quot;&gt;// resolve iOS7 size crash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [view drawViewHierarchyInRect:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.bounds afterScreenUpdates:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;span class=&quot;comment&quot;&gt;/* iOS 6 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [view.layer renderInContext:&lt;span class=&quot;built_in&quot;&gt;UIGraphicsGetCurrentContext&lt;/span&gt;()];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *screenshotimage = &lt;span class=&quot;built_in&quot;&gt;UIGraphicsGetImageFromCurrentImageContext&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIGraphicsEndImageContext&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; cutFromImage:screenshotimage inRect:aRect];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨å›¾ç‰‡ä¸­æˆªå–å›¾ç‰‡æ—¶éœ€è¦æ³¨æ„ Retina å±å¹•çš„ &lt;code&gt;scale&lt;/code&gt; é—®é¢˜ï¼ŒåŒºåˆ†ã€åæ ‡ç‚¹ã€ä¸ã€åƒç´ ç‚¹ã€å°±å¥½ã€‚è¿˜æœ‰è¦æ³¨æ„å¦‚æœæˆªå›¾çŸ©å½¢ &lt;code&gt;rect&lt;/code&gt; å¦‚æœè¶…å‡ºäº†å›¾ç‰‡ &lt;code&gt;image&lt;/code&gt; èŒƒå›´ï¼Œè¶…å‡ºçš„é‚£éƒ¨åˆ†ä¼šæ˜¯é€æ˜çš„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight processing&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  ä»å›¾ç‰‡ä¸­åˆ‡å›¾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param image è¦è¢«åˆ‡çš„å›¾ç‰‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @param rect  è¿™é‡Œå¯ä»¥è®¾ç½®æƒ³è¦æˆªå›¾çš„åŒºåŸŸ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  @return æˆªå›¾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (UIImage *)cutFromImage:(UIImage *)&lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt; inRect:(CGRect) &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CGImageRef imageRef = &lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt;.CGImage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CGRect transRect = CGRectMake(&lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;.origin.x*&lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;scale&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;.origin.y*&lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;scale&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;width&lt;/span&gt;*&lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;scale&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;height&lt;/span&gt;*&lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;scale&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CGImageRef imageRefRect =CGImageCreateWithImageInRect(imageRef, transRect);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UIImage *sendImage = [[UIImage alloc] initWithCGImage:imageRefRect &lt;span class=&quot;built_in&quot;&gt;scale&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;image&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;scale&lt;/span&gt; orientation:UIImageOrientationUp];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSData *imageViewData = UIImagePNGRepresentation(sendImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CGImageRelease(imageRefRect);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [UIImage imageWithData:imageViewData];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;ambientColor&quot;&gt;&lt;a href=&quot;#ambientColor&quot; class=&quot;headerlink&quot; title=&quot;ambientColor&quot;&gt;&lt;/a&gt;ambientColor&lt;/h5&gt;&lt;p&gt;ç¯å¢ƒè‰²å…¶å®å°±æ˜¯å®¹å™¨çš„èƒŒæ™¯é¢œè‰²ï¼Œä½†ä¸èƒ½å« &lt;code&gt;backgroundColor&lt;/code&gt;ï¼Œå› ä¸º &lt;code&gt;UIView&lt;/code&gt; ä¸­å·²ç»æœ‰ä¸ª &lt;code&gt;backgroundColor&lt;/code&gt; å±æ€§äº†ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±å¼ºåˆ¶å£°æ˜é‡åçš„å±æ€§ä¼šå¯¼è‡´å¥‡æ€ªçš„é—®é¢˜ã€‚æ¯”å¦‚è®¾ç½®å¥½çš„èƒŒæ™¯è‰²åœ¨ç¨‹åºè¿è¡Œä¸­è‡ªåŠ¨è¢«è®¾æˆå…¶ä»–é¢œè‰²ï¼ˆä¸€èˆ¬æ˜¯é»‘è‰²ï¼‰ï¼Œè€Œä¸”æ˜¯éšæœºå‡ºç°çš„ï¼Œè€Œä¸”ä¸€æ—¦å‡ºç°å°±ä¼šä¸€ç›´å¤ç°ï¼Œé™¤éæ€è¿›ç¨‹ã€‚PSï¼šåˆ«é—®æˆ‘ä¸ºå•¥çŸ¥é“è¿™ä¹ˆå¤šï¼Œéƒ½æ˜¯æ³ªå•Šï¼ç”¨åœ¨å…¬å¸é¡¹ç›®ä¸­è¢«æµ‹è¯•åŒå­¦æè¿‡å¥½å¤šæ¬¡ bugï¼&lt;/p&gt;
&lt;p&gt;å›å½’æ­£é¢˜ï¼å¦‚ä½•å°†ç¯å¢ƒè‰²åŠ å…¥åˆ°å®¹å™¨ä¸­å‘¢ï¼Ÿæ¯•ç«Ÿæœ‰å¤šç§æƒ…å†µï¼Œä½†å…¶æ€æƒ³è·Ÿæ¯›ç»ç’ƒæ¨¡ç³Šçš„æ€è·¯å·®ä¸å¤šï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/TBActionSheet/ambientColor.png&quot; alt=&quot;ç¯å¢ƒè‰²è®¾ç½®ç­–ç•¥&quot;&gt;&lt;/p&gt;
&lt;p&gt;å€¼å¾—ä¸€æçš„æ˜¯åœ¨å€’æ•°ç¬¬äºŒä¸ªåˆ†æ”¯ã€åœ¨ &lt;code&gt;UIVisualEffectView&lt;/code&gt; åæ’å…¥ç¯å¢ƒè‰²è§†å›¾ã€ã€‚æ˜¯åœ¨æ§ä»¶çš„åé¢æ’å…¥&lt;br&gt;&lt;code&gt;UIVisualEffectView&lt;/code&gt; åå†æ’å…¥ä¸€å±‚èƒŒæ™¯é¢œè‰²ä¸º &lt;code&gt;ambientColor&lt;/code&gt; çš„ &lt;code&gt;UIView&lt;/code&gt;ã€‚å¦‚æœæ§ä»¶ç±»å‹ä¸º &lt;code&gt;TBActionButton&lt;/code&gt;ï¼Œé‚£ä¹ˆéœ€è¦å°†å…¶ &lt;code&gt;behindColorView&lt;/code&gt; å±æ€§è®¾ä¸ºèƒŒæ™¯è‰²ä¸º &lt;code&gt;ambientColor&lt;/code&gt; çš„ &lt;code&gt;UIView&lt;/code&gt; å¯¹è±¡ã€‚åŸå› æ˜¯æŒ‰é’®æ­¤æ—¶æ— èƒŒæ™¯è‰²ï¼Œé«˜äº®çŠ¶æ€éœ€è¦è°ƒèŠ‚ &lt;code&gt;behindColorView&lt;/code&gt; çš„ &lt;code&gt;alpha&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™éƒ¨åˆ†çš„ä»£ç é€»è¾‘å…¶å®ç•¥å¤æ‚ï¼Œä½†è¿˜ä¸æ˜¯æœ€çƒ§è„‘çš„ã€‚&lt;/p&gt;
&lt;h5 id=&quot;Separator&quot;&gt;&lt;a href=&quot;#Separator&quot; class=&quot;headerlink&quot; title=&quot;Separator&quot;&gt;&lt;/a&gt;Separator&lt;/h5&gt;&lt;p&gt;åœ¨ &lt;code&gt;setupLayout&lt;/code&gt; ä¸­åˆ›å»ºçš„ Separator éƒ½ä¼šæ·»åŠ åˆ° &lt;code&gt;separators&lt;/code&gt; æ•°ç»„ä¸­ï¼Œå¹¶ä½œä¸ºå®¹å™¨çš„å­è§†å›¾å‚ä¸ UI ç»˜åˆ¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)&lt;span class=&quot;keyword&quot;&gt;addSeparatorLineAt:(CGPoint) &lt;/span&gt;point &lt;span class=&quot;keyword&quot;&gt;isBigFragment:(BOOL) &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;isBigFragment&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UIView *separatorLine = [[UIView alloc] initWithFrame:CGRectMake(point.x, point.y, &lt;span class=&quot;keyword&quot;&gt;self.sheetWidth, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;isBigFragment?bigFragment:smallFragment)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    separatorLine.&lt;span class=&quot;keyword&quot;&gt;backgroundColor &lt;/span&gt;= &lt;span class=&quot;keyword&quot;&gt;self.separatorColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    [&lt;span class=&quot;keyword&quot;&gt;self.actionContainer &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;addSubview:separatorLine];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    [&lt;span class=&quot;keyword&quot;&gt;self.separators &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;addObject:separatorLine];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Separator åªæ˜¯ä¸ªæ™®é€šçš„ &lt;code&gt;UIView&lt;/code&gt;ï¼Œå¯ä»¥é€æ˜ä¹Ÿå¯ä»¥æœ‰é¢œè‰²ï¼Œè¿™å–å†³äºè°ƒç”¨è€…çš„å£å‘³ã€‚å¾®ä¿¡æ ·å¼ä¸­æŒ‰é’®ä¹‹é—´æ˜¯æœ‰äº›æ·±è‰²çš„ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;separatorColor&lt;/code&gt; å±æ€§æ¥è®¾ç½®è¿™ä¸ªé¢œè‰²ã€‚Separator çš„ä¸¤ç§å°ºå¯¸ä¹‹å‰æåˆ°è¿‡ï¼ŒBigFragment ä¸º 8pointï¼Œä½äº Cancel æŒ‰é’®ä¸Šä¸‹ï¼Œå³ä½¿ Cancel æŒ‰é’®åœ¨ä¸­é—´ï¼Œä¹Ÿå¯ä»¥åº”ä»˜è‡ªå¦‚ã€‚&lt;/p&gt;
&lt;h4 id=&quot;RectCorner&quot;&gt;&lt;a href=&quot;#RectCorner&quot; class=&quot;headerlink&quot; title=&quot;RectCorner&quot;&gt;&lt;/a&gt;RectCorner&lt;/h4&gt;&lt;p&gt;åœ†è§’çš„å®ç°ä¸å¤æ‚ï¼Œä½†æ˜¯åˆ¤æ–­å“ªé‡Œéœ€è¦å¤„ç†æˆåœ†è§’å¾ˆå¤æ‚ï¼š&lt;strong&gt;å“ªä¸ª &lt;code&gt;UIView&lt;/code&gt; çš„å“ªä¸ªè§’éœ€è¦å¤„ç†æˆåœ†è§’&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å†™äº†ä¸ª &lt;code&gt;UIView (TBRectCorner)&lt;/code&gt; ç±»åˆ«æ–¹ä¾¿åŠ åœ†è§’ï¼ŒåŸç†æ˜¯ç”¨è´å¡å°”æ›²çº¿çš„ &lt;code&gt;bezierPathWithRoundedRect:byRoundingCorners:cornerRadii:&lt;/code&gt; æ–¹æ³•ç»˜åˆ¶åœ†è§’çŸ©å½¢è·¯å¾„ &lt;code&gt;maskPath&lt;/code&gt;ï¼Œç„¶åå°†å…¶ &lt;code&gt;CGPath&lt;/code&gt; ä½œä¸º &lt;code&gt;layer.mask&lt;/code&gt; çš„è·¯å¾„ã€‚ç”¨è´å¡å°”æ›²çº¿çš„ä¼˜ç‚¹å°±æ˜¯å¯ä»¥é’ˆå¯¹çŸ©å½¢æŸä¸ªå•ç‹¬çš„è§’åšåœ†è§’ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘éœ€è¦çš„ã€‚æˆ‘åœ¨ &lt;code&gt;UIView (TBRectCorner)&lt;/code&gt; ä¸­ä»¥&lt;a href=&quot;http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/#Objective-C-Associated-Objects&quot;&gt;å…³è”å¯¹è±¡&lt;/a&gt;çš„æ–¹å¼åŠ äº†ä¸ª &lt;code&gt;tbRectCorner&lt;/code&gt; å±æ€§ï¼Œç”¨äºæ ‡è®°åœ†è§’ç±»å‹ï¼ˆ&lt;code&gt;TBRectCorner&lt;/code&gt;ï¼‰ã€‚ActionSheet ä¸­çš„æ§ä»¶ä¸€å…±æœ‰å››ç§åœ†è§’ç±»å‹ï¼šé¡¶éƒ¨åœ†è§’ã€åº•éƒ¨åœ†è§’ã€å…¨åœ†è§’å’Œæ— åœ†è§’ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef &lt;span class=&quot;type&quot;&gt;NS_OPTIONS&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;NSUInteger&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;TBRectCorner&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBRectCornerTop&lt;/span&gt; = 1 &amp;lt;&amp;lt; 0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBRectCornerBottom&lt;/span&gt; = 1 &amp;lt;&amp;lt; 1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBRectCornerNone&lt;/span&gt; = 0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;TBRectCornerAll&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;TBRectCornerTop&lt;/span&gt;|&lt;span class=&quot;type&quot;&gt;TBRectCornerBottom&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface &lt;span class=&quot;type&quot;&gt;UIView&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;TBRectCorner&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property (nonatomic,assign) &lt;span class=&quot;type&quot;&gt;TBRectCorner&lt;/span&gt; tbRectCorner;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)setCornerRadius:(&lt;span class=&quot;type&quot;&gt;CGFloat&lt;/span&gt;) radius;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è€Œåˆ¤æ–­å“ªé‡Œéœ€è¦åœ†è§’çš„è¿‡ç¨‹å°±å¤æ‚äº†ï¼Œç”¨åˆ°äº†å¤§é‡çš„ if-else åˆ¤æ–­æ¥ä¿®æ”¹ &lt;code&gt;tbRectCorner&lt;/code&gt; å±æ€§ã€‚è¿™é¡¹å·¥ä½œå¤æ‚çš„åŸå› å°±åœ¨äºå…¶å¸ƒå±€ä¸ç¡®å®šæ€§ï¼ŒåŠ åœ†è§’çš„è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•´ä¸ªå®¹å™¨çš„è¾¹ç¼˜éƒ½æœ‰åœ†è§’ã€‚å®¹å™¨å†…éƒ¨ Separator ä¸º BigFragment çš„ä¸Šä¸‹è¾¹ç¼˜éƒ½æœ‰åœ†è§’ã€‚ï¼ˆCancel æŒ‰é’®ä¸Šä¸‹çš„ Separator éƒ½ä¸º BigFragmentï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;title&lt;/code&gt; å’Œ &lt;code&gt;message&lt;/code&gt; å¦‚æœéƒ½ä¸º &lt;code&gt;nil&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨çš„ &lt;code&gt;header&lt;/code&gt; æ— å†…å®¹ï¼Œåˆ™å®¹å™¨é¡¶éƒ¨åœ†è§’åŠ åœ¨ &lt;code&gt;custom&lt;/code&gt; é¡¶éƒ¨ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¼ å…¥çš„ &lt;code&gt;customView&lt;/code&gt; ä¸º &lt;code&gt;nil&lt;/code&gt;ï¼Œåˆ™å®¹å™¨çš„ &lt;code&gt;custom&lt;/code&gt; æ— å†…å®¹ï¼Œåˆ™å®¹å™¨é¡¶éƒ¨åœ†è§’åŠ åœ¨ç¬¬ä¸€ä¸ªæŒ‰é’®é¡¶éƒ¨ã€‚&lt;/li&gt;
&lt;li&gt;å®¹å™¨åº•éƒ¨åœ†è§’åŠ åœ¨æœ€åä¸€ä¸ªæŒ‰é’®åº•éƒ¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…·ä½“å®ç°ä»£ç å°±ä¸è´´äº†ï¼Œåˆ†æ•£åœ¨ &lt;code&gt;setupStyle&lt;/code&gt; æ–¹æ³•çš„å¤šä¸ªä½ç½®ã€‚&lt;/p&gt;
&lt;h4 id=&quot;setupContainerFrame&quot;&gt;&lt;a href=&quot;#setupContainerFrame&quot; class=&quot;headerlink&quot; title=&quot;setupContainerFrame&quot;&gt;&lt;/a&gt;setupContainerFrame&lt;/h4&gt;&lt;p&gt;&lt;code&gt;show&lt;/code&gt; æ–¹æ³•ä¸­çš„åŠ¨ç”»ä¼šå°†æ•´ä¸ªå®¹å™¨ä»å±å¹•å¤–å³ä¸‹è‡³ä¸Šæ»‘åŠ¨è‡³å±å¹•åº•éƒ¨ï¼ŒåŠ¨ç”»çš„ç»ˆç‚¹å°±æ˜¯å®¹å™¨æœ€ç»ˆçš„ &lt;code&gt;frame&lt;/code&gt;ã€‚åœ¨è®¡ç®—çºµåæ ‡æ—¶éœ€è¦è€ƒè™‘åˆ° iOS7 çš„çŠ¶æ€æ çš„é«˜åº¦ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setupContainerFrame&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.actionContainer.frame = CGRectMake(kContainerLeft, kScreenHeight - self.actionContainer.frame.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;height&lt;/span&gt; - (!kiOS7Later? &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;), self.actionContainer.frame.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;width&lt;/span&gt;, self.actionContainer.frame.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;height&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–è¿˜ç”¨åˆ°äº†å‡ ä¸ªè‡ªå®šä¹‰çš„å®ï¼Œéƒ½æ˜¯ä¸ºäº†ç®€åŒ–ä»£ç çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;#def&lt;/span&gt;ine kScreenWidth [UIScreen mainScreen]&lt;span class=&quot;selector-class&quot;&gt;.bounds&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.size&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.width&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;#def&lt;/span&gt;ine kScreenHeight [UIScreen mainScreen]&lt;span class=&quot;selector-class&quot;&gt;.bounds&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.size&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.height&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;#def&lt;/span&gt;ine kContainerLeft ((kScreenWidth - self.sheetWidth)/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;åŠ¨ç”»&quot;&gt;&lt;a href=&quot;#åŠ¨ç”»&quot; class=&quot;headerlink&quot; title=&quot;åŠ¨ç”»&quot;&gt;&lt;/a&gt;åŠ¨ç”»&lt;/h3&gt;&lt;p&gt;ä» iOS7 å¼€å§‹ UIKit æ”¯æŒäº† Spring åŠ¨ç”»ï¼Œæœ‰è¶£çš„æ˜¯ SpriteKit å’Œ UIDynamic ä¹Ÿæ˜¯åœ¨ iOS7 æ–°åŠ å…¥çš„ã€‚æˆ‘çŒœå…¶åº•å±‚å®ç°åº”è¯¥æ˜¯å…¬ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åªæ˜¯ç®€å•çš„æ”¯æŒäº†å¼¹ç°§åŠ¨ç”»ï¼Œæ·»åŠ äº†å‡ ä¸ªå±æ€§ä½œä¸ºåŠ¨ç”»å‚æ•°è€Œå·²ã€‚å¯èƒ½ä»Šåä¼šä¸°å¯Œä¸‹åŠ¨ç”»ç§ç±»ï¼Œæˆ–æ˜¯æä¾›æ¥å£ï¼Œè®©è°ƒç”¨è€…ä¼ å…¥è‡ªå®šä¹‰çš„åŠ¨ç”»ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰è°ƒèŠ‚åŠ¨ç”»çš„å‚æ•°æœ‰ä¸‰ä¸ªå±æ€§ï¼š&lt;code&gt;animationDuration&lt;/code&gt;ï¼Œ&lt;code&gt;animationDampingRatio&lt;/code&gt; å’Œ &lt;code&gt;animationVelocity&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;close-amp-buttonTapped&quot;&gt;&lt;a href=&quot;#close-amp-buttonTapped&quot; class=&quot;headerlink&quot; title=&quot;close &amp;amp; buttonTapped&quot;&gt;&lt;/a&gt;close &amp;amp; buttonTapped&lt;/h2&gt;&lt;p&gt;ç”¨æˆ·ç‚¹å‡»èƒŒæ™¯æˆ–è€…æŒ‰é’®æ—¶ï¼ŒActionSheet ä¼šæ‰§è¡Œæ¶ˆå¤±åŠ¨ç”»ï¼Œå¹¶ä¼´éšç€ &lt;code&gt;delegate&lt;/code&gt; çš„ä¸€äº›å›è°ƒæˆ–æ˜¯æ‰§è¡Œ blockã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°å·®ä¸å¤šï¼Œä»…ä»¥ &lt;code&gt;buttonTapped&lt;/code&gt; ä¸ºä¾‹è®²è§£ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)buttonTapped:(TBActionButton *)sender&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isVisible]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; index = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.buttons indexOfObject:sender];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; animateWithDuration:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.animationDuration delay:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; options:&lt;span class=&quot;built_in&quot;&gt;UIViewAnimationOptionCurveEaseInOut&lt;/span&gt; animations:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.background.backgroundColor = [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; colorWithWhite:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; alpha:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.actionContainer.frame = &lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(kContainerLeft, kScreenHeight, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.actionContainer.frame.size.width, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.actionContainer.frame.size.height);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; completion:^(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; finished) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//è¿™é‡Œä¹‹æ‰€ä»¥æŠŠå„ç§ delegate è°ƒç”¨éƒ½æ”¾åœ¨åŠ¨ç”»å®Œæˆåæ˜¯æœ‰åŸå› çš„ï¼šä¸ºäº†æ”¯æŒåœ¨å›è°ƒæ–¹æ³•ä¸­ show å¦ä¸€ä¸ª actionsheetï¼Œç³»ç»Ÿçš„ UIActionSheet çš„è°ƒç”¨æ—¶æœºä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(actionSheet:willDismissWithButtonIndex:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate actionSheet:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; willDismissWithButtonIndex:index];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.rootViewController = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.previousKeyWindow makeKeyAndVisible];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(actionSheet:clickedButtonAtIndex:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate actionSheet:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; clickedButtonAtIndex:index];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sender.handler) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            __&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; __&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt;(TBActionButton *)weakSender = sender;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sender.handler(weakSender);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(actionSheet:didDismissWithButtonIndex:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.delegate actionSheet:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didDismissWithButtonIndex:index];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.visible = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;]; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åŠ¨ç”»å°±ä¸å¤šè¯´äº†ï¼ŒåŸºæœ¬å°±æ˜¯ &lt;code&gt;show&lt;/code&gt; æ–¹æ³•ä¸­åŠ¨ç”»çš„é€†åŠ¨ç”»ã€‚å…¶ä½™è¿˜æœ‰å¾ˆå¤š &lt;code&gt;delegate&lt;/code&gt; å›è°ƒï¼Œæ³¨æ„è°ƒç”¨çš„é¡ºåºéœ€è¦è¿˜åŸ &lt;code&gt;UIActionSheet&lt;/code&gt; çš„è°ƒç”¨é¡ºåºï¼Œä¹Ÿä¸å¿…å¤šè¯´ã€‚é’ˆå¯¹å¸¦æœ‰ block çš„æŒ‰é’®ï¼Œæ‰§è¡Œ block æ—¶è¦é¿å…å†…å­˜æ³„éœ²ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;__weak&lt;/span&gt; __typeof(&lt;span class=&quot;type&quot;&gt;TBActionButton&lt;/span&gt; *)weakSender = sender;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;sender&lt;/span&gt;.handler(weakSender);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿˜æœ‰å°±æ˜¯å¤„ç† &lt;code&gt;UIWindow&lt;/code&gt; çš„åˆ‡æ¢å’Œé‡Šæ”¾ &lt;code&gt;rootViewController&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight crystal&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.rootViewController = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.previousKeyWindow makeKeyAndVisible];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åªè¦è°ƒç”¨æ–¹ä¸å†å¯¹ ActionSheet æœ‰å¼ºå¼•ç”¨ï¼Œ&lt;code&gt;window&lt;/code&gt; å°±ä¼šè¢«é‡Šæ”¾ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä¸€äº›ç»†èŠ‚&quot;&gt;&lt;a href=&quot;#ä¸€äº›ç»†èŠ‚&quot; class=&quot;headerlink&quot; title=&quot;ä¸€äº›ç»†èŠ‚&quot;&gt;&lt;/a&gt;ä¸€äº›ç»†èŠ‚&lt;/h1&gt;&lt;h2 id=&quot;Marco&quot;&gt;&lt;a href=&quot;#Marco&quot; class=&quot;headerlink&quot; title=&quot;Marco&quot;&gt;&lt;/a&gt;Marco&lt;/h2&gt;&lt;p&gt;é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸€äº› UIKit è‡ªå¸¦çš„å®ï¼Œå…¶å®å®ƒä»¬å¥½å¤šéƒ½æ˜¯ä½¿ç”¨ &lt;code&gt;__attribute__&lt;/code&gt; çš„å·æ‡’æ–¹å¼ï¼Œç›®çš„æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä¸€äº›äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h3 id=&quot;UI-APPEARANCE-SELECTOR&quot;&gt;&lt;a href=&quot;#UI-APPEARANCE-SELECTOR&quot; class=&quot;headerlink&quot; title=&quot;UI_APPEARANCE_SELECTOR&quot;&gt;&lt;/a&gt;UI_APPEARANCE_SELECTOR&lt;/h3&gt;&lt;p&gt;åœ¨å£°æ˜å±æ€§çš„æ—¶å€™ï¼Œè€ƒè™‘åˆ°æ–¹ä¾¿ä¸€ä¸ªåº”ç”¨å†…æ§ä»¶çš„ç»Ÿä¸€é£æ ¼ï¼Œä½¿ç”¨åˆ°äº† &lt;code&gt;UI_APPEARANCE_SELECTOR&lt;/code&gt; å®ã€‚åœ¨ iOS8 ä¹‹å‰ &lt;code&gt;UIAppearance&lt;/code&gt; ä¸æ”¯æŒ &lt;code&gt;BOOL&lt;/code&gt; ç±»å‹ï¼Œéœ€è¦ç”¨ &lt;code&gt;NSInteger&lt;/code&gt; æ›¿ä»£ã€‚æ‰€æœ‰å£°æ˜å¸¦æœ‰ &lt;code&gt;UI_APPEARANCE_SELECTOR&lt;/code&gt; çš„å±æ€§éƒ½åœ¨ &lt;code&gt;initialize&lt;/code&gt; åˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (void)initialize&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (self != [TBActionSheet class]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TBActionSheet *appearance = [self appearance]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.&lt;span class=&quot;keyword&quot;&gt;buttonHeight &lt;/span&gt;= &lt;span class=&quot;number&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.offsetY = - &lt;span class=&quot;keyword&quot;&gt;bigFragment;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    appearance.tintColor = [UIColor &lt;span class=&quot;keyword&quot;&gt;blackColor];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    appearance.destructiveButtonColor = [UIColor redColor]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.cancelButtonColor = [UIColor &lt;span class=&quot;keyword&quot;&gt;blackColor];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    appearance.&lt;span class=&quot;keyword&quot;&gt;sheetWidth &lt;/span&gt;= MIN(kScreenWidth, kScreenHeight) - &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.&lt;span class=&quot;keyword&quot;&gt;backgroundTransparentEnabled &lt;/span&gt;= YES&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.&lt;span class=&quot;keyword&quot;&gt;backgroundTouchClosureEnabled &lt;/span&gt;= YES&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.&lt;span class=&quot;keyword&quot;&gt;blurEffectEnabled &lt;/span&gt;= YES&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.rectCornerRadius = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.ambientColor = [UIColor colorWithWhite:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; alpha:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;65&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.separatorColor = [UIColor clearColor]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.animationDuration = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.animationDampingRatio = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.animationVelocity = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appearance.supportedInterfaceOrientations = UIInterfaceOrientationMaskAll&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“ç„¶æˆ‘æ˜¯ä¸å»ºè®®è°ƒç”¨è€…ç›´æ¥åœ¨è¿™é‡Œæ”¹æºç æ¥é…ç½®ä¸ªæ€§åŒ–çš„ ActionSheet ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨ &lt;code&gt;UIAppearance&lt;/code&gt; åœ¨å¤–éƒ¨è¿›è¡Œé…ç½®ï¼Œæˆ–æ˜¯é’ˆå¯¹æŸä¸ªå®ä¾‹çš„å±æ€§åšä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;UI_APPEARANCE_SELECTOR&lt;/code&gt; çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight lisp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;__attribute__((&lt;span class=&quot;name&quot;&gt;annotate&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;ui_appearance_selector&quot;&lt;/span&gt;)))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;NS-UNAVAILABLE&quot;&gt;&lt;a href=&quot;#NS-UNAVAILABLE&quot; class=&quot;headerlink&quot; title=&quot;NS_UNAVAILABLE&quot;&gt;&lt;/a&gt;NS_UNAVAILABLE&lt;/h3&gt;&lt;p&gt;æœ‰æ—¶å€™è‡ªå·±åˆ›å»ºäº†ä¸€ä¸ªç±»ï¼Œä½†æ˜¯æƒ³ç¦ç”¨ä¸€äº›ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ä½¿ç”¨ &lt;code&gt;NS_UNAVAILABLE&lt;/code&gt; å®ã€‚æ¯”å¦‚åœ¨ &lt;code&gt;TBActionSheet&lt;/code&gt; ç±»ä¸­æˆ‘ç¦ç”¨äº†è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (instance&lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt;)initWithFrame:(&lt;span class=&quot;type&quot;&gt;CGRect&lt;/span&gt;)frame &lt;span class=&quot;type&quot;&gt;NS_UNAVAILABLE&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;NS_UNAVAILABLE&lt;/code&gt; å…¶å®æœ‰ä¸€äº›æ›¿ä»£è€…ï¼Œä»ä¸‹é¢çš„å®å®šä¹‰å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; NS_UNAVAILABLE UNAVAILABLE_ATTRIBUTE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; UNAVAILABLE_ATTRIBUTE __attribute__((unavailable))&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; __unavailable	__attribute__((unavailable))&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶è€Œä¸Šé¢çš„è¿™äº›å®éƒ½æ˜¯ä¸å«æç¤ºä¿¡æ¯çš„ï¼Œæƒ³è¦å¸¦æç¤ºä¿¡æ¯è¿˜æ˜¯è€è€å®å®å†™ &lt;code&gt;__attribute__&lt;/code&gt; å§ã€‚ä¸‹é¢æ˜¯ &lt;code&gt;TBActionContainer&lt;/code&gt; çš„åˆå§‹åŒ–æ–¹æ³•å£°æ˜ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight erlang&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(instancetype)&lt;/span&gt;initWithSheet:&lt;span class=&quot;params&quot;&gt;(TBActionSheet *)&lt;/span&gt;actionSheet;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(instancetype)&lt;/span&gt;initWithFrame:&lt;span class=&quot;params&quot;&gt;(CGRect)&lt;/span&gt;frame __attribute__&lt;span class=&quot;params&quot;&gt;((unavailable(&lt;span class=&quot;string&quot;&gt;&quot;initWithFrame: not available, please use initWithSheet:&quot;&lt;/span&gt;))&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(instancetype)&lt;/span&gt;init __attribute__&lt;span class=&quot;params&quot;&gt;((unavailable(&lt;span class=&quot;string&quot;&gt;&quot;init not available, please use initWithSheet:&quot;&lt;/span&gt;))&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;NS-ASSUME-NONNULL-BEGINï¼ˆ-ENDï¼‰&quot;&gt;&lt;a href=&quot;#NS-ASSUME-NONNULL-BEGINï¼ˆ-ENDï¼‰&quot; class=&quot;headerlink&quot; title=&quot;NS_ASSUME_NONNULL_BEGINï¼ˆ_ENDï¼‰&quot;&gt;&lt;/a&gt;NS_ASSUME_NONNULL_BEGINï¼ˆ_ENDï¼‰&lt;/h3&gt;&lt;p&gt;llvm 6.1 ä¸º Objective-C åŠ å…¥äº† Nullability çš„æ–°ç‰¹æ€§åï¼Œå¤´æ–‡ä»¶ä»¬ä¸€ä¸ªä¸ªéƒ½æ›´å•°å—¦äº†ã€‚å¯ä»¥é»˜è®¤ä¸€æ®µä»£ç çš„å±æ€§æˆ–å‚æ•°ä¸ºéç©ºï¼Œé’ˆå¯¹å¯èƒ½ä¸ºç©ºçš„åˆ™ç”¨ &lt;code&gt;nullable&lt;/code&gt; ä¿®é¥°ã€‚ä½†æˆ‘ä»¬å£°æ˜çš„å¤§éƒ¨åˆ†å±æ€§æˆ–è€…æ–¹æ³•å‚æ•°éƒ½æ˜¯éç©ºçš„ï¼Œå¤§é‡çš„ &lt;code&gt;nonnull&lt;/code&gt; ä¼šé™ä½å¯è¯»æ€§ï¼Œæ‰€ä»¥è‹¹æœæä¾›äº† Audited Regions å®ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;NS_ASSUME_NONNULL_BEGIN&lt;/code&gt; å’Œ &lt;code&gt;NS_ASSUME_NONNULL_END&lt;/code&gt;ã€‚åœ¨å¤´æ–‡ä»¶ä¸­è¿™å¯¹å„¿å®ä¹‹é—´åŒºåŸŸçš„ä»£ç éƒ½ä¼šè¢«å®¡æŸ¥ï¼ŒæŒ‡é’ˆéƒ½ä¼šè¢«é»˜è®¤ä¸ºæ˜¯ &lt;code&gt;nonnull&lt;/code&gt;ã€‚&lt;code&gt;TBActionSheet&lt;/code&gt; é€‚é…äº† Nullability ç‰¹æ€§ï¼Œæ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒå®˜æ–¹çš„&lt;a href=&quot;https://developer.apple.com/swift/blog/?id=25&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nullability and Objective-C&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŠ¨æ€é…ç½®&quot;&gt;&lt;a href=&quot;#åŠ¨æ€é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;åŠ¨æ€é…ç½®&quot;&gt;&lt;/a&gt;åŠ¨æ€é…ç½®&lt;/h2&gt;&lt;p&gt;iOS ç³»ç»Ÿçš„ &lt;code&gt;UIActionSheet&lt;/code&gt; åœ¨å±•ç°åå°±ä¸èƒ½åšä¿®æ”¹äº†ï¼Œè€Œæˆ‘çš„ &lt;code&gt;TBActionSheet&lt;/code&gt; å¯ä»¥åšåˆ°å®æ—¶åŠ¨æ€æ›´æ–°ï¼Œæ¯”å¦‚åŠ¨æ€æ·»åŠ æŒ‰é’®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/yulingtianxia/TBActionSheet/blob/master/images/addButton.gif?raw=true&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨åŠ¨æ€é…ç½® &lt;code&gt;TBActionSheet&lt;/code&gt; çš„å±æ€§å&lt;strong&gt;å¿…é¡»&lt;/strong&gt;è°ƒç”¨ä»¥ä¸‹æ–¹æ³•åˆ·æ–° UIï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[self.actionSheet setupLayout]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[self.actionSheet setupStyle]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[self.actionSheet setupContainerFrame]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸ºäº†å®ç°åŠ¨æ€é…ç½®ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè¿˜åŸæœºåˆ¶æ¥æ¸…ç†ä¹‹å‰çš„çŠ¶æ€ã€‚æ¯”å¦‚å®¹å™¨å†…æœ‰å¾ˆå¤šå­è§†å›¾ï¼Œè¯¸å¦‚é‚£äº› Separator å’Œ &lt;code&gt;UIVisualEffectView&lt;/code&gt; å¯¹è±¡éƒ½æ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„ï¼Œåœ¨å¸ƒå±€å‘ç”Ÿå˜åŒ–åå¿…é¡»æ¸…ç†æ‰å®ƒä»¬ï¼Œå¹¶é‡æ–°ç”Ÿæˆä¸€éã€‚å®¹å™¨å†…è¿™äº›æ²¡æœ‰å­˜å‚¨æ•°æ®çš„è§†å›¾éƒ½æ˜¯æ²¡å¿…è¦é‡ç”¨çš„ï¼Œåªéœ€è¦æ¸…ç†æ‰é‡æ–°åˆ›å»ºä¸€éå³å¯ã€‚è¿™æ ·è™½ç„¶å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œä¸è¿‡è€ƒè™‘åˆ°æŒ‰é’®çš„æ•°é‡æ¯•ç«Ÿæœ‰é™ï¼Œæ‰€ä»¥è¿™äº›ä¸€æ¬¡æ€§çš„è§†å›¾æ•°é‡å¹¶ä¸å¤šã€‚è€Œä¸”é‡ç”¨å®ƒä»¬éœ€è¦ä¿®æ”¹å®ƒä»¬çš„ frameï¼Œéœ€è¦å•ç‹¬èŠ±ç²¾åŠ›ç®¡ç†å®ƒä»¬ï¼Œå¸¦æ¥çš„æˆæœ¬æ›´å¤§ã€‚æœ‰æ—¶ç®€å•ç²—æš´ç‚¹æ›´å¥½ï¼Œæ¯•ç«ŸåŠ¨æ€é…ç½®è¿™ç§åœºæ™¯ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å°±æ˜¯ä¸€äº›è§†å›¾èƒŒæ™¯é¢œè‰²çš„è¿˜åŸï¼Œæ¯æ¬¡è®¾ç½®å‰å…ˆå°†å…¶è®¾ä¸º &lt;code&gt;nil&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å±æ€§&quot;&gt;&lt;a href=&quot;#å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;å±æ€§&quot;&gt;&lt;/a&gt;å±æ€§&lt;/h1&gt;&lt;p&gt;&lt;code&gt;UIActionSheet&lt;/code&gt; ä¸­é™¤äº† &lt;code&gt;UIActionSheetStyle actionSheetStyle&lt;/code&gt; å±æ€§ï¼Œå…¶ä½™å±æ€§éƒ½å·²å®ç°ã€‚å› ä¸º &lt;code&gt;TBActionSheet&lt;/code&gt; çš„æ ·å¼å¯é«˜åº¦ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œæ‰€ä»¥ä¸å†éœ€è¦ &lt;code&gt;UIActionSheetStyle&lt;/code&gt; è¿™ç§æšä¸¾äº†ã€‚å¯ä»¥è¯´ &lt;code&gt;TBActionSheet&lt;/code&gt; åœ¨å±æ€§ä¸Šä¾ç„¶ã€å‡ ä¹ã€æ˜¯ &lt;code&gt;UIActionSheet&lt;/code&gt; çš„è¶…é›†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TBActionSheet&lt;/code&gt; çš„å±æ€§å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œå› ä¸ºå®ƒå®Œå…¨æ˜¯æ‰‹æ’¸çš„ï¼Œå¤ªçµæ´»äº†ã€‚ä½†æ€»ç»“èµ·æ¥æ— éå°±æ˜¯ã€å°ºå¯¸ã€ã€ã€æ ·å¼ã€ã€ã€çŠ¶æ€ã€ã€ã€å†…å®¹ã€ã€ã€æ ‡è®°ã€å’Œã€åŠ¨ç”»&amp;amp;æœå‘ã€è¿™å‡ å¤§ç±»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å°ºå¯¸&quot;&gt;&lt;a href=&quot;#å°ºå¯¸&quot; class=&quot;headerlink&quot; title=&quot;å°ºå¯¸&quot;&gt;&lt;/a&gt;å°ºå¯¸&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æŒ‰é’®é«˜åº¦&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; buttonHeight &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  actionsheetä¸‹æ–¹çš„ y è½´ä½ç§»ï¼Œå‘ä¸‹ä¸ºæ­£ï¼Œéè´Ÿå€¼æ— æ•ˆï¼Œé»˜è®¤å€¼ä¸º -8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; offsetY &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  sheet çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯æŒ‰é’®å®½åº¦&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; sheetWidth &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  çŸ©å½¢åœ†è§’åŠå¾„&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; rectCornerRadius &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;æ ·å¼&quot;&gt;&lt;a href=&quot;#æ ·å¼&quot; class=&quot;headerlink&quot; title=&quot;æ ·å¼&quot;&gt;&lt;/a&gt;æ ·å¼&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ–‡å­—é¢œè‰²&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *tintColor &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  Destructive æŒ‰é’®æ–‡å­—é¢œè‰²&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *destructiveButtonColor &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  Cancel æŒ‰é’®æ–‡å­—é¢œè‰²&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *cancelButtonColor &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  åˆ†å‰²çº¿é¢œè‰²&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *separatorColor &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æŒ‰é’®å­—ä½“&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIFont&lt;/span&gt; *buttonFont &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  ActionSheet çš„ç¯å¢ƒè‰²&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *ambientColor &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;çŠ¶æ€&quot;&gt;&lt;a href=&quot;#çŠ¶æ€&quot; class=&quot;headerlink&quot; title=&quot;çŠ¶æ€&quot;&gt;&lt;/a&gt;çŠ¶æ€&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ˜¯å¦å¯è§&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;,getter=isVisible) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; visible;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ˜¯å¦è®© ActionSheet èƒŒæ™¯é€æ˜&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, getter=isBackgroundTransparentEnabled) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; backgroundTransparentEnabled &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ˜¯å¦ç‚¹å‡»èƒŒæ™¯åå…³é—­ ActionSheet&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, getter=isBackgroundTouchClosureEnabled) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; backgroundTouchClosureEnabled &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ˜¯å¦å¯ç”¨æ¯›ç»ç’ƒæ•ˆæœ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, getter=isBlurEffectEnabled) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; blurEffectEnabled &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;å†…å®¹&quot;&gt;&lt;a href=&quot;#å†…å®¹&quot; class=&quot;headerlink&quot; title=&quot;å†…å®¹&quot;&gt;&lt;/a&gt;å†…å®¹&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;)  &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; * _Nullable  title;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;)  &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; * _Nullable  message;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ ‡é¢˜ UILabel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;,nullable,&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UILabel&lt;/span&gt; *titleLabel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  Message UILabel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;,nullable,&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UILabel&lt;/span&gt; *messageLabel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  è‡ªå®šä¹‰è§†å›¾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;,nullable) &lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *customView;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;æ ‡è®°&quot;&gt;&lt;a href=&quot;#æ ‡è®°&quot; class=&quot;headerlink&quot; title=&quot;æ ‡è®°&quot;&gt;&lt;/a&gt;æ ‡è®°&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *   æ ‡è®°è—äº ActionSheet ä¸‹é¢çš„ UIWindow&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIWindow&lt;/span&gt; *previousKeyWindow;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; cancelButtonIndex;      &lt;span class=&quot;comment&quot;&gt;// if the delegate does not implement -actionSheetCancel:, we pretend this button was clicked on. default is -1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; destructiveButtonIndex; &lt;span class=&quot;comment&quot;&gt;// sets destructive (red) button. -1 means none set. default is -1. ignored if only one button&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; firstOtherButtonIndex;	&lt;span class=&quot;comment&quot;&gt;// -1 if no otherButtonTitles or initWithTitle:... not used&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;åŠ¨ç”»-amp-æœå‘&quot;&gt;&lt;a href=&quot;#åŠ¨ç”»-amp-æœå‘&quot; class=&quot;headerlink&quot; title=&quot;åŠ¨ç”»&amp;amp;æœå‘&quot;&gt;&lt;/a&gt;åŠ¨ç”»&amp;amp;æœå‘&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; numberOfButtons;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  åŠ¨ç”»æŒç»­æ—¶é•¿&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSTimeInterval&lt;/span&gt; animationDuration &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  åŠ¨ç”»å¼¹ç°§æ•ˆæœè¡°å¼±æ¯”ä¾‹ï¼Œå€¼ä¸º 1 æ—¶æ— æ‘†åŠ¨ï¼Œå€¼è¶Šæ¥è¿‘ 0 æ‘†åŠ¨è¶Šå¤§&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; animationDampingRatio &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  åŠ¨ç”»å¼¹ç°§æ•ˆæœåˆé€Ÿåº¦ã€‚å¦‚æœåŠ¨ç”»æ€»è·ç¦»ä¸º 200 ç‚¹ï¼Œæƒ³è®©åˆé€Ÿåº¦ä¸ºæ¯ç§’ 100 ç‚¹ï¼Œé‚£ä¹ˆå°†å€¼è®¾ä¸º 0.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; animationVelocity &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *  æ”¯æŒçš„æœå‘&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIInterfaceOrientationMask&lt;/span&gt; supportedInterfaceOrientations &lt;span class=&quot;built_in&quot;&gt;UI_APPEARANCE_SELECTOR&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;å±æ€§å­˜å–å™¨&quot;&gt;&lt;a href=&quot;#å±æ€§å­˜å–å™¨&quot; class=&quot;headerlink&quot; title=&quot;å±æ€§å­˜å–å™¨&quot;&gt;&lt;/a&gt;å±æ€§å­˜å–å™¨&lt;/h2&gt;&lt;p&gt;å…¶å®å±æ€§å­˜å–å™¨å¹¶ä¸éƒ½æ˜¯å¿…è¦çš„ï¼Œå¾ˆå¤š set æ–¹æ³•å¯ä»¥ä¸å†™ï¼Œæ¯•ç«Ÿæ‰€æœ‰çš„å¸ƒå±€å’Œæ ·å¼éƒ½åœ¨æœ€åçš„ &lt;code&gt;show&lt;/code&gt; æ–¹æ³•ä¸­å†³å®šã€‚ä½†ä¸€äº›æ”¹åŠ¨ä¸å¤§çš„è½»é‡çº§å±æ€§ä¿®æ”¹è¿˜æ˜¯å¯ä»¥æ¥å—çš„ï¼Œè¿™äº›å±æ€§çš„ set æ–¹æ³•å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ã€‚åŠ¨æ€é…ç½®éœ€è¦å†æ¬¡è°ƒç”¨ &lt;code&gt;setupLayout&lt;/code&gt;ã€&lt;code&gt;setupStyle&lt;/code&gt; ä»¥åŠ &lt;code&gt;setupContainerFrame&lt;/code&gt;ï¼Œè€Œè¿™äº›è½»é‡çº§çš„å±æ€§ä¿®æ”¹åˆ™å¯ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€å†è°ƒç”¨é‚£ä¸‰ä¸ªæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰é’®å­—ä½“çš„å­˜å–å™¨å»ºç«‹åœ¨å¯¹ &lt;code&gt;buttons&lt;/code&gt; æ•°ç»„çš„éå†ä¸Šï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)setButtonFont:(UIFont *)&lt;span class=&quot;keyword&quot;&gt;buttonFont&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;buttonFont &lt;/span&gt;&amp;amp;&amp;amp; [&lt;span class=&quot;keyword&quot;&gt;self &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;buttonFont] &lt;/span&gt;!= &lt;span class=&quot;keyword&quot;&gt;buttonFont) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        for (TBActionButton *&lt;span class=&quot;keyword&quot;&gt;btn &lt;/span&gt;in &lt;span class=&quot;keyword&quot;&gt;self.buttons) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;btn.titleLabel.font &lt;/span&gt;= &lt;span class=&quot;keyword&quot;&gt;buttonFont;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (UIFont *)&lt;span class=&quot;keyword&quot;&gt;buttonFont&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &lt;span class=&quot;keyword&quot;&gt;self.buttons.lastObject.titleLabel.font;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;firstOtherButtonIndex&lt;/code&gt; æ˜¯åªè¯»å±æ€§ï¼Œå®ƒä¹Ÿæ˜¯éå† &lt;code&gt;buttons&lt;/code&gt; æ•°ç»„ï¼ŒçŸ¥é“æ‰¾åˆ°ç¬¬ä¸€ä¸ª Default é£æ ¼çš„æŒ‰é’®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)firstOtherButtonIndex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i&amp;lt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.buttons.count; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.buttons[i].style==TBActionButtonStyleDefault) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; i;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Separator çš„é¢œè‰²ä¿®æ”¹éœ€è¦æ›´æ–° &lt;code&gt;separators&lt;/code&gt; æ•°ç»„æ‰€æœ‰çš„å…ƒç´ ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setSeparatorColor:(&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *)separatorColor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (separatorColor &amp;amp;&amp;amp; separatorColor != _separatorColor) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _separatorColor = separatorColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *separator &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.separators) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            separator.backgroundColor = separatorColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ActionSheet æ˜¯å¦å¯è§ï¼Œå–å†³äºçª—å£åŠæ§åˆ¶å™¨æ˜¯å¦å­˜åœ¨ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gauss&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;BOOL&lt;/span&gt;)isVisible&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// action sheet is visible iff it&#39;s associated with a window&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; !!self.&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt; &amp;amp;&amp;amp; self.&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.rootViewController;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;backgroundTouchClosureEnabled&lt;/code&gt; çš„æ›´æ–°éœ€è¦åŒæ­¥åˆ°èƒŒæ™¯ &lt;code&gt;userInteractionEnabled&lt;/code&gt; å±æ€§ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)setBackgroundTouchClosureEnabled:(NSInteger)&lt;span class=&quot;keyword&quot;&gt;backgroundTouchClosureEnabled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _backgroundTouchClosureEnabled = &lt;span class=&quot;keyword&quot;&gt;backgroundTouchClosureEnabled;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    &lt;span class=&quot;keyword&quot;&gt;self.background.userInteractionEnabled &lt;/span&gt;= &lt;span class=&quot;keyword&quot;&gt;backgroundTouchClosureEnabled;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;åè®°&quot;&gt;&lt;a href=&quot;#åè®°&quot; class=&quot;headerlink&quot; title=&quot;åè®°&quot;&gt;&lt;/a&gt;åè®°&lt;/h1&gt;&lt;p&gt;æˆ‘ä¹Ÿæ²¡æƒ³åˆ°ä¸€ä¸ªç®€ç®€å•å•çš„ ActionSheet ä¹Ÿä¼šå†™çš„è¿™ä¹ˆå¤æ‚ï¼Œæ—©çŸ¥é“ä¼šè¿™æ ·æˆ‘çœŸçš„ä¸æ•¢ä¸‹æ‰‹ã€‚ä»¥è‡³äºå†™å®Œåè¿˜æ²¡æµ‹è¯•å°±ç”¨åœ¨äº†å…¬å¸çš„é¡¹ç›®ä¸­ï¼Œå„ç§çˆ† Bug ç„¶å Debugã€‚åŒäº‹ä»¬å„ç§ææ„è§ç„¶åæˆ‘å†å»å®Œå–„ã€‚ç¬¬ä¸€æ¬¡çº¿ä¸Šç‰ˆæœ¬å…¨éƒ¨æ›¿æ¢æˆ &lt;code&gt;TBActionSheet&lt;/code&gt; åå‡ºäº† Bugï¼Œè¿™çœŸçš„æ˜¯å®ä¹ ç”Ÿå¹²çš„ 23333 è¿™é”…æˆ‘èƒŒäº†ï¼&lt;/p&gt;
&lt;p&gt;å…¶å®å†™è¿™ä¸ªè½®å­æ˜¯ç•™ä¸‹äº†å¾ˆå¤šé—æ†¾å’Œä¸è¶³çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€å¼€å§‹è§‰å¾—å¸ƒå±€å¾ˆç®€å•ï¼Œæ— éå°±æ˜¯å‡ ä¸ª Button å•Š Label å•Šï¼Œæ‰€ä»¥æ²¡ç”¨è‡ªåŠ¨å¸ƒå±€ã€‚åé¢åŠŸèƒ½è¶Šæ¥è¶Šå¤šå¸ƒå±€å¼€å§‹å˜å¾—å¤æ‚ï¼Œéœ€è¦å¤§é‡è®¡ç®—ï¼Œæƒ³æƒ³çœŸæ˜¯åæ‚”ã€‚ä½†å†å¾€ååŠ¨æ€é…ç½®å’Œä¸ªæ€§åŒ–ç¨‹åº¦å¤§å¤§æå‡ï¼Œå‘ç°å·²ç»å¤æ‚åˆ°ä¸é€‚åˆç”¨è‡ªåŠ¨å¸ƒå±€ï¼Œä¸çŸ¥æ˜¯å¦æœ‰äº›å¿ƒå®‰&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿæ§ä»¶çš„å®ç°æ˜¯ç”¨ &lt;code&gt;UITableView&lt;/code&gt; æˆ– &lt;code&gt;UICollectionView&lt;/code&gt; æ¥å®ç°çš„ï¼Œåœ¨é•¿æŒ‰æŒ‰é’®æ»‘åŠ¨é€‰æ‹©çš„æ—¶å€™ï¼Œ&lt;code&gt;TBActionSheet&lt;/code&gt; å°±åšä¸åˆ°ç³»ç»Ÿæ§ä»¶é‚£æ ·äº†ã€‚å¦‚æœé‡å†™çš„è¯ä¸€å®šè¦ç”¨ Table å•Š&lt;/li&gt;
&lt;li&gt;å±æ€§åå‡ ç»ä¿®æ”¹ï¼Œæ¥å£ä¹Ÿæœ‰å°å¹…åº¦ä¿®æ”¹ï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ä¹Ÿå·²ç»è‡ƒè‚¿&lt;/li&gt;
&lt;li&gt;æ²¡èƒ½åšåˆ°å…¨åŠŸèƒ½é€‚é… iOS7ï¼Œæˆ–è®¸æ˜¯è‡ªå·±å¤ªæ‡’äº†ã€‚å…¶å®æœ‰å†™è¿‡äºŒç»´å˜æ¢æ¨¡æ‹Ÿç³»ç»Ÿçš„æ—‹è½¬åŠ¨ç”»ï¼Œå¹¶è¿›è¡Œäº†å¤æ‚çš„æ•°å­¦åæ ‡æ¨å¯¼å‡ºå˜æ¢å…¬å¼ï¼Œæœ€åè§‰å¾—è¿˜æ˜¯æ•ˆæœä¸æ»¡æ„ï¼Œå¹¶æŠ•å…¥å¤ªå¤šç²¾åŠ›ï¼Œé‚æ”¾å¼ƒ&lt;/li&gt;
&lt;li&gt;å½“æ—¶å› ä¸ºä¸šåŠ¡å¿™ï¼Œå†™çš„ä»£ç çœŸæ˜¯ä¹±ï¼Œç°åœ¨è¿˜åœ¨ä¸€ç‚¹ç‚¹æ•´ç†ã€‚ã€‚ã€‚è¯´å•¥éƒ½æ˜¯å€Ÿå£ï¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…¶å®ä¸€å¼€å§‹æˆ‘ä¹Ÿæƒ³å½“æŠŠæ ‡é¢˜å…šï¼ŒæŠŠæ–‡ç« æ ‡é¢˜å†™æˆã€è¿™å¯èƒ½æ˜¯ä¸œåŠçƒæœ€ç‰›é€¼çš„ ActionSheetã€ï¼Œæƒ³æƒ³è¿˜æ˜¯ç®—äº†ã€‚æˆ‘ä»ä¸æ±‚ star ä»ä¸æ±‚è½¬å‘ï¼Œè¸å®ç‚¹å¥½ğŸ˜„ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºå†™å¾—æ¯”è¾ƒåŒ†å¿™ï¼Œé€»è¾‘æ¯”è¾ƒå¤æ‚çš„åœ°æ–¹å¯èƒ½æè¿°ä¸æ¸…ï¼Œè¿˜è¯·å¤§ç¥ä»¬å¤šå¤šæå»ºè®®å’ŒæŒ‡æ­£ã€‚æ›´å¸Œæœ›èƒ½çœ‹åˆ°æœ‰å»ºè®¾æ€§çš„ PRï¼Œä¸€èµ·å°†å…¶å®Œå–„ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;iOS ç³»ç»Ÿè‡ªå¸¦çš„ &lt;code&gt;UIActionSheet&lt;/code&gt; æ— æ³•æ»¡è¶³å¼€å‘ä¸­é«˜åº¦ä¸ªæ€§åŒ–çš„ UI é£æ ¼å’Œä»£ç é£æ ¼ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œäºæ˜¯ &lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot;&gt;&lt;code&gt;TBActionSheet&lt;/code&gt;&lt;/a&gt; è¯ç”Ÿäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/yulingtianxia/TBActionSheet/blob/master/images/demo.gif?raw=true&quot; width=&quot;50%&quot; height=&quot;50%&quot;&gt;&lt;/p&gt;
&lt;p&gt;Githubï¼š&lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot;&gt;https://github.com/yulingtianxia/TBActionSheet&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/yulingtianxia/TBActionSheet&quot;&gt;&lt;code&gt;TBActionSheet&lt;/code&gt;&lt;/a&gt; ä¸ä»…è¿˜åŸäº† &lt;code&gt;UIActionSheet&lt;/code&gt; çš„å‡ ä¹æ‰€æœ‰åŠŸèƒ½å’Œ APIï¼Œè¿˜åœ¨æ­¤åŸºç¡€ä¸Šæ”¯æŒå¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;block è¯­æ³•&lt;/li&gt;
&lt;li&gt;æ’å…¥è‡ªå®šä¹‰çš„ Header è§†å›¾&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰å­—ä½“ã€é¢œè‰²ã€å°ºå¯¸ã€åœ†è§’ç­‰&lt;/li&gt;
&lt;li&gt;å°†æ¯›ç»ç’ƒæ•ˆæœæ”¯æŒåˆ°äº† iOS7ï¼Œä¸”å¯ä»¥å®šä¹‰é¢œè‰²&lt;/li&gt;
&lt;li&gt;æ”¯æŒ Cocoapods å’Œ Carthage&lt;/li&gt;
&lt;li&gt;æ”¯æŒåœ¨ Title ä¸‹é¢è®¾ç½® Message&lt;/li&gt;
&lt;li&gt;æ”¯æŒç‚¹å‡»èƒŒæ™¯å…³é—­&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨æ˜¾ç¤ºååŠ¨æ€æ›´æ–° UI&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†</title>
    <link href="http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/"/>
    <id>http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/</id>
    <published>2016-06-15T12:12:48.000Z</published>
    <updated>2016-08-27T03:30:16.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¶ˆæ¯å‘é€å’Œè½¬å‘æµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šæ¶ˆæ¯å‘é€ï¼ˆMessagingï¼‰æ˜¯ Runtime é€šè¿‡ selector å¿«é€ŸæŸ¥æ‰¾ IMP çš„è¿‡ç¨‹ï¼Œæœ‰äº†å‡½æ•°æŒ‡é’ˆå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•å®ç°ï¼›æ¶ˆæ¯è½¬å‘ï¼ˆMessage Forwardingï¼‰æ˜¯åœ¨æŸ¥æ‰¾ IMP å¤±è´¥åæ‰§è¡Œä¸€ç³»åˆ—è½¬å‘æµç¨‹çš„æ…¢é€Ÿé€šé“ï¼Œå¦‚æœä¸ä½œè½¬å‘å¤„ç†ï¼Œåˆ™ä¼šæ‰“æ—¥å¿—å’ŒæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬æ–‡ä¸è®²è¿°å¼€å‘è€…åœ¨æ¶ˆæ¯å‘é€å’Œè½¬å‘æµç¨‹ä¸­éœ€è¦åšçš„äº‹ï¼Œè€Œæ˜¯è®²è¿°åŸç†ã€‚èƒ½å¤Ÿå¾ˆå¥½åœ°é˜…è¯»æœ¬æ–‡çš„å‰ææ˜¯ä½ å¯¹ &lt;a href=&quot;http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/&quot;&gt;Objective-C Runtime&lt;/a&gt; å·²ç»æœ‰ä¸€å®šçš„äº†è§£ï¼Œå…³äºä»€ä¹ˆæ˜¯æ¶ˆæ¯ï¼ŒClass çš„ç»“æ„ï¼Œselectorã€IMPã€å…ƒç±»ç­‰æ¦‚å¿µå°†ä¸å†èµ˜è¿°&lt;/strong&gt;ã€‚æœ¬æ–‡ç”¨åˆ°çš„æºç ä¸º objc4-680 å’Œ CF-1153.18ï¼Œé€†å‘ CoreFoundation.framework çš„ç³»ç»Ÿç‰ˆæœ¬ä¸º macOS 10.11.5ï¼Œæ±‡ç¼–è¯­è¨€æ¶æ„ä¸º x86_64ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;å…«é¢ç²ç‘çš„-objc-msgSend&quot;&gt;&lt;a href=&quot;#å…«é¢ç²ç‘çš„-objc-msgSend&quot; class=&quot;headerlink&quot; title=&quot;å…«é¢ç²ç‘çš„ objc_msgSend&quot;&gt;&lt;/a&gt;å…«é¢ç²ç‘çš„ objc_msgSend&lt;/h2&gt;&lt;p&gt;æ­¤å‡½æ•°æ˜¯æ¶ˆæ¯å‘é€å¿…ç»ä¹‹è·¯ï¼Œä½†åªè¦ä¸€æ &lt;code&gt;objc_msgSend&lt;/code&gt;ï¼Œéƒ½ä¼šè¯´å®ƒçš„ä¼ªä»£ç å¦‚ä¸‹æˆ–ç±»ä¼¼çš„é€»è¾‘ï¼Œåæ­£å°±æ˜¯è·å– IMP å¹¶è°ƒç”¨ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;id objc_msgSend(id self, SEL _cmd, ...) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Class &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; = &lt;span class=&quot;title&quot;&gt;object_getClass&lt;/span&gt;&lt;/span&gt;(self);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  IMP imp = class_getMethodImplementation(&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;_cmd);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; imp ? imp(self, _cmd, ...) : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;æºç è§£æ&quot;&gt;&lt;a href=&quot;#æºç è§£æ&quot; class=&quot;headerlink&quot; title=&quot;æºç è§£æ&quot;&gt;&lt;/a&gt;æºç è§£æ&lt;/h3&gt;&lt;p&gt;ä¸ºå•¥è€ç”¨ä¼ªä»£ç ï¼Ÿå› ä¸º &lt;code&gt;objc_msgSend&lt;/code&gt; æ˜¯ç”¨æ±‡ç¼–è¯­è¨€å†™çš„ï¼Œé’ˆå¯¹ä¸åŒæ¶æ„æœ‰ä¸åŒçš„å®ç°ã€‚å¦‚ä¸‹ä¸º &lt;code&gt;x86_64&lt;/code&gt; æ¶æ„ä¸‹çš„æºç ï¼Œå¯ä»¥åœ¨ &lt;a href=&quot;https://github.com/opensource-apple/objc4/blob/master/runtime/Messengers.subproj/objc-msg-x86_64.s&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objc-msg-x86_64.s&lt;/a&gt; æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	ENTRY	_objc_msgSend&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	MESSENGER_START&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NilTest	NORMAL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	GetIsaFast NORMAL		&lt;span class=&quot;comment&quot;&gt;// r11 = self-&amp;gt;isa&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	CacheLookup NORMAL		&lt;span class=&quot;comment&quot;&gt;// calls IMP on success&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NilTestSupport	NORMAL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	GetIsaSupport	   NORMAL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// cache miss: go search the method lists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LCacheMiss:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// isa still in r11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	MethodTableLookup &lt;span class=&quot;built_in&quot;&gt;%a&lt;/span&gt;1, &lt;span class=&quot;built_in&quot;&gt;%a&lt;/span&gt;2	&lt;span class=&quot;comment&quot;&gt;// r11 = IMP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	cmp	&lt;span class=&quot;built_in&quot;&gt;%r&lt;/span&gt;11, &lt;span class=&quot;built_in&quot;&gt;%r&lt;/span&gt;11		&lt;span class=&quot;comment&quot;&gt;// set eq (nonstret) for forwarding&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	jmp	*&lt;span class=&quot;built_in&quot;&gt;%r&lt;/span&gt;11			&lt;span class=&quot;comment&quot;&gt;// goto *imp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	END_ENTRY	_objc_msgSend&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œé¢åŒ…å«ä¸€äº›æœ‰æ„ä¹‰çš„å®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NilTest&lt;/code&gt; å®ï¼Œåˆ¤æ–­è¢«å‘é€æ¶ˆæ¯çš„å¯¹è±¡æ˜¯å¦ä¸º &lt;code&gt;nil&lt;/code&gt; çš„ã€‚å¦‚æœä¸º &lt;code&gt;nil&lt;/code&gt;ï¼Œé‚£å°±ç›´æ¥è¿”å› &lt;code&gt;nil&lt;/code&gt;ã€‚è¿™å°±æ˜¯ä¸ºå•¥ä¹Ÿå¯ä»¥å¯¹ &lt;code&gt;nil&lt;/code&gt; å‘æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GetIsaFast&lt;/code&gt; å®å¯ä»¥ã€å¿«é€Ÿåœ°ã€è·å–åˆ°å¯¹è±¡çš„ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆåœ°å€ï¼ˆæ”¾åˆ° &lt;code&gt;r11&lt;/code&gt; å¯„å­˜å™¨ï¼Œ&lt;code&gt;r10&lt;/code&gt; ä¼šè¢«é‡å†™ï¼›åœ¨ arm æ¶æ„ä¸Šæ˜¯ç›´æ¥èµ‹å€¼åˆ° &lt;code&gt;r9&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CacheLookup&lt;/code&gt; è¿™ä¸ªå®æ˜¯åœ¨ç±»çš„ç¼“å­˜ä¸­æŸ¥æ‰¾ selector å¯¹åº”çš„ IMPï¼ˆæ”¾åˆ° &lt;code&gt;r10&lt;/code&gt;ï¼‰å¹¶æ‰§è¡Œã€‚å¦‚æœç¼“å­˜æ²¡ä¸­ï¼Œé‚£å°±å¾—åˆ° Class çš„æ–¹æ³•è¡¨ä¸­æŸ¥æ‰¾äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MethodTableLookup&lt;/code&gt; å®æ˜¯é‡ç‚¹ï¼Œè´Ÿè´£åœ¨ç¼“å­˜æ²¡å‘½ä¸­æ—¶åœ¨æ–¹æ³•è¡¨ä¸­è´Ÿè´£æŸ¥æ‰¾ IMPï¼š&lt;br&gt;&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;.macro&lt;/span&gt; MethodTableLookup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	MESSENGER_END_SLOW&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	SaveRegisters&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// _class_lookupMethodAndLoadCache3(receiver, &lt;span class=&quot;keyword&quot;&gt;selector, &lt;/span&gt;class)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;movq	&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;$0&lt;/span&gt;, %&lt;span class=&quot;built_in&quot;&gt;a1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;movq	&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;$1&lt;/span&gt;, %&lt;span class=&quot;built_in&quot;&gt;a2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;movq	&lt;/span&gt;%&lt;span class=&quot;built_in&quot;&gt;r11&lt;/span&gt;, %&lt;span class=&quot;built_in&quot;&gt;a3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call	__class_lookupMethodAndLoadCache3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// IMP is now in %rax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;movq	&lt;/span&gt;%rax, %&lt;span class=&quot;built_in&quot;&gt;r11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	RestoreRegisters&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;.endmacro&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºæ–¹æ³•æŸ¥æ‰¾ IMP çš„å·¥ä½œäº¤ç»™äº† OC ä¸­çš„ &lt;code&gt;_class_lookupMethodAndLoadCache3&lt;/code&gt; å‡½æ•°ï¼Œå¹¶å°† IMP è¿”å›ï¼ˆä» &lt;code&gt;r11&lt;/code&gt; æŒªåˆ° &lt;code&gt;rax&lt;/code&gt;ï¼‰ã€‚æœ€ååœ¨ &lt;code&gt;objc_msgSend&lt;/code&gt; ä¸­è°ƒç”¨ IMPã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸ºä»€ä¹ˆä½¿ç”¨æ±‡ç¼–è¯­è¨€&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆä½¿ç”¨æ±‡ç¼–è¯­è¨€&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆä½¿ç”¨æ±‡ç¼–è¯­è¨€&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆä½¿ç”¨æ±‡ç¼–è¯­è¨€&lt;/h3&gt;&lt;p&gt;å…¶å®åœ¨ &lt;a href=&quot;https://github.com/opensource-apple/objc4/blob/master/runtime/Messengers.subproj/objc-msg-x86_64.s&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objc-msg-x86_64.s&lt;/a&gt; ä¸­åŒ…å«äº†å¤šä¸ªç‰ˆæœ¬çš„ &lt;code&gt;objc_msgSend&lt;/code&gt; æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯æ ¹æ®è¿”å›å€¼çš„ç±»å‹å’Œè°ƒç”¨è€…çš„ç±»å‹åˆ†åˆ«å¤„ç†çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;objc_msgSendSuper&lt;/code&gt;:å‘çˆ¶ç±»å‘æ¶ˆæ¯ï¼Œè¿”å›å€¼ç±»å‹ä¸º &lt;code&gt;id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;objc_msgSend_fpret&lt;/code&gt;:è¿”å›å€¼ç±»å‹ä¸º floating-pointï¼Œå…¶ä¸­åŒ…å« &lt;code&gt;objc_msgSend_fp2ret&lt;/code&gt; å…¥å£å¤„ç†è¿”å›å€¼ç±»å‹ä¸º &lt;code&gt;long double&lt;/code&gt; çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;objc_msgSend_stret&lt;/code&gt;:è¿”å›å€¼ä¸ºç»“æ„ä½“&lt;/li&gt;
&lt;li&gt;&lt;code&gt;objc_msgSendSuper_stret&lt;/code&gt;:å‘çˆ¶ç±»å‘æ¶ˆæ¯ï¼Œè¿”å›å€¼ç±»å‹ä¸ºç»“æ„ä½“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“éœ€è¦å‘é€æ¶ˆæ¯æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸­é—´ä»£ç ï¼Œæ ¹æ®æƒ…å†µåˆ†åˆ«è°ƒç”¨ &lt;code&gt;objc_msgSend&lt;/code&gt;, &lt;code&gt;objc_msgSend_stret&lt;/code&gt;, &lt;code&gt;objc_msgSendSuper&lt;/code&gt;, æˆ– &lt;code&gt;objc_msgSendSuper_stret&lt;/code&gt; å…¶ä¸­ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ &lt;code&gt;objc_msgSend&lt;/code&gt; è¦ç”¨æ±‡ç¼–è¯­è¨€è€Œä¸æ˜¯ OCã€C æˆ– C++ è¯­è¨€æ¥å®ç°ï¼Œå› ä¸ºå•ç‹¬ä¸€ä¸ªæ–¹æ³•å®šä¹‰æ»¡è¶³ä¸äº†å¤šç§ç±»å‹è¿”å›å€¼ï¼Œæœ‰çš„æ–¹æ³•è¿”å› &lt;code&gt;id&lt;/code&gt;ï¼Œæœ‰çš„è¿”å› &lt;code&gt;int&lt;/code&gt;ã€‚è€ƒè™‘åˆ°ä¸åŒç±»å‹å‚æ•°è¿”å›å€¼æ’åˆ—ç»„åˆæ˜ å°„ä¸åŒæ–¹æ³•ç­¾åï¼ˆmethod signatureï¼‰çš„é—®é¢˜ï¼Œé‚£ switch è¯­å¥å¾—è€é•¿äº†ã€‚ã€‚ã€‚&lt;strong&gt;è¿™äº›åŸå› å¯ä»¥æ€»ç»“ä¸º &lt;a href=&quot;https://en.wikipedia.org/wiki/Calling_convention&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Calling Convention&lt;/a&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´å‡½æ•°è°ƒç”¨è€…ä¸è¢«è°ƒç”¨è€…å¿…é¡»çº¦å®šå¥½å‚æ•°ä¸è¿”å›å€¼åœ¨ä¸åŒæ¶æ„å¤„ç†å™¨ä¸Šçš„å­˜å–è§„åˆ™ï¼Œæ¯”å¦‚å‚æ•°æ˜¯ä»¥ä½•ç§é¡ºåºå­˜å‚¨åœ¨æ ˆä¸Šï¼Œæˆ–æ˜¯å­˜å‚¨åœ¨å“ªäº›å¯„å­˜å™¨ä¸Šã€‚&lt;/strong&gt;é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å…¶ä»–åŸå› ï¼Œæ¯”å¦‚å…¶å¯å˜å‚æ•°ç”¨æ±‡ç¼–å¤„ç†èµ·æ¥æœ€æ–¹ä¾¿ï¼Œå› ä¸ºæ‰¾åˆ° IMP åœ°å€åå‚æ•°éƒ½åœ¨æ ˆä¸Šã€‚è¦æ˜¯ç”¨ C++ ä¼ é€’å¯å˜å‚æ•°é‚£å°±æ‚²å‰§äº†ï¼Œprologue æœºåˆ¶ä¼šå¼„ä¹±åœ°å€ï¼ˆæ¯”å¦‚ i386 ä¸Šä¸ºäº†å­˜å‚¨ &lt;code&gt;ebp&lt;/code&gt; å‘åç§»ä½ 4byteï¼‰ï¼Œæœ€åè¿˜è¦ç”¨ epilogue æ‰“æ‰«æˆ˜åœºã€‚è€Œä¸”æ±‡ç¼–ç¨‹åºæ‰§è¡Œæ•ˆç‡é«˜ï¼Œåœ¨ Objective-C Runtime ä¸­è°ƒç”¨é¢‘ç‡è¾ƒé«˜çš„å‡½æ•°å¥½å¤šéƒ½ç”¨æ±‡ç¼–å†™çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä½¿ç”¨-lookUpImpOrForward-å¿«é€ŸæŸ¥æ‰¾-IMP&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨-lookUpImpOrForward-å¿«é€ŸæŸ¥æ‰¾-IMP&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ lookUpImpOrForward å¿«é€ŸæŸ¥æ‰¾ IMP&quot;&gt;&lt;/a&gt;ä½¿ç”¨ lookUpImpOrForward å¿«é€ŸæŸ¥æ‰¾ IMP&lt;/h2&gt;&lt;p&gt;ä¸Šä¸€èŠ‚ä¸­è¯´åˆ°çš„ &lt;code&gt;_class_lookupMethodAndLoadCache3&lt;/code&gt; å‡½æ•°å…¶å®åªæ˜¯ç®€å•çš„è°ƒç”¨äº† &lt;code&gt;lookUpImpOrForward&lt;/code&gt; å‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;IMP _class_lookupMethodAndLoadCache3(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj, SEL sel, Class cls)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; lookUpImpOrForward(cls, sel, obj, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                              &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*initialize*/&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*cache*/&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*resolver*/&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ &lt;code&gt;lookUpImpOrForward&lt;/code&gt; è°ƒç”¨æ—¶ä½¿ç”¨ç¼“å­˜å‚æ•°ä¼ å…¥ä¸º &lt;code&gt;NO&lt;/code&gt;ï¼Œå› ä¸ºä¹‹å‰å·²ç»å°è¯•è¿‡æŸ¥æ‰¾ç¼“å­˜äº†ã€‚&lt;code&gt;IMP lookUpImpOrForward(Class cls, SEL sel, id inst, bool initialize, bool cache, bool resolver)&lt;/code&gt; å®ç°äº†ä¸€å¥—æŸ¥æ‰¾ IMP çš„æ ‡å‡†è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¶ˆæ¯è½¬å‘ï¼ˆForwardï¼‰ä¹‹å‰çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¼˜åŒ–ç¼“å­˜æŸ¥æ‰¾-amp-ç±»çš„åˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#ä¼˜åŒ–ç¼“å­˜æŸ¥æ‰¾-amp-ç±»çš„åˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä¼˜åŒ–ç¼“å­˜æŸ¥æ‰¾&amp;amp;ç±»çš„åˆå§‹åŒ–&quot;&gt;&lt;/a&gt;ä¼˜åŒ–ç¼“å­˜æŸ¥æ‰¾&amp;amp;ç±»çš„åˆå§‹åŒ–&lt;/h3&gt;&lt;p&gt;å…ˆå¯¹ debug æ¨¡å¼ä¸‹çš„ assert è¿›è¡Œ unlockï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;runtimeLock&lt;span class=&quot;selector-class&quot;&gt;.assertUnlocked&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;runtimeLock&lt;/code&gt; æœ¬è´¨ä¸Šæ˜¯å¯¹ Darwin æä¾›çš„çº¿ç¨‹è¯»å†™é” &lt;code&gt;pthread_rwlock_t&lt;/code&gt; çš„ä¸€å±‚å°è£…ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;lookUpImpOrForward&lt;/code&gt; æ¥ç€åšäº†å¦‚ä¸‹ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨ç¼“å­˜ï¼ˆ&lt;code&gt;cache&lt;/code&gt; å‚æ•°ä¸º &lt;code&gt;YES&lt;/code&gt;ï¼‰ï¼Œé‚£å°±è°ƒç”¨ &lt;code&gt;cache_getImp&lt;/code&gt; æ–¹æ³•ä»ç¼“å­˜æŸ¥æ‰¾ IMPã€‚&lt;code&gt;cache_getImp&lt;/code&gt; æ˜¯ç”¨æ±‡ç¼–è¯­è¨€å†™çš„ï¼Œä¹Ÿå¯ä»¥åœ¨ &lt;a href=&quot;https://github.com/opensource-apple/objc4/blob/master/runtime/Messengers.subproj/objc-msg-x86_64.s&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objc-msg-x86_64.s&lt;/a&gt; æ‰¾åˆ°ï¼Œå…¶ä¾ç„¶ç”¨äº†ä¹‹å‰è¯´è¿‡çš„ &lt;code&gt;CacheLookup&lt;/code&gt; å®ã€‚å› ä¸º &lt;code&gt;_class_lookupMethodAndLoadCache3&lt;/code&gt; è°ƒç”¨ &lt;code&gt;lookUpImpOrForward&lt;/code&gt; æ—¶ &lt;code&gt;cache&lt;/code&gt; å‚æ•°ä¸º &lt;code&gt;NO&lt;/code&gt;ï¼Œ&lt;strong&gt;è¿™æ­¥ç›´æ¥ç•¥è¿‡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç”¨åˆ°è¿™ä¸ªç±»ä¸” &lt;code&gt;initialize&lt;/code&gt; å‚æ•°ä¸º &lt;code&gt;YES&lt;/code&gt;ï¼ˆ&lt;code&gt;initialize  &amp;amp;&amp;amp;  !cls-&amp;gt;isInitialized()&lt;/code&gt;ï¼‰ï¼Œéœ€è¦è¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼Œä¹Ÿå°±æ˜¯å¼€è¾Ÿä¸€ä¸ªç”¨äºè¯»å†™æ•°æ®çš„ç©ºé—´ã€‚å…ˆå¯¹ &lt;code&gt;runtimeLock&lt;/code&gt; å†™æ“ä½œåŠ é”ï¼Œç„¶åè°ƒç”¨ &lt;code&gt;cls&lt;/code&gt; çš„ &lt;code&gt;initialize&lt;/code&gt; æ–¹æ³•ã€‚å¦‚æœ &lt;code&gt;sel == initialize&lt;/code&gt; ä¹Ÿæ²¡å…³ç³»ï¼Œè™½ç„¶ &lt;code&gt;initialize&lt;/code&gt; è¿˜ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä½†ä¸ä¼šèµ·ä½œç”¨å•¦ï¼Œå› ä¸º &lt;code&gt;cls-&amp;gt;isInitialized()&lt;/code&gt; å·²ç»æ˜¯ &lt;code&gt;YES&lt;/code&gt; å•¦ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;ç»§ç»­åœ¨ç±»çš„ç»§æ‰¿ä½“ç³»ä¸­æŸ¥æ‰¾&quot;&gt;&lt;a href=&quot;#ç»§ç»­åœ¨ç±»çš„ç»§æ‰¿ä½“ç³»ä¸­æŸ¥æ‰¾&quot; class=&quot;headerlink&quot; title=&quot;ç»§ç»­åœ¨ç±»çš„ç»§æ‰¿ä½“ç³»ä¸­æŸ¥æ‰¾&quot;&gt;&lt;/a&gt;ç»§ç»­åœ¨ç±»çš„ç»§æ‰¿ä½“ç³»ä¸­æŸ¥æ‰¾&lt;/h3&gt;&lt;p&gt;è€ƒè™‘åˆ°è¿è¡Œæ—¶ç±»ä¸­çš„æ–¹æ³•å¯èƒ½ä¼šå¢åŠ ï¼Œéœ€è¦å…ˆåšè¯»æ“ä½œåŠ é”ï¼Œä½¿å¾—æ–¹æ³•æŸ¥æ‰¾å’Œç¼“å­˜å¡«å……æˆä¸ºåŸå­æ“ä½œã€‚æ·»åŠ  category ä¼šåˆ·æ–°ç¼“å­˜ï¼Œä¹‹åå¦‚æœæ—§æ•°æ®åˆè¢«é‡å¡«åˆ°ç¼“å­˜ä¸­ï¼Œcategory æ·»åŠ æ“ä½œå°±ä¼šè¢«å¿½ç•¥æ‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;runtimeLock&lt;span class=&quot;selector-class&quot;&gt;.read&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¹‹åçš„é€»è¾‘æ•´ç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœ selector æ˜¯éœ€è¦è¢«å¿½ç•¥çš„åƒåœ¾å›æ”¶ç”¨åˆ°çš„æ–¹æ³•ï¼Œåˆ™å°† IMP ç»“æœè®¾ä¸º &lt;code&gt;_objc_ignored_method&lt;/code&gt;ï¼Œè¿™æ˜¯ä¸ªæ±‡ç¼–ç¨‹åºå…¥å£ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡è®°ã€‚å¯¹æ­¤ç§æƒ…å†µè¿›è¡Œç¼“å­˜å¡«å……æ“ä½œåï¼Œè·³åˆ°ç¬¬ 7 æ­¥ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥æ‰¾å½“å‰ç±»ä¸­çš„ç¼“å­˜ï¼Œè·Ÿä¹‹å‰ä¸€æ ·ï¼Œä½¿ç”¨ &lt;code&gt;cache_getImp&lt;/code&gt; æ±‡ç¼–ç¨‹åºå…¥å£ã€‚å¦‚æœå‘½ä¸­ç¼“å­˜è·å–åˆ°äº† IMPï¼Œåˆ™ç›´æ¥è·³åˆ°ç¬¬ 7 æ­¥ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å½“å‰ç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨ï¼ˆmethod listï¼‰ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯æ ¹æ® selector æŸ¥æ‰¾åˆ° Method åï¼Œè·å– Method ä¸­çš„ IMPï¼ˆä¹Ÿå°±æ˜¯ &lt;code&gt;method_imp&lt;/code&gt; å±æ€§ï¼‰ï¼Œå¹¶å¡«å……åˆ°ç¼“å­˜ä¸­ã€‚æŸ¥æ‰¾è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¼šé’ˆå¯¹å·²ç»æ’åºçš„åˆ—è¡¨ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ï¼Œæœªæ’åºçš„åˆ—è¡¨åˆ™æ˜¯çº¿æ€§éå†ã€‚å¦‚æœæˆåŠŸæŸ¥æ‰¾åˆ° Method å¯¹è±¡ï¼Œå°±ç›´æ¥è·³åˆ°ç¬¬ 7 æ­¥ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ç»§æ‰¿å±‚çº§ä¸­é€’å½’å‘çˆ¶ç±»ä¸­æŸ¥æ‰¾ï¼Œæƒ…å†µè·Ÿä¸Šä¸€æ­¥ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…ˆæŸ¥æ‰¾ç¼“å­˜ï¼Œç¼“å­˜æ²¡ä¸­å°±æŸ¥æ‰¾æ–¹æ³•åˆ—è¡¨ã€‚è¿™é‡Œè·Ÿä¸Šä¸€æ­¥ä¸åŒçš„åœ°æ–¹åœ¨äºç¼“å­˜ç­–ç•¥ï¼Œæœ‰ä¸ª &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; æ±‡ç¼–ç¨‹åºå…¥å£ä½œä¸ºç¼“å­˜ä¸­æ¶ˆæ¯è½¬å‘çš„æ ‡è®°ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº† IMPï¼Œä½†å¦‚æœå‘ç°å…¶å†…å®¹æ˜¯ &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt;ï¼Œé‚£å°±ç»ˆæ­¢åœ¨ç±»çš„ç»§æ‰¿å±‚çº§ä¸­é€’å½’æŸ¥æ‰¾ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼›å¦åˆ™è·³åˆ°ç¬¬ 7 æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä¼ å…¥ &lt;code&gt;lookUpImpOrForward&lt;/code&gt; çš„å‚æ•° &lt;code&gt;resolver&lt;/code&gt; ä¸º &lt;code&gt;YES&lt;/code&gt; å¹¶ä¸”æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥ç¬¬ 5 æ­¥æ—¶ï¼Œæ—¶è¿›å…¥åŠ¨æ€æ–¹æ³•è§£æï¼›å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚è¿™æ­¥æ¶ˆæ¯è½¬å‘å‰çš„æœ€åä¸€æ¬¡æœºä¼šã€‚æ­¤æ—¶é‡Šæ”¾è¯»å…¥é”ï¼ˆ&lt;code&gt;runtimeLock.unlockRead()&lt;/code&gt;ï¼‰ï¼Œæ¥ç€é—´æ¥åœ°å‘é€ &lt;code&gt;+resolveInstanceMethod&lt;/code&gt; æˆ– &lt;code&gt;+resolveClassMethod&lt;/code&gt; æ¶ˆæ¯ã€‚è¿™ç›¸å½“äºå‘Šè¯‰ç¨‹åºå‘˜ã€èµ¶ç´§ç”¨ Runtime ç»™ç±»é‡Œè¿™ä¸ª selector å¼„ä¸ªå¯¹åº”çš„ IMP å§ã€ï¼Œå› ä¸ºæ­¤æ—¶é”å·²ç» unlock äº†æ‰€ä»¥ä¸ä¼šç¼“å­˜ç»“æœï¼Œç”šè‡³è¿˜éœ€è¦è½¯æ€§åœ°å¤„ç†ç¼“å­˜è¿‡æœŸé—®é¢˜å¯èƒ½å¸¦æ¥çš„é”™è¯¯ã€‚è¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘ç¨å¾®å¤æ‚äº›ï¼Œåé¢ä¼šæ€»ç»“ã€‚å› ä¸ºè¿™äº›å·¥ä½œéƒ½æ˜¯åœ¨éçº¿ç¨‹å®‰å…¨ä¸‹è¿›è¡Œçš„ï¼Œå®Œæˆåéœ€è¦å›åˆ°ç¬¬ 1 æ­¥å†æ¬¡æŸ¥æ‰¾ IMPã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ä¸ä»…æ²¡æŸ¥æ‰¾åˆ° IMPï¼ŒåŠ¨æ€æ–¹æ³•è§£æä¹Ÿä¸å¥æ•ˆï¼Œåªèƒ½å°† &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; å½“åš IMP å¹¶å†™å…¥ç¼“å­˜ã€‚è¿™ä¹Ÿå°±æ˜¯ä¹‹å‰ç¬¬ 4 æ­¥ä¸­ä¸ºä½•æŸ¥æ‰¾åˆ° &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; å°±è¡¨æ˜äº†è¦è¿›å…¥æ¶ˆæ¯è½¬å‘äº†ã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œè§£é”ï¼Œå¹¶å°†ä¹‹å‰æ‰¾åˆ°çš„ IMP è¿”å›ã€‚ï¼ˆæ— è®ºæ˜¯æ­£ç» IMP è¿˜æ˜¯ä¸æ­£ç»çš„ &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt;ï¼‰è¿™æ­¥è¿˜åæ‰§åœ°åšäº†ä¸€äº›è„‘æ´ç•¥å¤§çš„ assertï¼Œå¾ˆæœ‰è¶£ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äºç¬¬ 5 æ­¥ï¼Œå…¶å®æ˜¯ç›´æ¥è°ƒç”¨ &lt;code&gt;_class_resolveMethod&lt;/code&gt; å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­å®ç°äº†å¤æ‚çš„æ–¹æ³•è§£æé€»è¾‘ã€‚å¦‚æœ &lt;code&gt;cls&lt;/code&gt; æ˜¯å…ƒç±»åˆ™ä¼šå‘é€  &lt;code&gt;+resolveClassMethod&lt;/code&gt;ï¼Œç„¶åæ ¹æ® &lt;code&gt;lookUpImpOrNil(cls, sel, inst, NO/*initialize*/, YES/*cache*/, NO/*resolver*/)&lt;/code&gt; å‡½æ•°çš„ç»“æœæ¥åˆ¤æ–­æ˜¯å¦å‘é€ &lt;code&gt;+resolveInstanceMethod&lt;/code&gt;ï¼›å¦‚æœä¸æ˜¯å…ƒç±»ï¼Œåˆ™åªéœ€è¦å‘é€ &lt;code&gt;+resolveInstanceMethod&lt;/code&gt; æ¶ˆæ¯ã€‚è¿™é‡Œè°ƒç”¨ &lt;code&gt;+resolveInstanceMethod&lt;/code&gt; æˆ– &lt;code&gt;+resolveClassMethod&lt;/code&gt; æ—¶å†æ¬¡ç”¨åˆ°äº† &lt;code&gt;objc_msgSend&lt;/code&gt;ï¼Œè€Œä¸”ç¬¬ä¸‰ä¸ªå‚æ•°æ­£æ˜¯ä¼ å…¥ &lt;code&gt;lookUpImpOrForward&lt;/code&gt; çš„é‚£ä¸ª &lt;code&gt;sel&lt;/code&gt;ã€‚åœ¨å‘é€æ–¹æ³•è§£ææ¶ˆæ¯ä¹‹åè¿˜ä¼šè°ƒç”¨ &lt;code&gt;lookUpImpOrNil(cls, sel, inst, NO/*initialize*/, YES/*cache*/, NO/*resolver*/)&lt;/code&gt; æ¥åˆ¤æ–­æ˜¯å¦å·²ç»æ·»åŠ ä¸Š &lt;code&gt;sel&lt;/code&gt; å¯¹åº”çš„ IMP äº†ï¼Œæ‰“å°å‡ºç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æœ€å &lt;code&gt;lookUpImpOrForward&lt;/code&gt; æ–¹æ³•ä¹Ÿä¼šæŠŠçœŸæ­£çš„ IMP æˆ–è€…éœ€è¦æ¶ˆæ¯è½¬å‘çš„ &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; è¿”å›ï¼Œå¹¶æœ€ç»ˆä¸“é€’åˆ° &lt;code&gt;objc_msgSend&lt;/code&gt; ä¸­ã€‚è€Œ &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; ä¼šåœ¨è½¬åŒ–æˆ &lt;code&gt;_objc_msgForward&lt;/code&gt; æˆ– &lt;code&gt;_objc_msgForward_stret&lt;/code&gt;ã€‚è¿™ä¸ªåé¢ä¼šè®²è§£åŸç†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å›é¡¾-objc-msgSend-ä¼ªä»£ç &quot;&gt;&lt;a href=&quot;#å›é¡¾-objc-msgSend-ä¼ªä»£ç &quot; class=&quot;headerlink&quot; title=&quot;å›é¡¾ objc_msgSend ä¼ªä»£ç &quot;&gt;&lt;/a&gt;å›é¡¾ objc_msgSend ä¼ªä»£ç &lt;/h3&gt;&lt;p&gt;å›è¿‡å¤´æ¥ä¼šå‘ç° &lt;code&gt;objc_msgSend&lt;/code&gt; çš„ä¼ªä»£ç æè¿°å¾—å¾ˆä¼ ç¥å•Šï¼Œå› ä¸º&lt;code&gt;class_getMethodImplementation&lt;/code&gt; çš„å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;IMP class_getMethodImplementation(Class cls, SEL sel)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IMP imp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!cls  ||  !sel) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    imp = lookUpImpOrNil(cls, sel, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*initialize*/&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*cache*/&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*resolver*/&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Translate forwarding function to C-callable external version&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!imp) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _objc_msgForward;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; imp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;lookUpImpOrNil&lt;/code&gt; å‡½æ•°è·å–ä¸åˆ° IMP æ—¶å°±è¿”å› &lt;code&gt;_objc_msgForward&lt;/code&gt;ï¼Œåé¢ä¼šè®²åˆ°å®ƒã€‚&lt;code&gt;lookUpImpOrNil&lt;/code&gt; è·Ÿ &lt;code&gt;lookUpImpOrForward&lt;/code&gt; çš„åŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œåªæ˜¯å°† &lt;code&gt;lookUpImpOrForward&lt;/code&gt; å®ç°ä¸­çš„ &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; æ›¿æ¢æˆäº† &lt;code&gt;nil&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;IMP lookUpImpOrNil(Class cls, SEL sel, id &lt;span class=&quot;keyword&quot;&gt;inst, &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   &lt;span class=&quot;keyword&quot;&gt;bool &lt;/span&gt;initialize, &lt;span class=&quot;keyword&quot;&gt;bool &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;cache, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;bool &lt;/span&gt;resolver)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IMP imp = lookUpImpOrForward(cls, sel, &lt;span class=&quot;keyword&quot;&gt;inst, &lt;/span&gt;initialize, &lt;span class=&quot;keyword&quot;&gt;cache, &lt;/span&gt;resolver)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (imp == _objc_msgForward_impcache) return nil&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else return imp&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;lookUpImpOrNil&lt;/code&gt; æ–¹æ³•å¯ä»¥æŸ¥æ‰¾åˆ° selector å¯¹åº”çš„ IMP æˆ–æ˜¯ &lt;code&gt;nil&lt;/code&gt;ï¼Œæ‰€ä»¥å¦‚æœä¸è€ƒè™‘è¿”å›å€¼ç±»å‹ä¸ºç»“æ„ä½“çš„æƒ…å†µï¼Œç”¨é‚£å‡ è¡Œä¼ªä»£ç æ¥è¡¨ç¤ºå¤æ‚çš„æ±‡ç¼–å®ç°è¿˜æ˜¯æŒºæ°å½“çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;forwarding-ä¸­è·¯æ¼«æ¼«çš„æ¶ˆæ¯è½¬å‘&quot;&gt;&lt;a href=&quot;#forwarding-ä¸­è·¯æ¼«æ¼«çš„æ¶ˆæ¯è½¬å‘&quot; class=&quot;headerlink&quot; title=&quot;forwarding ä¸­è·¯æ¼«æ¼«çš„æ¶ˆæ¯è½¬å‘&quot;&gt;&lt;/a&gt;&lt;strong&gt;forwarding&lt;/strong&gt; ä¸­è·¯æ¼«æ¼«çš„æ¶ˆæ¯è½¬å‘&lt;/h2&gt;&lt;h3 id=&quot;objc-msgForward-impcache-çš„è½¬æ¢&quot;&gt;&lt;a href=&quot;#objc-msgForward-impcache-çš„è½¬æ¢&quot; class=&quot;headerlink&quot; title=&quot;objc_msgForward_impcache çš„è½¬æ¢&quot;&gt;&lt;/a&gt;objc_msgForward_impcache çš„è½¬æ¢&lt;/h3&gt;&lt;p&gt;&lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; åªæ˜¯ä¸ªå†…éƒ¨çš„å‡½æ•°æŒ‡é’ˆï¼Œåªå­˜å‚¨äºä¸ŠèŠ‚æåˆ°çš„ç±»çš„æ–¹æ³•ç¼“å­˜ä¸­ï¼Œéœ€è¦è¢«è½¬åŒ–ä¸º &lt;code&gt;_objc_msgForward&lt;/code&gt; å’Œ &lt;code&gt;_objc_msgForward_stret&lt;/code&gt; æ‰èƒ½è¢«å¤–éƒ¨è°ƒç”¨ã€‚ä½†åœ¨ &lt;del&gt;Mac OS X&lt;/del&gt; macOS 10.6 åŠæ›´æ—©ç‰ˆæœ¬çš„ libobjc.A.dylib ä¸­æ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨çš„ï¼Œå†µä¸”æˆ‘ä»¬æ ¹æœ¬ä¸ä¼šç›´æ¥ç”¨åˆ°å®ƒã€‚å¸¦ &lt;code&gt;stret&lt;/code&gt; åç¼€çš„å‡½æ•°ä¾æ—§æ˜¯è¿”å›å€¼ä¸ºç»“æ„ä½“çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€èŠ‚æœ€åè®²åˆ°å¦‚æœæ²¡æ‰¾åˆ° IMPï¼Œå°±ä¼šå°† &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; è¿”å›åˆ° &lt;code&gt;objc_msgSend&lt;/code&gt; å‡½æ•°ï¼Œè€Œæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”¨æ±‡ç¼–è¯­è¨€å†™çš„ï¼Œæ‰€ä»¥å°†å†…éƒ¨ä½¿ç”¨çš„ &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; è½¬åŒ–æˆå¤–éƒ¨å¯è°ƒç”¨çš„ &lt;code&gt;_objc_msgForward&lt;/code&gt; æˆ– &lt;code&gt;_objc_msgForward_stret&lt;/code&gt; ä¹Ÿæ˜¯ç”±æ±‡ç¼–ä»£ç æ¥å®Œæˆã€‚å®ç°åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯å¢åŠ ä¸ªé™æ€å…¥å£ &lt;code&gt;__objc_msgForward_impcache&lt;/code&gt;ï¼Œç„¶åæ ¹æ®æ­¤æ—¶ CPU çš„çŠ¶æ€å¯„å­˜å™¨çš„å†…å®¹æ¥å†³å®šè½¬æ¢æˆå“ªä¸ªã€‚å¦‚æœæ˜¯ &lt;code&gt;NE&lt;/code&gt;(Not Equal) åˆ™è½¬æ¢æˆ &lt;code&gt;_objc_msgForward_stret&lt;/code&gt;ï¼Œåä¹‹æ˜¯ &lt;code&gt;EQ&lt;/code&gt;(Equal) åˆ™è½¬æ¢æˆ &lt;code&gt;_objc_msgForward&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;jne	&lt;/span&gt;__objc_msgForward_stret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;jmp	&lt;/span&gt;__objc_msgForward&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸ºä½•æ ¹æ®çŠ¶æ€å¯„å­˜å™¨çš„å€¼æ¥åˆ¤æ–­è½¬æ¢æˆå“ªä¸ªå‡½æ•°æŒ‡é’ˆå‘¢ï¼Ÿå›è¿‡å¤´æ¥çœ‹çœ‹ &lt;code&gt;objc_msgSend&lt;/code&gt; ä¸­è°ƒç”¨å®Œ &lt;code&gt;MethodTableLookup&lt;/code&gt; ä¹‹åå¹²äº†ä»€ä¹ˆï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight perl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MethodTableLookup %a1, %a2	// r11 = IMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cmp	%r11, %r11		// set e&lt;span class=&quot;string&quot;&gt;q (nonstret)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; forwarding&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;jmp	*%r11			// &lt;span class=&quot;keyword&quot;&gt;goto&lt;/span&gt; *imp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å†çœ‹çœ‹è¿”å›å€¼ä¸ºç»“æ„ä½“çš„ &lt;code&gt;objc_msgSend_stret&lt;/code&gt; è¿™é‡Œçš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MethodTableLookup &lt;span class=&quot;built_in&quot;&gt;%a&lt;/span&gt;2, &lt;span class=&quot;built_in&quot;&gt;%a&lt;/span&gt;3	&lt;span class=&quot;comment&quot;&gt;// r11 = IMP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;test	&lt;span class=&quot;built_in&quot;&gt;%r&lt;/span&gt;11, &lt;span class=&quot;built_in&quot;&gt;%r&lt;/span&gt;11		&lt;span class=&quot;comment&quot;&gt;// set ne (stret) for forward; r11!=0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;jmp	*&lt;span class=&quot;built_in&quot;&gt;%r&lt;/span&gt;11			&lt;span class=&quot;comment&quot;&gt;// goto *imp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¨å¾®æ‡‚æ±‡ç¼–çš„äººä¸€çœ¼å°±çœ‹æ˜ç™½äº†ï¼Œä¸æ‡‚çš„çœ‹æ³¨é‡Šä¹Ÿæ‡‚äº†ï¼Œæˆ‘å°±ä¸å¢¨è¿¹äº†ã€‚ç°åœ¨æ€»ç®—æ˜¯æŠŠæ¶ˆæ¯è½¬å‘å‰çš„é€»è¾‘ç»•å›æ¥æ„æˆé—­ç¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€èŠ‚ä¸­æåˆ° &lt;code&gt;class_getMethodImplementation&lt;/code&gt; å‡½æ•°çš„å®ç°ï¼Œåœ¨æŸ¥æ‰¾ä¸åˆ° IMP æ—¶è¿”å› &lt;code&gt;_objc_msgForward&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;_objc_msgForward_stret&lt;/code&gt; æ­£å¥½å¯¹åº”ç€ &lt;code&gt;class_getMethodImplementation_stret&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;IMP&lt;/span&gt; class_getMethodImplementation_stret(Class cls, &lt;span class=&quot;keyword&quot;&gt;SEL &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;sel)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IMP imp = class_getMethodImplementation(cls, &lt;span class=&quot;keyword&quot;&gt;sel);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    // Translate forwarding &lt;span class=&quot;meta&quot;&gt;function&lt;/span&gt; to &lt;span class=&quot;keyword&quot;&gt;struct-returning &lt;/span&gt;version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;if&lt;/span&gt; (imp == (IMP)&amp;amp;_objc_msgForward &lt;span class=&quot;comment&quot;&gt;/* not _internal! */&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return (IMP)&amp;amp;_objc_msgForward_stret&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return imp&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ &lt;code&gt;_objc_msgForward*&lt;/code&gt; ç³»åˆ—æœ¬è´¨éƒ½æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œéƒ½ç”¨æ±‡ç¼–è¯­è¨€å®ç°ï¼Œéƒ½å¯ä»¥ä¸ IMP ç±»å‹çš„å€¼ä½œæ¯”è¾ƒã€‚&lt;code&gt;_objc_msgForward&lt;/code&gt; å’Œ &lt;code&gt;_objc_msgForward_stret&lt;/code&gt; å£°æ˜åœ¨ &lt;a href=&quot;https://github.com/opensource-apple/objc4/blob/master/runtime/message.h&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;message.h&lt;/a&gt; æ–‡ä»¶ä¸­ã€‚&lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; åœ¨æ—©æœŸç‰ˆæœ¬çš„ Runtime ä¸­å«åš &lt;code&gt;_objc_msgForward_internal&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;objc-msgForward-ä¹Ÿåªæ˜¯ä¸ªå…¥å£&quot;&gt;&lt;a href=&quot;#objc-msgForward-ä¹Ÿåªæ˜¯ä¸ªå…¥å£&quot; class=&quot;headerlink&quot; title=&quot;objc_msgForward ä¹Ÿåªæ˜¯ä¸ªå…¥å£&quot;&gt;&lt;/a&gt;objc_msgForward ä¹Ÿåªæ˜¯ä¸ªå…¥å£&lt;/h3&gt;&lt;p&gt;ä»æ±‡ç¼–æºç å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡º &lt;strong&gt;&lt;code&gt;_objc_msgForward&lt;/code&gt; å’Œ &lt;code&gt;_objc_msgForward_stret&lt;/code&gt; ä¼šåˆ†åˆ«è°ƒç”¨ &lt;code&gt;_objc_forward_handler&lt;/code&gt; å’Œ &lt;code&gt;_objc_forward_handler_stret&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;ENTRY&lt;/span&gt;	__objc_msgForward&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Non-&lt;span class=&quot;keyword&quot;&gt;stret &lt;/span&gt;version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;movq	&lt;/span&gt;__objc_forward_handler(%rip), %&lt;span class=&quot;built_in&quot;&gt;r11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;jmp&lt;/span&gt;	*%&lt;span class=&quot;built_in&quot;&gt;r11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;END_ENTRY&lt;/span&gt;	__objc_msgForward&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;ENTRY&lt;/span&gt;	__objc_msgForward_stret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Struct-return &lt;/span&gt;version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;movq	&lt;/span&gt;__objc_forward_stret_handler(%rip), %&lt;span class=&quot;built_in&quot;&gt;r11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;jmp&lt;/span&gt;	*%&lt;span class=&quot;built_in&quot;&gt;r11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;END_ENTRY&lt;/span&gt;	__objc_msgForward_stret&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¸¤ä¸ª handler å‡½æ•°çš„åŒºåˆ«ä»å­—é¢ä¸Šå°±èƒ½çœ‹å‡ºæ¥ï¼Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆæ¯è½¬å‘è¿‡ç¨‹æ˜¯ç°å°† &lt;code&gt;_objc_msgForward_impcache&lt;/code&gt; å¼ºè½¬æˆ &lt;code&gt;_objc_msgForward&lt;/code&gt; æˆ– &lt;code&gt;_objc_msgForward_stret&lt;/code&gt;ï¼Œå†åˆ†åˆ«è°ƒç”¨ &lt;code&gt;_objc_forward_handler&lt;/code&gt; æˆ– &lt;code&gt;_objc_forward_handler_stret&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;objc-setForwardHandler-è®¾ç½®äº†æ¶ˆæ¯è½¬å‘çš„å›è°ƒ&quot;&gt;&lt;a href=&quot;#objc-setForwardHandler-è®¾ç½®äº†æ¶ˆæ¯è½¬å‘çš„å›è°ƒ&quot; class=&quot;headerlink&quot; title=&quot;objc_setForwardHandler è®¾ç½®äº†æ¶ˆæ¯è½¬å‘çš„å›è°ƒ&quot;&gt;&lt;/a&gt;objc_setForwardHandler è®¾ç½®äº†æ¶ˆæ¯è½¬å‘çš„å›è°ƒ&lt;/h3&gt;&lt;p&gt;åœ¨ Objective-C 2.0 ä¹‹å‰ï¼Œé»˜è®¤çš„ &lt;code&gt;_objc_forward_handler&lt;/code&gt; æˆ– &lt;code&gt;_objc_forward_handler_stret&lt;/code&gt; éƒ½æ˜¯ &lt;code&gt;nil&lt;/code&gt;ï¼Œè€Œæ–°ç‰ˆæœ¬çš„é»˜è®¤å®ç°æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Default forward handler halts the process.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__attribute__((noreturn)) &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_defaultForwardHandler(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, SEL sel)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _objc_fatal(&lt;span class=&quot;string&quot;&gt;&quot;%c[%s %s]: unrecognized selector sent to instance %p &quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;(no message forward handler is installed)&quot;&lt;/span&gt;, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                class_isMetaClass(object_getClass(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;)) ? &lt;span class=&quot;string&quot;&gt;&#39;+&#39;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&#39;-&#39;&lt;/span&gt;, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                object_getClassName(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;), sel_getName(sel), &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *_objc_forward_handler = (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*)objc_defaultForwardHandler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if SUPPORT_STRET&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; stret &amp;#123; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i[&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;]; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__attribute__((noreturn)) &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; stret &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_defaultForwardStretHandler(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, SEL sel)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_defaultForwardHandler(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, sel);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *_objc_forward_stret_handler = (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*)objc_defaultForwardStretHandler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;objc_defaultForwardHandler&lt;/code&gt; ä¸­çš„ &lt;code&gt;_objc_fatal&lt;/code&gt; ä½œç”¨å°±æ˜¯æ‰“æ—¥å¿—å¹¶è°ƒç”¨ &lt;code&gt;__builtin_trap()&lt;/code&gt; è§¦å‘ crashï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„é‚£å¥ â€œunrecognized selector sent to instanceâ€ æ—¥å¿—ã€‚&lt;code&gt;__builtin_trap()&lt;/code&gt; åœ¨æ€æ‰è¿›ç¨‹çš„åŒæ—¶è¿˜èƒ½ç”Ÿæˆæ—¥å¿—ï¼Œæ¯”è°ƒç”¨ &lt;code&gt;exit()&lt;/code&gt; æ›´å¥½ã€‚&lt;code&gt;objc_defaultForwardStretHandler&lt;/code&gt; å°±æ˜¯è£…æ¨¡ä½œæ ·æä¸ªå½¢å¼ä¸»ä¹‰ï¼ŒæŠŠ &lt;code&gt;objc_defaultForwardHandler&lt;/code&gt; åŒ…äº†ä¸€å±‚ã€‚&lt;code&gt;__attribute__((noreturn))&lt;/code&gt;  å±æ€§é€šçŸ¥ç¼–è¯‘å™¨å‡½æ•°ä»ä¸è¿”å›å€¼ï¼Œå½“é‡åˆ°ç±»ä¼¼å‡½æ•°éœ€è¦è¿”å›å€¼è€Œå´ä¸å¯èƒ½è¿è¡Œåˆ°è¿”å›å€¼å¤„å°±å·²ç»é€€å‡ºæ¥çš„æƒ…å†µï¼Œè¯¥å±æ€§å¯ä»¥é¿å…å‡ºç°é”™è¯¯ä¿¡æ¯ã€‚è¿™é‡Œæ­£é€‚åˆæ­¤å±æ€§ï¼Œå› ä¸ºè¦æ±‚è¿”å›ç»“æ„ä½“å“’ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºé»˜è®¤çš„ Handler å¹²çš„äº‹å„¿å°±æ˜¯æ‰“æ—¥å¿—è§¦å‘ crashï¼Œæˆ‘ä»¬æƒ³è¦å®ç°æ¶ˆæ¯è½¬å‘ï¼Œå°±éœ€è¦æ›¿æ¢æ‰ Handler å¹¶èµ‹å€¼ç»™ &lt;code&gt;_objc_forward_handler&lt;/code&gt; æˆ– &lt;code&gt;_objc_forward_handler_stret&lt;/code&gt;ï¼Œèµ‹å€¼çš„è¿‡ç¨‹å°±éœ€è¦ç”¨åˆ° &lt;code&gt;objc_setForwardHandler&lt;/code&gt; å‡½æ•°ï¼Œå®ç°ä¹Ÿæ˜¯ç®€å•ç²—æš´ï¼Œå°±æ˜¯èµ‹å€¼å•Šï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;objc_setForwardHandler&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *fwd, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *fwd_stret)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _objc_forward_handler = fwd;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; SUPPORT_STRET&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _objc_forward_stret_handler = fwd_stret;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;é€†å‘å·¥ç¨‹åŠ©åŠ›åˆ¨æ ¹é—®åº•&quot;&gt;&lt;a href=&quot;#é€†å‘å·¥ç¨‹åŠ©åŠ›åˆ¨æ ¹é—®åº•&quot; class=&quot;headerlink&quot; title=&quot;é€†å‘å·¥ç¨‹åŠ©åŠ›åˆ¨æ ¹é—®åº•&quot;&gt;&lt;/a&gt;é€†å‘å·¥ç¨‹åŠ©åŠ›åˆ¨æ ¹é—®åº•&lt;/h3&gt;&lt;p&gt;é‡å¤´æˆåœ¨äºå¯¹ &lt;code&gt;objc_setForwardHandler&lt;/code&gt; çš„è°ƒç”¨ï¼Œä»¥åŠä¹‹åçš„æ¶ˆæ¯è½¬å‘è°ƒç”¨æ ˆã€‚è¿™å›ä¸æ˜¯åœ¨ Objective-C Runtime ï¼ˆlibobjc.dylibï¼‰ä¸­å•¦ï¼Œè€Œæ˜¯åœ¨ Core Foundationï¼ˆCoreFoundation.frameworkï¼‰ä¸­ã€‚è™½ç„¶ CF æ˜¯å¼€æºçš„ï¼Œä½†æœ‰æ„æ€çš„æ˜¯è‹¹æœæ•…æ„åœ¨å¼€æºçš„ä»£ç ä¸­åˆ é™¤äº†åœ¨ &lt;a href=&quot;https://github.com/opensource-apple/CF/blob/master/CFRuntime.c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CFRuntime.c&lt;/a&gt; æ–‡ä»¶ &lt;code&gt;__CFInitialize()&lt;/code&gt; ä¸­è°ƒç”¨ &lt;code&gt;objc_setForwardHandler&lt;/code&gt; çš„ä»£ç ã€‚&lt;code&gt;__CFInitialize()&lt;/code&gt; å‡½æ•°æ˜¯åœ¨ CF runtime è¿æ¥åˆ°è¿›ç¨‹æ—¶åˆå§‹åŒ–è°ƒç”¨çš„ã€‚ä»åç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç ä¸­å¯ä»¥å¾ˆå®¹æ˜“è·Ÿ C æºç å¯¹æ¯”å‡ºæ¥ï¼Œæˆ‘ç”¨çº¢è‰²æ ‡å‡ºäº†åŒä¸€æ®µä»£ç çš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;æ±‡ç¼–è¯­è¨€è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œçº¢è‰²æ ‡å‡ºçš„é‚£ä¸‰ä¸ªæŒ‡ä»¤å°±æ˜¯æŠŠ &lt;code&gt;__CF_forwarding_prep_0&lt;/code&gt; å’Œ &lt;code&gt;___forwarding_prep_1___&lt;/code&gt; ä½œä¸ºå‚æ•°è°ƒç”¨ &lt;code&gt;objc_setForwardHandler&lt;/code&gt; æ–¹æ³•ï¼ˆé‚£ä¹ˆä¹‹å‰é‚£ä¸¤ä¸ª DefaultHandler åµç”¨éƒ½æ²¡æœ‰å’¯ï¼Œåæ­£ä¸å‡ºæ„å¤–ä¼šè¢« CF æ›¿æ¢æ‰ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/MessageForward/QQ20160614-1@2x.png&quot; alt=&quot;åç¼–è¯‘åçš„ __CFInitialize() æ±‡ç¼–ä»£ç &quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶è€Œåœ¨æºç ä¸­å¯¹åº”çš„ä»£ç å´è¢«åˆ æ‰å•¦ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/MessageForward/QQ20160614-2@2x.png&quot; alt=&quot;è‹¹æœæä¾›çš„ __CFInitialize() å‡½æ•°æºç &quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ—©æœŸç‰ˆæœ¬çš„ CF æºç ä¸­ï¼Œè¿˜æ˜¯å¯ä»¥çœ‹åˆ° &lt;code&gt;__CF_forwarding_prep_0&lt;/code&gt; å’Œ &lt;code&gt;___forwarding_prep_1___&lt;/code&gt; çš„å£°æ˜çš„ï¼Œä½†æ˜¯ä¸ä¼šæœ‰å®ç°æºç ï¼Œä¹Ÿæ²¡æœ‰å¯¹ &lt;code&gt;objc_setForwardHandler&lt;/code&gt; çš„è°ƒç”¨ã€‚è¿™äº›ç»†èŠ‚ä»å‡½æ•°è°ƒç”¨æ ˆä¸­æ— æ³•çœ‹å‡ºï¼Œåªèƒ½é€†å‘å·¥ç¨‹çœ‹æ±‡ç¼–æŒ‡ä»¤ã€‚ä½†ä»å‡½æ•°è°ƒç”¨æ ˆå¯ä»¥çœ‹å‡º &lt;code&gt;__CF_forwarding_prep_0&lt;/code&gt; å’Œ &lt;code&gt;___forwarding_prep_1___&lt;/code&gt; è¿™ä¸¤ä¸ª Forward Handler åšäº†å•¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight smali&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2016-06-14 12:50:15.385 MessageForward[67364:7174239] -[MFObject sendMessage]: unrecognized selector sent to&lt;span class=&quot;built_in&quot;&gt; instance &lt;/span&gt;0x1006001a0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2016-06-14 12:50:15.387 MessageForward[67364:7174239] *** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;-[MFObject sendMessage]: unrecognized selector sent to&lt;span class=&quot;built_in&quot;&gt; instance &lt;/span&gt;0x1006001a0&#39;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*** First&lt;span class=&quot;built_in&quot;&gt; throw &lt;/span&gt;call stack:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	0   CoreFoundation                      0x00007fff8fa554f2 __exceptionPreprocess + 178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	1   libobjc.A.dylib                     0x00007fff98396f7e objc_exception_throw + 48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	2   CoreFoundation                      0x00007fff8fabf1ad -[NSObject(NSObject) doesNotRecognizeSelector:] + 205&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	3   CoreFoundation                      0x00007fff8f9c5571 ___forwarding___ + 1009&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	4   CoreFoundation                      0x00007fff8f9c50f8 _CF_forwarding_prep_0 + 120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	5   MessageForward                      0x0000000100000f1f main + 79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	6   libdyld.dylib                       0x00007fff8bc2c5ad start + 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	7   ???                                 0x0000000000000001 0x0 + 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;libc++abi.dylib: terminating with uncaught exception of type NSException&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¸ªæ—¥å¿—åœºæ™¯ç†Ÿæ‚‰å¾—ä¸èƒ½å†ç†Ÿæ‚‰äº†ï¼Œå¯ä»¥çœ‹å‡º &lt;code&gt;_CF_forwarding_prep_0&lt;/code&gt; å‡½æ•°è°ƒç”¨äº† &lt;code&gt;___forwarding___&lt;/code&gt; å‡½æ•°ï¼Œæ¥ç€åˆè°ƒç”¨äº† &lt;code&gt;doesNotRecognizeSelector&lt;/code&gt; æ–¹æ³•ï¼Œæœ€åæŠ›å‡ºå¼‚å¸¸ã€‚&lt;strong&gt;ä½†æ˜¯é è¿™äº›æ˜¯æ— æ³•è¯´æœçœ‹å®¢çš„ï¼Œè¿˜å¾—é é€†å‘å·¥ç¨‹åç¼–è¯‘åå†åæ±‡ç¼–æˆä¼ªä»£ç æ¥ä¸€æ¢ç©¶ç«Ÿï¼Œåˆ¨æ ¹é—®åº•ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;__CF_forwarding_prep_0&lt;/code&gt; å’Œ &lt;code&gt;___forwarding_prep_1___&lt;/code&gt; å‡½æ•°éƒ½è°ƒç”¨äº† &lt;code&gt;___forwarding___&lt;/code&gt;ï¼Œåªæ˜¯ä¼ å…¥å‚æ•°ä¸åŒã€‚&lt;code&gt;___forwarding___&lt;/code&gt; æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå°†è¦è¢«è½¬å‘æ¶ˆæ¯çš„æ ˆæŒ‡é’ˆï¼ˆå¯ä»¥ç®€å•ç†è§£æˆ IMPï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ ‡è®°æ˜¯å¦è¿”å›ç»“æ„ä½“ã€‚&lt;code&gt;__CF_forwarding_prep_0&lt;/code&gt; ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ &lt;code&gt;0&lt;/code&gt;ï¼Œ&lt;code&gt;___forwarding_prep_1___&lt;/code&gt; ä¼ å…¥çš„æ˜¯ &lt;code&gt;1&lt;/code&gt;ï¼Œä»å‡½æ•°åéƒ½èƒ½çœ‹å¾—å‡ºæ¥ã€‚ä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°çš„ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight x86asm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; __CF_forwarding_prep_0(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg0, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg1, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg2, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg3, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg4, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg5) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = ____forwarding___(&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (&lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; != &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;) &amp;#123; // è½¬å‘ç»“æœä¸ä¸ºç©ºï¼Œå°†å†…å®¹è¿”å›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = *&lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else &amp;#123; // è½¬å‘ç»“æœä¸ºç©ºï¼Œè°ƒç”¨ objc_msgSend(id self, SEL _cmd,...)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt; = *(&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;0x8&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rdi&lt;/span&gt; = *&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = objc_msgSend(&lt;span class=&quot;built_in&quot;&gt;rdi&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ___forwarding_prep_1___(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg0, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg1, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg2, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg3, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg4, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; arg5) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = ____forwarding___(&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0x1&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (&lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; != &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;) &amp;#123;// è½¬å‘ç»“æœä¸ä¸ºç©ºï¼Œå°†å†…å®¹è¿”å›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = *&lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else &amp;#123;// è½¬å‘ç»“æœä¸ºç©ºï¼Œè°ƒç”¨ objc_msgSend_stret(void * st_addr, id self, SEL _cmd, ...)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rdx&lt;/span&gt; = *(&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;0x10&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt; = *(&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;0x8&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rdi&lt;/span&gt; = *&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = objc_msgSend_stret(&lt;span class=&quot;built_in&quot;&gt;rdi&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rdx&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ &lt;code&gt;x86_64&lt;/code&gt; æ¶æ„ä¸­ï¼Œ&lt;code&gt;rax&lt;/code&gt; å¯„å­˜å™¨ä¸€èˆ¬æ˜¯ä½œä¸ºè¿”å›å€¼ï¼Œ&lt;code&gt;rsp&lt;/code&gt; å¯„å­˜å™¨æ˜¯æ ˆæŒ‡é’ˆã€‚åœ¨è°ƒç”¨ &lt;code&gt;objc_msgSend&lt;/code&gt; å‡½æ•°æ—¶ï¼Œå‚æ•° &lt;code&gt;arg0(self), arg1(_cmd), arg2, arg3, arg4, arg5&lt;/code&gt; åˆ†åˆ«ä½¿ç”¨å¯„å­˜å™¨ &lt;code&gt;rdi, rsi, rdx, rcx, r8, r9&lt;/code&gt; çš„å€¼ã€‚åœ¨è°ƒç”¨ &lt;code&gt;objc_msgSend_stret&lt;/code&gt; æ—¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸º &lt;code&gt;st_addr&lt;/code&gt;ï¼Œå…¶ä½™å‚æ•°ä¾æ¬¡åç§»ã€‚ä¸ºäº†èƒ½å¤Ÿæ‰“åŒ…å‡º &lt;code&gt;NSInvocation&lt;/code&gt; å®ä¾‹å¹¶ä¼ å…¥åç»­çš„ &lt;code&gt;forwardInvocation:&lt;/code&gt; æ–¹æ³•ï¼Œåœ¨è°ƒç”¨ &lt;code&gt;___forwarding___&lt;/code&gt; å‡½æ•°ä¹‹å‰ä¼šå…ˆå°†æ‰€æœ‰å‚æ•°å‹å…¥æ ˆä¸­ã€‚å› ä¸ºå¯„å­˜å™¨ &lt;code&gt;rsp&lt;/code&gt; ä¸ºæ ˆæŒ‡é’ˆæŒ‡å‘æ ˆé¡¶ï¼Œæ‰€ä»¥ &lt;code&gt;rsp&lt;/code&gt; çš„å†…å®¹å°±æ˜¯ &lt;code&gt;self&lt;/code&gt; å•¦ï¼Œå› ä¸º &lt;code&gt;x86_64&lt;/code&gt; æ˜¯å°ç«¯ï¼Œæ ˆå¢é•¿æ–¹å‘æ˜¯ç”±é«˜åœ°å€åˆ°ä½åœ°å€ï¼Œæ‰€ä»¥ä»æ ˆé¡¶å¾€ä¸‹ç§»åŠ¨ä¸€ä¸ªæŒ‡é’ˆéœ€è¦&lt;strong&gt;åŠ &lt;/strong&gt; &lt;code&gt;0x8ï¼ˆ64bitï¼‰&lt;/code&gt;ã€‚è€Œå°†å‚æ•°å…¥æ ˆçš„é¡ºåºæ˜¯ä»åå¾€å‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ &lt;code&gt;arg0&lt;/code&gt; æ˜¯æœ€åä¸€ä¸ªå…¥æ ˆçš„ï¼Œä½äºæ ˆé¡¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight x86asm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt; __CF_forwarding_prep_0:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;0000000000085080&lt;/span&gt;         &lt;span class=&quot;keyword&quot;&gt;push&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;rbp&lt;/span&gt;                                         &lt;span class=&quot;comment&quot;&gt;; XREF=___CFInitialize+138&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;0000000000085081&lt;/span&gt;         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;rbp&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;0000000000085084&lt;/span&gt;         &lt;span class=&quot;keyword&quot;&gt;sub&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0xd0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;000000000008508b         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0xb0&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;0000000000085093&lt;/span&gt;         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0xa0&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm7&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;000000000008509c         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x90&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850a5         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x80&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850ae         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x70&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850b4         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x60&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850ba         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x50&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850c0         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x40&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850c6         &lt;span class=&quot;keyword&quot;&gt;movq&lt;/span&gt;       &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x30&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;xmm0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850cc         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x28&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;r9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850d1         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x20&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;r8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850d6         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x18&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;rcx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850&lt;span class=&quot;built_in&quot;&gt;db&lt;/span&gt;         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x10&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;rdx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850e0         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;0x8&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850e5         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;qword&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;ss&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;], &lt;span class=&quot;built_in&quot;&gt;rdi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850e9         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;rdi&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;rsp&lt;/span&gt;                                    &lt;span class=&quot;comment&quot;&gt;; argument #1 for method ____forwarding___&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850ec         &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt;        &lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;                                    &lt;span class=&quot;comment&quot;&gt;; argument #2 for method ____forwarding___&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;00000000000850f3         &lt;span class=&quot;keyword&quot;&gt;call&lt;/span&gt;       ____forwarding___&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¶ˆæ¯è½¬å‘çš„é€»è¾‘å‡ ä¹éƒ½å†™åœ¨ &lt;code&gt;___forwarding___&lt;/code&gt; å‡½æ•°ä¸­äº†ï¼Œå®ç°æ¯”è¾ƒå¤æ‚ï¼Œåç¼–è¯‘å‡ºçš„ä¼ªä»£ç ä¹Ÿä¸æ˜¯å¾ˆç›´è§‚ã€‚æˆ‘å¯¹ &lt;a href=&quot;http://arigrant.com/blog/2013/12/13/a-selector-left-unhandled&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;arigrant.com&lt;/a&gt; çš„ç»“æœå®Œå–„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight lisp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int __forwarding__(&lt;span class=&quot;name&quot;&gt;void&lt;/span&gt; *frameStackPointer, int isStret) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id receiver = *(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; *)frameStackPointer;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  SEL sel = *(&lt;span class=&quot;name&quot;&gt;SEL&lt;/span&gt; *)(frameStackPointer + 8);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  const char *selName = sel_getName(&lt;span class=&quot;name&quot;&gt;sel&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Class receiverClass = object_getClass(&lt;span class=&quot;name&quot;&gt;receiver&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // è°ƒç”¨ forwardingTargetForSelector:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (&lt;span class=&quot;name&quot;&gt;class_respondsToSelector&lt;/span&gt;(&lt;span class=&quot;name&quot;&gt;receiverClass&lt;/span&gt;, @selector(&lt;span class=&quot;name&quot;&gt;forwardingTargetForSelector&lt;/span&gt;:))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    id forwardingTarget = [receiver forwardingTargetForSelector&lt;span class=&quot;symbol&quot;&gt;:sel&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (&lt;span class=&quot;name&quot;&gt;forwardingTarget&lt;/span&gt; &lt;span class=&quot;symbol&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; forwarding != receiver) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	if (&lt;span class=&quot;name&quot;&gt;isStret&lt;/span&gt; == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    		int ret&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    		objc_msgSend_stret(&lt;span class=&quot;name&quot;&gt;&amp;amp;ret&lt;/span&gt;,forwardingTarget, sel, ...)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    		return ret&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      return objc_msgSend(&lt;span class=&quot;name&quot;&gt;forwardingTarget&lt;/span&gt;, sel, ...)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // åƒµå°¸å¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  const char *className = class_getName(receiverClass);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  const char *zombiePrefix = &lt;span class=&quot;string&quot;&gt;&quot;_NSZombie_&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  size_t prefixLen = strlen(&lt;span class=&quot;name&quot;&gt;zombiePrefix&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;; // 0xa&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (&lt;span class=&quot;name&quot;&gt;strncmp&lt;/span&gt;(&lt;span class=&quot;name&quot;&gt;className&lt;/span&gt;, zombiePrefix, prefixLen) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFLog(&lt;span class=&quot;name&quot;&gt;kCFLogLevelError&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          @&lt;span class=&quot;string&quot;&gt;&quot;*** -[%s %s]: message sent to deallocated instance %p&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          className + prefixLen,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          selName,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          receiver)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;breakpoint-interrupt&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // è°ƒç”¨ methodSignatureForSelector è·å–æ–¹æ³•ç­¾ååå†è°ƒç”¨ forwardInvocation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (&lt;span class=&quot;name&quot;&gt;class_respondsToSelector&lt;/span&gt;(&lt;span class=&quot;name&quot;&gt;receiverClass&lt;/span&gt;, @selector(&lt;span class=&quot;name&quot;&gt;methodSignatureForSelector&lt;/span&gt;:))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSMethodSignature *methodSignature = [receiver methodSignatureForSelector:sel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (methodSignature) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      BOOL signatureIsStret = [methodSignature _frameDescriptor]-&amp;gt;returnArgInfo.flags.isStruct;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (signatureIsStret != isStret) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CFLog(kCFLogLevelWarning ,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              @&quot;*** NSForwarding: warning: method signature and compiler disagree on struct-return-edness of &#39;%s&#39;.  Signature thinks it does%s return a struct, and compiler thinks it does%s.&lt;span class=&quot;string&quot;&gt;&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              selName,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              signatureIsStret ? &quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot; : not,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              isStret ? &quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot; : not);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (class_respondsToSelector(receiverClass, @selector(forwardInvocation:))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSInvocation *invocation = [NSInvocation _invocationWithMethodSignature:methodSignature frame:frameStackPointer];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [receiver forwardInvocation:invocation];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        void *returnValue = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [invocation getReturnValue:&amp;amp;value];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return returnValue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CFLog(kCFLogLevelWarning ,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              @&quot;&lt;/span&gt;*** NSForwarding: warning: object %p of class &#39;%s&#39; does not implement forwardInvocation: -- dropping message&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              receiver,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              className);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  SEL *registeredSel = sel_getUid(&lt;span class=&quot;name&quot;&gt;selName&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // selector æ˜¯å¦å·²ç»åœ¨ Runtime æ³¨å†Œè¿‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (&lt;span class=&quot;name&quot;&gt;sel&lt;/span&gt; != registeredSel) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFLog(&lt;span class=&quot;name&quot;&gt;kCFLogLevelWarning&lt;/span&gt; ,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          @&lt;span class=&quot;string&quot;&gt;&quot;*** NSForwarding: warning: selector (%p) for message &#39;%s&#39; does not match selector known to Objective C runtime (%p)-- abort&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          sel,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          selName,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          registeredSel)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; // doesNotRecognizeSelector&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  else if (&lt;span class=&quot;name&quot;&gt;class_respondsToSelector&lt;/span&gt;(&lt;span class=&quot;name&quot;&gt;receiverClass&lt;/span&gt;,@selector(&lt;span class=&quot;name&quot;&gt;doesNotRecognizeSelector&lt;/span&gt;:))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [receiver doesNotRecognizeSelector&lt;span class=&quot;symbol&quot;&gt;:sel&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFLog(&lt;span class=&quot;name&quot;&gt;kCFLogLevelWarning&lt;/span&gt; ,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          @&lt;span class=&quot;string&quot;&gt;&quot;*** NSForwarding: warning: object %p of class &#39;%s&#39; does not implement doesNotRecognizeSelector: -- abort&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          receiver,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          className)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // The point of no return.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  kill(&lt;span class=&quot;name&quot;&gt;getpid&lt;/span&gt;(), &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¹ˆä¸€å¤§å¨ä»£ç å°±æ˜¯æ•´ä¸ªæ¶ˆæ¯è½¬å‘è·¯å¾„çš„é€»è¾‘ï¼Œæ¦‚æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆè°ƒç”¨ &lt;code&gt;forwardingTargetForSelector&lt;/code&gt; æ–¹æ³•è·å–æ–°çš„ target ä½œä¸º receiver é‡æ–°æ‰§è¡Œ selectorï¼Œå¦‚æœè¿”å›çš„å†…å®¹ä¸åˆæ³•ï¼ˆä¸º &lt;code&gt;nil&lt;/code&gt; æˆ–è€…è·Ÿæ—§ receiver ä¸€æ ·ï¼‰ï¼Œé‚£å°±è¿›å…¥ç¬¬äºŒæ­¥ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;methodSignatureForSelector&lt;/code&gt; è·å–æ–¹æ³•ç­¾ååï¼Œåˆ¤æ–­è¿”å›ç±»å‹ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œå†è°ƒç”¨ &lt;code&gt;forwardInvocation&lt;/code&gt; æ‰§è¡Œ &lt;code&gt;NSInvocation&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚å¦‚æœå¯¹è±¡æ²¡å®ç° &lt;code&gt;methodSignatureForSelector&lt;/code&gt; æ–¹æ³•ï¼Œè¿›å…¥ç¬¬ä¸‰æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;doesNotRecognizeSelector&lt;/code&gt; æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;doesNotRecognizeSelector&lt;/code&gt; ä¹‹å‰å…¶å®è¿˜æœ‰ä¸ªåˆ¤æ–­ selector åœ¨ Runtime ä¸­æ˜¯å¦æ³¨å†Œè¿‡çš„é€»è¾‘ï¼Œä½†åœ¨æˆ‘ä»¬æ­£å¸¸å‘æ¶ˆæ¯çš„æ—¶å€™ä¸ä¼šå‡ºæ­¤é—®é¢˜ã€‚ä½†å¦‚æœæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª &lt;code&gt;NSInvocation&lt;/code&gt; å¯¹è±¡å¹¶è°ƒç”¨ &lt;code&gt;invoke&lt;/code&gt;ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æˆä¸€ä¸ªä¸å­˜åœ¨çš„ selectorï¼Œé‚£å°±ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œå¹¶è¾“å…¥æ—¥å¿— â€œdoes not match selector known to Objective C runtimeâ€ã€‚è¾ƒçœŸå„¿çš„è¯»è€…å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šä½•è¿™æ®µé€»è¾‘åˆ¤æ–­å¹²è„†ç”¨ä¸åˆ°å´è¿˜å­˜åœ¨ç€ï¼Ÿéš¾é“é™¤äº† &lt;code&gt;__CF_forwarding_prep_0&lt;/code&gt; å’Œ &lt;code&gt;___forwarding_prep_1___&lt;/code&gt; å‡½æ•°è¿˜æœ‰å…¶ä»–å‡½æ•°ä¹Ÿè°ƒç”¨ &lt;code&gt;___forwarding___&lt;/code&gt; ä¹ˆï¼Ÿè«éæ¶ˆæ¯è½¬å‘è¿˜æœ‰å…¶ä»–è·¯å¾„ï¼Ÿå…¶å®å¹¶ä¸æ˜¯ï¼åŸå› æ˜¯ &lt;code&gt;___forwarding___&lt;/code&gt; è°ƒç”¨äº† &lt;code&gt;___invoking___&lt;/code&gt; å‡½æ•°ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä¼ªä»£ç ç›´æ¥æŠŠ &lt;code&gt;___invoking___&lt;/code&gt; å‡½æ•°çš„é€»è¾‘ä¹Ÿã€ç¿»è¯‘ã€è¿‡æ¥äº†ã€‚é™¤äº† &lt;code&gt;___forwarding___&lt;/code&gt; å‡½æ•°ï¼Œä»¥ä¸‹æ–¹æ³•ä¹Ÿä¼šè°ƒç”¨&lt;code&gt;___invoking___&lt;/code&gt; å‡½æ•°:&lt;/p&gt;
&lt;figure class=&quot;highlight haml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-&lt;span class=&quot;ruby&quot;&gt;[NSInvocation invoke]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;-&lt;span class=&quot;ruby&quot;&gt;[NSInvocation &lt;span class=&quot;symbol&quot;&gt;invokeUsingIMP:&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;-&lt;span class=&quot;ruby&quot;&gt;[NSInvocation invokeSuper]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;doesNotRecognizeSelector&lt;/code&gt; æ–¹æ³•å…¶å®åœ¨ libobj.A.dylib ä¸­å·²ç»åºŸå¼ƒäº†ï¼Œè€Œæ˜¯åœ¨ CF æ¡†æ¶ä¸­å®ç°ï¼Œè€Œä¸”ä¹Ÿä¸æ˜¯å¼€æºçš„ã€‚ä»å‡½æ•°è°ƒç”¨æ ˆå¯ä»¥å‘ç° &lt;code&gt;doesNotRecognizeSelector&lt;/code&gt; ä¹‹åä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ Runtime ä¸­åºŸå¼ƒçš„å®ç°çŸ¥è¯†æ‰“æ—¥å¿—åç›´æ¥æ€æ‰è¿›ç¨‹ï¼ˆ&lt;code&gt;__builtin_trap()&lt;/code&gt;ï¼‰ã€‚ä¸‹é¢æ˜¯ CF ä¸­å®ç°çš„ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; -[&lt;span class=&quot;built_in&quot;&gt;NSObject&lt;/span&gt; doesNotRecognizeSelector:](&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * _cmd, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * arg2) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    r14 = ___&lt;span class=&quot;built_in&quot;&gt;CFFullMethodName&lt;/span&gt;([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class], &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, arg2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _&lt;span class=&quot;built_in&quot;&gt;CFLog&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0x3&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;%@: unrecognized selector sent to instance %p&quot;&lt;/span&gt;, r14, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, r8, r9, stack[&lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rbx = _&lt;span class=&quot;built_in&quot;&gt;CFMakeCollectable&lt;/span&gt;(_&lt;span class=&quot;built_in&quot;&gt;CFStringCreateWithFormat&lt;/span&gt;(___k&lt;span class=&quot;built_in&quot;&gt;CFAllocatorSystemDefault&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;%@: unrecognized selector sent to instance %p&quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (*(int8_t *)___&lt;span class=&quot;built_in&quot;&gt;CFOASafe&lt;/span&gt; != &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ___&lt;span class=&quot;built_in&quot;&gt;CFRecordAllocationEvent&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rax = _objc_rootAutorelease(rbx);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rax = [&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; exceptionWithName:&lt;span class=&quot;string&quot;&gt;@&quot;NSInvalidArgumentException&quot;&lt;/span&gt; reason:rax userInfo:&lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_exception_throw(rax);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; +[&lt;span class=&quot;built_in&quot;&gt;NSObject&lt;/span&gt; doesNotRecognizeSelector:](&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * _cmd, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * arg2) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    r14 = ___&lt;span class=&quot;built_in&quot;&gt;CFFullMethodName&lt;/span&gt;([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class], &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, arg2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _&lt;span class=&quot;built_in&quot;&gt;CFLog&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0x3&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;%@: unrecognized selector sent to class %p&quot;&lt;/span&gt;, r14, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, r8, r9, stack[&lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rbx = _&lt;span class=&quot;built_in&quot;&gt;CFMakeCollectable&lt;/span&gt;(_&lt;span class=&quot;built_in&quot;&gt;CFStringCreateWithFormat&lt;/span&gt;(___k&lt;span class=&quot;built_in&quot;&gt;CFAllocatorSystemDefault&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;@&quot;%@: unrecognized selector sent to class %p&quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (*(int8_t *)___&lt;span class=&quot;built_in&quot;&gt;CFOASafe&lt;/span&gt; != &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ___&lt;span class=&quot;built_in&quot;&gt;CFRecordAllocationEvent&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rax = _objc_rootAutorelease(rbx);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rax = [&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; exceptionWithName:&lt;span class=&quot;string&quot;&gt;@&quot;NSInvalidArgumentException&quot;&lt;/span&gt; reason:rax userInfo:&lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_exception_throw(rax);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ override &lt;code&gt;doesNotRecognizeSelector&lt;/code&gt; æˆ–è€…æ•è·å…¶æŠ›å‡ºçš„å¼‚å¸¸ã€‚åœ¨è¿™é‡Œè¿˜æ˜¯å¤§æœ‰æ–‡ç« å¯åšçš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;æˆ‘å°†æ•´ä¸ªå®ç°æµç¨‹ç»˜åˆ¶å‡ºæ¥ï¼Œè¿‡æ»¤äº†ä¸€äº›ä¸ä¼šè¿›å…¥çš„åˆ†æ”¯è·¯å¾„å’Œè·Ÿä¸»é¢˜æ— å…³çš„ç»†èŠ‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/MessageForward/æ¶ˆæ¯å‘é€ä¸è½¬å‘è·¯å¾„æµç¨‹å›¾.jpg&quot; alt=&quot;æ¶ˆæ¯å‘é€ä¸è½¬å‘è·¯å¾„æµç¨‹å›¾&quot;&gt; &lt;/p&gt;
&lt;p&gt;ä»‹äºå›½å†…å…³äºè¿™å—çŸ¥è¯†çš„å¥½å¤šæ–‡ç« æè¿°ä¸å¤Ÿå‡†ç¡®å’Œè¯¦ç»†ï¼Œæˆ–æ˜¯å¯¹æ¶ˆæ¯è½¬å‘çš„åŸç†æè¿°ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œæˆ–æ˜¯ä¾§é‡è´´æºç è€Œæ¬ æ€è€ƒï¼Œæ‰€ä»¥æˆ‘åšäº†ä¸€ä¸ªæ¯”è¾ƒå…¨é¢è¯¦ç»†çš„è®²è§£ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;&lt;a href=&quot;#å‚è€ƒæ–‡çŒ®&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;&lt;/a&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://arigrant.com/blog/2014/2/12/why-objcmsgsend-must-be-written-in-assembly&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why objc_msgSend Must be Written in Assembly&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://arigrant.com/blog/2013/12/13/a-selector-left-unhandled&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hmmm, Whatâ€™s that Selector?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.zhengdong.me/2013/07/18/a-look-under-the-hood-of-objc-msgsend/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;A Look Under the Hood of objc_msgSend()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://arigrant.com/blog/2014/2/18/chisels-print-invocation-command&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Printing Objective-C Invocations in LLDB&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¶ˆæ¯å‘é€å’Œè½¬å‘æµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šæ¶ˆæ¯å‘é€ï¼ˆMessagingï¼‰æ˜¯ Runtime é€šè¿‡ selector å¿«é€ŸæŸ¥æ‰¾ IMP çš„è¿‡ç¨‹ï¼Œæœ‰äº†å‡½æ•°æŒ‡é’ˆå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•å®ç°ï¼›æ¶ˆæ¯è½¬å‘ï¼ˆMessage Forwardingï¼‰æ˜¯åœ¨æŸ¥æ‰¾ IMP å¤±è´¥åæ‰§è¡Œä¸€ç³»åˆ—è½¬å‘æµç¨‹çš„æ…¢é€Ÿé€šé“ï¼Œå¦‚æœä¸ä½œè½¬å‘å¤„ç†ï¼Œåˆ™ä¼šæ‰“æ—¥å¿—å’ŒæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬æ–‡ä¸è®²è¿°å¼€å‘è€…åœ¨æ¶ˆæ¯å‘é€å’Œè½¬å‘æµç¨‹ä¸­éœ€è¦åšçš„äº‹ï¼Œè€Œæ˜¯è®²è¿°åŸç†ã€‚èƒ½å¤Ÿå¾ˆå¥½åœ°é˜…è¯»æœ¬æ–‡çš„å‰ææ˜¯ä½ å¯¹ &lt;a href=&quot;http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/&quot;&gt;Objective-C Runtime&lt;/a&gt; å·²ç»æœ‰ä¸€å®šçš„äº†è§£ï¼Œå…³äºä»€ä¹ˆæ˜¯æ¶ˆæ¯ï¼ŒClass çš„ç»“æ„ï¼Œselectorã€IMPã€å…ƒç±»ç­‰æ¦‚å¿µå°†ä¸å†èµ˜è¿°&lt;/strong&gt;ã€‚æœ¬æ–‡ç”¨åˆ°çš„æºç ä¸º objc4-680 å’Œ CF-1153.18ï¼Œé€†å‘ CoreFoundation.framework çš„ç³»ç»Ÿç‰ˆæœ¬ä¸º macOS 10.11.5ï¼Œæ±‡ç¼–è¯­è¨€æ¶æ„ä¸º x86_64ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="http://yulingtianxia.com/tags/Objective-C/"/>
    
      <category term="Runtime" scheme="http://yulingtianxia.com/tags/Runtime/"/>
    
      <category term="Message Forwarding" scheme="http://yulingtianxia.com/tags/Message-Forwarding/"/>
    
      <category term="Messaging" scheme="http://yulingtianxia.com/tags/Messaging/"/>
    
  </entry>
  
  <entry>
    <title>è®©ä½ çš„å¾®ä¿¡ä¸å†è¢«äººæ’¤å›æ¶ˆæ¯</title>
    <link href="http://yulingtianxia.com/blog/2016/05/06/Let-your-WeChat-for-Mac-never-revoke-messages/"/>
    <id>http://yulingtianxia.com/blog/2016/05/06/Let-your-WeChat-for-Mac-never-revoke-messages/</id>
    <published>2016-05-06T10:24:04.000Z</published>
    <updated>2016-08-27T03:30:16.000Z</updated>
    
    <content type="html">&lt;p&gt;å¤„å¥³åº§å¼ºè¿«ç—‡æœ€è®¨åŒåˆ«äººå‘æ¶ˆæ¯åæ’¤å›äº†ï¼Œå°¤å…¶æ˜¯å‘çš„å›¾ç‰‡è¿˜æ²¡çœ‹æ¸…å°±è¢«æ’¤äº†ï¼Œæˆ–è€…è¿˜æ²¡æ¥å¾—åŠçœ‹çš„æ¶ˆæ¯å°±å·²ç»è¢«æ’¤å›äº†ã€‚æœ€è¿‘é€†å‘å·¥ç¨‹å¾ˆç«ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿç®€å•çš„é€†å‘äº†ä¸€æŠŠå¾®ä¿¡ for Mac &amp;amp; iOSã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;ä¸ºä»€ä¹ˆä¸å¯¹-iOS-åŠ¨åˆ€-Mac-å’Œ-iOS-åŒç®¡é½ä¸‹&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆä¸å¯¹-iOS-åŠ¨åˆ€-Mac-å’Œ-iOS-åŒç®¡é½ä¸‹&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆä¸å¯¹ iOS åŠ¨åˆ€ Mac å’Œ iOS åŒç®¡é½ä¸‹&quot;&gt;&lt;/a&gt;&lt;del&gt;ä¸ºä»€ä¹ˆä¸å¯¹ iOS åŠ¨åˆ€&lt;/del&gt; Mac å’Œ iOS åŒç®¡é½ä¸‹&lt;/h1&gt;&lt;p&gt;&lt;del&gt;iOS ä¸Šçš„å¾®ä¿¡ APP ä¸ä¸€å®šå§‹ç»ˆåœ¨å‰å°è¿è¡Œç€ï¼Œå¦‚æœåˆ«äººåœ¨æ’¤å›æ¶ˆæ¯æ—¶å¾®ä¿¡åœ¨åå°ç”šè‡³æ‰‹æœºé”å±ã€æ–­ç½‘ï¼Œè¿™æ—¶å¾ˆå¯èƒ½æ²¡æœ‰è°ƒç”¨æ’¤å›æ¶ˆæ¯çš„æ–¹æ³•ï¼Œç”šè‡³å½“å¾®ä¿¡é‡æ–°è¿”å›åˆ°å‰å°æ—¶ï¼Œä»æœåŠ¡å™¨æ ¹æœ¬ä¸ä¼šæ¥åˆ°åŸæ¥æ¶ˆæ¯çš„æ•°æ®ï¼Œè€Œæ˜¯åªæ”¶åˆ°äº†ä¸€æ¡ã€æ’¤å›ã€æŒ‡ä»¤ã€‚åŸºäºä»¥ä¸ŠçŒœæµ‹ï¼Œæˆ‘å†³å®šå¯¹å¾®ä¿¡ for Mac ä¸‹æ‰‹ï¼Œæ¯•ç«Ÿç”µè„‘ä¸Šçš„å¾®ä¿¡åªè¦å¼€ç€å°±ä¸€ç›´æ¥æ”¶æ¶ˆæ¯ï¼ŒMac ç‰ˆå¾®ä¿¡ä¸ä¼šè·‘åˆ°åå°ã€‚&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;PSï¼šåæ¥æœ‰äººè¯´ Web ç‰ˆå¾®ä¿¡æœ¬æ¥å°±ä¸ä¼šæ’¤å›æ¶ˆæ¯ã€‚ã€‚ã€‚å¯æƒœæˆ‘ä»æ²¡ç”¨è¿‡ï¼›å‘é€å’Œæ’¤å›æ¶ˆæ¯æ—¶ iOS å¾®ä¿¡å³ä½¿æ²¡è¿è¡Œï¼Œåœ¨ä¹‹åæ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯æ—¶ä¾ç„¶ä¼šæ¥åˆ°åŸæ¶ˆæ¯å†…å®¹ã€‚ã€‚ã€‚å¥½å§æ˜¯æˆ‘é«˜ä¼°äº†å¾®ä¿¡ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;20160701 Updateï¼š&lt;/p&gt;
&lt;p&gt;ä»Šå¤©åœ¨å®¶æ— èŠé¡ºæ‰‹ä¹Ÿå§ iOS çš„å¾®ä¿¡æå®šäº†ï¼Œåªæ˜¯æ¯” Mac çš„ç¨å¾®éº»çƒ¦ä¸€ç‚¹ç½¢äº†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;è„‘æ´å’Œèƒ†å­éƒ½è¦å¤§&quot;&gt;&lt;a href=&quot;#è„‘æ´å’Œèƒ†å­éƒ½è¦å¤§&quot; class=&quot;headerlink&quot; title=&quot;è„‘æ´å’Œèƒ†å­éƒ½è¦å¤§&quot;&gt;&lt;/a&gt;è„‘æ´å’Œèƒ†å­éƒ½è¦å¤§&lt;/h1&gt;&lt;p&gt;ä¹‹å‰çœ‹çš„ä¸€äº›é€†å‘çš„æ•™ç¨‹é‡Œï¼Œæ„Ÿè§‰å‰æœŸå·¥ä½œéƒ½æ˜¯è£…è½¯ä»¶é…ç¯å¢ƒï¼Œå™¼é‡Œå•ªå•¦å‘½ä»¤ä¸€é¡¿æ•²ï¼Œæ•´çš„æŒºç„ä¹ï¼Œå…¶å®éƒ½æ˜¯ç”¨äººå®¶ç°æˆå„¿çš„å·¥å…·åšäº›äº‹æƒ…ï¼Œç¾å…¶åæ›°ã€ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šã€ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚åœ¨æˆ‘çœ‹æ¥ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šæœ‰éš¾åº¦çš„äº‹æƒ…å°±æ˜¯ä¸€ä¸ªå­—å„¿ï¼šã€çŒœã€ï¼&lt;/p&gt;
&lt;p&gt;æƒ³è¦å‡­ dump å‡ºçš„å¤´æ–‡ä»¶é‡Œé¢çš„ä¸€å †å‡½æ•°åç±»åæ¥çŒœå‡ºæƒ³è¦åŠ¨æ‰‹è„šçš„åœ°æ–¹ï¼Œçš„ç¡®æ˜¯ä¸ªæŠ€æœ¯æ´»å„¿ã€‚ä¸ä»…è€ƒéªŒè„‘æ´ï¼Œæœ‰æ—¶å€™è¿˜å¾—è¿æ°”å¥½ã€‚æŠŠåº”ç”¨ç¨‹åºä¸­çš„å¾®ä¿¡æ‹–åˆ° Hopper ä¸­ï¼Œæœä¸‹ â€œrevokeâ€ã€‚è¿™ä¸ï¼Œæˆ‘ä¸€ä¸‹å­å°±çŒœå‡ºåœ¨å“ªä¸ªæ–¹æ³•é‡Œé¢å¤„ç†æ’¤å›æ¶ˆæ¯é€»è¾‘çš„äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/WeChatReverseEngineeringwechat-findfuntion@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å‡­å€Ÿç›´è§‰ï¼Œè®¤ä¸º &lt;code&gt;-[MessageService onRevokeMsg:]&lt;/code&gt; å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ–¹æ³•ã€‚äº‹å®ä¹Ÿè¯æ˜æˆ‘æ˜¯å¯¹çš„ï¼Œä¸€æ¬¡æˆåŠŸï¼å…ˆçœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/WeChatReverseEngineeringwechat-pseudocode@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¼ªä»£ç é‡Œé¢åŒ…å«ç€å¥½å¤šå±‚å¤æ‚çš„ &lt;code&gt;if&lt;/code&gt; åˆ¤æ–­é€»è¾‘ï¼Œæƒ³å¿…æ˜¯è¿™é‡Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘è®©å¾®ä¿¡çš„åŒäº‹æ— æ¯”æŠ“ç‹‚ï¼Œä¸è¦æ€•ï¼Œæˆ‘ä»¬ä¸æƒ³è®©åé¢çš„äº‹æƒ…å‘ç”Ÿï¼Œç›´æ¥æ¥ä¸ª &lt;code&gt;return&lt;/code&gt; å°±ä¸‡äº‹å¤§å‰ï¼æŒ‰å¿«æ·é”® ã€option+Aã€ æˆ–è€…é€‰æ‹© Hopper èœå•æ çš„ ã€Modify -&amp;gt; Assemble Instructionâ€¦ã€æ¥ä¿®æ”¹ç¬¬ä¸€è¡Œæ±‡ç¼–è¯­å¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/WeChatReverseEngineeringwechat-revokemsg@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¯èƒ½è§‰å¾—è¿™é‡Œç›´æ¥ &lt;code&gt;return&lt;/code&gt; æ‰æ˜¯ä¸æ˜¯èƒ†å­ä¹Ÿå¤ªå¤§äº†ï¼Œå…¶å®æˆ‘è¿˜æ˜¯çœ‹äº†å‡½æ•°é‡Œè¿™å¨ä»£ç çš„ã€‚é‚£ä¹ˆå¤šçš„ &lt;code&gt;if&lt;/code&gt; åˆ¤æ–­ä¼´éšç€çš„æ˜¯å„ç§å‡ºé”™åœºæ™¯ä¸‹çš„æ•°æ®ä¸ŠæŠ¥ï¼ŒçœŸæ­£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™å¨ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight x86asm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; = [[MessageData alloc] initWithMsgType:&lt;span class=&quot;number&quot;&gt;0x2710&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt; = [&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; isSendFromSelf]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;rsi&lt;/span&gt; = @selector(toUsrName)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if (LOBYTE(&lt;span class=&quot;built_in&quot;&gt;rax&lt;/span&gt;) != &lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; = [[&lt;span class=&quot;built_in&quot;&gt;r13&lt;/span&gt; toUsrName] retain]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setFromUsrName:&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; release]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; = [[&lt;span class=&quot;built_in&quot;&gt;r13&lt;/span&gt; fromUsrName] retain]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setToUsrName:&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; = [[&lt;span class=&quot;built_in&quot;&gt;r13&lt;/span&gt; toUsrName] retain]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setFromUsrName:&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; release]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; = [[&lt;span class=&quot;built_in&quot;&gt;r13&lt;/span&gt; fromUsrName] retain]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setToUsrName:&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; release]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setMsgStatus:&lt;span class=&quot;number&quot;&gt;0x4&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setMsgContent:var_58]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; setMsgCreateTime:LODWORD([&lt;span class=&quot;built_in&quot;&gt;r13&lt;/span&gt; msgCreateTime])]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;r15&lt;/span&gt; AddLocalMsg:var_50 msgData:&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; = [[NSArray arrayWithObject:&lt;span class=&quot;built_in&quot;&gt;r13&lt;/span&gt;] retain]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;r15&lt;/span&gt; DelMsg:var_50 msgList:&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; isDelAll:&lt;span class=&quot;number&quot;&gt;0x0&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;r15&lt;/span&gt; = *objc_release&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;rbx&lt;/span&gt; release]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;r12&lt;/span&gt; release]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ®µä»£ç å…ˆæ˜¯åˆ¤æ–­ä¸‹æ’¤å›æ¶ˆæ¯çš„äººæ˜¯ä¸æ˜¯è‡ªå·±ï¼Œç„¶ååˆ†æƒ…å†µæ›´æ–° UIï¼Œæœ€åç”Ÿæˆå¹¶æ›´æ–°æ•°æ®ã€‚æ—¢ç„¶æ²¡æœ‰å•¥é‡è¦æ“ä½œï¼Œé‚£å°±æ”¾å¿ƒåœ°å¿½ç•¥å§å“ˆå“ˆã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨éœ€è¦å°†ä¿®æ”¹åçš„æ±‡ç¼–é‡æ–°ç”Ÿæˆæ–°çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é€‰æ‹© Hopper èœå•é‡Œçš„ ã€File -&amp;gt; Produce New Executableâ€¦ã€ åç‚¹ Yesï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/WeChatReverseEngineeringwechat-NewExecutable@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ€åå°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ›¿æ¢åˆ° &lt;code&gt;/Applications/WeChat.app/Contents/MacOS/WeChat&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å”¯ä¸€è®©æˆ‘ä¸è§£çš„æ˜¯æ— éœ€å¯¹æ–°çš„ &lt;code&gt;WeChat&lt;/code&gt; å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œä»£ç ç­¾åå¾®ä¿¡ä¾ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œã€‚æˆ‘æ˜¯ç¬¬ä¸€æ¬¡ç©é€†å‘ï¼Œè¿˜è¯·å‰è¾ˆå¤§ç¥ä»¬æŒ‡æ•™ã€‚åšäº†ä¸€ç³»åˆ—æ’¤å›æ¶ˆæ¯çš„å°è¯•åï¼Œæ‰‹æœºä¸Šé¢æ˜¾ç¤ºæ’¤å›ï¼Œä½† Mac ç‰ˆå¾®ä¿¡çš„æ¶ˆæ¯ä¾ç„¶è¿˜åœ¨ã€‚ä¸€æ¬¡çŒœä¸­ï¼ŒæˆåŠŸï¼&lt;/p&gt;
&lt;h1 id=&quot;iOS-è¦ç¨å¾®æŠ˜è…¾ä¸€äº›&quot;&gt;&lt;a href=&quot;#iOS-è¦ç¨å¾®æŠ˜è…¾ä¸€äº›&quot; class=&quot;headerlink&quot; title=&quot;iOS è¦ç¨å¾®æŠ˜è…¾ä¸€äº›&quot;&gt;&lt;/a&gt;iOS è¦ç¨å¾®æŠ˜è…¾ä¸€äº›&lt;/h1&gt;&lt;p&gt;å‰ææ˜¯æœ‰ä¸€ä¸ªå·²ç»ç ¸å£³çš„ ipaï¼Œè¦ä¹ˆè‡ªå·±åœ¨è¶Šç‹±æœºä¸­ç”¨ dumpdecrypted ç ¸å£³ï¼Œæˆ–è€…å¹²è„†ä»ç¬¬ä¸‰æ–¹å·¥å…·ä¸‹ä¸€ä¸ªå·²ç»ç ¸å£³çš„ï¼ˆä¹Ÿå°±æ˜¯ç»™è¶Šç‹±æœºå®‰è£…çš„ï¼‰ã€‚æˆ‘ä¸€å¼€å§‹ä»åŒæ­¥åŠ©æ‰‹ä¸‹çš„æœ‰ç‚¹é—®é¢˜ï¼Œåæ¥ä»PPåŠ©æ‰‹ä¸‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¢«ç ¸å£³çš„ ipa å°±å¯ä»¥ç»§ç»­äº†ï¼Œè§£å‹åæ‰¾åˆ°é‡Œé¢çš„ WeChat.app ï¼Œæ³¨æ„ç”¨ &lt;code&gt;codesign -dvvv WeChat.app&lt;/code&gt; éªŒè¯ä¸‹ç­¾åã€‚æ­£ç‰ˆçš„ app ç­¾åæ˜¯è…¾è®¯çš„ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€æ­¥&lt;/strong&gt;ï¼ŒçŒœï¼Œå—¯ï¼Œæ˜¯ &lt;code&gt;-[CMessageMgr onRevokeMsg:]&lt;/code&gt; è¿™ä¸ªæ–¹æ³•ã€‚ç±»åæ¢äº†è€Œå·²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥&lt;/strong&gt;ï¼Œæ”¹æ±‡ç¼–ä»£ç ã€‚è¿™é‡Œéœ€è¦æ”¹çš„æ˜¯ Thumb æŒ‡ä»¤é›†ã€‚å…¶å®å®ƒæ˜¯è¾ƒæ–°çš„ ARM å¤„ç†å™¨çš„ä¸€ç§æ¨¡å¼ã€‚æˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒçš„æ˜¯å„ç§æŒ‡ä»¤çš„å«ä¹‰ï¼Œå°¤å…¶æ˜¯å¦‚ä½•ä» Thumb åˆ‡æ¢å› ARMï¼Œæ²¡é”™ï¼Œå°±æ˜¯ç”¨ &lt;code&gt;bx&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/WeChatReverseEngineering/wechat-ios.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æœ‰ä¸€ä¸ª&lt;a href=&quot;http://infocenter.arm.com/help/topic/com.arm.doc.qrc0006ec/QRC0006_UAL16.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ThumbÂ® 16 ä½æŒ‡ä»¤é›†å¿«é€Ÿå‚è€ƒå¡&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ€åè¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·æ›¿æ¢ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥&lt;/strong&gt;ï¼Œç­¾åï¼å»ºè®®å…ˆé˜…è¯» &lt;a href=&quot;http://objccn.io/issue-17-2/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä»£ç ç­¾åæ¢æ&lt;/a&gt;ï¼Œäº†è§£ä¸‹æˆæƒæœºåˆ¶ (Entitlements) å’Œé…ç½®æ–‡ä»¶ (Provisioning)ã€‚è¿™ä¸€æ­¥çš„å‰ææ˜¯æ‹¥æœ‰ä¸€ä¸ªåˆæ³•è¯ä¹¦ï¼Œä¸ªäººæˆ–ä¼ä¸šéƒ½å¯ä»¥ï¼&lt;/p&gt;
&lt;p&gt;å…ˆéšä¾¿æ–°å»ºä¸ªå·¥ç¨‹(æˆ‘çš„å« testUIImageï¼Œæ˜¨æ™šç ”ç©¶ UIImage æ—¶å»ºçš„)ï¼Œä¸€å®šè¦ç”¨è¯ä¹¦ç­¾åï¼Œåˆ«é€‰ Noneã€‚ã€‚ã€‚target æ¶æ„é€‰å¯¹ï¼ˆè‡ªå·±æ‰‹æœºï¼‰ï¼Œç¼–è¯‘åç”Ÿæˆäº†ä¸ª ipa æ–‡ä»¶ã€‚æˆ‘ä»¬è¦çš„å°±æ˜¯å®ƒé‡Œé¢çš„ç­¾åä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆç”¨ &lt;code&gt;ldid&lt;/code&gt; å·¥å…·åœ¨æ¡Œé¢ä¸Šç”Ÿæˆä¸ªæˆæƒæ–‡ä»¶ï¼ˆEntitlements.plistï¼‰ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ldid -e &lt;span class=&quot;regexp&quot;&gt;/Users/y&lt;/span&gt;angxiaoyu&lt;span class=&quot;regexp&quot;&gt;/Library/&lt;/span&gt;Developer&lt;span class=&quot;regexp&quot;&gt;/Xcode/&lt;/span&gt;DerivedData&lt;span class=&quot;regexp&quot;&gt;/testUIImage-aoqcifvynorulecqtwqqugleuktf/&lt;/span&gt;Build&lt;span class=&quot;regexp&quot;&gt;/Products/&lt;/span&gt;Debug-iphoneos&lt;span class=&quot;regexp&quot;&gt;/testUIImage.app/&lt;/span&gt;testUIImage &amp;gt; ~&lt;span class=&quot;regexp&quot;&gt;/Desktop/&lt;/span&gt;Entitlements.plist&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;PSï¼šæˆ‘æ˜¯ç”¨ &lt;code&gt;homebrew&lt;/code&gt; å®‰è£…çš„ &lt;code&gt;ldid&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæŠŠ testUIImage.app ä¸­çš„é…ç½®æ–‡ä»¶ (Provisioning) &lt;strong&gt;embedded.mobileprovision&lt;/strong&gt; å¤åˆ¶ç²˜è´´åˆ°æˆ‘ä»¬çš„ WeChat.app ä¸­ã€‚ï¼ˆå³é”®æ˜¾ç¤ºåŒ…å†…å®¹éƒ½ä¼šå§ï¼‰&lt;/p&gt;
&lt;p&gt;æœ€åç”¨ &lt;code&gt;codesign&lt;/code&gt; å‘½ä»¤å¯¹ WeChat.app ç­¾åï¼Œæ³¨æ„æ›¿æ¢ä¸ºä½ è‡ªå·±çš„è¯ä¹¦ã€å¸¸ç”¨åç§°ã€ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;codesign -f -s &lt;span class=&quot;string&quot;&gt;&quot;iPhone Developer: xiaoyu yang (XXXXXXXXX)&quot;&lt;/span&gt; --entitlements &lt;span class=&quot;regexp&quot;&gt;/Users/y&lt;/span&gt;angxiaoyu&lt;span class=&quot;regexp&quot;&gt;/Desktop/&lt;/span&gt;Entitlements.plist &lt;span class=&quot;regexp&quot;&gt;/Users/y&lt;/span&gt;angxiaoyu&lt;span class=&quot;regexp&quot;&gt;/Desktop/&lt;/span&gt;å¾®ä¿¡_v6.&lt;span class=&quot;number&quot;&gt;3.22&lt;/span&gt;&lt;span class=&quot;regexp&quot;&gt;/Payload/&lt;/span&gt;WeChat.app&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬å››æ­¥&lt;/strong&gt;ï¼Œä¹Ÿæ˜¯æœ€åä¸€æ­¥ï¼Œæ‰“åŒ…æ–°çš„ WeChat.ipaï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;xcrun -sdk iphoneos PackageApplication -v &lt;span class=&quot;regexp&quot;&gt;/Users/y&lt;/span&gt;angxiaoyu&lt;span class=&quot;regexp&quot;&gt;/Desktop/&lt;/span&gt;å¾®ä¿¡_v6.&lt;span class=&quot;number&quot;&gt;3.22&lt;/span&gt;&lt;span class=&quot;regexp&quot;&gt;/Payload/&lt;/span&gt;WeChat.app  -o ~&lt;span class=&quot;regexp&quot;&gt;/Desktop/&lt;/span&gt;WeChat.ipa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥æŠŠæ–°çš„ WeChat.ipa å®‰è£…åˆ°è‡ªå·±çš„æ‰‹æœºä¸Šå•¦ï¼&lt;/p&gt;
&lt;p&gt;éªŒè¯äº†ä¸‹é€€å‡ºå¾®ä¿¡æ€æ‰è¿›ç¨‹åï¼Œå¯¹æ–¹å‘æ¶ˆæ¯å¹¶æ’¤å›ï¼Œè¿›å…¥å¾®ä¿¡åä¾ç„¶å¯ä»¥æ”¶åˆ°æ’¤å›çš„æ¶ˆæ¯ã€‚excitedï¼&lt;/p&gt;
&lt;h1 id=&quot;åè®°&quot;&gt;&lt;a href=&quot;#åè®°&quot; class=&quot;headerlink&quot; title=&quot;åè®°&quot;&gt;&lt;/a&gt;åè®°&lt;/h1&gt;&lt;p&gt;å…¶å®é€†å‘å·¥ç¨‹æ˜¯é—¨å¾ˆæœ‰è¶£çš„å­¦é—®ï¼Œè€Œä»»ä½•å­¦é—®éƒ½æ˜¯å…¥é—¨ç®€å•æ·±å…¥éš¾ã€‚æœ¬ä¾‹çœ‹ä¼¼å®¹æ˜“ï¼Œå…¶å®å¦‚æœé¢å¯¹æ›´åŠ å¤æ‚çš„ç¯å¢ƒä¸‹ï¼Œå…‰é æˆ‘é‚£ç‚¹å„¿å¯æ€œçš„æ±‡ç¼–çŸ¥è¯†è‚¯å®šæ˜¯ä¸å¤Ÿçš„ã€‚å¦‚æœæ˜¯å¯¹ iOS ä¸Šçš„ APP è¿›è¡Œé€†å‘ï¼Œå®åˆ™å‡†å¤‡å·¥ä½œè¦éº»çƒ¦å¾—å¤šã€‚çœŸæ­£æŒæ¡äº†åº•å±‚çš„åŸç†å’ŒåŸºç¡€çŸ¥è¯†æ‰æ˜¯ç¡¬é“ç†ï¼&lt;/p&gt;
&lt;p&gt;å…¶å®æ˜¯åˆ©ç”¨ Security æ¡†æ¶åœ¨ app å†…éƒ¨éªŒè¯ç­¾åé˜²æ­¢è¢«äººä¿®æ”¹çš„ï¼Œå½“ç„¶åœ¨ Mac ä¸Šæˆ‘ä»¬æœ€æ–¹ä¾¿çš„è¿˜æ˜¯ç”¨ &lt;code&gt;codesign&lt;/code&gt; å‘½ä»¤å•¦ã€‚è‹¹æœæä¾›äº†&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Security/Reference/CodeSigningRef/index.html#//apple_ref/doc/uid/TP40008151-CH2-SW27&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä»£ç ç­¾åæœåŠ¡çš„æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è€å­ç»ˆäºä¹Ÿå½“äº†å›æ ‡é¢˜å…šï¼å•Šå“ˆï¼&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;å¤„å¥³åº§å¼ºè¿«ç—‡æœ€è®¨åŒåˆ«äººå‘æ¶ˆæ¯åæ’¤å›äº†ï¼Œå°¤å…¶æ˜¯å‘çš„å›¾ç‰‡è¿˜æ²¡çœ‹æ¸…å°±è¢«æ’¤äº†ï¼Œæˆ–è€…è¿˜æ²¡æ¥å¾—åŠçœ‹çš„æ¶ˆæ¯å°±å·²ç»è¢«æ’¤å›äº†ã€‚æœ€è¿‘é€†å‘å·¥ç¨‹å¾ˆç«ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿç®€å•çš„é€†å‘äº†ä¸€æŠŠå¾®ä¿¡ for Mac &amp;amp; iOSã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
      <category term="macOS" scheme="http://yulingtianxia.com/tags/macOS/"/>
    
      <category term="Reverse Engineering" scheme="http://yulingtianxia.com/tags/Reverse-Engineering/"/>
    
  </entry>
  
  <entry>
    <title>Find Convex Hull with Graham Scan &amp; Swift</title>
    <link href="http://yulingtianxia.com/blog/2016/04/28/Find-Convex-Hull-with-Graham-Scan-Swift/"/>
    <id>http://yulingtianxia.com/blog/2016/04/28/Find-Convex-Hull-with-Graham-Scan-Swift/</id>
    <published>2016-04-28T14:37:16.000Z</published>
    <updated>2016-08-27T03:30:16.000Z</updated>
    
    <content type="html">&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Convex_hull&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å‡¸åŒ…(Convex hull)&lt;/a&gt; æ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æ¦‚å¿µï¼Œåœ¨äºŒç»´å¹³é¢ä¸Šå¯ä»¥æƒ³è±¡æˆç”¨ä¸€ä¸ªæ©¡çš®ç­‹å¥—ä½ä¸€å †é’‰åœ¨å¹³é¢ä¸Šçš„é’‰å­ã€‚æœ¬æ–‡è®²è¿°å¦‚ä½•ä½¿ç”¨ Swift å®ç° &lt;a href=&quot;https://en.wikipedia.org/wiki/Graham_scan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Graham scan&lt;/a&gt; ç®—æ³•æ¥å¯»æ‰¾äºŒç»´å¹³é¢ç‚¹é›†ä¸Šçš„å‡¸åŒ…ã€‚å·¥ç¨‹æºç  Githubï¼š&lt;a href=&quot;https://github.com/yulingtianxia/Algorithm-Experiment&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/Algorithm-Experiment&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://upload.wikimedia.org/wikipedia/commons/d/de/ConvexHull.svg&quot; alt=&quot;By Maksim (original); en:User:Pbroks3 (redraw), via Wikimedia Commons&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/convexhull/convexhull.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;ç®€å•ç²—æš´çš„æƒ³æ³•&quot;&gt;&lt;a href=&quot;#ç®€å•ç²—æš´çš„æƒ³æ³•&quot; class=&quot;headerlink&quot; title=&quot;ç®€å•ç²—æš´çš„æƒ³æ³•&quot;&gt;&lt;/a&gt;ç®€å•ç²—æš´çš„æƒ³æ³•&lt;/h1&gt;&lt;p&gt;ç›´è§‚ä¸Šå»çœ‹å¯ä»¥ç†è§£ä¸ºã€æ‰¾å‡ºæœ€å¤–å›´çš„ç‚¹ã€ï¼Œè¿›è€ŒæŠŠé—®é¢˜è½¬åŒ–ä¸ºã€å‰”é™¤å‡¸å¤šè¾¹å½¢å†…éƒ¨çš„ç‚¹ã€ï¼Œè¿›è€Œç®€åŒ–ä¸ºã€å‰”é™¤ä»»æ„ä¸‰è§’å½¢å†…çš„ç‚¹ã€ã€‚PSï¼š&lt;strong&gt;ä¸‰è§’å½¢&lt;/strong&gt;æŒ‡çš„æ˜¯ç”±ç‚¹é›†å†…ä»»æ„ä¸‰ä¸ªä¸ç›¸åŒçš„ç‚¹æ„æˆçš„ä¸‰è§’å½¢ï¼Œä»¥ä¸‹ä¸å†èµ˜è¿°å®šä¹‰ï¼Œç›´æ¥ä»¥&lt;strong&gt;ä¸‰è§’å½¢&lt;/strong&gt;ä»£æŒ‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢éœ€è¦åšçš„æ˜¯éå†æ‰€æœ‰ä¸‰è§’å½¢çš„æ’åˆ—ç»„åˆï¼Œæ‰¾å‡ºä¸‰è§’å½¢ä¸Šæˆ–å†…éƒ¨çš„ç‚¹ï¼Œå¹¶å‰”é™¤ï¼Œå› ä¸ºå®ƒè‚¯å®šä¸æ˜¯å‡¸åŒ…çš„é¡¶ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç‚¹ &lt;code&gt;P&lt;/code&gt; æ˜¯å¦åœ¨ä¸‰è§’å½¢ &lt;code&gt;ABC&lt;/code&gt; é‡Œé¢å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¾ˆç®€å•ï¼å¦‚æœç‚¹ &lt;code&gt;P&lt;/code&gt; åœ¨ä¸‰è§’å½¢ &lt;code&gt;ABC&lt;/code&gt; å†…ï¼Œç‚¹ &lt;code&gt;A&lt;/code&gt; å’Œ &lt;code&gt;P&lt;/code&gt; è‚¯å®šåœ¨ç›´çº¿ &lt;code&gt;BC&lt;/code&gt; çš„åŒä¸€ä¾§ï¼Œç‚¹ &lt;code&gt;B&lt;/code&gt; å’Œ &lt;code&gt;P&lt;/code&gt; ä¹Ÿè‚¯å®šåœ¨ç›´çº¿ &lt;code&gt;AC&lt;/code&gt; åŒä¸€ä¾§ï¼Œç‚¹ &lt;code&gt;C&lt;/code&gt; å’Œ &lt;code&gt;P&lt;/code&gt; å¿…å®šä¹Ÿåœ¨ç›´çº¿ &lt;code&gt;AB&lt;/code&gt; åŒä¸€ä¾§ï¼&lt;/p&gt;
&lt;p&gt;æœç„¶å¤Ÿç®€å•ç²—æš´ï¼&lt;/p&gt;
&lt;p&gt;å‡è®¾ç›´çº¿ &lt;code&gt;BC&lt;/code&gt; æ–¹ç¨‹ä¸º &lt;code&gt;ax + by + c = 0&lt;/code&gt;,å¦‚æœç‚¹ &lt;code&gt;P(Xp,Yp)&lt;/code&gt; åœ¨ç›´çº¿ &lt;code&gt;BC&lt;/code&gt; ä¸Šï¼Œåˆ™æœ‰ &lt;code&gt;aÂ·Xp + bÂ·Yp + c = 0&lt;/code&gt;ï¼›å¦‚æœç‚¹ &lt;code&gt;P(Xp,Yp)&lt;/code&gt; ä¸ç‚¹ &lt;code&gt;A(Xa,Ya)&lt;/code&gt; åœ¨ç›´çº¿ &lt;code&gt;BC&lt;/code&gt; åŒä¸€ä¾§ï¼Œåˆ™æœ‰ &lt;code&gt;(aÂ·Xp + bÂ·Yp + c)(aÂ·Xa + bÂ·Ya + c) &amp;gt; 0&lt;/code&gt;ã€‚ä¸ºäº†ä¸è¢«åæ§½æ‹¿åˆä¸­æ•°å­¦å¿½æ‚ äººï¼Œè¿˜æ˜¯å¿«é€Ÿä¸Šä»£ç å§ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight processing&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;func calculatePoint(pointP:CGPoint,onLine &lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;:(pointA:CGPoint,pointB:CGPoint)) -&amp;gt; CGFloat &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (pointP.y - &lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;.pointA.y) * (&lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;.pointB.x - &lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;.pointA.x) - (&lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;.pointB.y - &lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;.pointA.y) * (pointP.x - &lt;span class=&quot;built_in&quot;&gt;line&lt;/span&gt;.pointA.x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;func checkPoint(P:CGPoint,inTriangle &lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;:(A:CGPoint,B:CGPoint,C:CGPoint)) -&amp;gt; Bool &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var Pp = calculatePoint(P, onLine: (&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.A,&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.B))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    let AB = Pp == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;||Pp * calculatePoint(&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.C, onLine: (&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.A,&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.B)) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !AB&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; AB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Pp = calculatePoint(P, onLine: (&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.A,&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.C))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    let AC = Pp == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;||Pp * calculatePoint(&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.B, onLine: (&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.A,&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.C)) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !AC&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; AC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Pp = calculatePoint(P, onLine: (&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.C,&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.B))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    let BC = Pp == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;||Pp * calculatePoint(&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.A, onLine: (&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.C,&lt;span class=&quot;built_in&quot;&gt;triangle&lt;/span&gt;.B)) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; AB &amp;amp;&amp;amp; AC &amp;amp;&amp;amp; BC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;calculatePoint: onLine:&lt;/code&gt; å‡½æ•°çš„ä½œç”¨æ˜¯å°†ç‚¹åæ ‡ä»£å…¥ç›´çº¿æ–¹ç¨‹å¼å¹¶è¿”å›è®¡ç®—ç»“æœï¼›&lt;code&gt;checkPoint: inTriangle:&lt;/code&gt; å‡½æ•°çš„ä½œç”¨æ˜¯åˆ¤æ–­æŸç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢ä¸Šæˆ–å†…éƒ¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å§‹æš´åŠ›éå†æ‰€æœ‰çš„ä¸‰è§’å½¢ç»„åˆå¹¶å‰”é™¤ä¸ç¬¦åˆè¦æ±‚çš„ç‚¹ä¹‹å‰ï¼Œæˆ‘æƒ³å†å£°æ˜ä¸€ä¸ªå‘½é¢˜ï¼šã€X è½´å’Œ Y è½´çš„æå€¼ç‚¹è‚¯å®šæ˜¯å‡¸åŒ…é¡¶ç‚¹ã€ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªç‚¹çš„ X åæ ‡æœ€å¤§ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šæ˜¯å‡¸åŒ…é¡¶ç‚¹ã€‚è¿™ä¸ªå‘½é¢˜åƒæ˜¯åºŸè¯ï¼Œç”¨åè¯æ³•å…¶å®ä¹Ÿå¾ˆå®¹æ˜“è¯æ˜ï¼šå‡å¦‚ &lt;code&gt;Y&lt;/code&gt; å€¼æœ€å¤§çš„ç‚¹ &lt;code&gt;P&lt;/code&gt; ä¸æ˜¯å‡¸åŒ…é¡¶ç‚¹ï¼Œé‚£ä¹ˆå¿…ç„¶å¤„äºæŸä¸ªä¸‰è§’å½¢ &lt;code&gt;ABC&lt;/code&gt; å†…ï¼Œå¹¶ä¸” &lt;code&gt;ABC&lt;/code&gt; ä¸‰ä¸ªç‚¹çš„ &lt;code&gt;Y&lt;/code&gt; å€¼éƒ½æ¯” &lt;code&gt;P&lt;/code&gt; å°ï¼Œå‡è®¾ &lt;code&gt;A&lt;/code&gt; ç‚¹ä¸ºä¸‰è§’å½¢ &lt;code&gt;ABC&lt;/code&gt; ä¸­ &lt;code&gt;Y&lt;/code&gt; å€¼æœ€å°çš„ç‚¹ï¼Œåˆ™ &lt;code&gt;P&lt;/code&gt; ç‚¹å’Œ &lt;code&gt;A&lt;/code&gt; ç‚¹å¿…ç„¶å¤„äºç›´çº¿ &lt;code&gt;BC&lt;/code&gt; ä¸¤ä¾§ï¼ŒçŸ›ç›¾ã€‚å‘½é¢˜å¾—è¯ã€‚&lt;/p&gt;
&lt;p&gt;PSï¼šè¿™é‡Œæ³¨æ„æˆ‘ä»¬æƒ³è¦çš„ç»“æœä»…ä»…æ˜¯&lt;strong&gt;å‡¸åŒ…é¡¶ç‚¹&lt;/strong&gt;ï¼Œæœ‰äº›ç‚¹å¯èƒ½ä½äºä¸¤ä¸ªç›¸é‚»çš„å‡¸åŒ…é¡¶ç‚¹è¿çº¿ä¸Šï¼Œè¿™æ ·çš„ç‚¹åªèƒ½ç®—ä½œ&lt;strong&gt;å‡¸åŒ…ä¸Šçš„ç‚¹&lt;/strong&gt;ï¼Œå®ƒä»¬ä¸&lt;strong&gt;å‡¸åŒ…å†…çš„ç‚¹&lt;/strong&gt;ä¸€æ ·éœ€è¦è¢«å‰”é™¤ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœ€ç»ˆè¾“å‡ºçš„ç»“æœå¸Œæœ›æ˜¯é€†æ—¶é’ˆé¡ºåºè¾“å‡ºçš„ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„å‡¸åŒ…é¡¶ç‚¹è¾“å‡ºé¡ºåºåº”ä¸ºï¼š&lt;code&gt;A,B,C,D,E,F,G,H&lt;/code&gt;ï¼Œå…¶ä¸­ &lt;code&gt;A&lt;/code&gt; ç‚¹å’Œ &lt;code&gt;D&lt;/code&gt; ç‚¹åˆ†åˆ«ä¸º X æœ€å°çš„ç‚¹å’Œ X æœ€å¤§çš„ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/convexhullQQ20160428-0@2x.png&quot; alt=&quot;éšæœºç”Ÿæˆ50ä¸ªç‚¹é›†çš„å‡¸åŒ…&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥æŒ‰ç…§é€†æ—¶é’ˆé¡ºåºè¾“å‡ºç»“æœï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»¥ &lt;code&gt;A&lt;/code&gt; ç‚¹ä¸ºä¸­å¿ƒï¼Œå‘é‡ &lt;code&gt;DA&lt;/code&gt; æ–¹å‘åšå°„çº¿é€†æ—¶é’ˆæ‰«æï¼ŒæŒ‰ç…§æ‰«æåˆ°ç‚¹çš„é¡ºåºè¾“å‡ºå³å¯ï¼Œç›´è‡³ 360Â° æ‰«æå®Œæ¯•ã€‚&lt;/li&gt;
&lt;li&gt;å°†ç›´çº¿ &lt;code&gt;AD&lt;/code&gt; ä¸Šæ–¹çš„ç‚¹é›† &lt;code&gt;Su&lt;/code&gt; æŒ‰ç…§ X å€¼ä»å¤§åˆ°å°æ’åˆ—ï¼Œä¸‹æ–¹çš„ç‚¹é›† &lt;code&gt;Sd&lt;/code&gt; æŒ‰ç…§ X å€¼ä»å°åˆ°å¤§æ’åˆ—ï¼Œæœ€åè¾“å‡ºé¡ºåºä¸ºï¼š&lt;code&gt;Aï¼ŒSdï¼ŒDï¼ŒSu&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¾ˆæ˜æ˜¾ï¼Œç¬¬äºŒç§æ–¹æ¡ˆè®¡ç®—é‡å°å¹¶ä¸”å®ç°ç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å—åˆ°æ–¹æ¡ˆ 1 çš„å¯å‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†æš´åŠ›éå†çš„æ—¶é—´å¤æ‚åº¦å‡å°‘ä¸€å±‚ã€‚å°† &lt;code&gt;A&lt;/code&gt; ç‚¹ä¸å…¶ä»–å‡¸åŒ…é¡¶ç‚¹è¿ä¸Šè™šçº¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/convexhull/divideintotriangles@2x.png&quot; alt=&quot;ä»¥ A ç‚¹å°†å‡¸åŒ…åˆ’åˆ†æˆå‡ ä¸ªä¸‰è§’å½¢&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å¯ä»¥æŠŠ &lt;code&gt;A&lt;/code&gt; ç‚¹ä½œä¸ºå…¬å…±ç‚¹æ¥éå†ä¸‰è§’å½¢ã€‚å› ä¸º &lt;code&gt;A&lt;/code&gt; ç‚¹è‚¯å®šä¸ä¼šè¢«å‰”é™¤ï¼Œå¹¶ä¸”ä¸Šå›¾ä¸­ä»¥ &lt;code&gt;A&lt;/code&gt; ç‚¹ä¸ºå…¬å…±ç‚¹çš„ä¸‰è§’å½¢å·²ç»è¦†ç›–äº†æ‰€æœ‰çš„ç‚¹ï¼Œä¸ç”¨æ‹…å¿ƒä¼šæœ‰é—æ¼ã€‚äºæ˜¯ä¸‰è§’å½¢çš„ä¸€ä¸ªé¡¶ç‚¹å·²ç»ç¡®å®šä¸‹æ¥äº†ï¼Œåªéœ€éå†ç”Ÿæˆå¦ä¸¤ä¸ªé¡¶ç‚¹å’Œä¸€ä¸ªéœ€è¦åˆ¤å®šæ˜¯å¦åœ¨ä¸‰è§’å½¢å†…çš„ç‚¹ï¼Œå››å±‚å¾ªç¯åµŒå¥—é™ä¸ºä¸‰å±‚ï¼&lt;/p&gt;
&lt;p&gt;çŒ®ä¸Šæ ¸å¿ƒç®—æ³•çš„ Swift ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight maxima&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;func generateConvexHull(inout &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;:[PointView])&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       point.isConvexHullNode = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.count &amp;lt;= &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; minXPoint = &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; maxXPoint = &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       minXPoint = point.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;.x &amp;lt; minXPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;.x ? point : minXPoint&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       maxXPoint = point.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;.x &amp;gt; maxXPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;.x ? point : maxXPoint&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;let&lt;/span&gt; point1 = minXPoint;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point2 &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !point2.isConvexHullNode || point2 == point1 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           continue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point3 &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !point3.isConvexHullNode || point3 == point1 || point3 == point2 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               continue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point4 &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !point4.isConvexHullNode || point4 == point1 || point4 == point2 || point4 == point3 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   continue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; checkPoint(point4.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;, inTriangle: (point2.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;,point3.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;,point1.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   point4.isConvexHullNode = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   continue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; su = &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.filter &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       calculatePoint($&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;, onLine: (minXPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;,maxXPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;)) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; sl = &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.filter &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       calculatePoint($&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;, onLine: (minXPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;,maxXPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;)) &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   su = su.&lt;span class=&quot;built_in&quot;&gt;sort&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; ($&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt; as CGPoint).x &amp;gt; ($&lt;span class=&quot;number&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt; as CGPoint).x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   sl = sl.&lt;span class=&quot;built_in&quot;&gt;sort&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; ($&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt; as CGPoint).x &amp;lt; ($&lt;span class=&quot;number&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt; as CGPoint).x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; result = [minXPoint]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   result += sl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   result.&lt;span class=&quot;built_in&quot;&gt;append&lt;/span&gt;(maxXPoint)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   result += su&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; = result&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¹ˆæš´åŠ›çš„ç®—æ³•å¤æ‚åº¦ä¹Ÿæ˜¯é«˜çš„æƒŠäººï¼Œä¸º &lt;code&gt;O(N^3)&lt;/code&gt;ï¼&lt;strong&gt;æƒ³å¿…æ­¤æ—¶å·²ç»æœ‰ä¸å°‘å·²ç»è„±äº†è£¤å­çš„åŒå­¦æƒ³é—®åšä¸»ä¸ºä»€ä¹ˆè¦ç»™è‡ªå·±çœ‹è¿™äº›ï¼&lt;/strong&gt;è¯´å¥½çš„ &lt;a href=&quot;https://en.wikipedia.org/wiki/Graham_scan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Graham scan&lt;/a&gt;ç®—æ³•å‘¢ï¼Ÿå…¶å®è¿™éƒ¨åˆ†ã€å‰æˆã€å¾ˆé‡è¦ï¼Œç»ä¸æ˜¯ä¸ºäº†å‡‘ç¯‡å¹…ï¼Œä¸€äº›é‡è¦æ¦‚å¿µå¯¹åé¢çš„æ­£é¢˜ç†è§£æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œæ¯”å¦‚ä¸‹é¢è¦ä»‹ç»çš„ &lt;code&gt;PointView&lt;/code&gt; ç±»ï¼ˆå§æ§½è¡¨ç¢§è²å•Šè¿˜æ¥ï¼ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PointView&lt;/code&gt; æ˜¯ç®—æ³•æ¼”ç¤ºç¨‹åºä¸­ç”¨äºç»˜åˆ¶å’Œå­˜å‚¨äºŒç»´ç‚¹åæ ‡ä¿¡æ¯çš„ç±»ï¼Œå®ƒä¸ä»…å­˜å‚¨åæ ‡ï¼Œè¿˜ç»´æŠ¤äº†çŠ¶æ€ &lt;code&gt;isConvexHullNode&lt;/code&gt;ï¼Œå¹¶æ ¹æ®çŠ¶æ€å€¼æ˜¯å¦ä¸ºå‡¸åŒ…é¡¶ç‚¹æ¥æ”¹å˜ UIï¼ˆçº¢è‰²çš„ç‚¹ä¸ºå‡¸åŒ…é¡¶ç‚¹ï¼Œç´«è‰²ä¸ºéå‡¸åŒ…é¡¶ç‚¹ï¼‰ã€‚æ­¤å¤– &lt;code&gt;PointView&lt;/code&gt; è¿˜éœ€è¦å¤„ç†é¼ æ ‡æ‹–æ‹½äº‹ä»¶ã€‚è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œå°±ä¸ä¸Šä»£ç äº†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Graham-Scan&quot;&gt;&lt;a href=&quot;#Graham-Scan&quot; class=&quot;headerlink&quot; title=&quot;Graham Scan&quot;&gt;&lt;/a&gt;Graham Scan&lt;/h1&gt;&lt;p&gt;å½“æ²¿ç€å‡¸åŒ…é€†æ—¶é’ˆæ¼«æ¸¸æ—¶ï¼Œä½ ä¼šå‘ç°æ€»æ˜¯åœ¨ã€å‘å·¦æ‹ã€ï¼›åä¹‹åˆ™æ˜¯ã€å‘å³æ‹ã€ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è®°å¾—ä¹‹å‰è¯´çš„ä»¥ &lt;code&gt;A&lt;/code&gt; ç‚¹ä¸ºä¸­å¿ƒé€†æ—¶é’ˆæ‰«ææ‰€æœ‰ç‚¹çš„æ–¹æ¡ˆå§ï¼Ÿå°†æ‰€æœ‰é™¤ &lt;code&gt;A&lt;/code&gt; ä»¥å¤–çš„ç‚¹æŒ‰ç…§è¿™ä¸ªæ‰«æé¡ºåºè¿›è¡Œæ’åˆ—ã€‚ç„¶ååœ¨æ­¤åŸºç¡€ä¸Šéå†å¹¶å‰”é™¤ã€ä¸å‘å·¦æ‹ã€çš„ç‚¹ï¼Œæœ€åè¾“å‡ºçš„ç‚¹é›†æ­£å¥½æ˜¯æŒ‰é¡ºåºæ’åˆ—å¥½çš„ã€‚&lt;/p&gt;
&lt;p&gt;PS:åˆ¤æ–­ &lt;code&gt;P1P2P3&lt;/code&gt; åœ¨ &lt;code&gt;P2&lt;/code&gt; æ‹å¼¯æ–¹å‘å…¬å¼ï¼š&lt;code&gt;(p2.x - p1.x) * (p3.y - p1.y) - (p2.y - p1.y) * (p3.x - p1.x)&lt;/code&gt;ï¼Œå¦‚æœå…¶ç»“æœä¸º &lt;code&gt;0&lt;/code&gt;ï¼Œè¿™ä¸‰ä¸ªç‚¹æ˜¯å…±çº¿çš„ï¼Œå¦‚æœå…¶ç»“æœä¸ºæ­£ï¼Œè¿™ä¸‰ä¸ªç‚¹æ˜¯å‘å·¦æ‹çš„ï¼Œå¦åˆ™ï¼Œå®ƒæ˜¯å‘å³æ‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œé€šå¸¸é€‰æ‹© Y å€¼æœ€å°çš„ç‚¹ä½œä¸º &lt;code&gt;A&lt;/code&gt; ç‚¹ï¼ˆY å€¼ä¸€æ ·å°±é€‰æœ€å³è¾¹çš„ç‚¹ï¼‰ï¼Œå…¶ä½™çš„ç‚¹å°±éƒ½è½åœ¨ç¬¬ä¸€ã€äºŒè±¡é™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ¥è‡ªç»´åŸºç™¾ç§‘ï¼Œä½†æ˜¯æ¼«æ¸¸æ–¹å‘æ˜¯&lt;strong&gt;é¡ºæ—¶é’ˆ&lt;/strong&gt;çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦å‰”é™¤&lt;strong&gt;ä¸å‘å³æ‹&lt;/strong&gt;çš„ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://upload.wikimedia.org/wikipedia/commons/1/1b/Graham_scan.png&quot; alt=&quot;via Wikimedia Commons&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;P&lt;/code&gt; ä¸ºåŸç‚¹çš„æåæ ‡ä¸‹æŒ‰ç…§æè§’å¤§å°æ„é€ é¡ºæ—¶é’ˆæ’åºçš„æ•°ç»„ï¼š&lt;code&gt;[A,B,C,D]&lt;/code&gt;ï¼Œè®¡ç®—æè§’çš„å‡½æ•°å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;calculatePolarAngle&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(origin:CGPoint, target:CGPoint)&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;Double&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; trans = (x: target.x - origin.x, y: target.y - origin.y)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; angle = atan(&lt;span class=&quot;type&quot;&gt;Double&lt;/span&gt;(trans.y) / &lt;span class=&quot;type&quot;&gt;Double&lt;/span&gt;(trans.x))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; trans &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; (x,y) &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; x &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; y &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; angle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; (x,y) &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; x &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; y &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; angle + &lt;span class=&quot;type&quot;&gt;M_PI&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; (x,y) &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; x &amp;lt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; y &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; angle + &lt;span class=&quot;type&quot;&gt;M_PI&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; (x,y) &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; x &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; y &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; angle + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * &lt;span class=&quot;type&quot;&gt;M_PI&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥ç€å°±æ˜¯éå†æŒ‰æè§’æ’åºå¥½çš„æ•°ç»„ã€‚å…ˆå°† &lt;code&gt;P&lt;/code&gt; ç‚¹å’Œ &lt;code&gt;A&lt;/code&gt; ç‚¹ push è¿›æ ˆï¼Œç„¶åæ£€æŸ¥ &lt;code&gt;PAB&lt;/code&gt; æ˜¯å¦ä¸å‘å³æ‹ï¼Œå› ä¸ºåœ¨ &lt;code&gt;A&lt;/code&gt; ç‚¹å³æ‹æ‰€ä»¥å°† &lt;code&gt;B&lt;/code&gt; ç‚¹ push è¿›æ ˆï¼Œç„¶åç»§ç»­æ£€æŸ¥ &lt;code&gt;C&lt;/code&gt; ç‚¹ã€‚å¯ä»¥çœ‹å‡ºåœ¨ &lt;code&gt;C&lt;/code&gt; ç‚¹å¤„ &lt;code&gt;BCD&lt;/code&gt; å‘å·¦æ‹äº†ï¼Œäºæ˜¯ &lt;code&gt;C&lt;/code&gt; ç‚¹è¢«å‰”é™¤ï¼Œæ ˆ pop å‡º &lt;code&gt;C&lt;/code&gt;ã€‚ç„¶åæ£€æŸ¥ &lt;code&gt;ABD&lt;/code&gt; å¤„æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç»“æœæ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œäºæ˜¯å°† &lt;code&gt;D&lt;/code&gt; ç‚¹ push è¿›æ ˆã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´éå†æ•°ç»„æ—¶å§‹ç»ˆåˆ¤æ–­æ ˆé¡¶å…ƒç´ å¤„æ‹å¼¯æ–¹å‘æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼šæ–¹å‘ç¬¦åˆè¦æ±‚åˆ™å°†å½“å‰éå†çš„ç‚¹ push è¿›æ ˆï¼Œå¦åˆ™å°†æ ˆé¡¶å…ƒç´  popï¼Œå¹¶ç»§ç»­åˆ¤æ–­æ ˆé¡¶å…ƒç´ å¤„æ‹å¼¯æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç›´åˆ°ç¬¦åˆè¦æ±‚ä¸ºæ­¢ã€‚ï¼ˆå¦‚è‹¥æ ˆå…ƒç´ ä¸ªæ•°å°äº &lt;code&gt;3&lt;/code&gt;ï¼Œåˆ™ä¸å† popï¼‰&lt;/p&gt;
&lt;p&gt;æœ€åçš„å®ç°ç®—æ³• Swift ä»£ç å¦‚ä¸‹ï¼ˆé€†æ—¶é’ˆæ¼«æ¸¸ï¼‰&lt;/p&gt;
&lt;figure class=&quot;highlight maxima&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;func generateConvexHull(inout &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;: [PointView]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       point.isConvexHullNode = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.count &amp;lt;= &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; minYPoint = &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; minIndex = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (index,point) &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.enumerate() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       (minIndex,minYPoint) = point.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;.y &amp;lt; minYPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;.y ? (index,point) : (minIndex,minYPoint)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.removeAtIndex(minIndex)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.sortInPlace &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; calculatePolarAngle(minYPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;, target: $&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;) &amp;lt; calculatePolarAngle(minYPoint.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;, target: $&lt;span class=&quot;number&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; stack = [minYPoint]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; restPoints = [PointView]()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   stack.&lt;span class=&quot;built_in&quot;&gt;append&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; point &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;..&amp;lt;&lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt;.count] &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       func checkTurnsRight() -&amp;gt; Bool &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;let&lt;/span&gt; p1 = stack[stack.count-&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;].&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;let&lt;/span&gt; p2 = stack.&lt;span class=&quot;built_in&quot;&gt;last&lt;/span&gt;!.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;let&lt;/span&gt; p3 = point.&lt;span class=&quot;built_in&quot;&gt;position&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; (p2.x - p1.x) * (p3.y - p1.y) - (p2.y - p1.y) * (p3.x - p1.x) &amp;lt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; checkTurnsRight() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           stack.&lt;span class=&quot;built_in&quot;&gt;last&lt;/span&gt;?.isConvexHullNode = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           restPoints.&lt;span class=&quot;built_in&quot;&gt;append&lt;/span&gt;(stack.&lt;span class=&quot;built_in&quot;&gt;last&lt;/span&gt;!)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           stack.removeLast()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; stack.count &amp;lt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;built_in&quot;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       stack.&lt;span class=&quot;built_in&quot;&gt;append&lt;/span&gt;(point)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;points&lt;/span&gt; = stack + restPoints&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Graham Scan çš„æ—¶é—´å¤æ‚åº¦æ˜¯ &lt;code&gt;O(nlogn)&lt;/code&gt;ï¼Œè€Œä¸”åªé€‚ç”¨äºäºŒç»´å¹³é¢ã€‚ç®—æ³•å¯¼è®ºä¸Šä¹Ÿè®²åˆ°äº†åŒ…è£¹æ³•ï¼ˆJarvisæ­¥è¿›æ³•ï¼‰å’Œåˆ†æ²»æ³•ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ &lt;code&gt;O(nlogn)&lt;/code&gt;ã€‚æˆ‘çš„&lt;a href=&quot;https://github.com/yulingtianxia/Algorithm-Experiment&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;é‚£ä¸ªå·¥ç¨‹&lt;/a&gt;é‡Œä¹Ÿæœ‰&lt;a href=&quot;https://github.com/yulingtianxia/Algorithm-Experiment/blob/master/ConvexHull/ConvexHull/DivideAndConquer.swift&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åˆ†æ²»æ³•çš„ Swift å®ç°&lt;/a&gt;ã€‚å¦‚æœæ‹“å±•åˆ°å¤šç»´ç©ºé—´ï¼Œæˆ‘è§‰å¾—ä½¿ç”¨ Swift å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®ç°è¯­è¨€ï¼ŒMatlab å†é€‚åˆä¸è¿‡äº†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;åè®°&quot;&gt;&lt;a href=&quot;#åè®°&quot; class=&quot;headerlink&quot; title=&quot;åè®°&quot;&gt;&lt;/a&gt;åè®°&lt;/h1&gt;&lt;p&gt;åšä¸»æ±Ÿéƒæ‰å°½ç«Ÿç„¶æ‹¿å­¦æ ¡çš„æŸæ¬¡ç®—æ³•å®éªŒå……æ•°å°¼ç›å‘çˆ¹å‘¢è¿™æ˜¯ï¼&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Convex_hull&quot;&gt;å‡¸åŒ…(Convex hull)&lt;/a&gt; æ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æ¦‚å¿µï¼Œåœ¨äºŒç»´å¹³é¢ä¸Šå¯ä»¥æƒ³è±¡æˆç”¨ä¸€ä¸ªæ©¡çš®ç­‹å¥—ä½ä¸€å †é’‰åœ¨å¹³é¢ä¸Šçš„é’‰å­ã€‚æœ¬æ–‡è®²è¿°å¦‚ä½•ä½¿ç”¨ Swift å®ç° &lt;a href=&quot;https://en.wikipedia.org/wiki/Graham_scan&quot;&gt;Graham scan&lt;/a&gt; ç®—æ³•æ¥å¯»æ‰¾äºŒç»´å¹³é¢ç‚¹é›†ä¸Šçš„å‡¸åŒ…ã€‚å·¥ç¨‹æºç  Githubï¼š&lt;a href=&quot;https://github.com/yulingtianxia/Algorithm-Experiment&quot;&gt;https://github.com/yulingtianxia/Algorithm-Experiment&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://upload.wikimedia.org/wikipedia/commons/d/de/ConvexHull.svg&quot; alt=&quot;By Maksim (original); en:User:Pbroks3 (redraw), via Wikimedia Commons&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/convexhull/convexhull.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Swift" scheme="http://yulingtianxia.com/tags/Swift/"/>
    
      <category term="macOS" scheme="http://yulingtianxia.com/tags/macOS/"/>
    
      <category term="Algorithm" scheme="http://yulingtianxia.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>ä¸º UIAutomation æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾çš„æ¢ç´¢</title>
    <link href="http://yulingtianxia.com/blog/2016/03/28/Add-UITest-Label-for-UIAutomation/"/>
    <id>http://yulingtianxia.com/blog/2016/03/28/Add-UITest-Label-for-UIAutomation/</id>
    <published>2016-03-27T16:47:32.000Z</published>
    <updated>2016-08-27T14:47:42.000Z</updated>
    
    <content type="html">&lt;p&gt;UIAutomation æ˜¯è‹¹æœæä¾›çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼ŒiOS ä¸åƒ Android é‚£æ ·å¯ä»¥åœ¨ xml æ–‡ä»¶ä¸­è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€çš„ id ä½œä¸ºæ ‡ç­¾ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¸ºæ§ä»¶æ·»åŠ å¯è®¿é—®æ€§ï¼ˆAccessibilityï¼‰ã€‚å¦‚ä½•è®©ä¸€ä¸ªæ§ä»¶çš„å¯è®¿é—®æ ‡ç­¾åœ¨å½“å‰é¡µé¢å”¯ä¸€ä¸”ä¸å˜å‘¢ï¼Ÿå½“ç„¶çº¯æ‰‹å·¥åœ¨ä»£ç ä¸­æ’å…¥åŠ æ ‡ç­¾çš„é€»è¾‘ä»£ç è‚¯å®šæ˜¯å¯è¡Œçš„ï¼Œä½†è´¹æ—¶è´¹åŠ›ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œåšä¸€äº›ç”¨ç¨‹åºè‡ªåŠ¨åŒ–æ·»åŠ æ ‡ç­¾å°è¯•æ€§çš„æ¢ç´¢ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;åˆ†æ-amp-æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#åˆ†æ-amp-æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&amp;amp;æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;åˆ†æ&amp;amp;æ–¹æ¡ˆ&lt;/h2&gt;&lt;p&gt;é¦–å…ˆå›é¡¾ä¸‹ç”Ÿæˆæ ‡ç­¾éœ€è¦ç¬¦åˆçš„å¿…è¦æ¡ä»¶ï¼šï¼ˆ&lt;strong&gt;ä»¥ä¸‹å°†â€œè‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾â€ç®€ç§°ä¸ºâ€œæ ‡ç­¾â€&lt;/strong&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¡µé¢å†…å”¯ä¸€ï¼šé¡µé¢å†…ä¸åŒè§†å›¾æ ‡ç­¾ä¸é‡å¤ã€‚&lt;/li&gt;
&lt;li&gt;è¿è¡Œæ—¶æ’å®šï¼šæ¯æ¬¡è¿è¡Œåº”ç”¨ä¸­æ­¤é¡µé¢æ—¶è§†å›¾çš„æ ‡ç­¾å§‹ç»ˆæ’å®šï¼Œæ— éœ€ä¿®æ”¹æµ‹è¯•è„šæœ¬ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºäº†æ»¡è¶³æ ‡ç­¾çš„å¿…è¦æ¡ä»¶ï¼Œå¯ä»¥é€‰æ‹©å…¶åœ¨æŸä¸ªç±»ä¸­çš„å±æ€§åç§°ä½œä¸ºæ ‡ç­¾ï¼Œå› ä¸ºåŒä¸€ä¸ªç±»ä¸­æ˜¯ä¸å¯èƒ½æœ‰ä¸¤ä¸ªç›¸åŒåç§°çš„å±æ€§çš„ï¼Œå¹¶ä¸”å±æ€§åç§°éƒ½æ˜¯å›ºå®šåœ¨ä»£ç é‡Œçš„ï¼Œä¹Ÿå°±æ˜¯æ’å®šä¸å˜çš„ã€‚åœ¨æ­¤æ€»ç»“ä¸‹æ ‡ç­¾çš„ç­–ç•¥æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœå˜é‡æ˜¯æŸä¸ªç±»çš„å±æ€§ï¼Œåˆ™å¯æ»¡è¶³æ ‡ç­¾æ¡ä»¶ã€‚å› ä¸ºä»£ç æ²¡æœ‰æ”¹åŠ¨ï¼Œåˆ™æ ‡ç­¾ä¹Ÿä¸ä¼šå˜åŒ–ã€‚å³ä½¿ä»£ç æœ‰å˜åŠ¨ï¼Œä¹Ÿè‚¯å®šæ˜¯å› ä¸ºä¸šåŠ¡é€»è¾‘å˜æ›´å¯¼è‡´äº†ç•Œé¢ä¸Šçš„å˜åŒ–ï¼Œé‚£ä¹ˆæµ‹è¯•è„šæœ¬è‚¯å®šä¹Ÿæ˜¯è¦æ”¹çš„ï¼Œæ‰€ä»¥æ— éœ€å¤šè™‘æ­¤ç§æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ä¸´æ—¶åˆ›å»ºçš„å±€éƒ¨å˜é‡ï¼ŒåŒä¸€é¡µé¢ä¸­å¾ˆæœ‰å¯èƒ½æœ‰ç›¸åŒåå­—çš„å±€éƒ¨å˜é‡ã€‚è€Œä¸” Objective-C Runtime æ— æ³•è·å–å±€éƒ¨å˜é‡åç§°ï¼Œæ‰€ä»¥é’ˆå¯¹æ­¤ç§æƒ…å†µå°½é‡é‡‡ç”¨å…¶ä»–æ¥æºçš„å†…å®¹ä½œä¸ºæ ‡ç­¾ã€‚&lt;/li&gt;
&lt;li&gt;è·å–ä»£ç ä¸­å±€éƒ¨å˜é‡çš„å˜é‡åï¼Œå¹¶ä¸å…¶å¯¹è±¡ç»‘å®šèµ·æ¥ã€‚ï¼ˆç»‘å®šæ˜¯æŒ‡å°†æ ‡ç­¾èµ‹ç»™&lt;code&gt;accessibilityIdentifier&lt;/code&gt; ä¹‹ç±»çš„å±æ€§ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äºä¸Šé¢ç¬¬äºŒæ¡ç§çš„å±€éƒ¨å˜é‡ç”Ÿæˆæ ‡ç­¾çš„ç­–ç•¥ï¼Œè¯¦ç»†é˜è¿°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;ç”±äºç¼–è¯‘å™¨å¯¹ä»£ç è¿›è¡Œäº†è¯æ³•åˆ†æã€è¯­æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡åæ—©å°±æ¶ˆå¤±äº†ã€‚è¿è¡Œçš„æ—¶å€™å±€éƒ¨å˜é‡åœ¨å†…å­˜é‡Œä¹Ÿåªæ˜¯ä¸ªå†°å†·å†·çš„å¯¹è±¡ç½¢äº†ï¼Œä¸åƒç±»çš„å®ä¾‹å˜é‡æˆ–å±æ€§é‚£æ ·å¯ä»¥è·å–åç§°ã€‚æ—¢ç„¶ç¼–è¯‘é˜¶æ®µä¹‹åå°±å·²ç»æ‹¿ä¸åˆ°å±€éƒ¨å˜é‡åäº†ï¼Œæ‰€ä»¥åªèƒ½å¯¹æºä»£ç è¿›è¡Œæ–‡å­—å¤„ç†æ¥è·å–å±€éƒ¨å˜é‡åã€‚æ¯”å¦‚ä½¿ç”¨å®å®šä¹‰åœ¨ &lt;code&gt;addSubview:&lt;/code&gt; æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ä¼ å…¥å‚æ•°åï¼Œå¹¶å°†å‚æ•°è¡¨ä¸å‚æ•°å®ä¾‹ç»‘å®šã€‚ä½†æ˜¯è¿™å¯¹ Swift ç®—æ˜¯ä¸ªæ–¹æ¡ˆï¼Œå¯¹äºè¯­æ³•æ€ªå¼‚çš„ Objective-C æ¥è¯´æ˜¯ä¸å¯è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶ä»æ–¹æ³•å¤–ä¸èƒ½ç›´æ¥ä¼ å…¥å‚æ•°ï¼Œé‚£ä¹ˆå°è¯•ä»æ–¹æ³•å†…æ¥è·å–å‡½æ•°è°ƒç”¨å †æ ˆã€‚æŸ¥æ‰¾ä¸Šä¸€å±‚å‡½æ•°åœ¨æºç çš„ä½ç½®ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼å¾—åˆ° &lt;code&gt;addSubview:&lt;/code&gt; çš„å‚æ•°åç§°ã€‚ä»å‡½æ•°è°ƒç”¨å †æ ˆè·å–ä¸Šä¸€å±‚è°ƒç”¨å‡½æ•°åœ¨æºç ä¸­çš„ä½ç½®ï¼ˆæ¯”å¦‚æ–‡ä»¶åå’Œè¡Œæ•°ï¼‰ï¼Œç„¶åç”¨æ­£åˆ™åŒ¹é…æŠ“å– &lt;code&gt;addSubview:&lt;/code&gt; çš„å‚æ•°åï¼Œçœ‹æ ·å­æ˜¯ä¸ªæ–¹æ¡ˆã€‚è·å–å‡½æ•°è°ƒç”¨æ ˆå¯¹åº”æºç ä½ç½®å¯ä»¥ç”¨ &lt;a href=&quot;http://stackoverflow.com/questions/3151779/how-its-better-to-invoke-gdb-from-program-to-print-its-stacktrace/4611112#4611112&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;backtrace_symbols&lt;/code&gt;&lt;/a&gt;ï¼Œæˆ–è€… &lt;code&gt;[NSThread callStackSymbols]&lt;/code&gt; ç­‰ï¼Œä½†è¿™äº›æ“ä½œéƒ½ä¸æ˜¯åœ¨ iOS ç³»ç»Ÿå†…ï¼Œä¸èƒ½å°†æ ‡ç­¾ç»‘å®šåˆ° iOS è¿è¡Œç¯å¢ƒä¸­çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥ç”¨è„šæœ¬ç¨‹åºå¸®æˆ‘ä»¬åœ¨æºç æŒ‡å®šä½ç½®ä¸­æ’å…¥æ·»åŠ æ ‡ç­¾çš„é€»è¾‘ä»£ç ï¼Œä½†è¿™æ ·çš„å¼Šç«¯æœ‰äºŒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»´æŠ¤æˆæœ¬è¾ƒé«˜ï¼Œè„šæœ¬åœ¨å‘æºç ä¸­æ’å…¥åŠ æ ‡ç­¾é€»è¾‘ä»£ç æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦å·²ç»æ’å…¥è¿‡è¿™æ®µä»£ç ï¼Œå¢åŠ äº†å‡ºé”™å‡ ç‡&lt;/li&gt;
&lt;li&gt;å¯¹ä»£ç å†…å®¹å˜åŒ–çš„é²æ£’æ€§ä¸é«˜ã€‚å› ä¸ºé‡æ„ç­‰è¡Œä¸ºå¾ˆå¯èƒ½æŠŠåŸæœ‰ä»£ç é¡ºåºå¼„ä¹±ï¼Œè„šæœ¬éœ€è¦è€ƒè™‘å¾ˆå¤šæƒ…å†µã€‚æ¯æ¬¡æ–°å¢ä»£ç éƒ½è¦é‡æ–°è·‘ä¸€æ¬¡è„šæœ¬ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ—¢ç„¶å±€éƒ¨å˜é‡çš„åå­—å¯èƒ½é‡åå¹¶éš¾äºä¸å®ä¾‹ç»‘å®šï¼Œä¸å¦¨å¦è¾Ÿè¹Šå¾„å¯»æ±‚å…¶ä»–æ–¹æ³•ã€‚è¿™é‡Œæå‡ºä¸€ç§å‡è®¾ï¼šç¨‹åºå‘˜å†™ä»£ç çš„æ—¶å€™ä¹‹æ‰€ä»¥å°†ä¸€ä¸ªè§†å›¾å˜é‡å£°æ˜ä¸ºç±»çš„å±æ€§ï¼Œæ˜¯å› ä¸ºä»¥åè¿˜ä¼šç»å¸¸ç”¨åˆ°å®ƒã€‚è€Œé‚£äº›è¢«å£°æ˜ä¸ºå±€éƒ¨å˜é‡çš„ï¼Œè‚¯å®šæ˜¯ä¸´æ—¶ç”¨ä¸€æ¬¡å°±ä¸ç”¨äº†ã€‚è¿™ç§ç”¨ä¸´æ—¶å˜é‡åˆ›å»ºçš„è§†å›¾æ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸­å†…å®¹ææœ‰å¯èƒ½å°±ä¸ä¼šå˜äº†ï¼Œå…¶å¤§éƒ¨åˆ†åº”è¯¥æ˜¯ &lt;code&gt;UILabel&lt;/code&gt;ã€&lt;code&gt;UIButton&lt;/code&gt;ã€&lt;code&gt;UIImageView&lt;/code&gt; ä»¥åŠè¢«å½“åšå®¹å™¨è§†å›¾åŠŸèƒ½çš„ &lt;code&gt;UIView&lt;/code&gt; å®ä¾‹ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µå¯ä»¥å°†å…¶è§†å›¾çš„å†…å®¹ä½œä¸ºæ ‡ç­¾çš„ã€ç‰¹æ®Šæ ‡è¯†ã€ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µå¯ä»¥å°†å…¶è§†å›¾çš„å†…å®¹ä½œä¸ºæ ‡ç­¾ï¼Œæ¯”å¦‚ &lt;code&gt;UILabel&lt;/code&gt; çš„æ–‡æœ¬å†…å®¹ã€&lt;code&gt;UIButton&lt;/code&gt; çš„èƒŒæ™¯å›¾ç‰‡èµ„æºåå’Œæ–‡æœ¬å†…å®¹ä»¥åŠ &lt;code&gt;UIImageView&lt;/code&gt; çš„å›¾ç‰‡èµ„æºåã€‚åŸºäºä»¥ä¸Šçš„é€»è¾‘ï¼Œæœ€åé‡‡ç”¨åŸºç¡€æ§ä»¶å†…å®¹ä½œä¸ºå±€éƒ¨å˜é‡çš„æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå¦‚æœè§†å›¾æ˜¯æŸä¸ªç±»çš„å±æ€§ï¼Œå°±ç”¨å±æ€§åä½œä¸ºæ ‡ç­¾ï¼›å¦åˆ™ä½¿ç”¨å…¶å†…å®¹ä½œä¸ºæ ‡ç­¾ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®è·µ-amp-æ¢ç´¢&quot;&gt;&lt;a href=&quot;#å®è·µ-amp-æ¢ç´¢&quot; class=&quot;headerlink&quot; title=&quot;å®è·µ&amp;amp;æ¢ç´¢&quot;&gt;&lt;/a&gt;å®è·µ&amp;amp;æ¢ç´¢&lt;/h2&gt;&lt;p&gt;æˆ‘é‡‡ç”¨ hook çš„æ–¹å¼æ¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆæ ‡ç­¾ã€‚hook &lt;code&gt;UIView&lt;/code&gt; ä¸­çš„&lt;code&gt;accessibilityIdentifier&lt;/code&gt; çš„åŸå› æ˜¯æ­¤æ—¶çš„è§†å›¾å±‚çº§æ›´å…¨ï¼Œå¹¶ä¸”æ˜¯æƒ°æ€§ç”Ÿæˆæ ‡ç­¾ã€‚å…¶å®ä½¿ç”¨ &lt;code&gt;accessibilityLabel&lt;/code&gt; ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†å¯¹ VoiceOver åŠŸèƒ½ä¼šæœ‰å½±å“ï¼Œæ¯•ç«Ÿå˜é‡åä¸åƒè§†å›¾æ–‡å­—å†…å®¹é‚£æ ·æœ‰å®é™…æ„ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;PSï¼šè¿™é‡Œä¹‹æ‰€ä»¥ä¸ hook &lt;code&gt;addSubview:&lt;/code&gt; æ˜¯å› ä¸ºåœ¨æ·»åŠ  subview æ—¶ï¼Œè§†å›¾å±‚çº§æ ‘å¹¶ä¸å®Œæ•´ã€‚è™½ç„¶è°ƒç”¨ &lt;code&gt;accessibilityIdentifier&lt;/code&gt; æ—¶è§†å›¾å±‚çº§ä¹Ÿå¯èƒ½ä¸å®Œæ•´ï¼ˆæ¯”å¦‚åœ¨ &lt;code&gt;addSubview:&lt;/code&gt; ä¹‹å‰è°ƒç”¨ &lt;code&gt;accessibilityIdentifier&lt;/code&gt;ï¼‰ï¼Œä½†è¿™æ ·çš„å‡ ç‡è¿œè¿œå°äºå‰è€…ï¼šå¾ˆå¤šæ—¶å€™æ˜¯ &lt;code&gt;[a addSubview:b]&lt;/code&gt;ï¼Œä½†æ­¤æ—¶ &lt;code&gt;a&lt;/code&gt; è¿˜æ²¡æœ‰ &lt;code&gt;superview&lt;/code&gt;ï¼Œé‚£ä¹ˆå¦‚æœ hook &lt;code&gt;addSubview:&lt;/code&gt;æ–¹æ³•ï¼Œå°±åªèƒ½ä¿ç•™ &lt;code&gt;a&lt;/code&gt; ä»¥ä¸‹çš„è§†å›¾å±‚çº§ã€‚è¿™å¹¶ä¸æ˜¯æˆ‘æƒ³çœ‹åˆ°çš„ã€‚æ‰€ä»¥åœ¨ &lt;code&gt;UIView&lt;/code&gt; ä¸­çš„ &lt;code&gt;accessibilityIdentifier&lt;/code&gt; æ–¹æ³•ä¸­ç”Ÿæˆæ ‡ç­¾å¯ä»¥å°½å¯èƒ½åœ°ä¿ç•™å®Œæ•´çš„è§†å›¾å±‚çº§ï¼Œå¹¶ä¸”æ˜¯ lazy load çš„æ–¹å¼ï¼Œé™ä½ CPU ä½¿ç”¨å³°å€¼ã€‚&lt;/p&gt;
&lt;p&gt;æ”¾ä¸ªæ®‹ç¼ºç‰ˆçš„ä»£ç ï¼Œå¿ƒæƒ…å¥½çš„æ—¶å€™æ›´æ–°ä¸‹ï¼Œé‡è¦çš„è¿˜æ˜¯æ€è·¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UIView&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;TBUIAutoTest&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)load &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;dispatch_once_t&lt;/span&gt; onceToken;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;dispatch_once&lt;/span&gt;(&amp;amp;onceToken, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; swizzleSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(accessibilityIdentifier) withAnotherSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(tb_accessibilityIdentifier)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; swizzleSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(accessibilityLabel) withAnotherSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(tb_accessibilityLabel)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)swizzleSelector:(SEL)originalSelector withAnotherSelector:(SEL)swizzledSelector&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class aClass = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method originalMethod = class_getInstanceMethod(aClass, originalSelector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method swizzledMethod = class_getInstanceMethod(aClass, swizzledSelector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; didAddMethod =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    class_addMethod(aClass,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    originalSelector,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    method_getImplementation(swizzledMethod),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    method_getTypeEncoding(swizzledMethod));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (didAddMethod) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        class_replaceMethod(aClass,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            swizzledSelector,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            method_getImplementation(originalMethod),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            method_getTypeEncoding(originalMethod));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        method_exchangeImplementations(originalMethod, swizzledMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark - Method Swizzling&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)tb_accessibilityIdentifier&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *accessibilityIdentifier = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; tb_accessibilityIdentifier];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (accessibilityIdentifier.length &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; [[accessibilityIdentifier substringToIndex:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;(&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; accessibilityIdentifier;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([accessibilityIdentifier isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;null&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        accessibilityIdentifier = &lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *labelStr = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.superview findNameWithInstance:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (labelStr &amp;amp;&amp;amp; ![labelStr isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        labelStr = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,labelStr];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UILabel&lt;/span&gt; class]]) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//UILabel ä½¿ç”¨ text&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            labelStr = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UILabel&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).text?:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; class]]) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//UIImageView ä½¿ç”¨ image çš„ imageName&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            labelStr = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).image.accessibilityIdentifier?:[&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;image%ld&quot;&lt;/span&gt;,(&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;)((&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).tag]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; class]]) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//UIButton ä½¿ç”¨ button çš„ text å’Œ image&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            labelStr = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@%@)&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).titleLabel.text?:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).imageView.image.accessibilityIdentifier?:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (accessibilityIdentifier) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// å·²æœ‰ labelï¼Œåˆ™åœ¨æ­¤åŸºç¡€ä¸Šå†æ¬¡æ·»åŠ æ›´å¤šä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            labelStr = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,accessibilityIdentifier];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.accessibilityValue = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).currentBackgroundImage.accessibilityIdentifier?:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([labelStr isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;()&quot;&lt;/span&gt;] || [labelStr isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;(null)&quot;&lt;/span&gt;] || [labelStr isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;null&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        labelStr = &lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setAccessibilityIdentifier:labelStr];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; labelStr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)tb_accessibilityLabel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; class]]) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//UIImageView ç‰¹æ®Šå¤„ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *name = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.superview findNameWithInstance:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (name) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.accessibilityIdentifier = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,name];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.accessibilityIdentifier = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).image.accessibilityIdentifier?:[&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;image%ld&quot;&lt;/span&gt;,(&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;)((&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).tag]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UITableViewCell&lt;/span&gt; class]]) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//UITableViewCell ç‰¹æ®Šå¤„ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.accessibilityIdentifier = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;(%@)&quot;&lt;/span&gt;,((&lt;span class=&quot;built_in&quot;&gt;UITableViewCell&lt;/span&gt; *)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;).reuseIdentifier];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; tb_accessibilityLabel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è·å–åˆ°å˜é‡åä¹‹åï¼Œè¿˜éœ€è¦è¿›è¡Œå¤„ç†æ‰èƒ½ä½œä¸ºæ ‡ç­¾ã€‚é¦–å…ˆåœ¨å˜é‡åå¤–åŠ ä¸€å±‚æ‹¬å·ï¼Œç›®çš„æ˜¯åŒºåˆ†ä¸‹æ­¤æ ‡ç­¾æ˜¯ä»£ç ç”Ÿæˆçš„è€Œä¸æ˜¯æ‰‹åŠ¨åŠ ä¸Šå»çš„ã€‚æ–¹æ³•ç»“å°¾çš„ &lt;code&gt;[self setAccessibilityIdentifier:subLabelStr]&lt;/code&gt; ç”¨æ¥ç»™ &lt;code&gt;_accessibilityIdentifier&lt;/code&gt; èµ‹å€¼ç”Ÿæˆå¥½çš„æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè·å–ä¸åˆ°å˜é‡åçš„ä¸´æ—¶å˜é‡å’Œè§†å›¾å±‚çº§ä¸­ä¸€äº›ç³»ç»Ÿç§æœ‰çš„è§†å›¾å˜é‡ï¼Œæ‰å»ä¹‹å‰åˆ†æä¸­æåˆ°çš„æ–¹æ¡ˆç‰¹æ®Šå¤„ç†ã€‚å¥½ä¸€é•¿ä¸²çš„ &lt;code&gt;if-else&lt;/code&gt; å•Šï¼Œä¸ºäº†å¤„ç†è¿™äº›ç‰¹æ®Šæƒ…å†µå†™ä¸€å¨è„ä»£ç æˆ‘ä¹Ÿæ˜¯é†‰äº†ã€‚æœ€ååˆ«å¿˜å¤„ç†ä¸‹æ— æ„ä¹‰çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ â€œnullâ€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ UIAutomation ç”Ÿæˆæ§ä»¶æ ‘æ—¶ï¼Œå¤§éƒ¨åˆ† &lt;code&gt;UIImageView&lt;/code&gt; å’Œ &lt;code&gt;UITableViewCell&lt;/code&gt; æ— æ³•é€šè¿‡ hook &lt;code&gt;accessibilityIdentifier&lt;/code&gt; æ¥åœ¨æ§ä»¶æ ‘ä¸­è·å–åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾ï¼Œæˆ–è€…è·å¾—çš„æ ‡ç­¾ä¸æ˜¯å±æ€§åè€Œæ˜¯å›¾ç‰‡èµ„æºåã€‚è§£å†³æ–¹æ¡ˆæ˜¯ hook accessibilityLabel æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­ä¸º &lt;code&gt;UIImageView&lt;/code&gt; å’Œ &lt;code&gt;UITableViewCell&lt;/code&gt; åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å°† &lt;code&gt;UIImage&lt;/code&gt; çš„å›¾ç‰‡èµ„æºåå’Œå®ä¾‹ç»‘å®šï¼Œæˆ‘åˆ hook äº† &lt;code&gt;UIImage&lt;/code&gt; çš„ &lt;code&gt;imageNamed:&lt;/code&gt; ç±»æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)tb_imageNamed:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)imageName&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; tb_imageNamed:imageName];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    image.accessibilityIdentifier = imageName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; image;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸‹é¢è¯´ä¸‹è·å–å˜é‡åçš„ &lt;code&gt;findNameWithInstance:&lt;/code&gt; æ–¹æ³•çš„å®ç°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UIResponder&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;TBUIAutoTest&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)nameWithInstance:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)instance &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; numIvars = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *key=&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Ivar * ivars = class_copyIvarList([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; class], &amp;amp;numIvars);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; numIvars; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Ivar thisIvar = ivars[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *type = ivar_getTypeEncoding(thisIvar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *stringType =  [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithCString:type encoding:&lt;span class=&quot;built_in&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![stringType hasPrefix:&lt;span class=&quot;string&quot;&gt;@&quot;@&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((object_getIvar(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, thisIvar) == instance)) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//æ­¤å¤„ crash ä¸è¦æ…Œï¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            key = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithUTF8String:ivar_getName(thisIvar)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    free(ivars);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; key;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)findNameWithInstance:(&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *) instance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; nextResponder = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; nextResponder];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *name = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; nameWithInstance:instance];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!name) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [nextResponder findNameWithInstance:instance];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([name hasPrefix:&lt;span class=&quot;string&quot;&gt;@&quot;_&quot;&lt;/span&gt;]) &amp;#123;  &lt;span class=&quot;comment&quot;&gt;//å»æ‰å˜é‡åçš„ä¸‹åˆ’çº¿å‰ç¼€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        name = [name substringFromIndex:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬å¹¶ä¸çŸ¥é“æŸä¸ªè§†å›¾å¯¹è±¡åœ¨å“ªä¸ªç±»ä¸­å……å½“äº†å±æ€§æˆ–æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥ &lt;code&gt;findNameWithInstance:&lt;/code&gt; æ–¹æ³•ä¼šæ²¿ç€å“åº”é“¾å‘ä¸Šé€’å½’æŸ¥æ‰¾ï¼ŒèŒƒå›´ä¸ä»…æ¶µç›– &lt;code&gt;UIView&lt;/code&gt;ï¼Œè¿ &lt;code&gt;UIViewController&lt;/code&gt; éƒ½ä¸èƒ½æ”¾è¿‡ã€‚æ¯æ‰¾ä¸€å±‚å°±è¦è°ƒç”¨ &lt;code&gt;nameWithInstance:&lt;/code&gt; æ–¹æ³•ç”¨ &lt;a href=&quot;http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/&quot;&gt;Objective-C Runtime&lt;/a&gt; éå†æˆå‘˜å˜é‡åˆ—è¡¨çš„æ–¹å¼æŸ¥æ‰¾å˜é‡åã€‚&lt;/p&gt;
&lt;p&gt;åˆ«å¿˜å»æ‰å¼€å¤´çš„ä¸‹åˆ’çº¿ï¼Œå› ä¸ºåœ¨Runtimeä¸­ä¿å­˜çš„å…¶å®æ˜¯æˆå‘˜å˜é‡çš„åç§°ï¼Œé»˜è®¤éƒ½æ˜¯å¸¦æœ‰ä¸‹åˆ’çº¿å‰ç¼€çš„ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸º hook çš„æ–¹æ³•ä¸æ˜¯ &lt;code&gt;accessibilityLabel&lt;/code&gt;ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ Xcode ä¸­çš„ View Debug é¡µé¢æ¥æŸ¥çœ‹åŠ æ ‡ç­¾çš„æ•ˆæœã€‚æœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯é€šè¿‡ UIAutomation æŠ“å–æ§ä»¶æ ‘ï¼Œè¿™æ ·çš„æ•ˆæœæ¯”è¾ƒçœŸå®ã€‚ä¸ºäº†ä¾¿äºåœ¨çœŸæœºä¸ŠæŸ¥çœ‹æ ‡ç­¾å†…å®¹ï¼Œæˆ‘ä¸ºæ‰€æœ‰è§†å›¾å¢åŠ äº†é•¿æŒ‰æ‰‹åŠ¿ï¼Œé•¿æŒ‰è§†å›¾åå¼¹è­¦å‘Šæ¡†æ˜¾ç¤ºè‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾çš„å†…å®¹ã€‚ &lt;/p&gt;
&lt;p&gt;hook  &lt;code&gt;addSubview:&lt;/code&gt; æ–¹æ³•ï¼Œåœ¨å…¶ä¸­æ·»åŠ é•¿æŒ‰æ‰‹åŠ¿ã€‚ &lt;code&gt;longPress:&lt;/code&gt; æ–¹æ³•ä¸­ä¸»è¦æ˜¯è®©é•¿æŒ‰çš„è§†å›¾é«˜äº®å¹¶å¼¹ Alert æ˜¾ç¤ºè‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾çš„å†…å®¹ï¼Œä»£ç å°±ä¸è´´äº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)tb_addSubview:(&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *)view &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!view) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; tb_addSubview:view];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UILongPressGestureRecognizer&lt;/span&gt; *longPress = [[&lt;span class=&quot;built_in&quot;&gt;UILongPressGestureRecognizer&lt;/span&gt; alloc] initWithTarget:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; action:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(longPress:)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    longPress.delegate = [TB&lt;span class=&quot;built_in&quot;&gt;UIAutoTest&lt;/span&gt; sharedInstance];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addGestureRecognizer:longPress];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åˆ›å»º &lt;code&gt;TBUIAutoTest&lt;/code&gt; å•ä¾‹ä½œä¸ºæ‰€æœ‰æ‰‹åŠ¿çš„å§”æ‰˜ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°ä¸€äº›æ‰‹åŠ¿æ•è·ä¼˜å…ˆçº§çš„é€»è¾‘ï¼Œä»¥æ­¤è§£å†³æ‰‹åŠ¿å†²çªå¸¦æ¥çš„é—®é¢˜:&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TBUIAutoTest&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (instancetype)sharedInstance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;dispatch_once_t&lt;/span&gt; onceToken;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; TB&lt;span class=&quot;built_in&quot;&gt;UIAutoTest&lt;/span&gt; *_instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;dispatch_once&lt;/span&gt;(&amp;amp;onceToken, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _instance = [TB&lt;span class=&quot;built_in&quot;&gt;UIAutoTest&lt;/span&gt; new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)gestureRecognizer:(&lt;span class=&quot;built_in&quot;&gt;UIGestureRecognizer&lt;/span&gt; *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(&lt;span class=&quot;built_in&quot;&gt;UIGestureRecognizer&lt;/span&gt; *)otherGestureRecognizer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)gestureRecognizer:(&lt;span class=&quot;built_in&quot;&gt;UIGestureRecognizer&lt;/span&gt; *)gestureRecognizer shouldRequireFailureOfGestureRecognizer:(&lt;span class=&quot;built_in&quot;&gt;UIGestureRecognizer&lt;/span&gt; *)otherGestureRecognizer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([otherGestureRecognizer.view isDescendantOfView:gestureRecognizer.view]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![otherGestureRecognizer isKindOfClass:[&lt;span class=&quot;built_in&quot;&gt;UILongPressGestureRecognizer&lt;/span&gt; class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;æ„Ÿå—-amp-æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ„Ÿå—-amp-æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ„Ÿå—&amp;amp;æ€»ç»“&quot;&gt;&lt;/a&gt;æ„Ÿå—&amp;amp;æ€»ç»“&lt;/h2&gt;&lt;p&gt;&lt;del&gt;æˆ‘æ˜¯æ¨(gu)é˜¿è«ï¼Œä»Šå¤©æˆ‘ç»™å¤§å®¶è¦è®²çš„æ˜¯ä¸€ä¸ªæœˆå‰æµ‹è¯•å¸…å“¥è¦æ±‚åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾åè€å¤§å¼€ä¼šè®¨è®ºæ–¹æ¡ˆç»„å†…é«˜å·¥ä¸€è‡´ä¸èµåŒæ‰‹åŠ¨åŠ å¹¶è¦æ±‚è‡ªåŠ¨åŠ å¹¶åœ¨æœ€åè€å¤§é’¦ç‚¹è¿™ä¸ªäº‹æƒ…å°±äº¤ç»™æˆ‘äº†çš„æ•…äº‹ã€‚è¿™å…¶ä¸­è¿˜ç»å†äº†æ–¹æ¡ˆçš„å„ç§æ”¹ï¼Œäº”å­æ£‹åŒå­¦çš„å®åŠ›å‚(jiao)è°‹(ji)ï¼Œä»¥åŠæ‹‰å±æ—¶æŠŠæœ¬è¯¥æ€è€ƒäººç”Ÿçš„æ—¶é—´èŠ±åœ¨äº†æ”¹è¿›æ–¹æ¡ˆã€‚è¿™ä¸ªæœˆåšå®¢å®åœ¨ä¸çŸ¥é“è¯¥å†™å•¥çœ¼çœ‹æœˆåº•äº†å†ä¸æ›´æ–°æ€•ä»¥åå†ä¹Ÿä¸æƒ³æ›´æ–°äº†å‘¢æ‰€ä»¥ä½ ä¼šå‘ç°è¿™ç¯‡æ–‡ç« æ°´æ°´çš„ç§‘ç§‘ï¼&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;å‘µå‘µåæ¥å‘ç°&lt;del&gt;å¤§éƒ¨åˆ†äºº&lt;/del&gt;æ‰€æœ‰äººéƒ½çœ‹ä¸æ‡‚ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆçœŸçš„å¥½ç”¨ï¼&lt;/p&gt;
&lt;p&gt;å¦‚æœå¤§å®¶æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæˆ–è€…è§‰å¾—æˆ‘çš„æ–¹æ¡ˆä¸€å¼€å§‹å°±è·‘åäº†ï¼Œç”šè‡³æ˜¯å·²ç»æœ‰ä¸€ä¸ªä¸ç”¨æ‰‹åŠ¨åŠ æ ‡ç­¾ä»£ç çš„ç°æˆçš„è¶…å±Œè¶…ç‰›é€¼çš„ iOS è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼æ®è¯´æ•´ä¸ªè…¾è®¯éƒ½æ˜¯æ‰‹åŠ¨åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾ï¼Œè€å¤§è¯´åšæœ‰æŒ‘æˆ˜çš„äº‹æƒ…æ‰æœ‰æ„æ€å˜›ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;UIAutomation æ˜¯è‹¹æœæä¾›çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼ŒiOS ä¸åƒ Android é‚£æ ·å¯ä»¥åœ¨ xml æ–‡ä»¶ä¸­è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€çš„ id ä½œä¸ºæ ‡ç­¾ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¸ºæ§ä»¶æ·»åŠ å¯è®¿é—®æ€§ï¼ˆAccessibilityï¼‰ã€‚å¦‚ä½•è®©ä¸€ä¸ªæ§ä»¶çš„å¯è®¿é—®æ ‡ç­¾åœ¨å½“å‰é¡µé¢å”¯ä¸€ä¸”ä¸å˜å‘¢ï¼Ÿå½“ç„¶çº¯æ‰‹å·¥åœ¨ä»£ç ä¸­æ’å…¥åŠ æ ‡ç­¾çš„é€»è¾‘ä»£ç è‚¯å®šæ˜¯å¯è¡Œçš„ï¼Œä½†è´¹æ—¶è´¹åŠ›ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œåšä¸€äº›ç”¨ç¨‹åºè‡ªåŠ¨åŒ–æ·»åŠ æ ‡ç­¾å°è¯•æ€§çš„æ¢ç´¢ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªåˆ¶ä¸€æ¬¾ Mac å¹³å° URL è¾…åŠ©å·¥å…·</title>
    <link href="http://yulingtianxia.com/blog/2016/02/27/TFSHelper/"/>
    <id>http://yulingtianxia.com/blog/2016/02/27/TFSHelper/</id>
    <published>2016-02-26T16:35:53.000Z</published>
    <updated>2016-09-21T15:25:54.000Z</updated>
    
    <content type="html">&lt;p&gt;å·¥ä½œæ—¶ç»å¸¸ä¼šæ”¶åˆ°åŒäº‹å‘æ¥çš„ä¸€äº›é“¾æ¥ï¼Œæœ‰çš„å¸¦ç©ºæ ¼çš„é“¾æ¥ä¼šæ–­å¼€ï¼Œä¸èƒ½ç›´æ¥ç‚¹å‡»æŸ¥çœ‹ï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶å®Œæ•´é“¾æ¥å¹¶ç²˜è´´æŸ¥çœ‹ã€‚æ‰€ä»¥æˆ‘åšäº†ä¸ª Mac ç³»ç»Ÿä¸Šçš„ URL è¾…åŠ©å·¥å…·ï¼Œåœ¨å¤åˆ¶ URL æ—¶è‡ªåŠ¨å°†å…¶æ‰“å¼€ã€‚è¿˜å®ç°ç¼“å­˜å¸¸ç”¨é“¾æ¥ã€è‡ªåŠ¨/æ‰‹åŠ¨è¿æ¥åˆ‡æ¢ã€ç™»å½•æ—¶å¯åŠ¨ç­‰åŠŸèƒ½ã€‚å¼€å‘è¯­è¨€ä¸º Swift 3 å’Œ AppleScriptã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;å› ä¸ºåœ¨è…¾è®¯å¤§éƒ¨åˆ†èµ„æºéƒ½åœ¨ TFSï¼ˆTencent File Systemï¼‰ä¸Šï¼Œæ‰€ä»¥æˆ‘é’ˆå¯¹ TFS æ ¼å¼çš„é“¾æ¥åšäº†äº›ç‰¹æ®Šå¤„ç†ã€‚å› ä¸º TFS æœ¬è´¨æ˜¯åŸºäº Windows ä¸Šçš„åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œä» Mac ä¸Šè®¿é—®å…¶å…±äº«çš„æ–‡ä»¶éœ€è¦å°† URL å¤„ç†æˆ SMB ï¼ˆæœåŠ¡ä¿¡æ¯å—ï¼‰åè®®ï¼Œç„¶åæ‰èƒ½æ‰“å¼€ã€‚å› ä¸ºæ˜¯é’ˆå¯¹ TFS è€Œåšäº†ç‰¹æ®Šé€»è¾‘å¤„ç†ï¼Œæˆ‘å°†å…¶å‘½åä¸º &lt;a href=&quot;https://github.com/yulingtianxia/TFSHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;TFSHelper&lt;/a&gt;ã€‚å¯ä»¥åœ¨ &lt;a href=&quot;https://github.com/yulingtianxia/TFSHelper/releases&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/TFSHelper/releases&lt;/a&gt; ä¸‹è½½ TFSHelper æœ€æ–°çš„ Release ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å®ç°åŸç†&quot;&gt;&lt;a href=&quot;#å®ç°åŸç†&quot; class=&quot;headerlink&quot; title=&quot;å®ç°åŸç†&quot;&gt;&lt;/a&gt;å®ç°åŸç†&lt;/h1&gt;&lt;p&gt;æˆ‘çš„æ€è·¯æ˜¯å…ˆå°†å‰ªè´´æ¿ä¸­çš„ URL å¤„ç†åå†å†™å…¥å‰ªè´´æ¿ï¼Œç„¶åç”¨ AppleScript æ¨¡æ‹Ÿé”®ç›˜äº‹ä»¶ï¼Œåˆ©ç”¨å¿«æ·é”®å°†å‰ªè´´æ¿å†…å®¹ç²˜è´´åˆ° Finder çš„è¿æ¥æœåŠ¡å™¨åœ°å€æ ï¼Œç„¶åæ¨¡æ‹ŸæŒ‰ä¸‹å›è½¦ï¼Œå®ç°è‡ªåŠ¨è¿æ¥ã€‚å…¶å®ç†è®ºä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ AppleScript ç›´æ¥é€šè¿‡ URL è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä½†æ˜¯ä¸€ç›´éƒ½å‡ºç° errorï¼Œåªå¥½ç”¨è¿™ä¸ªæ­ªæ‹›æ›²çº¿æ•‘å›½ã€‚ç¼“å­˜å¸¸ç”¨é“¾æ¥ä½¿ç”¨ LRU ç­–ç•¥ï¼Œç™»å½•æ—¶å¯åŠ¨å…¶å®ç©çš„ä¾æ—§æ˜¯å¥—è·¯ï¼Œè¿™ä¸ªåé¢å†è®²ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ›¿æ¢å‰ªè´´æ¿å†…å®¹&quot;&gt;&lt;a href=&quot;#æ›¿æ¢å‰ªè´´æ¿å†…å®¹&quot; class=&quot;headerlink&quot; title=&quot;æ›¿æ¢å‰ªè´´æ¿å†…å®¹&quot;&gt;&lt;/a&gt;æ›¿æ¢å‰ªè´´æ¿å†…å®¹&lt;/h2&gt;&lt;p&gt;å¦‚æœå‰ªè´´æ¿ä¸­çš„æ–‡å­—å†…å®¹å«æœ‰ç¬¦åˆ TFS è§„åˆ™çš„ URLï¼Œé‚£å°±å°†å…¶æå–å¹¶ä½¿ç”¨ &lt;code&gt;convert:&lt;/code&gt; å‡½æ•°å°†å…¶å¤„ç†æˆ SMB åè®®æ ¼å¼ï¼›å¦‚æœå·²ç»å«æœ‰ SMB åè®®çš„ URLï¼Œé‚£å°±æå–å‡ºæ¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight nimrod&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;func catchTFSLocation() -&amp;gt; &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;? &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; texts = &lt;span class=&quot;type&quot;&gt;NSPasteboard&lt;/span&gt;.general().readObjects(forClasses: [&lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt;.self &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;AnyClass&lt;/span&gt;], options: &lt;span class=&quot;keyword&quot;&gt;nil&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt;? [&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;] &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; text &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; texts &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;range&lt;/span&gt; = text.&lt;span class=&quot;built_in&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;\\\\tencent&quot;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                text = convert(text.substring(&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;range&lt;/span&gt;.lowerBound))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;range&lt;/span&gt; = text.&lt;span class=&quot;built_in&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;smb://&quot;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                text = text.substring(&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;range&lt;/span&gt;.lowerBound)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; text&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åå°†å¤„ç†åçš„ URL å†™å…¥å‰ªè´´æ¿ï¼Œæ³¨æ„è¿™é‡Œå†™å…¥å‰ªè´´æ¿çš„ç±»å‹ä¸º &lt;code&gt;NSStringPboardType&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;writePasteboard&lt;/span&gt;(_ &lt;span class=&quot;attribute&quot;&gt;location&lt;/span&gt;: String) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSPasteboard&lt;span class=&quot;selector-class&quot;&gt;.general&lt;/span&gt;()&lt;span class=&quot;selector-class&quot;&gt;.declareTypes&lt;/span&gt;([NSStringPboardType], &lt;span class=&quot;attribute&quot;&gt;owner&lt;/span&gt;: nil)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;NSPasteboard&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.general&lt;/span&gt;()&lt;span class=&quot;selector-class&quot;&gt;.setString&lt;/span&gt;(location, &lt;span class=&quot;attribute&quot;&gt;forType&lt;/span&gt;: NSStringPboardType)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;æ¨¡æ‹Ÿé”®ç›˜äº‹ä»¶&quot;&gt;&lt;a href=&quot;#æ¨¡æ‹Ÿé”®ç›˜äº‹ä»¶&quot; class=&quot;headerlink&quot; title=&quot;æ¨¡æ‹Ÿé”®ç›˜äº‹ä»¶&quot;&gt;&lt;/a&gt;æ¨¡æ‹Ÿé”®ç›˜äº‹ä»¶&lt;/h2&gt;&lt;p&gt;ç”¨ Cocoa æ‰§è¡Œè„šæœ¬æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯é€šè¿‡ &lt;code&gt;NSTask&lt;/code&gt; ç±»ï¼Œå±¡è¯•ä¸çˆ½ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;simulateKeys&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; task = &lt;span class=&quot;type&quot;&gt;Process&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   task.launchPath = &lt;span class=&quot;string&quot;&gt;&quot;/usr/bin/osascript&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   task.arguments = [&lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;subst&quot;&gt;\(Bundle.main.resourcePath!)&lt;/span&gt;/simulateKeys.scpt&quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   task.launch()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;launchPath&lt;/code&gt; æ˜¯èƒ½å¤Ÿæ‰§è¡Œè„šæœ¬æ–‡ä»¶çš„ç¨‹åºè·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è§£é‡Šå™¨å’¯ã€‚å‚æ•°æ•°ç»„çš„ç¬¬ 0 ä¸ªæ˜¯è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯è„šæœ¬å†…å®¹å­—ç¬¦ä¸²ã€‚è¿™ä¸æ­£å¸¸åœ¨ terminal ä¸­æ•²å‘½ä»¤æ˜¯ä¸€æ ·çš„ã€‚å› ä¸ºæˆ‘ä»¬çš„è„šæœ¬ä¸æ¶‰åŠåˆ°æ•°æ®çš„è¾“å…¥è¾“å‡ºï¼Œæ‰€ä»¥ä»£ç æ¯”è¾ƒç®€å•ã€‚ è¿™é‡Œä½¿ç”¨ AppleScript çš„å¥½å¤„æ˜¯æ–¹ä¾¿å¿«æ·é€šä¿—æ˜“æ‡‚ï¼Œå…¶æ‹ŸäººåŒ–çš„è¯­æ³•å¾ˆæ˜¯ç”ŸåŠ¨ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;tell&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;application&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Finder&quot;&lt;/span&gt;	&lt;span class=&quot;built_in&quot;&gt;activate&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;tell&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;tell&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;application&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;System Events&quot;&lt;/span&gt;	&lt;span class=&quot;keyword&quot;&gt;tell&lt;/span&gt; process &lt;span class=&quot;string&quot;&gt;&quot;Finder&quot;&lt;/span&gt;		&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;frontmost&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;	&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;tell&lt;/span&gt;		key down command	keystroke &lt;span class=&quot;string&quot;&gt;&quot;k&quot;&lt;/span&gt;	keystroke &lt;span class=&quot;string&quot;&gt;&quot;v&quot;&lt;/span&gt;	key up command	keystroke &lt;span class=&quot;literal&quot;&gt;return&lt;/span&gt;	&lt;span class=&quot;built_in&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;	&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;the clipboard&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; null&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;tell&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘æ¥ç¿»è¯‘ä¸‹å“ˆï¼šå‘Šè¯‰ Finder èµ·æ¥å—¨ï¼Œç«™åˆ°æœ€å‰é¢ï¼æŒ‰ä½ command åˆ«æ’’æ‰‹ï¼Œæ•²ä¸ª k å†æ•²ä¸ª vï¼ŒåŠ¨æ¬¡å¤§æ¬¡ï¼æ’’æ‰‹å›è½¦ç­‰åŠç§’ï¼Œæœ€åæ¸…ç©ºå‰ªè´´æ¿ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å†™è¿™æ®µè„šæœ¬å‰æˆ‘çš„ç¡®å°±æ˜¯ç…§ç€è¿™ä¸ªèŠ‚æ‹ä¸€æ¬¡æ¬¡æ‰“å¼€è®¾è®¡å¦¹å­å’Œäº§å“å¦¹å­å‘æ¥çš„ TFS é“¾æ¥çš„ï¼ï¼ˆå½“ç„¶æ±‰å­å‘çš„æˆ‘ä¹Ÿå¾—æ‰“å¼€ï¼Œå°±æ˜¯èŠ‚æ‹æ…¢äº†è®¸å¤šï¼‰å…³é”®æ˜¯å¾—å…ˆæ‰‹åŠ¨æŠŠ URL æ ¼å¼æ”¹äº†ç„¶åå†åŠ¨æ¬¡å¤§æ¬¡ï¼Œåˆ«ææœ‰å¤šç—›è‹¦äº†~&lt;/p&gt;
&lt;h2 id=&quot;ç¼“å­˜å¸¸ç”¨é“¾æ¥&quot;&gt;&lt;a href=&quot;#ç¼“å­˜å¸¸ç”¨é“¾æ¥&quot; class=&quot;headerlink&quot; title=&quot;ç¼“å­˜å¸¸ç”¨é“¾æ¥&quot;&gt;&lt;/a&gt;ç¼“å­˜å¸¸ç”¨é“¾æ¥&lt;/h2&gt;&lt;p&gt;å”‰å§æ§½è¿™ä¹ˆç®€å•çš„äº‹å„¿ä¸€ä¸ª &lt;code&gt;NSCache&lt;/code&gt; ä¸å°±æå®šäº†ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚å®Œã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;é‚£æˆ‘è¿˜å†™å®ƒå¹²å˜›ï¼Ÿï¼&lt;/p&gt;
&lt;p&gt;å¸¸ç”¨é“¾æ¥ä¼šè®°å½•æœ€è¿‘æ‰“å¼€çš„ 5 ä¸ª TFS é“¾æ¥ï¼Œå› ä¸º &lt;code&gt;NSCache&lt;/code&gt; ä¸æ˜¯å¾ˆç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±æ‰‹åŠ¨å†™äº†ä¸ª LRU Cacheã€‚ç›¸æ¯”äº Cocoa æä¾›çš„ &lt;code&gt;NSCache&lt;/code&gt;ï¼Œæˆ‘å†™çš„è¿™ä¸ª LRU Cache æ”¯æŒéå† key å€¼ï¼Œå¹¶æ ¹æ®åœºæ™¯éœ€æ±‚åšäº†ä¸€äº›å®šåˆ¶ï¼Œæ¯”å¦‚ get æ“ä½œå¹¶ä¸ä¼šç®—ä½œä½¿ç”¨é¢‘æ¬¡ã€‚ç”¨æ³•å¾ˆç®€å•ï¼Œæ—¢å¯ä»¥å°†å…¶å½“ä¸ºæ•°ç»„æ¥è·å– keyï¼Œä¹Ÿèƒ½å½“æˆå­—å…¸ä½¿ç”¨ï¼Œé€šè¿‡ key è·å– valueã€‚å› ä¸ºæˆ‘è®©å®ƒå…¼å®¹äº†ä¸¤å¥—åè®®ï¼Œå¹¶å®ç° &lt;code&gt;SequenceType&lt;/code&gt; åè®®èƒ½å¤Ÿä½¿ç”¨ &lt;code&gt;for...in&lt;/code&gt; éå†ï¼Œè¿™äº›ç‰¹æ€§éƒ½æ˜¯ &lt;code&gt;NSCache&lt;/code&gt; æ‰€æ²¡æœ‰çš„ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè§£å†³&lt;strong&gt;æ—¢å¯ä»¥å°†å…¶å½“ä¸ºæ•°ç»„æ¥è·å– keyï¼Œä¹Ÿèƒ½å½“æˆå­—å…¸ä½¿ç”¨ï¼Œé€šè¿‡ key è·å– value&lt;/strong&gt;è¿™ä¸ªé—®é¢˜ã€‚åœ¨ &lt;code&gt;LRUCache&lt;/code&gt; å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå­—å…¸å’Œä¸€ä¸ªæ•°ç»„ï¼Œå¯¹å¤–æš´æ¼ &lt;code&gt;subscript&lt;/code&gt; æ¥å£å³å¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LRUCache&lt;/span&gt; &amp;lt;&lt;span class=&quot;title&quot;&gt;K&lt;/span&gt;:&lt;span class=&quot;title&quot;&gt;Hashable&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;V&lt;/span&gt;&amp;gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;NSCoding&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;SequenceType&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fileprivate &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; _cache = [&lt;span class=&quot;type&quot;&gt;K&lt;/span&gt;:&lt;span class=&quot;type&quot;&gt;V&lt;/span&gt;]()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fileprivate &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; _keys = [&lt;span class=&quot;type&quot;&gt;K&lt;/span&gt;]()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; countLimit:&lt;span class=&quot;type&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;subscript&lt;/span&gt;(index:&lt;span class=&quot;type&quot;&gt;Int&lt;/span&gt;) -&amp;gt; &lt;span class=&quot;type&quot;&gt;K&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _keys[index]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;subscript&lt;/span&gt;(key:&lt;span class=&quot;type&quot;&gt;K&lt;/span&gt;) -&amp;gt; &lt;span class=&quot;type&quot;&gt;V&lt;/span&gt;? &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _cache[key]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt;(obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; obj == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _cache.removeValue(forKey: key)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                useKey(key)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _cache[key] = obj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fileprivate &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;useKey&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; key: K)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; index = _keys.index(of: key) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// key å·²å­˜åœ¨æ•°ç»„ä¸­ï¼Œåªéœ€è¦å°†å…¶æŒªè‡³ index 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _keys.insert(_keys.remove(at: index), at: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;span class=&quot;comment&quot;&gt;// key ä¸å­˜åœ¨æ•°ç»„ä¸­ï¼Œéœ€è¦å°†å…¶æ’å…¥ index 0ï¼Œå¹¶åœ¨è¶…å‡ºç¼“å­˜å¤§å°é˜ˆå€¼æ—¶ç§»èµ°æœ€åé¢çš„å…ƒç´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; _keys.&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt; &amp;gt;= countLimit &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _cache.removeValue(forKey: _keys.last!)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _keys.removeLast()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _keys.insert(key, at: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;cleanCache&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _cache.removeAll()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _keys.removeAll()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;LRU ç­–ç•¥ä¸»è¦ä½“ç°åœ¨ç»´æŠ¤ &lt;code&gt;_keys&lt;/code&gt; æ•°ç»„çš„æ’åºä¸Šã€‚æ¯å½“éœ€è¦è®°å½•æŸä¸ªé”®è¢«ä½¿ç”¨æ—¶ï¼Œå°±è°ƒç”¨ &lt;code&gt;useKey:&lt;/code&gt; æ–¹æ³•å¯¹ &lt;code&gt;_keys&lt;/code&gt; å’Œ &lt;code&gt;_cache&lt;/code&gt; æ›´æ–°ã€‚å…·ä½“ç­–ç•¥æ˜¯ï¼šå¦‚æœç¼“å­˜ä¸­å·²ç»æœ‰è¿™ä¸ª key äº†ï¼Œé‚£å°±å°†å…¶ç§»åˆ° &lt;code&gt;_keys&lt;/code&gt; æ•°ç»„æœ€å‰é¢ï¼›å¦‚æœè¿™ä¸ª key æœ¬ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆéœ€è¦æŸ¥çœ‹å½“å‰ç¼“å­˜ç©ºé—´æ˜¯å¦å·²ç»å¡«æ»¡ï¼Œå¦‚æœæ²¡æœ‰å‰©ä½™ç©ºé—´å°±éœ€è¦åˆ é™¤ &lt;code&gt;_keys&lt;/code&gt; æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿å¸¦åˆ é™¤å¯¹åº” &lt;code&gt;_cache&lt;/code&gt; ä¸­å¯¹åº”çš„é”®å€¼å¯¹ï¼Œæœ€åå°†æ–°çš„ key æ’å…¥åˆ° &lt;code&gt;_keys&lt;/code&gt; æ•°ç»„æœ€å‰é¢ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘åªæƒ³åœ¨ç»™ &lt;code&gt;LRUCache&lt;/code&gt; ä½œä¸ºå­—å…¸èµ‹å€¼çš„æ—¶å€™æ‰ç®—ä½œä¸€æ¬¡â€œä½¿ç”¨â€ï¼Œæ‰€ä»¥åªåœ¨ &lt;code&gt;set&lt;/code&gt; æ–¹æ³•ä¸­è°ƒç”¨äº† &lt;code&gt;useKey:&lt;/code&gt;ã€‚å¦‚æœç»™ &lt;code&gt;LRUCache&lt;/code&gt; èµ‹ç©ºå€¼å¹¶ä¸ç®—åšä¸€æ¬¡â€œä½¿ç”¨â€ã€‚è€Œå¯¹ &lt;code&gt;LRUCache&lt;/code&gt; æ‰€æœ‰çš„å–å€¼è¡Œä¸ºéƒ½ä¸ç®—åšâ€œä½¿ç”¨â€ï¼Œå› ä¸ºä¸ºäº†æ›´æ–°ç•Œé¢ç­‰å› ç´ ï¼Œç»å¸¸ä¼šä»ç¼“å­˜ä¸­å–å€¼ï¼Œè¿™äº›å¹¶ä¸æ˜¯ç”¨æˆ·è‡ªèº«çš„æ“ä½œã€‚åªæœ‰å½“ç”¨æˆ·çœŸæ­£æ‰“å¼€æŸä¸ª URL æ—¶æ‰ç®—åšä¸€æ¬¡â€œä½¿ç”¨â€ï¼Œè€Œæ­¤æ—¶åˆšå¥½æ˜¯å¯¹ &lt;code&gt;LRUCache&lt;/code&gt; èµ‹å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ &lt;code&gt;for...in&lt;/code&gt; éå† &lt;code&gt;LRUCache&lt;/code&gt;ï¼Œéœ€è¦è®©å…¶å®ç° &lt;code&gt;SequenceType&lt;/code&gt; åè®®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Iterator&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;CacheGenerator&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;K&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;makeIterator&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;Iterator&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;CacheGenerator&lt;/span&gt;(keys:_keys)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬éå†çš„å†…å®¹æ˜¯â€œé”®â€ï¼Œæ‰€ä»¥åˆå§‹åŒ– &lt;code&gt;CacheGenerator&lt;/code&gt; æ—¶ä¼ å…¥ &lt;code&gt;_keys&lt;/code&gt;ï¼Œå¹¶åœ¨ &lt;code&gt;CacheGenerator&lt;/code&gt; å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ &lt;code&gt;counter&lt;/code&gt;ï¼Œåœ¨ &lt;code&gt;next&lt;/code&gt; æ–¹æ³•ä¸­ä»¥æ­£åºè¿”å›æ•°ç»„ä¸­çš„é”®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CacheGenerator&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;:&lt;span class=&quot;title&quot;&gt;Hashable&lt;/span&gt;&amp;gt; : &lt;span class=&quot;title&quot;&gt;IteratorProtocol&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Element&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; counter: &lt;span class=&quot;type&quot;&gt;Int&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; array:[&lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;(keys:[&lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        counter = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        array = keys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;Element&lt;/span&gt;? &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; result:&lt;span class=&quot;type&quot;&gt;Element&lt;/span&gt;? = counter &amp;lt; array.&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt; ? array[counter] : &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        counter += &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜ &lt;code&gt;counter&lt;/code&gt; çš„å˜åŒ–è§„åˆ™æ¥å®ç°é€†åºã€ä¹±åºéå†ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä¸ºäº†èƒ½è®© &lt;code&gt;LRUCache&lt;/code&gt; é€šè¿‡ &lt;code&gt;NSUserDefaults&lt;/code&gt; æŒä¹…åŒ–å†™å…¥æœ¬åœ°ï¼Œè¿˜éœ€è¦å®ç° &lt;code&gt;NSCoding&lt;/code&gt; åè®®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// NSCoding&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@objc&lt;/span&gt; required init?(coder aDecoder: NSCoder) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   _keys = aDecoder.decodeObject(&lt;span class=&quot;string&quot;&gt;forKey:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;keys&quot;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt;! [K]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   _cache = aDecoder.decodeObject(&lt;span class=&quot;string&quot;&gt;forKey:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;cache&quot;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt;! [&lt;span class=&quot;string&quot;&gt;K:&lt;/span&gt;V]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@objc&lt;/span&gt; func encode(with &lt;span class=&quot;string&quot;&gt;aCoder:&lt;/span&gt; NSCoder) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   aCoder.encode(_keys, &lt;span class=&quot;string&quot;&gt;forKey:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;keys&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   aCoder.encode(_cache, &lt;span class=&quot;string&quot;&gt;forKey:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;cache&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ç™»é™†æ—¶å¯åŠ¨&quot;&gt;&lt;a href=&quot;#ç™»é™†æ—¶å¯åŠ¨&quot; class=&quot;headerlink&quot; title=&quot;ç™»é™†æ—¶å¯åŠ¨&quot;&gt;&lt;/a&gt;ç™»é™†æ—¶å¯åŠ¨&lt;/h2&gt;&lt;p&gt;Mac å¼€å‘å¼€æœºå¯åŠ¨æœ‰å¥½å‡ ç§æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&quot;http://www.tanhao.me/talk/1287.html/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Mac OSXçš„å¼€æœºå¯åŠ¨é…ç½®&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸è¿‡å¯¹äº Swift å¼€å‘ Mac Appï¼Œæˆ‘æ›´æ¨è&lt;a href=&quot;https://theswiftdev.com/2015/09/17/first-os-x-tutorial-how-to-launch-an-os-x-app-at-login/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;ï¼Œå…¶ç­–ç•¥æ˜¯å°† App æ·»åŠ ä¸ºå¯åŠ¨é¡¹ã€‚åŸç†æ˜¯é€šè¿‡ &lt;code&gt;SMLoginItemSetEnabled&lt;/code&gt; æ–¹æ³•åœ¨ä¸»åº”ç”¨çš„ &lt;code&gt;Contents/Library/LoginItems&lt;/code&gt; æ–‡ä»¶å¤¹å»ºç«‹ä¸€ä¸ªåå°è¾…åŠ©åº”ç”¨æ¥å¯åŠ¨ä¸»åº”ç”¨ï¼Œå¦‚æœä¸»åº”ç”¨å·²å¯åŠ¨åå°±ä¼šç»ˆæ­¢åå°åº”ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;UI&quot;&gt;&lt;a href=&quot;#UI&quot; class=&quot;headerlink&quot; title=&quot;UI&quot;&gt;&lt;/a&gt;UI&lt;/h2&gt;&lt;p&gt;ä¸ºäº†è®©è¿™ä¸ª App çš®å®è€æ“ï¼Œæˆ‘å†³å®šè¿˜æ˜¯ä¸ç”»ä¸»é¡µé¢ï¼Œè®©å…¶é™„ç€åœ¨èœå•æ å§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/yulingtianxia/TFSHelper/master/image/screenshot.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å°† plist æ–‡ä»¶ä¸­ &lt;code&gt;Application is background only&lt;/code&gt; è®¾ä¸º &lt;code&gt;YES&lt;/code&gt; å°±ä¸ä¼šè®©åº”ç”¨å‡ºç°åœ¨ Dock ä¸Šäº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ·»åŠ èœå•å¾ˆå®¹æ˜“æ²¡å•¥å¥½è¯´çš„ï¼Œéœ€è¦æ³¨æ„çš„é€»è¾‘æ˜¯åœ¨èœå•æ˜¾ç¤ºå‰å…ˆéªŒè¯å‰ªè´´æ¿é“¾æ¥æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç„¶åå†³å®šæ˜¯å¦æ˜¾ç¤ºâ€œæ‰“å¼€é“¾æ¥â€æŒ‰é’®ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰å¼€å…³è®¾ç½®éƒ½ä¼šé€šè¿‡ &lt;code&gt;NSUserDefaults&lt;/code&gt; æŒä¹…åŒ–å†™å…¥æœ¬åœ°ï¼Œç¬¬ä¸€æ¬¡åŠ è½½åº”ç”¨éœ€è¦ä»æœ¬åœ°è¯»å–ï¼Œç„¶åæ›´æ–°ç•Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;â€œå¸¸ç”¨é“¾æ¥â€é‡Œé¢çš„â€œæ¸…ç©ºåˆ—è¡¨â€æŒ‰é’®åœ¨æ²¡æœ‰é“¾æ¥ç¼“å­˜çš„æ—¶å€™éœ€è¦è®¾ä¸ºä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è‡ªåŠ¨-VS-æ‰‹åŠ¨&quot;&gt;&lt;a href=&quot;#è‡ªåŠ¨-VS-æ‰‹åŠ¨&quot; class=&quot;headerlink&quot; title=&quot;è‡ªåŠ¨ VS æ‰‹åŠ¨&quot;&gt;&lt;/a&gt;è‡ªåŠ¨ VS æ‰‹åŠ¨&lt;/h2&gt;&lt;p&gt;åœ¨è®¾è®¡äº§å“æ—¶æ›¾ç»çº ç»“æ˜¯åº”è¯¥è‡ªåŠ¨æ‰“å¼€é“¾æ¥è¿˜æ˜¯è®©ç”¨æˆ·æ¯æ¬¡æ‰‹åŠ¨æ‰“å¼€ã€‚æ¯ç§é€‰æ‹©éƒ½æœ‰è‡ªå·±çš„ç†ç”±ï¼Œä½†å¦‚æœç”¨æˆ·ä»…æ˜¯æƒ³å¤åˆ¶æŸä¸ª TFS é“¾æ¥å‘ç»™åˆ«äººï¼Œè‡ªåŠ¨æ‰“å¼€é“¾æ¥ä½“éªŒä¼šå¾ˆç³Ÿç³•ï¼›å¦‚æœæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨ç‚¹å‡»â€œæ‰“å¼€é“¾æ¥â€æŒ‰é’®ï¼Œåˆæä¸ºä¸ä¾¿ã€‚ä¸ºäº†æŠ˜è¡·ï¼Œä¾¿æä¾›äº†ä¸ªå¼€å…³ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªåŠ¨æ‰“å¼€é“¾æ¥çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨å®šæ—¶å™¨å¾ªç¯å¤„ç†å‰ªè´´æ¿å†…å®¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Timer&lt;/span&gt;.scheduledTimer(timeInterval: &lt;span class=&quot;number&quot;&gt;0.25&lt;/span&gt;, target: &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, selector: #selector(&lt;span class=&quot;type&quot;&gt;AppDelegate&lt;/span&gt;.pollPasteboard(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;:)), userInfo: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, repeats: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;pollPasteboard&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; timer: Timer)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !autoCatch &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; currentChangeCount = &lt;span class=&quot;type&quot;&gt;NSPasteboard&lt;/span&gt;.general().changeCount&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; currentChangeCount == previousChangeCount &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   handlePasteboard()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸ºäº†é¿å…å‰ªè´´æ¿å†…å®¹ä¸å˜æ—¶çš„é‡å¤å¤„ç†ï¼Œ&lt;code&gt;handlePasteboard&lt;/code&gt; å‡½æ•°è®°å½•äº†ä¸Šæ¬¡çš„ &lt;code&gt;changeCount&lt;/code&gt;ï¼Œæ¯æ¬¡å‰ªè´´æ¿è¢«æ›´æ–°æ—¶å®ƒä¼šé€’å¢ï¼Œåˆå§‹ä¸º 0ã€‚è¿™æ ·æ¯æ¬¡åˆ¤æ–­ä¸‹ &lt;code&gt;changeCount&lt;/code&gt; æ˜¯å¦è·Ÿä¸Šæ¬¡æœ‰å˜åŒ–å³å¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;func handlePasteboard() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; let result = catchTFSLocation() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        recentUseLinks[result] = URL(fileURLWithPath: result)&lt;span class=&quot;selector-class&quot;&gt;.pathComponents&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.last&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        writePasteboard(result)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DistributedNotificationCenter.default().post(name: Notification.Name(&lt;span class=&quot;string&quot;&gt;&quot;simulateKeys&quot;&lt;/span&gt;), &lt;span class=&quot;selector-tag&quot;&gt;object&lt;/span&gt;: Bundle&lt;span class=&quot;selector-class&quot;&gt;.main&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.bundleIdentifier&lt;/span&gt;!)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    previousChangeCount = NSPasteboard.general()&lt;span class=&quot;selector-class&quot;&gt;.changeCount&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰‹åŠ¨æ‰“å¼€é“¾æ¥æ›´ç®€å•äº†ï¼Œç›´æ¥è°ƒç”¨ &lt;code&gt;handlePasteboard&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h1&gt;&lt;p&gt;è¯¸å¦‚ UI ä¸Šä¸€äº›ç»†èŠ‚å®ç°å°±ä¸å™è¿°äº†ï¼Œæ¯”å¦‚åœ¨æ˜¾ç¤ºå¸¸ç”¨é“¾æ¥æ—¶æˆ‘åªæ˜¾ç¤ºäº†è·¯å¾„çš„æœ€åä¸€æ®µæ–‡å­—ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼Œå¦åˆ™é“¾æ¥è¿‡é•¿å½±åƒä½“éªŒã€‚å› ä¸ºæˆ‘æ˜¯ä¸º TFS æ ¼å¼é‡èº«å®šåˆ¶çš„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹æˆ‘æºç ä¸­çš„åŒ¹é…è§„åˆ™æ¥ä¸ºä½ è‡ªå·±æ‰€ç”¨ã€‚Github é“¾æ¥ï¼š&lt;a href=&quot;https://github.com/yulingtianxia/TFSHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/TFSHelper&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;å·¥ä½œæ—¶ç»å¸¸ä¼šæ”¶åˆ°åŒäº‹å‘æ¥çš„ä¸€äº›é“¾æ¥ï¼Œæœ‰çš„å¸¦ç©ºæ ¼çš„é“¾æ¥ä¼šæ–­å¼€ï¼Œä¸èƒ½ç›´æ¥ç‚¹å‡»æŸ¥çœ‹ï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶å®Œæ•´é“¾æ¥å¹¶ç²˜è´´æŸ¥çœ‹ã€‚æ‰€ä»¥æˆ‘åšäº†ä¸ª Mac ç³»ç»Ÿä¸Šçš„ URL è¾…åŠ©å·¥å…·ï¼Œåœ¨å¤åˆ¶ URL æ—¶è‡ªåŠ¨å°†å…¶æ‰“å¼€ã€‚è¿˜å®ç°ç¼“å­˜å¸¸ç”¨é“¾æ¥ã€è‡ªåŠ¨/æ‰‹åŠ¨è¿æ¥åˆ‡æ¢ã€ç™»å½•æ—¶å¯åŠ¨ç­‰åŠŸèƒ½ã€‚å¼€å‘è¯­è¨€ä¸º Swift 3 å’Œ AppleScriptã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Swift" scheme="http://yulingtianxia.com/tags/Swift/"/>
    
      <category term="macOS" scheme="http://yulingtianxia.com/tags/macOS/"/>
    
      <category term="Algorithm" scheme="http://yulingtianxia.com/tags/Algorithm/"/>
    
      <category term="AppleScript" scheme="http://yulingtianxia.com/tags/AppleScript/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•è‡ªåˆ¶ä¸€æ¬¾å¯»æ‰¾ç›¸ä¼¼å›¾ç‰‡çš„ Mac å·¥å…·</title>
    <link href="http://yulingtianxia.com/blog/2016/01/17/search-for-similar-images/"/>
    <id>http://yulingtianxia.com/blog/2016/01/17/search-for-similar-images/</id>
    <published>2016-01-17T07:13:18.000Z</published>
    <updated>2016-08-27T03:30:16.000Z</updated>
    
    <content type="html">&lt;p&gt;è¿™å‘¨èŠ±äº†ä¸€å¤©åŠçš„æ—¶é—´åšäº†ä¸ª Mac OS X ä¸Šçš„å°å·¥å…·ï¼Œç”¨æ¥æŸ¥æ‰¾ç›¸ä¼¼å†…å®¹çš„å›¾ç‰‡ã€‚èµ·å› æ˜¯å…¬å¸çš„ iOS é¡¹ç›®ä¸­å·²æœ‰çš„å›¾ç‰‡ç®¡ç†æ··ä¹±ï¼Œæœ‰äº›å›¾ç‰‡æ–‡ä»¶åä¸è§„èŒƒï¼Œè¿˜æœ‰ä¸€äº›å†…å®¹é‡å¤ä½†æ–‡ä»¶åä¸åŒçš„å›¾ç‰‡ã€‚ç°åœ¨è§†è§‰è¦ç»™å‡ºä¸€äº› 3x åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œå¦‚ä½•ä¸å·²æœ‰çš„ä½åˆ†è¾¨ç‡å›¾ç‰‡åŒ¹é…ï¼Œè¿™åˆæ˜¯ä¸ªé—®é¢˜ã€‚äººå·¥ä¸€ä¸ªä¸ªå»æ‰¾å›ºç„¶å¥½ï¼Œä½†è¿™ç§æŠ€æœ¯å«é‡ä½çš„ä½“åŠ›æ´»å¾ˆæµªè´¹ç²¾åŠ›å’Œæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;Github åœ°å€ï¼š&lt;a href=&quot;https://github.com/yulingtianxia/SimilarImageHunter&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/SimilarImageHunter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20160117-2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;æœ€æ–° Release ä¸‹è½½ï¼š&lt;a href=&quot;https://github.com/yulingtianxia/SimilarImageHunter/releases&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/SimilarImageHunter/releases&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å¼€å‘çš„è¿™æ¬¾å·¥å…·å¯ä»¥åœ¨ç›®æ ‡è·¯å¾„ä¸­æ‰¾å‡ºä¸åŸå§‹è·¯å¾„ä¸­å›¾ç‰‡æœ€ä¸ºç›¸ä¼¼çš„å›¾ç‰‡ã€‚å¦‚æœç›®æ ‡è·¯å¾„ä¸­æœ‰å¤šå¼ å›¾ç‰‡ç›¸ä¼¼åº¦ç›¸åŒä¸”æœ€å¤§ï¼Œè¿™äº›å›¾ç‰‡éƒ½ä¼šè¢«åˆ—å‡ºæ¥ã€‚æ ‘å½¢åˆ—è¡¨ç¬¬ä¸€åˆ—çš„çˆ¶èŠ‚ç‚¹å†…å®¹ä¸ºåŸå§‹è·¯å¾„ä¸­çš„å›¾ç‰‡ï¼Œå­èŠ‚ç‚¹ä¸ºç›®æ ‡è·¯å¾„ä¸­åŒ¹é…åˆ°çš„æœ€ä½³ç›¸ä¼¼å†…å®¹å›¾ç‰‡ã€‚åˆ—è¡¨ç¬¬äºŒåˆ—ä¸ºç›¸ä¼¼åº¦ã€‚åŒå‡»å›¾ç‰‡è·¯å¾„å³å¯æ‰“å¼€è¯¥å›¾ç‰‡ã€‚ç‚¹å‡» â€œHUNTâ€ æŒ‰é’®å¼€å§‹å¯»æ‰¾ç›¸ä¼¼å›¾ç‰‡ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¤„ç†å›¾ç‰‡ä¿¡æ¯è€—æ—¶è¾ƒé•¿ï¼Œå¯åœ¨ä¸­é€”ç‚¹å‡» â€œCANCELâ€ æŒ‰é’®å–æ¶ˆå½“å‰ä»»åŠ¡ã€‚â€œCLEARâ€ æŒ‰é’®åˆ™å¯æ¸…é™¤å½“å‰ç•Œé¢ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è·å–å›¾ç‰‡è·¯å¾„&quot;&gt;&lt;a href=&quot;#è·å–å›¾ç‰‡è·¯å¾„&quot; class=&quot;headerlink&quot; title=&quot;è·å–å›¾ç‰‡è·¯å¾„&quot;&gt;&lt;/a&gt;è·å–å›¾ç‰‡è·¯å¾„&lt;/h2&gt;&lt;p&gt;å› ä¸ºä¼šä¸€ç‚¹ shellï¼Œæ‰€ä»¥ç¬¬ä¸€ååº”æ˜¯ä¸€è¡Œè„šæœ¬ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight xl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;find $&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; -&lt;span class=&quot;keyword&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;*.jpg&#39;&lt;/span&gt; -&lt;span class=&quot;built_in&quot;&gt;or&lt;/span&gt; -&lt;span class=&quot;keyword&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;*.png&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥ä¸‹æ¥ç”¨ &lt;code&gt;NSTask&lt;/code&gt; è·‘è„šæœ¬å¤ª esay å°±ä¸ç»†è¯´äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç®—æ³•å®ç°&quot;&gt;&lt;a href=&quot;#ç®—æ³•å®ç°&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•å®ç°&quot;&gt;&lt;/a&gt;ç®—æ³•å®ç°&lt;/h2&gt;&lt;h3 id=&quot;AspectRatio&quot;&gt;&lt;a href=&quot;#AspectRatio&quot; class=&quot;headerlink&quot; title=&quot;AspectRatio&quot;&gt;&lt;/a&gt;AspectRatio&lt;/h3&gt;&lt;p&gt;å› ä¸ºä¸ç”¨è€ƒè™‘ä¸€å¼ å›¾ç‰‡åŒ…å«å¦ä¸€å¼ å›¾ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œæ­¤å¤„çš„åœºæ™¯æ˜¯å¯»æ‰¾å†…å®¹ç›¸åŒåˆ†è¾¨ç‡ä¸åŒçš„å›¾ç‰‡ï¼Œæ‰€ä»¥æ¯”è¾ƒå›¾ç‰‡çš„å®½é«˜æ¯”è‡ªç„¶æ˜¯ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ã€‚åœ¨ç›¸ä¼¼åº¦çš„è®¡ç®—ä¸Šï¼Œæˆ‘è®¾å®šå®½é«˜æ¯”çš„ç›¸ä¼¼åº¦æƒé‡å åˆ°æ€»ä½“ç›¸ä¼¼åº¦çš„30%ã€‚ï¼ˆè¿™ä¸ªé˜ˆå€¼ä»¥åå¯èƒ½è¿˜ä¼šè°ƒæ•´ï¼‰&lt;/p&gt;
&lt;h3 id=&quot;åƒç´ -RGBA-ä¿¡æ¯&quot;&gt;&lt;a href=&quot;#åƒç´ -RGBA-ä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;åƒç´  RGBA ä¿¡æ¯&quot;&gt;&lt;/a&gt;åƒç´  RGBA ä¿¡æ¯&lt;/h3&gt;&lt;p&gt;æŠŠä¸åŒæ ¼å¼çš„å›¾ç‰‡è§£å‹æˆä½å›¾ï¼Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰åƒç´ æœ€åŸå§‹çš„ä¿¡æ¯ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„è‰²å½©ç©ºé—´æ˜¯ RGBAï¼Œæ¯ä¸ªåƒç´ ç”¨ 32 bit å¤§ç«¯æ¨¡å¼å­˜å‚¨ã€‚ç„¶åç»Ÿè®¡æ¯ç§é¢œè‰²(RGBA)çš„åƒç´ æ•°é‡ï¼Œå¹¶è®¡ç®—å…¶å åƒç´ æ€»æ•°çš„æ¯”ä¾‹ã€‚æ¯”è¾ƒä¸¤å¼ å›¾ç‰‡ç›¸åŒé¢œè‰²åƒç´ æ¯”ä¾‹çš„å·®å¼‚å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;åƒç´ ä½ç½®ä¿¡æ¯&quot;&gt;&lt;a href=&quot;#åƒç´ ä½ç½®ä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;åƒç´ ä½ç½®ä¿¡æ¯&quot;&gt;&lt;/a&gt;åƒç´ ä½ç½®ä¿¡æ¯&lt;/h3&gt;&lt;p&gt;å…‰æœ‰é¢œè‰²ä¿¡æ¯è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæœ‰ä¸€äº›å›¾ç‰‡å¯èƒ½å®½é«˜æ¯”ç›¸ä¼¼ï¼Œå¤§ä½“çš„è‰²å½©ä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯ç›¸åŒé¢œè‰²çš„åƒç´ æ’åˆ—å´ä¸ä¸€æ ·ã€‚æ‰€ä»¥ä¹Ÿéœ€è¦è€ƒè™‘åˆ°æ¯ä¸ªåƒç´ æ‰€å¤„å›¾ç‰‡ä¸­çš„ä½ç½®ã€‚è¿™ä¸ªä½ç½®ä¿¡æ¯ä¹Ÿæ˜¯é‡‡ç”¨æ¯”ä¾‹çš„æ–¹å¼æ¥è®¡ç®—ï¼Œè€Œä¸æ˜¯åƒç´ åˆ°åŸç‚¹çš„ç»å¯¹è·ç¦»ã€‚&lt;strong&gt;æŠŠåƒç´ ä½ç½®ä¿¡æ¯åŠ å…¥åˆ°æ¯”è¾ƒé¢œè‰²ç›¸ä¼¼åº¦çš„è¿‡ç¨‹ä¸­ï¼Œå¤§å¤§æå‡äº†å‡†ç¡®åº¦ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;æ„é€ æŒ‡çº¹å‘é‡&quot;&gt;&lt;a href=&quot;#æ„é€ æŒ‡çº¹å‘é‡&quot; class=&quot;headerlink&quot; title=&quot;æ„é€ æŒ‡çº¹å‘é‡&quot;&gt;&lt;/a&gt;æ„é€ æŒ‡çº¹å‘é‡&lt;/h3&gt;&lt;p&gt;åœ¨å®é™…ç»Ÿè®¡ä¸­ä¼šå‘ç°ä½¿ç”¨åŸå§‹çš„ â€œRGBA+åƒç´ ä½ç½®â€ ä¿¡æ¯å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç»Ÿè®¡ç»“æœæ›´åŠ åˆ†æ•£ã€‚æ›´è‡´å‘½çš„æ˜¯åœ¨å®éªŒä¸­æˆ‘å°è¯•è°ƒæ•´äº†ä¸€å¼ å›¾ç‰‡çš„å°ºå¯¸åï¼Œå…¶è‰²å½©ç©ºé—´ä¹Ÿå‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ã€‚æ¯”å¦‚åŸå›¾åªæœ‰ 100 ç§ RGBA å€¼ï¼Œè€Œå¤„ç†åçš„å›¾ç‰‡åˆ™æœ‰ 1000 ç§ RGBA å€¼ï¼è™½ç„¶è‚‰çœ¼ä¸Šçœ‹èµ·æ¥ä¸¤å¼ å›¾ç‰‡å†…å®¹ä¸€æ ·ï¼Œä½†å®é™…ä¸Šåè€…å´æœ‰å¾ˆå¤šé¢œè‰²ç›¸ä¼¼çš„åƒç´ è¢«åˆ†æ•£å¼€äº†ï¼Œè€Œåœ¨æ¯”è¾ƒç›¸åŒé¢œè‰²çš„åƒç´ æ¯”ä¾‹æ—¶ï¼Œå› ä¸ºåè€…çš„åƒç´ æ•°é‡è¢«ç¨€é‡Šæˆäº†å¤šç§ç›¸ä¼¼çš„é¢œè‰²ï¼Œä½¿å¾—è®¡ç®—åçš„ç›¸ä¼¼åº¦å¤§å¹…é™ä½ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥éœ€è¦å°†ç›¸ä¼¼é¢œè‰²çš„åƒç´ å½’ä¸ºä¸€ç±»ï¼ŒRGBA å››ä¸ªé€šé“å…± 32 bitï¼Œæ¯ä¸ªé€šé“å  8 bitï¼Œæ•°å€¼èŒƒå›´æ˜¯ 0~127ï¼Œæˆ‘å°†å…¶åˆ’åˆ†ä¸º 8 ä¸ªåŒºé—´ï¼Œè¿™æ ·æ€»å…±åªæœ‰ 8^4 ä¸ªç»„åˆï¼ˆè¦çŸ¥é“è¿™åœ¨ç®€åŒ–ä¹‹å‰å¯æ˜¯ 2^32 ä¸ªç»„åˆï¼ï¼‰ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;#define&lt;/span&gt; Mask8(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) ( (&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) &amp;amp; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;xFF )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;#define&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) ( Mask8(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;#define&lt;/span&gt; G(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) ( Mask8(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt; ) )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;#define&lt;/span&gt; B(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) ( Mask8(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;) )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;#define&lt;/span&gt; A(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;) ( Mask8(&lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;) )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(UInt32)fingerprintOfColor:(UInt32)color&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [self areaOfComponent:&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;(color)]*&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;+[self areaOfComponent:G(color)]*&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;+[self areaOfComponent:B(color)]*&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;+[self areaOfComponent:A(color)]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(UInt32)areaOfComponent:(UInt32)component&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; component/&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åƒç´ çš„ä½ç½®ä¿¡æ¯ä¹ŸåŒæ ·éœ€è¦ç®€åŒ–ï¼Œæˆ‘é‡‡ç”¨ 9 å®«æ ¼çš„æ–¹æ¡ˆï¼šå³å°†å›¾ç‰‡æŒ‰æ¯”ä¾‹åˆ’åˆ†æˆä¹å®«æ ¼ï¼Œå¹¶å°†æ¯ä¸ªæ–¹æ ¼ä» 1 åˆ° 9æ ‡è®°ã€‚è¿™æ ·å°±ç›´æ¥æŠŠåƒç´ çš„ä½ç½®æ¯”ä¾‹ç®€åŒ–ä¸ºä¸¤ä¸ªæ•°å­—ï¼ˆx å’Œ yï¼‰ï¼Œåªæœ‰ 9^2 ä¸ªç»„åˆï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(UInt32)areaOfX:(NSUInteger)x y:(NSUInteger)y width:(NSUInteger)width height:(NSUInteger)height&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UInt32 &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (x&amp;lt;=width/&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;+=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (x&amp;lt;=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;*width/&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;+=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;+=&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (y&amp;lt;=height/&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;+=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (y&amp;lt;=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;*height/&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;+=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;+=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ€åå°†ä¸¤è€…ç›¸ç»“åˆï¼Œæ„é€ ä¸€ä¸ªå¤šç»´å‘é‡ï¼Œ&lt;code&gt;pixels&lt;/code&gt; ä¸ºæŒ‡å‘å›¾ç‰‡åƒç´ æ•°ç»„ RGBA ä¿¡æ¯çš„ &lt;code&gt;UInt32&lt;/code&gt; ç±»å‹æŒ‡é’ˆï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *,&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *&amp;gt; *pixelBucket = [&lt;span class=&quot;built_in&quot;&gt;NSMutableDictionary&lt;/span&gt; dictionary];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; * currentPixel = pixels;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; j = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j &amp;lt; height; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; width; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; color = *currentPixel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; fingerprint = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; fingerprintOfColor:color]*&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;+[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; areaOfX:i y:j width:width height:height];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       pixelBucket[@(fingerprint)] = @(pixelBucket[@(fingerprint)].intValue+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       currentPixel++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;free(pixels);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[pixelBucket enumerateKeysAndObjectsUsingBlock:^(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; * _Nonnull key, &lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; * _Nonnull obj, &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; * _Nonnull stop) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   pixelBucket[key] = @(obj.doubleValue/(height * width));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;pixelBucket&lt;/code&gt; æœ€å¤šæœ‰ 8^4*9^2 ä¸ªé”®å€¼å¯¹ï¼Œä¹Ÿå°±æ˜¯æŒ‡çº¹å‘é‡æœ€å¤§çš„ç»´åº¦ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è®¡ç®—å‘é‡ç›¸ä¼¼æ€§&quot;&gt;&lt;a href=&quot;#è®¡ç®—å‘é‡ç›¸ä¼¼æ€§&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç®—å‘é‡ç›¸ä¼¼æ€§&quot;&gt;&lt;/a&gt;è®¡ç®—å‘é‡ç›¸ä¼¼æ€§&lt;/h3&gt;&lt;p&gt;è¿™é‡Œæˆ‘é‡‡ç”¨äº†å‘é‡çš„&lt;a href=&quot;https://zh.wikipedia.org/wiki/ä½™å¼¦ç›¸ä¼¼æ€§&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä½™å¼¦ç›¸ä¼¼æ€§&lt;/a&gt;ï¼šè®¡ç®—ç»“æœè¶Šæ¥è¿‘äº 1ï¼Œä¸¤å¼ å›¾ç‰‡å†…å®¹è¶Šç›¸ä¼¼ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;__block double similarityOfPixelVector = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__block double targetRank = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__block double sourceRank = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[sourcePixelVector enumerateKeysAndObjectsUsingBlock:^(NSNumber * _Nonnull key, NSNumber * _Nonnull obj, BOOL * _Nonnull stop) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   NSNumber *targetObj = targetPixelVector[key]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   if (targetObj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       similarityOfPixelVector += obj.doubleValue*targetObj.doubleValue&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   sourceRank += obj.doubleValue * obj.doubleValue&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sourceRank = sqrt(sourceRank)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[targetPixelVector enumerateKeysAndObjectsUsingBlock:^(NSNumber * _Nonnull key, NSNumber * _Nonnull obj, BOOL * _Nonnull stop) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   targetRank += obj.doubleValue * obj.doubleValue&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;targetRank = sqrt(targetRank)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;similarityOfPixelVector = similarityOfPixelVector/(sourceRank*targetRank)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‡‡ç”¨ä½™å¼¦ç›¸ä¼¼æ€§çš„ä¸»è¦åŸå› æ˜¯æˆ‘å®ƒçš„ç»“æœèŒƒå›´æ˜¯ 0~1ï¼Œè€Œä¸”å‘é‡è¶Šç›¸ä¼¼ç»“æœè¶Šæ¥è¿‘äº 1ï¼Œåˆšå¥½æ»¡è¶³æˆ‘çš„è®¡ç®—è¦æ±‚ã€‚è€Œæ¬§æ°è·ç¦»å’Œæ°å¡å¾·ç›¸ä¼¼æ€§åº¦é‡éƒ½ä¸å¤ªæ»¡è¶³æˆ‘çš„è®¡ç®—æ–¹æ³•ä¸Šçš„è¦æ±‚ã€‚ä½™å¼¦ç›¸ä¼¼æ€§æœ‰ä¸ªç¼ºç‚¹å°±æ˜¯åªèƒ½æ¯”è¾ƒå‘é‡çš„è§’åº¦ï¼Œè€Œä¸èƒ½æ¯”è¾ƒè·ç¦»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ä¸ªå‘é‡è§’åº¦å›ºå®šåï¼Œé•¿åº¦è‹¥æœ‰å˜åŒ–ï¼Œå‘é‡æœ«ç«¯çš„ç»å¯¹è·ç¦»ï¼ˆä¹Ÿå°±æ˜¯æ¬§æ°è·ç¦»ï¼‰ä¹Ÿä¼šå˜ï¼Œä½†ä½™å¼¦ç›¸ä¼¼æ€§ä¸å˜ã€‚ä½†è¿™åœ¨æœ¬ä¾‹ä¸­æ°å·§å…‹æœäº†è¿™ä¸ªç¼ºç‚¹ã€‚å› ä¸ºå›¾ç‰‡æŒ‡çº¹å‘é‡æ‰€æœ‰ç»´åº¦çš„å€¼ä¹‹å’Œä¸º 1ï¼Œä¹Ÿå°±æ˜¯è¯´å‘é‡çš„æ–¹å‘å›ºå®šåï¼Œé•¿åº¦ä¹Ÿå°±å›ºå®šäº†ã€‚å¦‚æœä½ è¿˜ä¸æ‡‚ï¼Œçœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚å°†é—®é¢˜ç®€åŒ–åˆ°ä¸‰ç»´ç©ºé—´ï¼Œæ‰€æœ‰ä¸‰ç»´å‘é‡èµ·ç‚¹éƒ½æ˜¯åŸç‚¹ï¼Œç»ˆç‚¹éƒ½åœ¨ç»¿è‰²å¹³é¢ä¸Šï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20160117-3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ€åçš„å›¾ç‰‡ç›¸ä¼¼æ€§ç»“åˆäº†é•¿å®½æ¯”ç›¸ä¼¼æ€§ä¸æŒ‡çº¹å‘é‡ç›¸ä¼¼æ€§ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight lisp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;double similarityOfAspectRatio = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;-fabs(&lt;span class=&quot;name&quot;&gt;sourceAspectRatio-targetAspectRatio&lt;/span&gt;)/sourceAspectRatio&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;result = similarityOfAspectRatio*weightOfAspectRatio + similarityOfPixelVector*(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;-weightOfAspectRatio)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œçš„ &lt;code&gt;similarityOfAspectRatio&lt;/code&gt; å¯èƒ½ä¸ºè´Ÿå€¼ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä¸€æ—¶ç–å¿½ï¼Œè€Œæ˜¯æœ‰æ„ä¸ºä¹‹ï¼šæˆ‘çš„åˆè¡·æ˜¯æƒ³åŒ¹é…è§†è§‰æä¾›çš„ä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡ç´ æï¼Œå¦‚æœè¿é•¿å®½æ¯”éƒ½å·®å¾ˆå¤šï¼Œé‚£ç»é€¼ä¸æ˜¯æˆ‘è¦çš„ç»“æœã€‚é‚£ä¸ºä½•æˆ‘ä¸ç›´æ¥åŠ ä¸ªåˆ¤æ–­ï¼Œå¦‚æœé•¿å®½æ¯”ä¸ä¸€æ ·ï¼Œå°±ç›´æ¥åˆ¤æ–­ä¸ç¬¦åˆè¦æ±‚ï¼Œç›´æ¥ pass å‘¢ï¼Ÿè¿™é‡ŒåŸå› æœ‰äºŒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘æ›¾ç»å‘ç°è¿‡è§†è§‰åˆ‡å›¾çš„åƒç´ å°ºå¯¸ä¸ç²¾ç¡®ï¼Œå°¤å…¶æ˜¯å°å›¾ã€‚ç”šè‡³è¿˜å‘ç°è¿‡æœ¬åº”æ˜¯æ­£æ–¹å½¢çš„å›¾ï¼Œé•¿å’Œå®½ç«Ÿç„¶ä¸ç›¸åŒã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦å®¹é”™ï¼Œè®¡ç®—é•¿å®½æ¯”çš„ç›¸ä¼¼åº¦ï¼Œå³ä¾¿æˆ‘æƒ³è¦çš„ç»“æœç†è®ºä¸Šåº”è¯¥ç›¸åŒï¼Œè€Œä¸æ˜¯ç›¸ä¼¼ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ç»™å‡ºä¸¤å¼ å›¾ç‰‡çš„ç›¸ä¼¼åº¦ï¼Œéœ€è¦æœ‰ä¸ªå…¨é¢çš„åˆ†æï¼Œå…‰ç”¨é•¿å®½æ¯”å¾—ä¸å‡ºæ•°æ®ã€‚è¿™ç‚¹åˆä¸åˆè¡·è¿èƒŒï¼Œç‰ºç‰²äº†æ•ˆç‡ï¼Œåªä¸ºäº†æœ€åç»™å‡ºç»“æœè£…ä¸ªé€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;UI-å®ç°&quot;&gt;&lt;a href=&quot;#UI-å®ç°&quot; class=&quot;headerlink&quot; title=&quot;UI å®ç°&quot;&gt;&lt;/a&gt;UI å®ç°&lt;/h2&gt;&lt;p&gt;æˆ‘å¯¹ Cocoa ä¹Ÿä¸ç†Ÿï¼Œè‡ªç„¶ä¼šè¸©ä¸€äº›å‘çš„ã€‚å…¶ä¸­ä¸»è¦æ˜¯ä¸ºäº†å±•ç°æ ‘å½¢åˆ—è¡¨è€Œè¸©äº† &lt;code&gt;NSOutlineView&lt;/code&gt; çš„å‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;NSOutlineView&lt;/code&gt; çš„æ•°æ®æ¥æºï¼š&lt;a href=&quot;http://stackoverflow.com/questions/6664898/nsoutlineview-example&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æç®€æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/7533682/nstableview-only-displaying-table-view-cell&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSTableView only displaying â€œTable View Cellâ€&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åŒå‡»æ–‡ä»¶è·¯å¾„åè‡ªåŠ¨æ‰“å¼€å›¾ç‰‡ï¼Œä½¿ç”¨ &lt;code&gt;NSWorkspace&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ç”¨å†…å­˜ç¼“å­˜ä¸Šæ¬¡è®¡ç®—çš„æŒ‡çº¹å‘é‡ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘ä¸‹æ¬¡ UI çš„æ›´æ–°æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æ¯›ç»ç’ƒæ•ˆæœã€åå°å¼‚æ­¥ä»»åŠ¡ã€Autolayout ä¹‹ç±»çš„å¸¸è¯†è¿™äº›å°±ä¸ç»†è¯´äº†ã€‚æ›´å¤šçš„ç»†èŠ‚è¿˜æ˜¯çœ‹æºç å§ï¼š&lt;a href=&quot;https://github.com/yulingtianxia/SimilarImageHunter&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SimilarImageHunter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è‡³äºä¹‹åçš„ä¸€é”®æ›¿æ¢æ–‡ä»¶åç­‰åŠŸèƒ½ï¼Œè™½ç„¶æ˜¯åˆšéœ€ï¼Œä½†æ˜¯è¿˜éœ€ç­‰å®‰å…¨å¯é çš„æ›¿æ¢ç­–ç•¥åˆ¶å®šå‡ºä¹‹åæ‰å¯ä»¥ç¥­å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç°åœ¨çœ‹å¤ªé˜³éƒ½æ˜¯ç»¿è‰²çš„ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™å‘¨èŠ±äº†ä¸€å¤©åŠçš„æ—¶é—´åšäº†ä¸ª Mac OS X ä¸Šçš„å°å·¥å…·ï¼Œç”¨æ¥æŸ¥æ‰¾ç›¸ä¼¼å†…å®¹çš„å›¾ç‰‡ã€‚èµ·å› æ˜¯å…¬å¸çš„ iOS é¡¹ç›®ä¸­å·²æœ‰çš„å›¾ç‰‡ç®¡ç†æ··ä¹±ï¼Œæœ‰äº›å›¾ç‰‡æ–‡ä»¶åä¸è§„èŒƒï¼Œè¿˜æœ‰ä¸€äº›å†…å®¹é‡å¤ä½†æ–‡ä»¶åä¸åŒçš„å›¾ç‰‡ã€‚ç°åœ¨è§†è§‰è¦ç»™å‡ºä¸€äº› 3x åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œå¦‚ä½•ä¸å·²æœ‰çš„ä½åˆ†è¾¨ç‡å›¾ç‰‡åŒ¹é…ï¼Œè¿™åˆæ˜¯ä¸ªé—®é¢˜ã€‚äººå·¥ä¸€ä¸ªä¸ªå»æ‰¾å›ºç„¶å¥½ï¼Œä½†è¿™ç§æŠ€æœ¯å«é‡ä½çš„ä½“åŠ›æ´»å¾ˆæµªè´¹ç²¾åŠ›å’Œæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;Github åœ°å€ï¼š&lt;a href=&quot;https://github.com/yulingtianxia/SimilarImageHunter&quot;&gt;https://github.com/yulingtianxia/SimilarImageHunter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20160117-2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="macOS" scheme="http://yulingtianxia.com/tags/macOS/"/>
    
      <category term="Algorithm" scheme="http://yulingtianxia.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C å¼•ç”¨è®¡æ•°åŸç†</title>
    <link href="http://yulingtianxia.com/blog/2015/12/06/The-Principle-of-Refenrence-Counting/"/>
    <id>http://yulingtianxia.com/blog/2015/12/06/The-Principle-of-Refenrence-Counting/</id>
    <published>2015-12-06T08:32:07.000Z</published>
    <updated>2016-08-27T03:30:16.000Z</updated>
    
    <content type="html">&lt;ul&gt;
&lt;li&gt;æœ¬æ–‡æ‰€ä½¿ç”¨çš„æºç ä¸º objc4-647 å’Œ CF-1153.18&lt;/li&gt;
&lt;li&gt;å®é™…ä¸Šè¿™æ˜¯æˆ‘æœ¬å‘¨å®ä¹ å‘¨æŠ¥çš„ä¸€éƒ¨åˆ†ï¼Œå†™çš„æ¯”è¾ƒä»“ä¿ƒï¼Œå¦‚æœ‰å·®é”™è¿˜è¯·å¤šå¤šæŒ‡æ­£ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è®²ç”¨æ³•ï¼Œåªè¯´åŸç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;å¼•ç”¨è®¡æ•°å¦‚ä½•å­˜å‚¨&quot;&gt;&lt;a href=&quot;#å¼•ç”¨è®¡æ•°å¦‚ä½•å­˜å‚¨&quot; class=&quot;headerlink&quot; title=&quot;å¼•ç”¨è®¡æ•°å¦‚ä½•å­˜å‚¨&quot;&gt;&lt;/a&gt;å¼•ç”¨è®¡æ•°å¦‚ä½•å­˜å‚¨&lt;/h1&gt;&lt;p&gt;æœ‰äº›å¯¹è±¡å¦‚æœæ”¯æŒä½¿ç”¨ TaggedPointerï¼Œè‹¹æœä¼šç›´æ¥å°†å…¶æŒ‡é’ˆå€¼ä½œä¸ºå¼•ç”¨è®¡æ•°è¿”å›ï¼›å¦‚æœå½“å‰è®¾å¤‡æ˜¯ 64 ä½ç¯å¢ƒå¹¶ä¸”ä½¿ç”¨ Objective-C 2.0ï¼Œé‚£ä¹ˆâ€œä¸€äº›â€å¯¹è±¡ä¼šä½¿ç”¨å…¶ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆçš„ä¸€éƒ¨åˆ†ç©ºé—´æ¥å­˜å‚¨å®ƒçš„å¼•ç”¨è®¡æ•°ï¼›å¦åˆ™ Runtime ä¼šä½¿ç”¨ä¸€å¼ æ•£åˆ—è¡¨æ¥ç®¡ç†å¼•ç”¨è®¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®è¿˜æœ‰ä¸€ç§æƒ…å†µä¼šæ”¹å˜å¼•ç”¨è®¡æ•°çš„å­˜å‚¨ç­–ç•¥ï¼Œé‚£å°±æ˜¯æ˜¯å¦ä½¿ç”¨åƒåœ¾å›æ”¶ï¼ˆç”¨&lt;code&gt;UseGC&lt;/code&gt;å±æ€§åˆ¤æ–­ï¼‰ï¼Œä½†è¿™ç§æ—©å·²å¼ƒç”¨çš„ä¸œè¥¿å°±ä¸è¦ç®¡äº†ï¼Œè€Œä¸”åˆå§‹åŒ–åƒåœ¾å›æ”¶æœºåˆ¶çš„ &lt;code&gt;void gc_init(BOOL wantsGC)&lt;/code&gt; æ–¹æ³•ä¸€ç›´è¢«ä¼ å…¥ &lt;code&gt;NO&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;TaggedPointer&quot;&gt;&lt;a href=&quot;#TaggedPointer&quot; class=&quot;headerlink&quot; title=&quot;TaggedPointer&quot;&gt;&lt;/a&gt;TaggedPointer&lt;/h2&gt;&lt;p&gt;åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦åœ¨ä½¿ç”¨ TaggedPointer æ˜¯çœ‹æ ‡å¿—ä½æ˜¯å¦ä¸º 1 ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; SUPPORT_MSB_TAGGED_POINTERS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; TAG_MASK (1ULL&amp;lt;&amp;lt;63)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; TAG_MASK 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_object::isTaggedPointer() &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; SUPPORT_TAGGED_POINTERS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; ((uintptr_t)&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; &amp;amp; TAG_MASK);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;id&lt;/code&gt; å…¶å®å°±æ˜¯ &lt;code&gt;objc_object *&lt;/code&gt; çš„ç®€å†™ï¼ˆ&lt;code&gt;typedef struct objc_object *id;&lt;/code&gt;ï¼‰ï¼Œå®ƒçš„ &lt;code&gt;isTaggedPointer()&lt;/code&gt; æ–¹æ³•ç»å¸¸ä¼šåœ¨æ“ä½œå¼•ç”¨è®¡æ•°æ—¶ç”¨åˆ°ï¼Œå› ä¸ºè¿™å†³å®šäº†å­˜å‚¨å¼•ç”¨è®¡æ•°çš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id=&quot;isa-æŒ‡é’ˆï¼ˆNONPOINTER-ISAï¼‰&quot;&gt;&lt;a href=&quot;#isa-æŒ‡é’ˆï¼ˆNONPOINTER-ISAï¼‰&quot; class=&quot;headerlink&quot; title=&quot;isa æŒ‡é’ˆï¼ˆNONPOINTER_ISAï¼‰&quot;&gt;&lt;/a&gt;isa æŒ‡é’ˆï¼ˆNONPOINTER_ISAï¼‰&lt;/h2&gt;&lt;p&gt;ç”¨ 64 bit å­˜å‚¨ä¸€ä¸ªå†…å­˜åœ°å€æ˜¾ç„¶æ˜¯ç§æµªè´¹ï¼Œæ¯•ç«Ÿå¾ˆå°‘æœ‰é‚£ä¹ˆå¤§å†…å­˜çš„è®¾å¤‡ã€‚äºæ˜¯å¯ä»¥ä¼˜åŒ–å­˜å‚¨æ–¹æ¡ˆï¼Œç”¨ä¸€éƒ¨åˆ†é¢å¤–ç©ºé—´å­˜å‚¨å…¶ä»–å†…å®¹ã€‚&lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆç¬¬ä¸€ä½ä¸º 1 å³è¡¨ç¤ºä½¿ç”¨ä¼˜åŒ–çš„ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆï¼Œè¿™é‡Œåˆ—å‡ºä¸åŒæ¶æ„ä¸‹çš„ 64 ä½ç¯å¢ƒä¸­ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆç»“æ„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;union&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;isa_t&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;isa_t&lt;/span&gt;() &amp;#123; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;isa_t&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; value) : bits(value) &amp;#123; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class cls;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; bits;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; SUPPORT_NONPOINTER_ISA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; __arm64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; ISA_MASK        0x00000001fffffff8ULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; ISA_MAGIC_MASK  0x000003fe00000001ULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; ISA_MAGIC_VALUE 0x000001a400000001ULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; indexed           : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; has_assoc         : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; has_cxx_dtor      : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; shiftcls          : &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// MACH_VM_MAX_ADDRESS 0x1a0000000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; magic             : &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; weakly_referenced : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; deallocating      : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; has_sidetable_rc  : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; extra_rc          : &lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#       &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; RC_ONE   (1ULL&amp;lt;&amp;lt;45)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#       &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; RC_HALF  (1ULL&amp;lt;&amp;lt;18)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;elif&lt;/span&gt; __x86_64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; ISA_MASK        0x00007ffffffffff8ULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; ISA_MAGIC_MASK  0x0000000000000001ULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; ISA_MAGIC_VALUE 0x0000000000000001ULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; indexed           : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; has_assoc         : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; has_cxx_dtor      : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; shiftcls          : &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// MACH_VM_MAX_ADDRESS 0x7fffffe00000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; weakly_referenced : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; deallocating      : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; has_sidetable_rc  : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; extra_rc          : &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#       &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; RC_ONE   (1ULL&amp;lt;&amp;lt;50)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#       &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; RC_HALF  (1ULL&amp;lt;&amp;lt;13)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Available bits in isa field are architecture-specific.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;error&lt;/span&gt; unknown architecture&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// SUPPORT_NONPOINTER_ISA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;SUPPORT_NONPOINTER_ISA&lt;/code&gt; ç”¨äºæ ‡è®°æ˜¯å¦æ”¯æŒä¼˜åŒ–çš„ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆï¼Œå…¶å­—é¢å«ä¹‰æ„æ€æ˜¯ &lt;code&gt;isa&lt;/code&gt; çš„å†…å®¹ä¸å†æ˜¯ç±»çš„æŒ‡é’ˆäº†ï¼Œè€Œæ˜¯åŒ…å«äº†æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚å¼•ç”¨è®¡æ•°ï¼Œææ„çŠ¶æ€ï¼Œè¢«å…¶ä»– weak å˜é‡å¼•ç”¨æƒ…å†µã€‚åˆ¤æ–­æ–¹æ³•ä¹Ÿæ˜¯æ ¹æ®è®¾å¤‡ç±»å‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Define SUPPORT_NONPOINTER_ISA=1 to enable extra data in the isa field.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; !__LP64__  ||  TARGET_OS_WIN32  ||  TARGET_IPHONE_SIMULATOR  ||  __x86_64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SUPPORT_NONPOINTER_ISA 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SUPPORT_NONPOINTER_ISA 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç»¼åˆçœ‹æ¥ç›®å‰åªæœ‰ arm64 æ¶æ„çš„è®¾å¤‡æ”¯æŒï¼Œä¸‹é¢åˆ—å‡ºäº† &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆä¸­å˜é‡å¯¹åº”çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å˜é‡å&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;indexed&lt;/td&gt;
&lt;td&gt;0 è¡¨ç¤ºæ™®é€šçš„ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆï¼Œ1 è¡¨ç¤ºä½¿ç”¨ä¼˜åŒ–ï¼Œå­˜å‚¨å¼•ç”¨è®¡æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;has_assoc&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦åŒ…å« associated objectï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ææ„æ—¶ä¼šæ›´å¿«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;has_cxx_dtor&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦æœ‰ C++ æˆ– ARC çš„ææ„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ææ„æ—¶æ›´å¿«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;shiftcls&lt;/td&gt;
&lt;td&gt;ç±»çš„æŒ‡é’ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;magic&lt;/td&gt;
&lt;td&gt;å›ºå®šå€¼ä¸º 0xd2ï¼Œç”¨äºåœ¨è°ƒè¯•æ—¶åˆ†è¾¨å¯¹è±¡æ˜¯å¦æœªå®Œæˆåˆå§‹åŒ–ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;weakly_referenced&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦æœ‰è¿‡ &lt;code&gt;weak&lt;/code&gt; å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ææ„æ—¶æ›´å¿«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;deallocating&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦æ­£åœ¨ææ„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;has_sidetable_rc&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å€¼æ˜¯å¦è¿‡å¤§æ— æ³•å­˜å‚¨åœ¨ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;extra_rc&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å¼•ç”¨è®¡æ•°å€¼å‡ä¸€åçš„ç»“æœ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨ 64 ä½ç¯å¢ƒä¸‹ï¼Œä¼˜åŒ–çš„ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆå¹¶ä¸æ˜¯å°±ä¸€å®šä¼šå­˜å‚¨å¼•ç”¨è®¡æ•°ï¼Œæ¯•ç«Ÿç”¨ 19bit ï¼ˆiOS ç³»ç»Ÿï¼‰ä¿å­˜å¼•ç”¨è®¡æ•°ä¸ä¸€å®šå¤Ÿã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ 19 ä½ä¿å­˜çš„æ˜¯&lt;strong&gt;å¼•ç”¨è®¡æ•°çš„å€¼å‡ä¸€&lt;/strong&gt;ã€‚&lt;code&gt;has_sidetable_rc&lt;/code&gt; çš„å€¼å¦‚æœä¸º 1ï¼Œé‚£ä¹ˆå¼•ç”¨è®¡æ•°ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªå« &lt;code&gt;SideTable&lt;/code&gt; çš„ç±»çš„å±æ€§ä¸­ï¼Œåé¢ä¼šè¯¦ç»†è®²ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ•£åˆ—è¡¨&quot;&gt;&lt;a href=&quot;#æ•£åˆ—è¡¨&quot; class=&quot;headerlink&quot; title=&quot;æ•£åˆ—è¡¨&quot;&gt;&lt;/a&gt;æ•£åˆ—è¡¨&lt;/h2&gt;&lt;p&gt;æ•£åˆ—è¡¨æ¥å­˜å‚¨å¼•ç”¨è®¡æ•°å…·ä½“æ˜¯ç”¨ &lt;code&gt;DenseMap&lt;/code&gt; ç±»æ¥å®ç°ï¼Œè¿™ä¸ªç±»ä¸­åŒ…å«å¥½å¤šæ˜ å°„å®ä¾‹åˆ°å…¶å¼•ç”¨è®¡æ•°çš„é”®å€¼å¯¹ï¼Œå¹¶æ”¯æŒç”¨ &lt;code&gt;DenseMapIterator&lt;/code&gt; è¿­ä»£å™¨å¿«é€ŸæŸ¥æ‰¾éå†è¿™äº›é”®å€¼å¯¹ã€‚æ¥ç€è¯´é”®å€¼å¯¹çš„æ ¼å¼ï¼šé”®çš„ç±»å‹ä¸º &lt;code&gt;DisguisedPtr&amp;lt;objc_object&amp;gt;&lt;/code&gt;ï¼Œ&lt;code&gt;DisguisedPtr&lt;/code&gt; ç±»æ˜¯å¯¹ &lt;code&gt;objc_object *&lt;/code&gt; æŒ‡é’ˆåŠå…¶ä¸€äº›æ“ä½œè¿›è¡Œçš„å°è£…ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è®©å®ƒç»™äººçœ‹èµ·æ¥ä¸ä¼šæœ‰å†…å­˜æ³„éœ²çš„æ ·å­ï¼ˆçœŸæ˜¯å¿ƒæœºè£±ï¼‰ï¼Œå…¶å†…å®¹å¯ä»¥ç†è§£ä¸ºå¯¹è±¡çš„å†…å­˜åœ°å€ï¼›å€¼çš„ç±»å‹ä¸º &lt;code&gt;__darwin_size_t&lt;/code&gt;ï¼Œåœ¨ darwin å†…æ ¸ä¸€èˆ¬ç­‰åŒäº &lt;code&gt;unsigned long&lt;/code&gt;ã€‚å…¶å®è¿™é‡Œä¿å­˜çš„å€¼ä¹Ÿæ˜¯ç­‰äº&lt;strong&gt;å¼•ç”¨è®¡æ•°å‡ä¸€&lt;/strong&gt;ã€‚ä½¿ç”¨æ•£åˆ—è¡¨ä¿å­˜å¼•ç”¨è®¡æ•°çš„è®¾è®¡å¾ˆå¥½ï¼Œå³ä½¿å‡ºç°æ•…éšœå¯¼è‡´å¯¹è±¡çš„å†…å­˜å—æŸåï¼Œåªè¦å¼•ç”¨è®¡æ•°è¡¨æ²¡æœ‰è¢«ç ´åï¼Œä¾ç„¶å¯ä»¥é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°å†…å­˜å—çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰è¯´å¼•ç”¨è®¡æ•°è¡¨æ˜¯ä¸ªæ•£åˆ—è¡¨ï¼Œè¿™é‡Œç®€è¦è¯´ä¸‹æ•£åˆ—çš„æ–¹æ³•ã€‚æœ‰ä¸ªä¸“é—¨å¤„ç†é”®çš„ &lt;code&gt;DenseMapInfo&lt;/code&gt; ç»“æ„ä½“ï¼Œå®ƒé’ˆå¯¹ &lt;code&gt;DisguisedPtr&lt;/code&gt; åšäº†äº›ä¼˜åŒ–åŒ¹é…é”®å€¼é€Ÿåº¦çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; DenseMapInfo&amp;lt;DisguisedPtr&amp;lt;T&amp;gt;&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; DisguisedPtr&amp;lt;T&amp;gt; getEmptyKey() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return DisguisedPtr&amp;lt;T&amp;gt;((T*)(&lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt;)&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; DisguisedPtr&amp;lt;T&amp;gt; getTombstoneKey() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return DisguisedPtr&amp;lt;T&amp;gt;((T*)(&lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt;)&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getHashValue&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; T *PtrVal)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      return ptr_hash((&lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt;)PtrVal);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;isEqual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; DisguisedPtr&amp;lt;T&amp;gt; &amp;amp;LHS, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; DisguisedPtr&amp;lt;T&amp;gt; &amp;amp;RHS)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      return LHS == RHS; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“ç„¶è¿™é‡Œçš„å“ˆå¸Œç®—æ³•ä¼šæ ¹æ®æ˜¯å¦ä¸º 64 ä½å¹³å°æ¥è¿›è¡Œä¼˜åŒ–ï¼Œç®—æ³•å…·ä½“ç»†èŠ‚å°±ä¸æ·±ç©¶äº†ï¼Œæˆ‘æ€»è§‰å¾—è‹¹æœåœ¨è¿™é‡Œçš„ hardcode æ˜¯éšä¾¿å†™çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gauss&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#if __LP64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static inline uint32_t ptr_hash(uint64_t &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; ^= &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; *= &lt;span class=&quot;number&quot;&gt;0x8a970be7488fda55&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; ^= __builtin_bswap64(&lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (uint32_t)&lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static inline uint32_t ptr_hash(uint32_t &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; ^= &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; *= &lt;span class=&quot;number&quot;&gt;0x5052acdb&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt; ^= __builtin_bswap32(&lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;key&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å†ä»‹ç»ä¸‹ &lt;code&gt;SideTable&lt;/code&gt; è¿™ä¸ªç±»ï¼Œå®ƒç”¨äºç®¡ç†å¼•ç”¨è®¡æ•°è¡¨å’Œ &lt;code&gt;weak&lt;/code&gt; è¡¨ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;spinlock_lock&lt;/code&gt; è‡ªæ—‹é”æ¥é˜²æ­¢æ“ä½œè¡¨ç»“æ„æ—¶å¯èƒ½çš„ç«æ€æ¡ä»¶ã€‚å®ƒç”¨ä¸€ä¸ª 64*128 å¤§å°çš„ &lt;code&gt;uint8_t&lt;/code&gt; é™æ€æ•°ç»„ä½œä¸º buffer æ¥ä¿å­˜æ‰€æœ‰çš„ &lt;code&gt;SideTable&lt;/code&gt; å®ä¾‹ã€‚å¹¶æä¾›ä¸‰ä¸ªå…¬æœ‰å±æ€§ï¼š&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;spinlock_t&lt;/span&gt; slock;&lt;span class=&quot;comment&quot;&gt;//ä¿è¯åŸå­æ“ä½œçš„è‡ªé€‰é”&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RefcountMap refcnts;&lt;span class=&quot;comment&quot;&gt;//ä¿å­˜å¼•ç”¨è®¡æ•°çš„æ•£åˆ—è¡¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;weak_table_t&lt;/span&gt; weak_table;&lt;span class=&quot;comment&quot;&gt;//ä¿å­˜ weak å¼•ç”¨çš„å…¨å±€æ•£åˆ—è¡¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æä¾›äº†ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œç”¨äºæ ¹æ®å¯¹è±¡çš„åœ°å€åœ¨ buffer ä¸­å¯»æ‰¾å¯¹åº”çš„ &lt;code&gt;SideTable&lt;/code&gt; å®ä¾‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight actionscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; SideTable *tableForPointer(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *p)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;weak&lt;/code&gt; è¡¨çš„ä½œç”¨æ˜¯åœ¨å¯¹è±¡æ‰§è¡Œ &lt;code&gt;dealloc&lt;/code&gt; çš„æ—¶å€™å°†æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„ &lt;code&gt;weak&lt;/code&gt; æŒ‡é’ˆçš„å€¼è®¾ä¸º &lt;code&gt;nil&lt;/code&gt;ï¼Œé¿å…æ‚¬ç©ºæŒ‡é’ˆã€‚è¿™æ˜¯ &lt;code&gt;weak&lt;/code&gt; è¡¨çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;weak_table_t&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;weak_entry_t&lt;/span&gt; *weak_entries;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;size_t&lt;/span&gt;    num_entries;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; mask;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;uintptr_t&lt;/span&gt; max_hash_displacement;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è‹¹æœä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„ &lt;code&gt;weak&lt;/code&gt; è¡¨æ¥ä¿å­˜æ‰€æœ‰çš„ &lt;code&gt;weak&lt;/code&gt; å¼•ç”¨ã€‚å¹¶å°†å¯¹è±¡ä½œä¸ºé”®ï¼Œ&lt;code&gt;weak_entry_t&lt;/code&gt; ä½œä¸ºå€¼ã€‚&lt;code&gt;weak_entry_t&lt;/code&gt; ä¸­ä¿å­˜äº†æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„ &lt;code&gt;weak&lt;/code&gt; æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;h1 id=&quot;è·å–å¼•ç”¨è®¡æ•°&quot;&gt;&lt;a href=&quot;#è·å–å¼•ç”¨è®¡æ•°&quot; class=&quot;headerlink&quot; title=&quot;è·å–å¼•ç”¨è®¡æ•°&quot;&gt;&lt;/a&gt;è·å–å¼•ç”¨è®¡æ•°&lt;/h1&gt;&lt;p&gt;åœ¨é ARC ç¯å¢ƒå¯ä»¥ä½¿ç”¨ &lt;code&gt;retainCount&lt;/code&gt; æ–¹æ³•è·å–æŸä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå…¶ä¼šè°ƒç”¨ &lt;code&gt;objc_object&lt;/code&gt; çš„ &lt;code&gt;rootRetainCount()&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight livescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (NSUInteger)retainCount &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;((id)self)&lt;/span&gt;-&amp;gt;&lt;/span&gt;rootRetainCount();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ ARC æ—¶ä»£é™¤äº†ä½¿ç”¨ Core Foundation åº“çš„ &lt;code&gt;CFGetRetainCount()&lt;/code&gt; æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Runtime çš„ &lt;code&gt;_objc_rootRetainCount(id obj)&lt;/code&gt; æ–¹æ³•æ¥è·å–å¼•ç”¨è®¡æ•°ï¼Œæ­¤æ—¶éœ€è¦å¼•å…¥ &lt;code&gt;&amp;lt;objc/runtime.h&amp;gt;&lt;/code&gt; å¤´æ–‡ä»¶ã€‚è¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯è°ƒç”¨ &lt;code&gt;objc_object&lt;/code&gt; çš„ &lt;code&gt;rootRetainCount()&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;inline uintptr_t &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;objc_object:&lt;/span&gt;:rootRetainCount()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    assert(!UseGC)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (isTaggedPointer()) return (uintptr_t)this&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sidetable_lock()&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    isa_t &lt;span class=&quot;keyword&quot;&gt;bits &lt;/span&gt;= LoadExclusive(&amp;amp;isa.&lt;span class=&quot;keyword&quot;&gt;bits);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    if (&lt;span class=&quot;keyword&quot;&gt;bits.indexed) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        uintptr_t rc = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; + &lt;span class=&quot;keyword&quot;&gt;bits.extra_rc;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        if (&lt;span class=&quot;keyword&quot;&gt;bits.has_sidetable_rc) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            rc += sidetable_getExtraRC_nolock()&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sidetable_unlock()&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return rc&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sidetable_unlock()&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return sidetable_retainCount()&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;rootRetainCount()&lt;/code&gt; æ–¹æ³•å¯¹å¼•ç”¨è®¡æ•°å­˜å‚¨é€»è¾‘è¿›è¡Œäº†åˆ¤æ–­ï¼Œå› ä¸º TaggedPointer å‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå¯ä»¥ç›´æ¥è·å–å¼•ç”¨è®¡æ•°ï¼›64 ä½ç¯å¢ƒä¼˜åŒ–çš„ &lt;code&gt;isa&lt;/code&gt; æŒ‡é’ˆå‰é¢ä¹Ÿè¯´è¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œçš„é‡å¤´æˆæ˜¯åœ¨ TaggedPointer æ— æ³•ä½¿ç”¨æ—¶è°ƒç”¨çš„ &lt;code&gt;sidetable_retainCount()&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight gams&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;uintptr_t&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_object::sidetable_retainCount()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SideTable *&lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt; = SideTable::tableForPointer(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    size_t refcnt_result = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spinlock_lock(&amp;amp;&lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt;-&amp;gt;slock);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RefcountMap::iterator it = &lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt;-&amp;gt;refcnts.find(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (it != &lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt;-&amp;gt;refcnts.end()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// this is valid for SIDE_TABLE_RC_PINNED too&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        refcnt_result += it-&amp;gt;second &amp;gt;&amp;gt; SIDE_TABLE_RC_SHIFT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spinlock_unlock(&amp;amp;&lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt;-&amp;gt;slock);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return refcnt_result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;sidetable_retainCount()&lt;/code&gt; æ–¹æ³•çš„é€»è¾‘å°±æ˜¯å…ˆä» &lt;code&gt;SideTable&lt;/code&gt; çš„é™æ€æ–¹æ³•è·å–å½“å‰å®ä¾‹å¯¹åº”çš„ &lt;code&gt;SideTable&lt;/code&gt; å¯¹è±¡ï¼Œå…¶ &lt;code&gt;refcnts&lt;/code&gt; å±æ€§å°±æ˜¯ä¹‹å‰è¯´çš„å­˜å‚¨å¼•ç”¨è®¡æ•°çš„æ•£åˆ—è¡¨ï¼Œè¿™é‡Œå°†å…¶ç±»å‹ç®€å†™ä¸º &lt;code&gt;RefcountMap&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight elixir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef &lt;span class=&quot;symbol&quot;&gt;objc:&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;:DenseMap&amp;lt;DisguisedPtr&amp;lt;objc_object&amp;gt;&lt;/span&gt;,size_t,&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&amp;gt; RefcountMap;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨å¼•ç”¨è®¡æ•°è¡¨ä¸­ç”¨è¿­ä»£å™¨æŸ¥æ‰¾å½“å‰å®ä¾‹å¯¹åº”çš„é”®å€¼å¯¹ï¼Œè·å–å¼•ç”¨è®¡æ•°å€¼ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Š &lt;strong&gt;+1&lt;/strong&gt; å¹¶å°†ç»“æœè¿”å›ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¹‹å‰è¯´&lt;strong&gt;å¼•ç”¨è®¡æ•°è¡¨å­˜å‚¨çš„å€¼ä¸ºå®é™…å¼•ç”¨è®¡æ•°å‡ä¸€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ä¸ºä»€ä¹ˆè¿™é‡ŒæŠŠé”®å€¼å¯¹çš„å€¼åšäº†å‘å³ç§»ä½æ“ä½œï¼ˆ&lt;code&gt;it-&amp;gt;second &amp;gt;&amp;gt; SIDE_TABLE_RC_SHIFT&lt;/code&gt;ï¼‰:&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __LP64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; WORD_BITS 64&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; WORD_BITS 32&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The order of these bits is important.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SIDE_TABLE_WEAKLY_REFERENCED (1UL&amp;lt;&amp;lt;0)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SIDE_TABLE_DEALLOCATING      (1UL&amp;lt;&amp;lt;1)  &lt;span class=&quot;comment&quot;&gt;// MSB-ward of weak bit&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SIDE_TABLE_RC_ONE            (1UL&amp;lt;&amp;lt;2)  &lt;span class=&quot;comment&quot;&gt;// MSB-ward of deallocating bit&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SIDE_TABLE_RC_PINNED         (1UL&amp;lt;&amp;lt;(WORD_BITS-1))&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SIDE_TABLE_RC_SHIFT 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; SIDE_TABLE_FLAG_MASK (SIDE_TABLE_RC_ONE-1)RefcountMap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºå€¼çš„ç¬¬ä¸€ä¸ª bit è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦æœ‰è¿‡ &lt;code&gt;weak&lt;/code&gt; å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåœ¨ææ„é‡Šæ”¾å†…å­˜æ—¶å¯ä»¥æ›´å¿«ï¼›ç¬¬äºŒä¸ª bit è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦æ­£åœ¨ææ„ã€‚ä»ç¬¬ä¸‰ä¸ª bit å¼€å§‹æ‰æ˜¯å­˜å‚¨å¼•ç”¨è®¡æ•°æ•°å€¼çš„åœ°æ–¹ã€‚æ‰€ä»¥è¿™é‡Œè¦åšå‘å³ç§»ä¸¤ä½çš„æ“ä½œï¼Œè€Œå¯¹å¼•ç”¨è®¡æ•°çš„ +1 å’Œ -1 å¯ä»¥ä½¿ç”¨ &lt;code&gt;SIDE_TABLE_RC_ONE&lt;/code&gt;,è¿˜å¯ä»¥ç”¨ &lt;code&gt;SIDE_TABLE_RC_PINNED&lt;/code&gt; æ¥åˆ¤æ–­æ˜¯å¦å¼•ç”¨è®¡æ•°å€¼æœ‰å¯èƒ½æº¢å‡ºã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¸èƒ½å¤Ÿå®Œå…¨ä¿¡ä»»è¿™ä¸ª &lt;code&gt;_objc_rootRetainCount(id obj)&lt;/code&gt; å‡½æ•°ï¼Œå¯¹äºå·²é‡Šæ”¾çš„å¯¹è±¡ä»¥åŠä¸æ­£ç¡®çš„å¯¹è±¡åœ°å€ï¼Œæœ‰æ—¶ä¹Ÿè¿”å› â€œ1â€ã€‚å®ƒæ‰€è¿”å›çš„å¼•ç”¨è®¡æ•°åªæ˜¯æŸä¸ªç»™å®šæ—¶é—´ç‚¹ä¸Šçš„å€¼ï¼Œè¯¥æ–¹æ³•å¹¶æœªè€ƒè™‘åˆ°ç³»ç»Ÿç¨åä¼šæŠŠè‡ªåŠ¨é‡Šæ”¾åƒæ± æ¸…ç©ºï¼Œå› è€Œä¸ä¼šå°†åç»­çš„é‡Šæ”¾æ“ä½œä»è¿”å›å€¼é‡Œå‡å»ã€‚clang ä¼šå°½å¯èƒ½æŠŠ &lt;code&gt;NSString&lt;/code&gt; å®ç°æˆå•ä¾‹å¯¹è±¡ï¼Œå…¶å¼•ç”¨è®¡æ•°ä¼šå¾ˆå¤§ã€‚å¦‚æœä½¿ç”¨äº† TaggedPointerï¼Œ&lt;code&gt;NSNumber&lt;/code&gt; çš„å†…å®¹&lt;strong&gt;æœ‰å¯èƒ½&lt;/strong&gt;å°±ä¸å†æ”¾åˆ°å †ä¸­ï¼Œè€Œæ˜¯ç›´æ¥å†™åœ¨å®½æ•çš„64ä½æ ˆæŒ‡é’ˆå€¼é‡Œã€‚å…¶çœ‹ä¸Šå»å’ŒçœŸæ­£çš„ &lt;code&gt;NSNumber&lt;/code&gt; å¯¹è±¡ä¸€æ ·ï¼Œåªæ˜¯ä½¿ç”¨ TaggedPointer ä¼˜åŒ–äº†ä¸‹ï¼Œä½†å…¶å¼•ç”¨è®¡æ•°å¯èƒ½ä¸å‡†ç¡®ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä¿®æ”¹å¼•ç”¨è®¡æ•°&quot;&gt;&lt;a href=&quot;#ä¿®æ”¹å¼•ç”¨è®¡æ•°&quot; class=&quot;headerlink&quot; title=&quot;ä¿®æ”¹å¼•ç”¨è®¡æ•°&quot;&gt;&lt;/a&gt;ä¿®æ”¹å¼•ç”¨è®¡æ•°&lt;/h1&gt;&lt;h2 id=&quot;retain-å’Œ-release&quot;&gt;&lt;a href=&quot;#retain-å’Œ-release&quot; class=&quot;headerlink&quot; title=&quot;retain å’Œ release&quot;&gt;&lt;/a&gt;retain å’Œ release&lt;/h2&gt;&lt;p&gt;åœ¨é ARC ç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ &lt;code&gt;retain&lt;/code&gt; å’Œ &lt;code&gt;release&lt;/code&gt; æ–¹æ³•å¯¹å¼•ç”¨è®¡æ•°è¿›è¡ŒåŠ ä¸€å‡ä¸€æ“ä½œï¼Œå®ƒä»¬åˆ†åˆ«è°ƒç”¨äº† &lt;code&gt;_objc_rootRetain(id obj)&lt;/code&gt; å’Œ &lt;code&gt;_objc_rootRelease(id obj)&lt;/code&gt; å‡½æ•°ï¼Œä¸è¿‡åä¸¤è€…åœ¨ ARC ç¯å¢ƒä¸‹ä¹Ÿå¯ä½¿ç”¨ã€‚æœ€åè¿™ä¸¤ä¸ªå‡½æ•°åˆä¼šè°ƒç”¨ &lt;code&gt;objc_object&lt;/code&gt; çš„ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; id &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_object::rootRetain()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    assert(!UseGC);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isTaggedPointer()) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (id)&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sidetable_retain();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; bool &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_object::rootRelease()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    assert(!UseGC);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isTaggedPointer()) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sidetable_release(&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·çš„å®ç°è·Ÿè·å–å¼•ç”¨è®¡æ•°ç±»ä¼¼ï¼Œå…ˆæ˜¯çœ‹æ˜¯å¦æ”¯æŒ TaggedPointerï¼ˆæ¯•ç«Ÿæ•°æ®å­˜åœ¨æ ˆæŒ‡é’ˆè€Œä¸æ˜¯å †ä¸­ï¼Œæ ˆçš„ç®¡ç†æœ¬æ¥å°±æ˜¯è‡ªåŠ¨çš„ï¼‰ï¼Œå¦åˆ™å»æ“ä½œ &lt;code&gt;SideTable&lt;/code&gt; ä¸­çš„ &lt;code&gt;refcnts&lt;/code&gt; å±æ€§ï¼Œè¿™ä¸è·å–å¼•ç”¨è®¡æ•°ç­–ç•¥ç±»ä¼¼ã€‚&lt;code&gt;sidetable_retain()&lt;/code&gt; å°† å¼•ç”¨è®¡æ•°åŠ ä¸€åè¿”å›å¯¹è±¡ï¼Œ&lt;code&gt;sidetable_release()&lt;/code&gt; è¿”å›æ˜¯å¦è¦æ‰§è¡Œ &lt;code&gt;dealloc&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight zephir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objc_object::sidetable_release(&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; performDealloc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#if SUPPORT_NONPOINTER_ISA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    assert(!isa.indexed);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SideTable *table = SideTable::tableForPointer(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; do_dealloc = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (spinlock_trylock(&amp;amp;table-&amp;gt;slock)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RefcountMap::iterator it = table-&amp;gt;refcnts.find(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (it == table-&amp;gt;refcnts.end()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            do_dealloc = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            table-&amp;gt;refcnts[this] = SIDE_TABLE_DEALLOCATING;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (it-&amp;gt;second &amp;lt; SIDE_TABLE_DEALLOCATING) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// SIDE_TABLE_WEAKLY_REFERENCED may be set. Don&#39;t change it.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            do_dealloc = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            it-&amp;gt;second |= SIDE_TABLE_DEALLOCATING;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (! (it-&amp;gt;second &amp;amp; SIDE_TABLE_RC_PINNED)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            it-&amp;gt;second -= SIDE_TABLE_RC_ONE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        spinlock_unlock(&amp;amp;table-&amp;gt;slock);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (do_dealloc  &amp;amp;&amp;amp;  performDealloc) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ((void(*)(objc_object *, SEL))objc_msgSend)(this, SEL_dealloc);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; do_dealloc;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sidetable_release_slow(table, performDealloc);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;çœ‹åˆ°è¿™é‡ŒçŸ¥é“ä¸ºä»€ä¹ˆåœ¨å­˜å‚¨å¼•ç”¨è®¡æ•°æ—¶&lt;strong&gt;æ€»æ˜¯çœŸæ­£çš„å¼•ç”¨è®¡æ•°å€¼å‡ä¸€&lt;/strong&gt;äº†å§ã€‚å› ä¸º release æœ¬æ¥æ˜¯è¦å°†å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œæ‰€ä»¥å­˜å‚¨å¼•ç”¨è®¡æ•°æ—¶å…ˆé¢„ç•™äº†ä¸ªâ€œä¸€â€ï¼Œåœ¨å‡ä¸€ä¹‹å‰å…ˆçœ‹çœ‹å­˜å‚¨çš„å¼•ç”¨è®¡æ•°å€¼æ˜¯å¦ä¸º 0 ï¼ˆ&lt;code&gt;it-&amp;gt;second &amp;lt; SIDE_TABLE_DEALLOCATING&lt;/code&gt;ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œé‚£å°±å°†å¯¹è±¡æ ‡è®°ä¸ºâ€œæ­£åœ¨ææ„â€ï¼ˆ&lt;code&gt;it-&amp;gt;second |= SIDE_TABLE_DEALLOCATING&lt;/code&gt;ï¼‰,å¹¶å‘é€ &lt;code&gt;dealloc&lt;/code&gt; æ¶ˆæ¯ï¼Œè¿”å› &lt;code&gt;YES&lt;/code&gt;ï¼›å¦åˆ™å°±å°†å¼•ç”¨è®¡æ•°å‡ä¸€ï¼ˆ&lt;code&gt;it-&amp;gt;second -= SIDE_TABLE_RC_ONE&lt;/code&gt;ï¼‰ã€‚è¿™æ ·åšé¿å…äº†è´Ÿæ•°çš„äº§ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼ŒCore Foundation åº“ä¸­ä¹Ÿæä¾›äº†å¢å‡å¼•ç”¨è®¡æ•°çš„æ–¹æ³•ã€‚æ¯”å¦‚åœ¨ä½¿ç”¨ Toll-Free Bridge è½¬æ¢æ—¶ä½¿ç”¨çš„ &lt;code&gt;CFBridgingRetain&lt;/code&gt; å’Œ &lt;code&gt;CFBridgingRelease&lt;/code&gt; æ–¹æ³•ï¼Œå…¶æœ¬è´¨æ˜¯ä½¿ç”¨ &lt;code&gt;__bridge_retained&lt;/code&gt; å’Œ &lt;code&gt;__bridge_transfer&lt;/code&gt; å‘Šè¯‰ç¼–è¯‘å™¨æ­¤å¤„éœ€è¦å¦‚ä½•ä¿®æ”¹å¼•ç”¨è®¡æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_INLINE&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CF_RETURNS_RETAINED&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CFTypeRef&lt;/span&gt; __nullable &lt;span class=&quot;built_in&quot;&gt;CFBridgingRetain&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; __nullable X) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (__bridge_retained &lt;span class=&quot;built_in&quot;&gt;CFTypeRef&lt;/span&gt;)X;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_INLINE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; __nullable &lt;span class=&quot;built_in&quot;&gt;CFBridgingRelease&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;CFTypeRef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CF_CONSUMED&lt;/span&gt; __nullable X) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (__bridge_transfer &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)X;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤å¤– Objective-C å¾ˆå¤šå®ç°æ˜¯é  Core Foundation Runtime æ¥å®ç°ï¼Œ Objective-C Runtime æºç ä¸­æœ‰äº›åœ°æ–¹æ˜ç¡®æ³¨æ˜ï¼šâ€&lt;code&gt;// Replaced by CF&lt;/code&gt;â€œï¼Œé‚£å°±æ˜¯æ„æ€è¯´è¿™å—ä»»åŠ¡è¢« Core Foundation åº“æ¥ç®¡äº†ã€‚å½“ç„¶ Core Foundation æœ‰ä¸€éƒ¨åˆ†æ˜¯å¼€æºçš„ã€‚è¿˜æœ‰ä¸€äº› Objective-C Runtime å‡½æ•°çš„å®ç°è¢«è¯¸å¦‚ &lt;code&gt;ObjectAlloc&lt;/code&gt; å’Œ &lt;code&gt;NSZombie&lt;/code&gt; è¿™æ ·çš„å†…å­˜ç®¡ç†å·¥å…·æ‰€æ›¿ä»£ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Replaced by ObjectAlloc&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)allocWithZone:(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; _&lt;span class=&quot;built_in&quot;&gt;NSZone&lt;/span&gt; *)zone &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _objc_rootAllocWithZone(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, (malloc_zone_t *)zone);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Replaced by CF (throws an NSException)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)init &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Replaced by NSZombies&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)dealloc &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _objc_rootDealloc(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;alloc-new-copy-mutableCopy&quot;&gt;&lt;a href=&quot;#alloc-new-copy-mutableCopy&quot; class=&quot;headerlink&quot; title=&quot;alloc, new, copy, mutableCopy&quot;&gt;&lt;/a&gt;alloc, new, copy, mutableCopy&lt;/h2&gt;&lt;p&gt;æ ¹æ®ç¼–è¯‘å™¨çš„çº¦å®šï¼Œè¿™ä»¥è¿™å››ä¸ªå•è¯å¼€å¤´çš„æ–¹æ³•éƒ½ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ ä¸€ã€‚è€Œ &lt;code&gt;new&lt;/code&gt; ç›¸å½“äºè°ƒç”¨ &lt;code&gt;alloc&lt;/code&gt; åå†è°ƒç”¨ &lt;code&gt;init&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;_objc_rootAlloc(Class cls)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; callAlloc(cls, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*checkNil*/&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*allocWithZone*/&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)alloc &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _objc_rootAlloc(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)new &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [callAlloc(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;/*checkNil*/&lt;/span&gt;) init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡º &lt;code&gt;alloc&lt;/code&gt; å’Œ &lt;code&gt;new&lt;/code&gt; æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ &lt;code&gt;callAlloc&lt;/code&gt;ï¼Œé»˜è®¤ä½¿ç”¨ Objective-C 2.0 ä¸”å¿½è§†åƒåœ¾å›æ”¶å’Œ NSZoneï¼Œé‚£ä¹ˆåç»­çš„è°ƒç”¨é¡ºåºä¾æ¬¡æ˜¯ä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;class_createInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;_class_createInstanceFromZone()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;calloc&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;calloc()&lt;/code&gt; å‡½æ•°ç›¸æ¯”äº &lt;code&gt;malloc()&lt;/code&gt; å‡½æ•°çš„ä¼˜ç‚¹æ˜¯å®ƒå°†åˆ†é…çš„å†…å­˜åŒºåŸŸåˆå§‹åŒ–ä¸º0ï¼Œç›¸å½“äº &lt;code&gt;malloc()&lt;/code&gt; åå†ç”¨ &lt;code&gt;memset()&lt;/code&gt; æ–¹æ³•åˆå§‹åŒ–ä¸€éã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;copy&lt;/code&gt; å’Œ &lt;code&gt;mutableCopy&lt;/code&gt; éƒ½æ˜¯åŸºäº &lt;code&gt;NSCopying&lt;/code&gt; å’Œ &lt;code&gt;NSMutableCopying&lt;/code&gt; æ–¹æ³•çº¦å®šï¼Œåˆ†åˆ«è°ƒç”¨å„ç±»è‡ªå·±å®ç°çš„ &lt;code&gt;copyWithZone:&lt;/code&gt; å’Œ &lt;code&gt;mutableCopyWithZone:&lt;/code&gt; æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æ— è®ºå®ç°æ–¹å¼æ˜¯æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼Œéƒ½ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚ï¼ˆæœ‰äº›ç±»çš„ç­–ç•¥æ˜¯æ‡’æ‹·è´ï¼Œåªå¢åŠ å¼•ç”¨è®¡æ•°ä½†å¹¶ä¸çœŸçš„æ‹·è´ï¼Œç­‰å¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶å†æ‹·è´ä¸€ä»½å‡ºæ¥ï¼Œæ¯”å¦‚ &lt;code&gt;NSArray&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;retain&lt;/code&gt; æ–¹æ³•åŠ ç¬¦å·æ–­ç‚¹ä¼šå‘ç° &lt;code&gt;alloc&lt;/code&gt;, &lt;code&gt;new&lt;/code&gt;, &lt;code&gt;copy&lt;/code&gt;, &lt;code&gt;mutableCopy&lt;/code&gt; è¿™å››ä¸ªæ–¹æ³•éƒ½ä¼šé€šè¿‡ Core Foundation çš„ &lt;code&gt;CFBasicHashAddValue()&lt;/code&gt; å‡½æ•°æ¥è°ƒç”¨ &lt;code&gt;retain&lt;/code&gt; æ–¹æ³•ã€‚å…¶å® CF æœ‰ä¸ªä¿®æ”¹å’ŒæŸ¥çœ‹å¼•ç”¨è®¡æ•°çš„å…¥å£å‡½æ•° &lt;code&gt;__CFDoExternRefOperation&lt;/code&gt;ï¼Œåœ¨ &lt;code&gt;CFRuntime.c&lt;/code&gt; æ–‡ä»¶ä¸­å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;autorelease&quot;&gt;&lt;a href=&quot;#autorelease&quot; class=&quot;headerlink&quot; title=&quot;autorelease&quot;&gt;&lt;/a&gt;autorelease&lt;/h2&gt;&lt;p&gt;æœ¬æƒ³è´´ä¸Šä¸€å † Runtime ä¸­å…³äºè‡ªåŠ¨é‡Šæ”¾æ± çš„æºç ç„¶åè¯´ä¸Šä¸€å¤§å †ï¼Œç„¶åå‘ç°äº†å¤ªé˜³ç¥çš„è¿™ç¯‡&lt;a href=&quot;http://blog.sunnyxx.com/2014/10/15/behind-autorelease/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;é»‘å¹•èƒŒåçš„Autorelease&lt;/a&gt;æŠŠæˆ‘æƒ³è¯´çš„éƒ½è¯´äº†ï¼ŒæŠŠæˆ‘ä¸çŸ¥é“çš„ä¹Ÿè¯´äº†ï¼Œç®€ç›´å¤ªå±Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®é€šè¿‡çœ‹æºç å¯ä»¥çŸ¥é“å¥½å¤šç»†èŠ‚ï¼Œæ²¡äº‹ç‚¹è¿›å»å„ç§å®å®šä¹‰å¾€å¾€ä¼šå¾—åˆ°æƒŠå–œï¼šå“‡ï¼ŒåŸæ¥æ˜¯è¿™ä¹ˆå›äº‹ï¼ŒXX å°±æ˜¯ XX ä¹‹ç±»ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.sealiesoftware.com/blog/archive/2013/09/24/objc_explain_Non-pointer_isa.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.sealiesoftware.com/blog/archive/2013/09/24/objc_explain_Non-pointer_isa.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.opensource.apple.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.opensource.apple.com&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;æœ¬æ–‡æ‰€ä½¿ç”¨çš„æºç ä¸º objc4-647 å’Œ CF-1153.18&lt;/li&gt;
&lt;li&gt;å®é™…ä¸Šè¿™æ˜¯æˆ‘æœ¬å‘¨å®ä¹ å‘¨æŠ¥çš„ä¸€éƒ¨åˆ†ï¼Œå†™çš„æ¯”è¾ƒä»“ä¿ƒï¼Œå¦‚æœ‰å·®é”™è¿˜è¯·å¤šå¤šæŒ‡æ­£ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è®²ç”¨æ³•ï¼Œåªè¯´åŸç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="http://yulingtianxia.com/tags/Objective-C/"/>
    
      <category term="Runtime" scheme="http://yulingtianxia.com/tags/Runtime/"/>
    
      <category term="Reference Counting" scheme="http://yulingtianxia.com/tags/Reference-Counting/"/>
    
  </entry>
  
  <entry>
    <title>è…¾è®¯å®ä¹ ç¬¬ä¸€ä¸ªæœˆå·¥ä½œæ€»ç»“</title>
    <link href="http://yulingtianxia.com/blog/2015/11/13/Summary-of-the-first-month-in-the-internship-of-Tencent/"/>
    <id>http://yulingtianxia.com/blog/2015/11/13/Summary-of-the-first-month-in-the-internship-of-Tencent/</id>
    <published>2015-11-13T15:55:38.000Z</published>
    <updated>2016-05-11T14:31:51.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¥è…¾è®¯å®ä¹ æ­£å¥½ä¸€ä¸ªæœˆäº†ï¼Œå› ä¸ºé¡¹ç›®å·²ç»è¿›å…¥äº†æˆç†ŸæœŸï¼Œæ¥äº†ä¸¤ä¸ªéœ€æ±‚ï¼Œæ”¹äº†äºŒåå‡ ä¸ª bugã€‚æ‰€ä»¥æŠŠè¿™æœŸé—´çš„ä¸€äº›æ€è€ƒå†™ä¸‹æ¥ï¼Œå‘äº†é‚®ä»¶åˆ†äº«ç»™ç»„å†…åŒäº‹ä»¬ã€‚æˆ‘æŠŠä¸€äº›è‡ªå·±è§‰å¾—ä¸åˆé€‚çš„å†…å®¹åˆ¨é™¤å‡ºå»ï¼Œé€‰å–é‚®ä»¶çš„éƒ¨åˆ†å†…å®¹å†™åœ¨è¿™é‡Œï¼šï¼‰&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;è®©-UIAlertController-å…¼å®¹-iOS7&quot;&gt;&lt;a href=&quot;#è®©-UIAlertController-å…¼å®¹-iOS7&quot; class=&quot;headerlink&quot; title=&quot;è®© UIAlertController å…¼å®¹ iOS7&quot;&gt;&lt;/a&gt;è®© UIAlertController å…¼å®¹ iOS7&lt;/h1&gt;&lt;h2 id=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#é—®é¢˜èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;/a&gt;é—®é¢˜èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;å…¬å¸é¡¹ç›®ä¸­ç”¨åˆ°äº† &lt;a href=&quot;http://yulingtianxia.com/blog/2014/09/29/uialertcontroller-in-ios8/&quot;&gt;&lt;code&gt;UIAlertController&lt;/code&gt;&lt;/a&gt; æ¥å®ç°è‡ªå®šä¹‰ actionsheet æ–‡å­—é¢œè‰²çš„éœ€æ±‚ï¼Œè€Œ &lt;code&gt;UIAlertController&lt;/code&gt; &lt;strong&gt;åªèƒ½åœ¨ iOS8 åŠæ›´é«˜ç‰ˆæœ¬ç³»ç»Ÿä½¿ç”¨ï¼Œåœ¨iOS7ä¸‹ä¼š crash&lt;/strong&gt;ã€‚è€å¤§è®©æˆ‘å†™ä¸ªç»„ä»¶å…¼å®¹ä¸‹ iOS7ï¼Œäºæ˜¯ &lt;code&gt;TBAlertController&lt;/code&gt; è¯ç”Ÿäº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ç»™å‡ºçš„å…³äº &lt;code&gt;TBAlertController&lt;/code&gt; çš„ä»£ç ç‰‡æ®µéƒ½ä¸æ˜¯çœŸå®æºç ï¼Œåªä¸ºè¯´æ˜å®ç°çš„å…·ä½“æ€æƒ³ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ†æé—®é¢˜&quot;&gt;&lt;a href=&quot;#åˆ†æé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æé—®é¢˜&quot;&gt;&lt;/a&gt;åˆ†æé—®é¢˜&lt;/h2&gt;&lt;p&gt;ä¸ºäº†å¤šå¿«å¥½çœçš„è§£å†³å½“å‰çš„é—®é¢˜ï¼Œæˆ‘ä¾ç„¶ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ &lt;code&gt;UIAlertController&lt;/code&gt; å’Œ &lt;code&gt;UIActionSheet&lt;/code&gt; åˆ†åˆ«å…¼å®¹ iOS8ã€9 å’Œ iOS7ã€‚å¹¶ä¸”æ¥å£ä¸ä»£ç ä¸­å·²ç»å­˜åœ¨çš„ &lt;code&gt;UIAlertController&lt;/code&gt; æ¥å£ä¸€è‡´ï¼Œè¿™æ ·åªéœ€è¦å°†ä»£ç ä¸­æ‰€æœ‰çš„ â€œUIAlertControllerâ€ å’Œ â€œUIAlertActionâ€ æ”¹ä¸º â€œTBAlertControllerâ€ å’Œ â€œTBAlertActionâ€ å³å¯ã€‚è¿™æ ·&lt;strong&gt;æ›´ç¬¦åˆè®¾è®¡æ¨¡å¼ä¸­â€œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­â€çš„å¼€æ”¾åŸåˆ™ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶æœ€é•¿è¿œçš„æ‰“ç®—åº”è¯¥æ˜¯è‡ªå·±å†™ä¸ª AlertControllerï¼Œå¯ä»¥éšæ„å®šåˆ¶æƒ³è¦çš„ styleï¼Œè€Œä¸å—ç³»ç»Ÿæ§ä»¶çš„é£æ ¼é™åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æŠ€æœ¯é‡ç‚¹&quot;&gt;&lt;a href=&quot;#æŠ€æœ¯é‡ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;æŠ€æœ¯é‡ç‚¹&quot;&gt;&lt;/a&gt;æŠ€æœ¯é‡ç‚¹&lt;/h2&gt;&lt;p&gt;&lt;code&gt;UIAlertController&lt;/code&gt; ä¸ &lt;code&gt;UIActionSheet&lt;/code&gt; æ¥å£ä¸Šæœ€å¤§çš„ä¸åŒä¹‹å¤„å°±æ˜¯å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ—¶å‰è€…åœ¨ block ä¸­å®ç°ï¼Œåè€…ä»¥ delegate å›è°ƒçš„å½¢å¼å®ç°ã€‚è€Œä¸”è¿˜éœ€è¦é«˜åº¦æ¨¡ä»¿ &lt;code&gt;UIAlertController&lt;/code&gt; çš„æ¥å£ï¼Œä½¿åŸæœ‰ä»£ç ä¿®æ”¹é‡è¾¾åˆ°æœ€å°‘ã€‚è€Œæˆ‘è‹¥æƒ³å®ç°ä¸€ä¸ªç»„ä»¶å…¼å®¹äºŒè€…ï¼Œé‚£å°±å¿…é¡»å°†å®ƒä»¬â€œè£…ç®±â€å°è£…ã€‚åŒç†ï¼Œ&lt;code&gt;UIAlertAction&lt;/code&gt; ä¹Ÿéœ€è¦ç±»ä¼¼çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è§£å†³æ€è·¯&quot;&gt;&lt;a href=&quot;#è§£å†³æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³æ€è·¯&quot;&gt;&lt;/a&gt;è§£å†³æ€è·¯&lt;/h2&gt;&lt;h3 id=&quot;æ„å»º-TBAlertAction-æ›¿ä»£-UIAlertAction&quot;&gt;&lt;a href=&quot;#æ„å»º-TBAlertAction-æ›¿ä»£-UIAlertAction&quot; class=&quot;headerlink&quot; title=&quot;æ„å»º TBAlertAction æ›¿ä»£ UIAlertAction&quot;&gt;&lt;/a&gt;æ„å»º TBAlertAction æ›¿ä»£ UIAlertAction&lt;/h3&gt;&lt;p&gt;é¦–å…ˆï¼Œå‚ç…§ &lt;code&gt;UIAlertAction&lt;/code&gt; çš„æ¥å£ï¼Œé€ ä¸€ä¸ª &lt;code&gt;TBAlertAction&lt;/code&gt; å‡ºæ¥ã€‚æ€æƒ³æ˜¯ iOS8ä»¥ä¸Šç›´æ¥ä½¿ç”¨ &lt;code&gt;UIAlertAction&lt;/code&gt; æ¥æ›¿ä»£ï¼ŒiOS7 åˆ™ç‰¹æ®Šå¤„ç†ï¼Œå°†é‡è¦ä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TBAlertAction&lt;/span&gt; ()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (nullable, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *title;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) TBAlertActionStyle style;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; enabled;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (nullable,&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^handler)(TBAlertAction *);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TBAlertAction&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)actionWithTitle:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)title style:(TBAlertActionStyle)style handler:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^)(TBAlertAction *))handler &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (iOS8Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIAlertActionStyle&lt;/span&gt; actionStyle = (&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)style;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;UIAlertAction&lt;/span&gt; actionWithTitle:title style:actionStyle handler:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^ __nullable)(&lt;span class=&quot;built_in&quot;&gt;UIAlertAction&lt;/span&gt; *))handler];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TBAlertAction *action = [[TBAlertAction alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        action.title = title;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        action.style = style;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        action.handler = handler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        action.enabled = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; action;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œçš„ &lt;code&gt;handler&lt;/code&gt; block å¾ˆé‡è¦ï¼Œåœ¨ iOS7 ä¸­ä½¿ç”¨ &lt;code&gt;UIActionSheet&lt;/code&gt; æ—¶æ˜¯åœ¨ delegate å›è°ƒæ–¹æ³•ä¸­å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„ï¼Œè€Œå¤„ç†çš„äº‹åŠ¡é€»è¾‘æ­¤æ—¶å·²ç»å†™åœ¨ &lt;code&gt;handler&lt;/code&gt; ä¸­äº†ï¼Œåç»­åªéœ€åœ¨ delegate å›è°ƒæ–¹æ³•ä¸­æ­£ç¡®çš„æ‰§è¡Œå¯¹åº”çš„ block å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ„å»º-TBAlertController-å±æ€§&quot;&gt;&lt;a href=&quot;#æ„å»º-TBAlertController-å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;æ„å»º TBAlertController å±æ€§&quot;&gt;&lt;/a&gt;æ„å»º TBAlertController å±æ€§&lt;/h3&gt;&lt;p&gt;&lt;code&gt;TBAlertController&lt;/code&gt; ä¹Ÿæ˜¯é‡‡å–è£…ç®±ç­–ç•¥ï¼Œæ¨¡ä»¿ &lt;code&gt;UIAlertController&lt;/code&gt; çš„æ¥å£ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ª &lt;code&gt;adaptiveAlert&lt;/code&gt; æ›¿èº«å’Œ &lt;code&gt;actions&lt;/code&gt; æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/TBAlertController.png&quot; alt=&quot;TBAlertController å±æ€§&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (iOS8Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _adaptiveAlert = [[&lt;span class=&quot;built_in&quot;&gt;UIAlertController&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _adaptiveAlert = [[&lt;span class=&quot;built_in&quot;&gt;UIActionSheet&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _actions = [&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; array];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ((&lt;span class=&quot;built_in&quot;&gt;UIActionSheet&lt;/span&gt; *)_adaptiveAlert).delegate = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; forKeyPath:&lt;span class=&quot;string&quot;&gt;@&quot;view.tintColor&quot;&lt;/span&gt; options:&lt;span class=&quot;built_in&quot;&gt;NSKeyValueObservingOptionNew&lt;/span&gt;|&lt;span class=&quot;built_in&quot;&gt;NSKeyValueObservingOptionOld&lt;/span&gt; context:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)dealloc &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; removeObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; forKeyPath:&lt;span class=&quot;string&quot;&gt;@&quot;view.tintColor&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (instancetype)alertControllerWithTitle:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)title message:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)message preferredStyle:(TBAlertControllerStyle)preferredStyle &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TBAlertController *controller = [[TBAlertController alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (iOS8Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        controller.adaptiveAlert = [&lt;span class=&quot;built_in&quot;&gt;UIAlertController&lt;/span&gt; alertControllerWithTitle:title message:message preferredStyle:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)preferredStyle];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (preferredStyle) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; TBAlertControllerStyleActionSheet: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                controller.adaptiveAlert = [[&lt;span class=&quot;built_in&quot;&gt;UIActionSheet&lt;/span&gt; alloc] initWithTitle:title delegate:controller cancelButtonTitle:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; destructiveButtonTitle:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; otherButtonTitles:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; TBAlertControllerStyleAlert: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                controller.adaptiveAlert = [[&lt;span class=&quot;built_in&quot;&gt;UIAlertView&lt;/span&gt; alloc] initWithTitle:title message:message delegate:controller cancelButtonTitle:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; otherButtonTitles: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; controller;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ®µå®ä¾‹åŒ– &lt;code&gt;TBAlertController&lt;/code&gt; çš„æ–¹æ³•å¾ˆå¥½ç†è§£ï¼Œæ€»ä¹‹å°±æ˜¯é’ˆå¯¹ä¸åŒæƒ…å†µå°† &lt;code&gt;adaptiveAlert&lt;/code&gt; èµ‹äºˆä¸åŒçš„å®ä¾‹ã€‚è¿˜é¡ºå¸¦ç”¨ KVO ç›‘å¬äº†ä¸‹ tintColorï¼Œè¿™æ˜¯ä¸ºäº†å®ç°å½“åˆä½¿ç”¨ &lt;code&gt;UIAlertController&lt;/code&gt; çš„ç›®çš„-æ”¹å˜å­—ä½“é¢œè‰²ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ„å»º-TBAlertController-æ–¹æ³•&quot;&gt;&lt;a href=&quot;#æ„å»º-TBAlertController-æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;æ„å»º TBAlertController æ–¹æ³•&quot;&gt;&lt;/a&gt;æ„å»º TBAlertController æ–¹æ³•&lt;/h3&gt;&lt;p&gt;&lt;code&gt;addAction:&lt;/code&gt; æ–¹æ³•çš„å®ç°ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é’ˆå¯¹ä¸åŒæƒ…å†µå‘ &lt;code&gt;actions&lt;/code&gt; æ•°ç»„æ·»åŠ ä¸åŒå†…å®¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addAction:(TBAlertAction *)action &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (iOS8Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.adaptiveAlert addAction:(&lt;span class=&quot;built_in&quot;&gt;UIAlertAction&lt;/span&gt; *)action];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.actions addObject:action];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; buttonIndex = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.adaptiveAlert addButtonWithTitle:action.title];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *textColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (action.style) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; TBAlertActionStyleDefault: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                textColor = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tintColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; TBAlertActionStyleCancel: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.adaptiveAlert setCancelButtonIndex:buttonIndex];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                textColor = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tintColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; TBAlertActionStyleDestructive: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.adaptiveAlert setDestructiveButtonIndex:buttonIndex];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                textColor = [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; redColor];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                textColor = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tintColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        [((UIButton *)((UIView *)self.adaptiveAlert).subviews.lastObject) setTitleColor:textColor forState:0xFFFFFFFF];&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯é’ˆå¯¹ä¸åŒ style çš„æŒ‰é’®è¦è®¾ç½®å¥½å¯¹åº”çš„ &lt;code&gt;buttonindex&lt;/code&gt; å’Œ &lt;code&gt;titleColor&lt;/code&gt;ã€‚å› ä¸ºè‹¹æœå¯èƒ½ä¼šæ‹’ç»ä¿®æ”¹ç³»ç»Ÿæ§ä»¶æ ·å¼çš„ app ä¸Šæ¶ï¼Œæ‰€ä»¥æˆ‘å°†é‚£è¡Œè®¾ç½®é¢œè‰²çš„ä»£ç æ³¨é‡Šæ‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨ delegate ä¸­å–åˆ°å¯¹åº”çš„ block å¹¶æ‰§è¡Œï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma - UIAlertViewDelegate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)alertView:(&lt;span class=&quot;built_in&quot;&gt;UIAlertView&lt;/span&gt; *)alertView clickedButtonAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)buttonIndex &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; __&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;)weakSelf = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.actions[buttonIndex].handler) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.actions[buttonIndex].handler(weakSelf.adaptiveAlert);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;hook-presentViewController-æ–¹æ³•&quot;&gt;&lt;a href=&quot;#hook-presentViewController-æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;hook presentViewController: æ–¹æ³•&quot;&gt;&lt;/a&gt;hook presentViewController: æ–¹æ³•&lt;/h3&gt;&lt;p&gt;æœ€åå°è£…ä¸‹ &lt;code&gt;presentViewController:&lt;/code&gt; å°±å¯ä»¥äº†ï¼Œå› ä¸ºè¦åšåˆ°æ¥å£ä¸ &lt;code&gt;UIAlertController&lt;/code&gt; ä¸€æ¨¡ä¸€æ ·ï¼Œå‡å°‘å·²æœ‰ä»£ç ä¿®æ”¹é‡ï¼Œéœ€è¦ hook åˆ°ç³»ç»Ÿçš„ &lt;code&gt;presentViewController:&lt;/code&gt; æ–¹æ³•ï¼Œå¹¶æŠ˜è…¾ä¸€ç•ªï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (void)load &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static &lt;span class=&quot;keyword&quot;&gt;dispatch_once_t &lt;/span&gt;onceToken&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;dispatch_once(&amp;amp;onceToken, &lt;/span&gt;^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Class aClass = [self class]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SEL &lt;span class=&quot;keyword&quot;&gt;originalSelector &lt;/span&gt;= @selector(presentViewController:animated:completion:)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SEL &lt;span class=&quot;keyword&quot;&gt;swizzledSelector &lt;/span&gt;= @selector(tb_presentViewController:animated:completion:)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Method &lt;span class=&quot;keyword&quot;&gt;originalMethod &lt;/span&gt;= class_getInstanceMethod(aClass, &lt;span class=&quot;keyword&quot;&gt;originalSelector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        Method &lt;span class=&quot;keyword&quot;&gt;swizzledMethod &lt;/span&gt;= class_getInstanceMethod(aClass, &lt;span class=&quot;keyword&quot;&gt;swizzledSelector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;BOOL &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;didAddMethod &lt;/span&gt;=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        class_addMethod(aClass,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;originalSelector,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;                        method_getImplementation(&lt;span class=&quot;keyword&quot;&gt;swizzledMethod),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;                        method_getTypeEncoding(&lt;span class=&quot;keyword&quot;&gt;swizzledMethod));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (&lt;span class=&quot;keyword&quot;&gt;didAddMethod) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            class_replaceMethod(aClass,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;swizzledSelector,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;                                method_getImplementation(&lt;span class=&quot;keyword&quot;&gt;originalMethod),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;                                method_getTypeEncoding(&lt;span class=&quot;keyword&quot;&gt;originalMethod));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            method_exchangeImplementations(&lt;span class=&quot;keyword&quot;&gt;originalMethod, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;swizzledMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#pragma mark - Method Swizzling&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)tb_presentViewController:(UIViewController *)viewControllerToPresent animated:(&lt;span class=&quot;keyword&quot;&gt;BOOL)flag &lt;/span&gt;completion:(void (^)(void))completion &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ([viewControllerToPresent isKindOfClass:[TBAlertController class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TBAlertController* controller = (TBAlertController *)viewControllerToPresent&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (iOS8Later) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ((UIAlertController *)controller.adaptiveAlert).view.tintColor = controller.tintColor&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [self tb_presentViewController:((TBAlertController *)viewControllerToPresent).adaptiveAlert animated:flag completion:completion]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if ([controller.adaptiveAlert isKindOfClass:[UIAlertView class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.tbAlertController = controller&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                controller.ownerController = self&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [controller.adaptiveAlert &lt;span class=&quot;keyword&quot;&gt;show];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            else if ([controller.adaptiveAlert isKindOfClass:[UIActionSheet class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.tbAlertController = controller&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                controller.ownerController = self&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [controller.adaptiveAlert &lt;span class=&quot;keyword&quot;&gt;showInView:self.view];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [self tb_presentViewController:viewControllerToPresent animated:flag completion:completion]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ Objective-C ä¸­ï¼Œhook è¢«ç§°ä¸ºä¸€ç§å«åšâ€œMethod Swizzlingâ€çš„æŠ€æœ¯ï¼Œæ¯ç§åŠ¨æ€è¯­è¨€çš„ &lt;a href=&quot;http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/&quot;&gt;Runtime&lt;/a&gt; ç³»ç»Ÿéƒ½æ”¯æŒè¿™äº›ç‰¹æ€§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘åœ¨ hook åˆ°çš„æ–¹æ³•é‡Œå…ˆå®ä¾‹åŒ–ä¸€ä¸ª &lt;code&gt;TBAlertController&lt;/code&gt;ï¼Œç„¶ååˆ¤æ–­ç³»ç»Ÿç‰ˆæœ¬ï¼Œåˆ†åˆ«å°† &lt;code&gt;UIAlertController&lt;/code&gt; æˆ– &lt;code&gt;UIAlertView&lt;/code&gt;ã€&lt;code&gt;UIActionSheet&lt;/code&gt;å±•ç¤ºå‡ºæ¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹&quot;&gt;&lt;a href=&quot;#è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹&quot; class=&quot;headerlink&quot; title=&quot;è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹&quot;&gt;&lt;/a&gt;è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹&lt;/h3&gt;&lt;p&gt;è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;UIAlertController&lt;/code&gt; æ—¶ï¼Œå¿…éœ€åœ¨æ·»åŠ å®Œæ‰€æœ‰ Action ä¹‹åæ‰èƒ½è®¾å®šå®ƒçš„ &lt;code&gt;view.tintColor&lt;/code&gt; å±æ€§ï¼Œå¦åˆ™ä¼šåœ¨ iOS8 ä¸‹å‡ºç°é—®é¢˜ï¼šå–æ¶ˆæŒ‰é’®ä¸å…¶ä»–æŒ‰é’®è¿æˆä¸€ç‰‡ã€‚è€Œåœ¨ iOS9 ä¸‹é¢åˆ™ä¸ä¼šå‡ºç°æ­¤é—®é¢˜ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¼šåœ¨ hook åˆ° &lt;code&gt;presentViewController:&lt;/code&gt; æ—¶æ‰è®¾å®šå®ƒçš„  &lt;code&gt;tintColor&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦ &lt;code&gt;adaptiveAlert&lt;/code&gt; æ›¿èº«è¢«å±•ç°åœ¨å±å¹•ä¸Šï¼Œ &lt;code&gt;TBAlertController&lt;/code&gt; è¿™ä¸ªç®±å­å°±å¯èƒ½ä¼šè¢«é‡Šæ”¾æ‰ã€‚å› ä¸ºå¾ˆå¯èƒ½å…¶ä»–äººåˆ›å»º &lt;code&gt;TBAlertController&lt;/code&gt; å®ä¾‹çš„æ—¶å€™åªæ˜¯ä¸ªå±€éƒ¨å˜é‡ï¼Œä¸€æ—¦å‡ºäº†ä½œç”¨åŸŸï¼Œå®ƒå°±ä¼šè¢«é‡Šæ”¾æ‰ï¼Œè€Œä¸€æ—¦å®ƒè¢«æå‰é‡Šæ”¾ï¼Œdelegate å›è°ƒæ–¹æ³•å°±æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œå‰é¢çš„åŠªåŠ›éƒ½ç™½è´¹äº†ï¼Œæ­£å¦‚ä¸‹é¢è¿™æ ·ï¼š&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;TBAlertController *operationAlertController = [TBAlertController &lt;span class=&quot;string&quot;&gt;alertControllerWithTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;æ˜¯å¦å–æ¶ˆå…³æ³¨&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;message:&lt;/span&gt;nil &lt;span class=&quot;string&quot;&gt;preferredStyle:&lt;/span&gt;TBAlertControllerStyleActionSheet];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[operationAlertController &lt;span class=&quot;string&quot;&gt;addAction:&lt;/span&gt;[TBAlertAction &lt;span class=&quot;string&quot;&gt;actionWithTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;æ˜¯&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;style:&lt;/span&gt;TBAlertActionStyleDestructive &lt;span class=&quot;string&quot;&gt;handler:&lt;/span&gt;^(TBAlertAction * _Nonnull action) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       [self &lt;span class=&quot;string&quot;&gt;alertControllerHandler:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;clickedButtonAtIndex:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   [operationAlertController &lt;span class=&quot;string&quot;&gt;addAction:&lt;/span&gt;[TBAlertAction &lt;span class=&quot;string&quot;&gt;actionWithTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;å¦&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;style:&lt;/span&gt;TBAlertActionStyleCancel &lt;span class=&quot;string&quot;&gt;handler:&lt;/span&gt;nil]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   operationAlertController.view.tintColor = [UIColor blackColor];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   [[[TBRootViewController sharedInstance] getCurrentNavigationController] &lt;span class=&quot;string&quot;&gt;presentViewController:&lt;/span&gt;operationAlertController &lt;span class=&quot;string&quot;&gt;animated:&lt;/span&gt;YES &lt;span class=&quot;string&quot;&gt;completion:&lt;/span&gt;nil];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘æ€»ä¸èƒ½å¼ºåˆ¶è¦æ±‚æ‰€æœ‰ä½¿ç”¨ &lt;code&gt;TBAlertController&lt;/code&gt; çš„äººéƒ½è¦ç”¨ä¸€ä¸ªå±æ€§æ¥å¼ºå¼•ç”¨å®ƒå§?æ‰€ä»¥æˆ‘ä¸º &lt;code&gt;UIViewController&lt;/code&gt; æ·»åŠ äº†ä¸€ä¸ªç±»åˆ«ï¼Œç›®çš„æ˜¯ä¸ºå…¶å¢åŠ ä¸€ä¸ªå±æ€§ &lt;code&gt;tbAlertController&lt;/code&gt;ï¼ˆå› ä¸º OC çš„ç±»åˆ«æ— æ³•ä¸ºæ·»åŠ çš„å±æ€§è‡ªåŠ¨ç”Ÿæˆ getter å’Œ setterï¼Œéœ€è¦ä½¿ç”¨å…³è”å¯¹è±¡åŠ¨æ€æ·»åŠ ï¼‰ï¼Œåˆ©ç”¨å®ƒæ¥ä¿æŒå¯¹â€œç®±å­â€ &lt;code&gt;TBAlertController&lt;/code&gt; çš„å¼ºå¼•ç”¨ï¼Œé˜²æ­¢å…¶å†…å­˜è¢«è¿‡æ—©é‡Šæ”¾ã€‚å¹¶åœ¨ hook æ—¶çš„ &lt;code&gt;tb_presentViewController:&lt;/code&gt; æ–¹æ³•ä¸­æ·»åŠ è¿™æ ·ä¸€è¡Œï¼š&lt;br&gt;&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self.tbAlertController &lt;/span&gt;= controller&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶åˆæ¶‰åŠåˆ°äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå†…å­˜æ³„éœ²ã€‚å› ä¸ºæˆ‘ä»¬æ— æ³•ç¡®å®šå…¶ä»–äººåœ¨å®ä¾‹åŒ– &lt;code&gt;TBAlertAction&lt;/code&gt; æ—¶ä¼ å…¥çš„ block ä¸­åšäº†ä»€ä¹ˆï¼Œå› ä¸ºå®ƒå¾ˆæœ‰å¯èƒ½æ•è·åˆ°äº† &lt;code&gt;self&lt;/code&gt;ï¼è€Œæ­¤æ—¶ &lt;code&gt;self&lt;/code&gt; å¾ˆå¯èƒ½å¼ºå¼•ç”¨äº†ä¸€ä¸ª &lt;code&gt;UIViewController&lt;/code&gt;ï¼Œç„¶åå…¶ &lt;code&gt;tbAlertController&lt;/code&gt; å±æ€§åˆå¼ºå¼•ç”¨äº† &lt;code&gt;TBAlertController&lt;/code&gt;ï¼Œè¿™ä¸ª &lt;code&gt;TBAlertController&lt;/code&gt; çš„ &lt;code&gt;actions&lt;/code&gt; æ•°ç»„ä¸­çš„ä¸€ä¸ª &lt;code&gt;TBAlertAction&lt;/code&gt; å¼ºå¼•ç”¨äº†è¿™ä¸ª blockã€‚å¥½é•¿çš„ä¸€ä¸ªä¿ç•™ç¯å•Šï¼é‚£ä¹ˆå¦‚ä½•æ‰“ç ´è¿™ä¸ªç¯å‘¢ï¼Ÿæˆ‘æ€»ä¸èƒ½è¦æ±‚ä½¿ç”¨è€…å¿…éœ€åœ¨ block å†…å¤–åšä¸ª &lt;a href=&quot;http://ashfurrow.com/blog/weakstrong-dance/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Weak/Strong Dance&lt;/a&gt; å§ï¼æ¯•ç«Ÿâ€œè°åˆ›å»ºï¼Œè°é‡Šæ”¾â€çš„è§„åˆ™æˆ‘ä»¬è¿˜æ˜¯è¦éµå®ˆçš„ï¼Œå¿…éœ€åœ¨ç»„ä»¶å†…éƒ¨è§£å†³å¯èƒ½å‘ç”Ÿçš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚äºæ˜¯æˆ‘ç»™ &lt;code&gt;TBAlertController&lt;/code&gt; åˆæ·»åŠ äº†ä¸€ä¸ªå±æ€§ &lt;code&gt;ownerController&lt;/code&gt;ï¼Œæ³¨æ„å†…å­˜ç®¡ç†è¯­ä¹‰æ˜¯ &lt;code&gt;weak&lt;/code&gt;ï¼š&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (nullable,&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; *ownerController;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨ &lt;code&gt;tb_presentViewController:&lt;/code&gt; æ–¹æ³•ä¸­å†æ·»åŠ ä¸€è¡Œä»£ç ï¼Œå°† &lt;code&gt;TBAlertController&lt;/code&gt; çš„ &lt;code&gt;ownerController&lt;/code&gt; è®¾ä¸ºè°ƒç”¨ &lt;code&gt;presentViewController:&lt;/code&gt; æ–¹æ³•çš„ controllerï¼š&lt;br&gt;&lt;figure class=&quot;highlight crystal&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;controller.ownerController = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æœ€ååœ¨ &lt;code&gt;UIAlertView&lt;/code&gt; æˆ– &lt;code&gt;UIActionSheet&lt;/code&gt; æ¶ˆå¤±æ—¶å°† &lt;code&gt;tbAlertController&lt;/code&gt; è®¾ä¸º &lt;code&gt;nil&lt;/code&gt; å°±æ‰“ç ´ä¿ç•™ç¯äº†ï¼Œå®ƒåŸæœ¬æŒ‡å‘ &lt;code&gt;TBAlertController&lt;/code&gt; è‡ªå·±ï¼Œè®¾ä¸º &lt;code&gt;nil&lt;/code&gt; åï¼Œæ²¡æœ‰å¯¹è±¡å¼•ç”¨ &lt;code&gt;TBAlertController&lt;/code&gt; å®ä¾‹äº†ï¼Œå…¶å¼•ç”¨è®¡æ•°ä¸ºé›¶ï¼Œç„¶åè¢«é‡Šæ”¾ï¼š&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)actionSheet:(&lt;span class=&quot;built_in&quot;&gt;UIActionSheet&lt;/span&gt; *)actionSheet didDismissWithButtonIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)buttonIndex &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.ownerController.tbAlertController = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰åœ¨è¿™é‡Œé˜è¿°ï¼Œæ¯”å¦‚å¯¹å±æ€§çš„å°è£…ï¼Œè¿˜æœ‰å¯¹ &lt;code&gt;addTextFieldWithConfigurationHandler:&lt;/code&gt; ç­‰æ¥å£çš„å°è£…ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®æ—©å·²æœ‰äººåšè¿‡ç±»ä¼¼çš„äº‹æƒ…ï¼Œå°†ç³»ç»Ÿç»„ä»¶å°è£…æˆå…¼å®¹çš„ç‰ˆæœ¬ï¼š&lt;a href=&quot;https://github.com/steipete/PSTAlertController&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PSTAlertController&lt;/a&gt;ã€‚ä½†å…¶æ¥å£ä¸åŸç”Ÿçš„ &lt;code&gt;UIAlertController&lt;/code&gt; å·®å¾ˆå¤šï¼Œéœ€è¦æ‰‹åŠ¨æ›¿æ¢å¾ˆå¤šå·²æœ‰çš„ä»£ç ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ„Ÿæ‚Ÿ-amp-æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ„Ÿæ‚Ÿ-amp-æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ„Ÿæ‚Ÿ&amp;amp;æ€»ç»“&quot;&gt;&lt;/a&gt;æ„Ÿæ‚Ÿ&amp;amp;æ€»ç»“&lt;/h2&gt;&lt;p&gt;åœ¨è¿™é‡Œè¿˜æƒ³è¯´ä¸‹å…³äº block ä¸­çš„ &lt;a href=&quot;http://ashfurrow.com/blog/weakstrong-dance/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Weak/Strong Dance&lt;/a&gt; çš„é—®é¢˜ã€‚æˆ‘çœ‹åˆ°é¡¹ç›®ä¸­å¥½å¤šå¸¦æœ‰ block çš„ä»£ç éƒ½ä½¿ç”¨ä¸€äº›å®å®šä¹‰ï¼Œæ¯”å¦‚ &lt;a href=&quot;http://blog.aceontech.com/post/111694918560/weakifyself-a-more-elegant-solution-to&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;@weakify(self): A more elegant solution to weakSelf in Objective-C&lt;/a&gt;ï¼Œè€Œä¸ªåˆ« block å…¶å®æ˜¯ä¸éœ€è¦ä½¿ç”¨ weakSelf çš„ï¼Œè¿™äº› block çš„æ‹¥æœ‰è€…å¹¶æ²¡è¢« &lt;code&gt;self&lt;/code&gt; åœ¨å…¶ç”Ÿå­˜å‘¨æœŸå§‹ç»ˆå¼ºå¼•ç”¨ç€ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç”¨ weakSelfã€‚åè€Œåœ¨å°‘æ•°æç«¯æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚å¼‚æ­¥å»¶æ—¶æ‰§è¡Œ blockï¼‰å› ä¸ºæ•è·çš„æ˜¯ weakSelfï¼Œè€Œåœ¨ block æ‰§è¡Œå‰ self å·²ç»æ˜¯ &lt;code&gt;nil&lt;/code&gt;ã€‚æ­¤æ—¶ä¸è¦æŒ‡æœ› block ä¸­çš„ strongSelf ä¼šå¸®åˆ°ä»€ä¹ˆå¿™ï¼Œå› ä¸ºå®ƒåŠ›æ‰€èƒ½åŠçš„åªæ˜¯åœ¨ block æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿è¯å¯¹ weakSelf çš„å¼ºå¼•ç”¨ã€‚å¦‚è‹¥ weakSelf ä¸å†æŒ‡å‘ &lt;code&gt;self&lt;/code&gt; è€Œæ˜¯ &lt;code&gt;nil&lt;/code&gt;ï¼Œblock ä¸­çš„å†…å®¹è‚¯å®šä¸ä¼šæ­£å¸¸æ‰§è¡Œï¼ˆè¿™ä¸ä»£è¡¨ä¸€å®šä¼š crashï¼Œå‘ &lt;code&gt;nil&lt;/code&gt; å‘é€æ¶ˆæ¯ä¼šæ‰§è¡Œé»˜è®¤çš„è¡Œä¸ºï¼‰ã€‚&lt;/p&gt;
&lt;h1 id=&quot;LLDB-è°ƒè¯•-UI-çš„æŠ€å·§&quot;&gt;&lt;a href=&quot;#LLDB-è°ƒè¯•-UI-çš„æŠ€å·§&quot; class=&quot;headerlink&quot; title=&quot;LLDB è°ƒè¯• UI çš„æŠ€å·§&quot;&gt;&lt;/a&gt;LLDB è°ƒè¯• UI çš„æŠ€å·§&lt;/h1&gt;&lt;h2 id=&quot;é—®é¢˜èƒŒæ™¯-1&quot;&gt;&lt;a href=&quot;#é—®é¢˜èƒŒæ™¯-1&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;/a&gt;é—®é¢˜èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;åœ¨ Xcode æ·»åŠ  View Debugging ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥è°ƒè¯• UI ç•Œé¢ã€‚ä¸€ç§æ˜¯èŠ±é’±ä¹° &lt;a href=&quot;http://revealapp.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Reveal&lt;/a&gt; äº«å—è§†å›¾å±‚çº§å¯è§†åŒ–è°ƒè¯•ï¼Œå¦ä¸€ç§æ˜¯ç”¨ lldbï¼ˆæ›´æ—©æ˜¯ gdbï¼‰å‘½ä»¤æ¥è°ƒè¯•ã€‚è€Œå¦‚ä»Š Xcode å·²ç»æä¾›äº†éƒ¨åˆ†å®¡æŸ¥è§†å›¾å…ƒç´ å’Œå±‚çº§çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒè¯•æ—¶æ˜¾ç¤ºæ¯ä¸ªè§†å›¾çš„ frame å¤–æ¡†å’Œè§†å›¾çš„æ¸²æŸ“çŠ¶å†µç­‰ã€‚è¿™å·²ç»æ»¡è¶³äº†å¾ˆå¤§éƒ¨åˆ†çš„ UI è°ƒè¯•éœ€æ±‚ã€‚&lt;a href=&quot;https://www.jetbrains.com/objc/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AppCode&lt;/a&gt; åˆ™é€‰æ‹©äº†ä¸ &lt;a href=&quot;http://revealapp.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Reveal&lt;/a&gt; é›†æˆï¼Œè™½ç„¶ jetbrains å¤§æ³•å¥½ï¼Œä½†ä¹Ÿæœ‰ä¸ç»™åŠ›çš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç”¨-LLDB-æ”¹å˜è§†å›¾&quot;&gt;&lt;a href=&quot;#ç”¨-LLDB-æ”¹å˜è§†å›¾&quot; class=&quot;headerlink&quot; title=&quot;ç”¨ LLDB æ”¹å˜è§†å›¾&quot;&gt;&lt;/a&gt;ç”¨ LLDB æ”¹å˜è§†å›¾&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;strong&gt;iOS7 ä¸Š Xcode å¹¶ä¸æ”¯æŒæ•è·å¯è§†åŒ–çš„è§†å›¾å±‚çº§ï¼Œæˆ‘ä»¬åªèƒ½ç”¨ lldb çš„å‘½ä»¤æ¥è¾“å‡ºè§†å›¾å±‚çº§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight inform7&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;po &lt;span class=&quot;comment&quot;&gt;[&lt;span class=&quot;comment&quot;&gt;[&lt;span class=&quot;comment&quot;&gt;[UIApplication sharedApplication]&lt;/span&gt; keyWindow]&lt;/span&gt; recursiveDescription]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;po&lt;/code&gt; æ˜¯ &lt;code&gt;p object&lt;/code&gt; çš„ç¼©å†™ï¼Œè€Œ &lt;code&gt;p&lt;/code&gt; åˆæ˜¯ &lt;code&gt;print&lt;/code&gt; çš„ç¼©å†™ï¼Œ&lt;code&gt;print&lt;/code&gt; åˆæ˜¯ &lt;code&gt;expression --&lt;/code&gt;çš„ç¼©å†™ã€‚&lt;code&gt;expression&lt;/code&gt; å°±æ˜¯ &lt;code&gt;e&lt;/code&gt; å‘½ä»¤ï¼Œè€Œ &lt;code&gt;--&lt;/code&gt; ä»£è¡¨æ ‡è¯†çš„ç»“æŸã€‚ä¸Šé¢è¿™æ¡å‘½ä»¤çš„å‚æ•°æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è®¿é—®ï¼Œæ— éœ€åœ¨ç‰¹å®šä½ç½®åŠ æ–­ç‚¹ï¼Œåªéœ€ç‚¹æš‚åœæŒ‰é’®å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;e&lt;/code&gt; å‘½ä»¤ï¼Œå¯ä»¥&lt;em&gt;åœ¨è°ƒè¯•æ—¶æ”¹å˜å˜é‡çš„å€¼ï¼Œæ¯”å¦‚æŸä¸ªè§†å›¾çš„é€æ˜åº¦ã€èƒŒæ™¯é¢œè‰²ç­‰ï¼Œè¿˜å¯ä»¥ä¸´æ—¶åˆ›å»ºæ–°çš„è§†å›¾æˆ–è€…è§†å›¾æ§åˆ¶å™¨ï¼Œç”šè‡³å¯ä»¥å®Œæˆè§†å›¾æ§åˆ¶å™¨çš„ push æ“ä½œ&lt;/em&gt;ã€‚è™½ç„¶æ­¤æ—¶ç¨‹åºï¼ˆæŸä¸ªè¿›ç¨‹ï¼‰æ˜¯è¢«æˆ‘ä»¬æš‚åœäº†çš„ï¼Œä½†æ˜¯åå°çš„æ¸²æŸ“æœåŠ¡æ˜¯ç”±åå°çš„å¦ä¸€ä¸ªè¿›ç¨‹å®Œæˆçš„ï¼Œæ‰€ä»¥å¯ä»¥&lt;strong&gt;å¼ºåˆ¶è§¦å‘æ¸²æŸ“æœåŠ¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;e (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)[CATransaction &lt;span class=&quot;built_in&quot;&gt;flush&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ä½¿ç”¨-Chisel-ç®€åŒ–-LLDB-å‘½ä»¤&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨-Chisel-ç®€åŒ–-LLDB-å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ Chisel ç®€åŒ– LLDB å‘½ä»¤&quot;&gt;&lt;/a&gt;ä½¿ç”¨ Chisel ç®€åŒ– LLDB å‘½ä»¤&lt;/h2&gt;&lt;p&gt;è™½ç„¶è°ƒè¯•å™¨ä¹Ÿæœ‰ä¸€å®šçš„ä»£ç è¡¥å…¨åŠŸèƒ½ï¼Œä½†æ˜¯æ¯•ç«Ÿç¨‹åºå‘˜çš„æ—¶é—´æ˜¯å®è´µçš„ï¼Œ Xcode çš„è°ƒè¯•å™¨æ¯•ç«Ÿè¿˜æ²¡åšåˆ° zsh é‚£æ ·å±Œç‚¸å¤©ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„â€œç¼©å†™â€å‘½ä»¤ã€‚Facebook çš„ç¨‹åºå‘˜ä»¬æœ€å…ˆæŒ‰æºä¸ä½ï¼ˆæ¯•ç«Ÿäººå®¶åšä¸ªå®¢æˆ·ç«¯å°±è¦åŠ¨è¾„å‡ ç™¾å·äººï¼‰ï¼Œå¼€å‘äº†ä¸€ä¸ªåŸºäº lldb çš„å·¥å…·ï¼š&lt;a href=&quot;https://github.com/facebook/chisel&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;chisel&lt;/a&gt;ã€‚ä»æ­¤ï¼Œè¾“å‡ºè§†å›¾å±‚çº§åªéœ€è¦ä¸€æ¡å‘½ä»¤ï¼š&lt;code&gt;pviews&lt;/code&gt;ï¼Œè¾“å‡ºè§†å›¾æ§åˆ¶å™¨å±‚çº§ä¹Ÿæ˜¯ä¸€æ¡å‘½ä»¤ï¼š&lt;code&gt;pvc&lt;/code&gt;ï¼Œåˆ·æ–°æ¸²æŸ“æœåŠ¡æ›´æ˜¯ä¸€æ¡å‘½ä»¤ï¼š&lt;code&gt;caflush&lt;/code&gt;ã€‚å®‰è£… chisel æ›´æ˜¯ç®€å•ï¼Œç›´æ¥ç”¨ &lt;a href=&quot;http://brew.sh&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Homebrew&lt;/a&gt; åˆ†åˆ†é’Ÿæå®šï¼Œå› ä¸º Homebrew åœ¨ OSX ä¸Šå¤ªç«ï¼Œæœ‰äººè¿˜ä¸“é—¨åšäº†ä¸ªå¸¦å›¾å½¢ç•Œé¢çš„å®¢æˆ·ç«¯ &lt;a href=&quot;https://www.cakebrew.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Cakebrew&lt;/a&gt;ï¼Œç®€ç›´éªšå¾—ä¸å¾—äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶æˆ‘ä»¬æ— éœ€æŸ¥çœ‹å®Œæ•´çš„è§†å›¾å±‚çº§æ ‘ï¼Œ&lt;code&gt;pviews&lt;/code&gt; åé¢å¯ä»¥é™„å¸¦å‚æ•°ï¼ŒæŸ¥çœ‹å½“å‰ view ä¸ºæ ¹èŠ‚ç‚¹ä¸‹çš„å±‚çº§æ ‘ã€‚é»˜è®¤ä¸å¸¦å‚æ•°å°±æ˜¯å®Œæ•´æ‰“å°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æˆ‘çš„å®è·µä¸æ„Ÿæ‚Ÿ&quot;&gt;&lt;a href=&quot;#æˆ‘çš„å®è·µä¸æ„Ÿæ‚Ÿ&quot; class=&quot;headerlink&quot; title=&quot;æˆ‘çš„å®è·µä¸æ„Ÿæ‚Ÿ&quot;&gt;&lt;/a&gt;æˆ‘çš„å®è·µä¸æ„Ÿæ‚Ÿ&lt;/h2&gt;&lt;p&gt;æœ€ç›´è§‚çš„è¿˜æ˜¯èƒ½å¯è§†åŒ–åœ°æŸ¥çœ‹è§†å›¾å±‚çº§ï¼Œæ¯”å¦‚æŸä¸ªè§†å›¾ä¸ºä½•ä¸æ˜¾ç¤ºï¼Ÿæ˜¯å› ä¸º hidden äº†è¿˜æ˜¯ alpha é—®é¢˜ï¼Œæˆ–æ˜¯è¢«å…¶ä»–è§†å›¾é®æŒ¡ä½äº†ï¼Ÿæ•è·ä¸‹è§†å›¾å±‚çº§ä¸€çœ‹ä¾¿çŸ¥ã€‚ä½†å…¶ç¼ºç‚¹æ˜¯æ•è·é€Ÿåº¦è¾ƒæ…¢ï¼Œè§†å›¾å±‚çº§è¾ƒä¸ºå¤æ‚æ—¶ï¼ŒæŸ¥æ‰¾æ˜ç¡®ç±»å‹çš„è§†å›¾æˆ–è€…æ˜ç¡®å†…å­˜åœ°å€çš„è§†å›¾å¯¹è±¡è¾ƒä¸ºå›°éš¾ã€‚æ‰€ä»¥ lldb è°ƒè¯• UI è¿˜æ˜¯æœ‰ä¸€å®šä¼˜åŠ¿çš„ï¼Œå°¤å…¶æ˜¯åœ¨åŠ¨ç”»ç¹å¤šç•Œé¢å˜åŒ–èŠ‚å¥è¾ƒå¿«æ—¶ä¹Ÿä¼šéœ€è¦ç”¨åˆ°ã€‚æˆ‘åœ¨è°ƒè¯•â€œå›¾ç‰‡é€‰æ‹©å™¨è§¦å‘æ‘„åƒå¤´æ‹ç…§åå±å¹•å˜é»‘æ— ååº”â€çš„ bug æ—¶å°±æ˜¯é  &lt;code&gt;pvc&lt;/code&gt; å’Œ &lt;code&gt;pviews&lt;/code&gt; è¿™ä¸¤ä¸ªå‘½ä»¤æ¥å¼„æ¸…è§†å›¾æ§åˆ¶å™¨ä¸è§†å›¾ä¹‹é—´å¤æ‚çš„å±‚çº§ã€‚è¡¨é¢ä¸Šçœ‹æ˜¯å›¾ç‰‡é€‰æ‹©å™¨çš„åŸå› ï¼Œå› ä¸ºå…¶ä»–ç”¨åˆ°æ‘„åƒå¤´ç»„ä»¶çš„åœ°æ–¹å¹¶æ²¡æœ‰è¿™ä¸ª bugï¼Œå…¶å®æ‘„åƒå¤´ç»„ä»¶å¯¹å¤–éƒ¨è°ƒç”¨æœ‰ä¸€äº›ä¾èµ–æ¡ä»¶ï¼Œä¸€æ—¦ä¸æ»¡è¶³å°±ä¼šäº§ç”Ÿ bugã€‚æœ€åæ›´æ”¹æ‹ç…§æ§ä»¶çš„å®ç°ï¼Œå¼ƒç”¨äº† &lt;code&gt;UIWindow&lt;/code&gt; å’Œä¸€äº›è§†å›¾æ§åˆ¶å™¨ï¼Œç®€åŒ–å±‚çº§ï¼Œä»æºå¤´ä¸Šæ¶ˆé™¤äº† bugã€‚&lt;/p&gt;
&lt;h1 id=&quot;é¡¹ç›®å®è·µç®¡ç†ç»éªŒ&quot;&gt;&lt;a href=&quot;#é¡¹ç›®å®è·µç®¡ç†ç»éªŒ&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®å®è·µç®¡ç†ç»éªŒ&quot;&gt;&lt;/a&gt;é¡¹ç›®å®è·µç®¡ç†ç»éªŒ&lt;/h1&gt;&lt;p&gt;åœ¨å…¬å¸é¡¹ç›®ä¸­æˆ‘å‘ç°äº†æœ‰å…³é¡¹ç›®èµ„æºç®¡ç†çš„ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å›¾ç‰‡èµ„æºä½¿ç”¨æ–‡ä»¶å¤¹ç®¡ç†&lt;/li&gt;
&lt;li&gt;æ–‡æ¡ˆ hardcode&lt;/li&gt;
&lt;li&gt;å·¥ç¨‹æ–‡ä»¶ project.pbxproj å†²çªåˆå¹¶&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;å›¾ç‰‡èµ„æºç®¡ç†&quot;&gt;&lt;a href=&quot;#å›¾ç‰‡èµ„æºç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;å›¾ç‰‡èµ„æºç®¡ç†&quot;&gt;&lt;/a&gt;å›¾ç‰‡èµ„æºç®¡ç†&lt;/h2&gt;&lt;p&gt;æˆ‘è§‰å¾—å›¾ç‰‡æœ€å¥½æ˜¯æ”¾åœ¨ xcassets ä¸­ï¼Œå› ä¸ºå¥½å¤„ç®€ç›´æ˜¯ä¸€å¤§å †ã€‚æ¯”å¦‚å¯¹å¤šåˆ†è¾¨ç‡å¤šè®¾å¤‡çš„æ”¯æŒï¼ŒçŸ¢é‡pdfå›¾ç‰‡çš„æ”¯æŒï¼Œç±»ä¼¼å®‰å“â€œ9.pngâ€çš„å›¾ç‰‡ slicing æ”¯æŒï¼Œæ›´æ”¹å›¾ç‰‡é¢œè‰²å’Œ Xcode7 æ–°å¢çš„â€œOn Demand Resourceâ€ç­‰ç­‰ã€‚å¦‚æœå›¾ç‰‡è¿‡å¤šï¼Œè¿˜å¯ä»¥åœ¨ xcassets ä¸­å†å»ºç«‹ xcassets å˜›ï¼Œå¦‚æœæœ‰æ‰“åŒ…éœ€è¦å¯ä»¥é…åˆä¸Š Bundleã€‚&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡ä¸€æ—¦ç”¨ Asset Catalog ç®¡ç†åï¼Œåœ¨ç¨‹åºä¸­åŠ è½½å›¾ç‰‡åªéœ€è¦ç”¨å›¾ç‰‡åè€Œæ— éœ€åç¼€åï¼Œæ›´ä¸ç”¨å…³å¿ƒå‡ å€åˆ†è¾¨ç‡ï¼Œæ˜¯ç”¨2x è¿˜æ˜¯ 3xï¼ŸXcode å…¨éƒ½å¸®æˆ‘ä»¬æå®šäº†ï¼ä¹‹å‰ç¢°åˆ°è¿‡ä¸€ä¸ª iOS7 ä¸Šå›¾ç‰‡è¢«æ‹‰ä¼¸çš„ bugï¼ŒåŸå› å°±æ˜¯æ²¡æœ‰ä½¿ç”¨ Asset Catalog ç®¡ç†å›¾ç‰‡èµ„æºï¼Œè€Œæ˜¯ç›´æ¥ç”¨æ–‡ä»¶å¤¹ã€‚è€Œåœ¨ä»£ç ä¸­å´å†™äº†å›¾ç‰‡æ–‡ä»¶çš„å…¨åï¼Œæ¯”å¦‚ â€œpic@2x.pngâ€ï¼Œæœ¬æ¥è´´å¿ƒçš„ Xcode ä¼šä¸ºæˆ‘ä»¬åœ¨åç¼€åå‰è‡ªåŠ¨åŠ ä¸Š â€œ@2xâ€ æ¥å¯»æ‰¾å›¾ç‰‡ï¼Œäºæ˜¯å»æŸ¥æ‰¾ â€œpic@2x@2x.pngâ€ï¼Œå‘ç°å¹¶æ²¡æœ‰è¿™ä¸ªäºŒå€åˆ†è¾¨ç‡å›¾ç‰‡ï¼ŒXcode äºæ˜¯åªå¥½ç»§ç»­å¯»æ‰¾ä¸€å€åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯ â€œpic@2x.pngâ€ è¢«å½“åšäº†ä¸€å€åˆ†è¾¨ç‡çš„å›¾ç‰‡å¤„ç†äº†ï¼Œæ‰€ä»¥ &lt;code&gt;UIImage&lt;/code&gt; çš„ &lt;code&gt;size&lt;/code&gt; å°±å˜å¤§äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ–‡æ¡ˆç®¡ç†&quot;&gt;&lt;a href=&quot;#æ–‡æ¡ˆç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;æ–‡æ¡ˆç®¡ç†&quot;&gt;&lt;/a&gt;æ–‡æ¡ˆç®¡ç†&lt;/h2&gt;&lt;h3 id=&quot;æ–‡æ¡ˆæ˜¯å¯å¤ç”¨çš„&quot;&gt;&lt;a href=&quot;#æ–‡æ¡ˆæ˜¯å¯å¤ç”¨çš„&quot; class=&quot;headerlink&quot; title=&quot;æ–‡æ¡ˆæ˜¯å¯å¤ç”¨çš„&quot;&gt;&lt;/a&gt;æ–‡æ¡ˆæ˜¯å¯å¤ç”¨çš„&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æœ‰å¾ˆå¤šæ–‡æ¡ˆå¯ä»¥é‡ç”¨ï¼Œå› ä¸ºäº§å“è®¾è®¡çš„æ–‡æ¡ˆå¤§éƒ½æ˜¯ç»Ÿä¸€çš„&lt;/strong&gt;ï¼Œæ¯”å¦‚æ‰€æœ‰éœ€è¦å±•ç¤ºç½‘ç»œå‡ºé”™çš„æ–‡æ¡ˆè‚¯å®šéƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå¦‚æœæ¯ä¸ª Alert å¼¹å‡ºçš„æ–‡æ¡ˆæç¤ºéƒ½ä¸ä¸€æ ·ï¼Œé‚£æ‰æ˜¯äº§å“çš„å¤±è´£ã€‚ä»ä¸èƒ½ A ç•Œé¢æ— ç½‘ç»œï¼Œæç¤ºâ€œæ–­ç½‘å•¦â€ï¼ŒB ç•Œé¢æ— ç½‘ç»œæ—¶æç¤ºâ€œæ— æ³•è®¿é—®ç½‘ç»œâ€ï¼Œè¿™æ ·å­çš„è®¾è®¡å¾ˆå°‘è§ã€‚&lt;/p&gt;
&lt;h3 id=&quot;é‡å¤çš„æ–‡æ¡ˆåœ¨å¤šå¤„-hardcode-ä¼šé™ä½æ•ˆç‡&quot;&gt;&lt;a href=&quot;#é‡å¤çš„æ–‡æ¡ˆåœ¨å¤šå¤„-hardcode-ä¼šé™ä½æ•ˆç‡&quot; class=&quot;headerlink&quot; title=&quot;é‡å¤çš„æ–‡æ¡ˆåœ¨å¤šå¤„ hardcode ä¼šé™ä½æ•ˆç‡&quot;&gt;&lt;/a&gt;é‡å¤çš„æ–‡æ¡ˆåœ¨å¤šå¤„ hardcode ä¼šé™ä½æ•ˆç‡&lt;/h3&gt;&lt;p&gt;åŸºäºä¸Šé¢è¿™ç‚¹â€œå°èªæ˜â€ï¼Œæˆ‘è§‰å¾—ä¸åŒåŠŸèƒ½ç•Œé¢çš„æ–‡æ¡ˆå®Œå…¨æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œè¿™åœ¨æˆ‘ä»¥å¾€çš„ç»éªŒä¸­ä¹Ÿå¾—åˆ°äº†éªŒè¯ã€‚è€Œé¡¹ç›®å½“å‰æ˜¯ç›´æ¥å°†æ–‡æ¡ˆç¡¬ç¼–ç åˆ°ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­ï¼Œä»¥åæ¯æ¬¡ä¿®æ”¹éƒ½è¦æ‰¾åˆ°å¯¹åº”çš„é€»è¾‘ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœæ˜¯ç»´æŠ¤è‡ªå·±ä»£ç ä¸­çš„æ–‡æ¡ˆæˆ–è€…æ˜¯ä¸šåŠ¡é€»è¾‘è¾ƒä¸ºç®€å•æ—¶è¿˜å¯ä»¥æ¥å—ï¼Œå› ä¸ºåªæ˜¯ä¸€æ¬¡æ¬¡çš„é‡å¤åŠ³åŠ¨ç½¢äº†ï¼Œå¯¹ä¸ªäººæ¥è¯´å¾®ä¸è¶³é“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æœ‰ä¸€å¤©æˆ‘ä»¬çš„äº§å“å°†è¦åšå›½é™…åŒ–ï¼ŒåŠ ä¸Šè‹±æ–‡ï¼Œå¯èƒ½è¿™å¯¹æ¯ä¸ªäººè´Ÿè´£çš„æ¨¡å—æ¥è¯´ä¹Ÿåªæ˜¯æ›¿æ¢ä¸‹ç½¢äº†ã€‚ç„¶è€Œäº‹æƒ…ä¸èƒ½æ˜¯è¿™ä¹ˆä»»ç”±å‘å±•çš„ï¼Œå…ˆä¸è¯´å›½é™…åŒ–ä¸­æœ‰ä¸€äº›è¯¸å¦‚ XLIFF æ–‡ä»¶çš„å¯¼å…¥çš„æ ‡å‡†å’Œæµç¨‹ï¼Œä¸€æ—¦ä¸€ä¸ªæ¨¡å—çš„æ–‡æ¡ˆå…¨ç”±å¦å¤–ä¸€ä¸ªä¸ç†Ÿæ‚‰ä»£ç çš„äººæ¥ä¿®æ”¹ï¼Œæ¼æ”¹æˆ–é”™æ”¹çš„é£é™©ä¼šå¢åŠ ï¼Œè¿™æ— ç–‘å¢åŠ äº†æµ‹è¯•çš„æ—¶é—´æˆæœ¬ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼šæ–‡æ¡ˆä¸ä»£ç åˆ†ç¦»&quot;&gt;&lt;a href=&quot;#æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼šæ–‡æ¡ˆä¸ä»£ç åˆ†ç¦»&quot; class=&quot;headerlink&quot; title=&quot;æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼šæ–‡æ¡ˆä¸ä»£ç åˆ†ç¦»&quot;&gt;&lt;/a&gt;æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼šæ–‡æ¡ˆä¸ä»£ç åˆ†ç¦»&lt;/h3&gt;&lt;p&gt;ä¸ºä»€ä¹ˆä¸å»ºç«‹ä¸€ä¸ªå¯¹ç…§è¡¨ï¼Œå°†æ‰€æœ‰çš„æ–‡æ¡ˆåˆ—å‡ºæ¥å‘¢ï¼Ÿæ¯”å¦‚TB001å·æ–‡æ¡ˆå†…å®¹æ˜¯â€œå–æ¶ˆâ€ï¼Œæˆ‘æ•¢è¯´è‚¯å®šå¾ˆå¤š AlertView çš„æŒ‰é’®éƒ½ä¼šç”¨åˆ°ï¼Œç›´æ¥åœ¨ä»£ç é‡Œä½¿ç”¨è¿™ä¸ªç¼–å·å¯¹åº”çš„çš„ &lt;code&gt;NSString&lt;/code&gt;å˜é‡ï¼ˆæˆ–è®¸å¹²è„†å˜é‡åå°±æ˜¯ &lt;code&gt;tb001&lt;/code&gt;ï¼‰ã€‚äº§å“é‚£è¾¹æä¾›æ–‡æ¡ˆæ—¶ä¹Ÿåˆ—ä¸€å¼ æ˜ å°„è¡¨ï¼Œå°†å„ä¸ªæ¨¡å—é¡µé¢çš„æ–‡æ¡ˆéƒ½å¯¹åº”ä¸Šç¼–å·ï¼Œç„¶åç¼–å·åˆæ˜ å°„åˆ°å…·ä½“æ–‡æ¡ˆå†…å®¹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è§£å†³æ–¹æ¡ˆçš„åˆ†æ&quot;&gt;&lt;a href=&quot;#è§£å†³æ–¹æ¡ˆçš„åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³æ–¹æ¡ˆçš„åˆ†æ&quot;&gt;&lt;/a&gt;è§£å†³æ–¹æ¡ˆçš„åˆ†æ&lt;/h3&gt;&lt;p&gt;å¯èƒ½è¿™ä¹ˆåšæœ€å¼€å§‹ä¼šæœ‰ä¸€å®šçš„å·¥ä½œé‡ï¼Œä½†è¶ç€æ–‡æ¡ˆç§ç±»æ²¡æœ‰æš´å¢æ—¶ï¼Œè¿™ä»¶äº‹æƒ…åšçš„è¶Šæ—©è¶Šå¥½ã€‚è¿™ä¼šæé«˜å…¨ç»„äººçš„æ•ˆç‡ï¼Œå› ä¸ºä»¥åå†ä¿®æ”¹æ–‡æ¡ˆæ—¶ï¼Œç›´æ¥ä¿®æ”¹é‚£ä¸ªä¿å­˜æ–‡æ¡ˆç¼–ç ä¸å†…å®¹çš„æ–‡ä»¶å³å¯ã€‚å¦‚æœéœ€è¦å˜æ›´ä»£ç ä¸­çš„ç¼–ç ï¼Œæ­¤æ—¶æ‰éœ€è¦æ¶‰åŠåˆ°æŸ¥çœ‹ä»£ç é€»è¾‘ï¼Œç„¶è€Œè¿™ç§æƒ…å†µæˆ‘ç›¸ä¿¡æ˜¯å°‘æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;project-pbxprojæ–‡ä»¶&quot;&gt;&lt;a href=&quot;#project-pbxprojæ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;project.pbxprojæ–‡ä»¶&quot;&gt;&lt;/a&gt;project.pbxprojæ–‡ä»¶&lt;/h2&gt;&lt;p&gt;å…³äºå·¥ç¨‹æ–‡ä»¶ project.pbxproj ç¡®å®è¯Ÿç—…å·²ä¹…ï¼Œå¤šäººåä½œæ—¶æ€»ä¼šè›‹ç–¼ã€‚æ¯æ¬¡æœ‰æ–‡ä»¶çš„å¢åˆ æ“ä½œæ—¶æˆ‘ä»¬æ€»æ˜¯éœ€è¦è§£å†³ svn ä¸Šä¸æœ¬åœ°ç‰ˆæœ¬çš„å†²çªã€‚æˆ‘å¯¹å®ƒç ”ç©¶å¹¶ä¸å¤šï¼Œä½†å‘ç°äº†æœ‰äººæä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š&lt;a href=&quot;https://github.com/truebit/xUnique&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;xUnique&lt;/a&gt;ï¼Œç›®å‰å¤„äºè§‚æœ›çŠ¶æ€ï¼Œè¿˜ä¸æ•¢å°è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘çš„è®¾æƒ³æ˜¯èƒ½å¤Ÿç”¨ä¸€ä¸ªè„šæœ¬ï¼Œæ¯æ¬¡ commit project.pbxproj æ–‡ä»¶æ—¶å¯ä»¥è‡ªåŠ¨å±è”½æ‰ä¸€äº›å†…å®¹ï¼Œæ¯”å¦‚è¯ä¹¦ç­‰ã€‚ä½†è¿™ç§è®¾æƒ³æ²¡æœ‰ç»è¿‡éªŒè¯ï¼Œå¯èƒ½è¿˜æ˜¯æ— æ³•è§£å†³æ ¹æœ¬é—®é¢˜ã€‚æ¯•ç«Ÿ project.pbxproj æ–‡ä»¶æ ¼å¼å¯èƒ½è¿˜ä¼šæœ‰å˜åŒ–ï¼Œè‹¹æœæ€»æ˜¯å–œæ¬¢ä¼˜åŒ–å®ƒè¢«è¯Ÿç—…çš„ä¸œè¥¿ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¥è…¾è®¯å®ä¹ æ­£å¥½ä¸€ä¸ªæœˆäº†ï¼Œå› ä¸ºé¡¹ç›®å·²ç»è¿›å…¥äº†æˆç†ŸæœŸï¼Œæ¥äº†ä¸¤ä¸ªéœ€æ±‚ï¼Œæ”¹äº†äºŒåå‡ ä¸ª bugã€‚æ‰€ä»¥æŠŠè¿™æœŸé—´çš„ä¸€äº›æ€è€ƒå†™ä¸‹æ¥ï¼Œå‘äº†é‚®ä»¶åˆ†äº«ç»™ç»„å†…åŒäº‹ä»¬ã€‚æˆ‘æŠŠä¸€äº›è‡ªå·±è§‰å¾—ä¸åˆé€‚çš„å†…å®¹åˆ¨é™¤å‡ºå»ï¼Œé€‰å–é‚®ä»¶çš„éƒ¨åˆ†å†…å®¹å†™åœ¨è¿™é‡Œï¼šï¼‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº @synchronizedï¼Œè¿™å„¿æ¯”ä½ æƒ³çŸ¥é“çš„è¿˜è¦å¤š</title>
    <link href="http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/"/>
    <id>http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/</id>
    <published>2015-11-01T03:58:23.000Z</published>
    <updated>2016-05-11T14:32:38.000Z</updated>
    
    <content type="html">&lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª &lt;a href=&quot;http://rykap.com/about/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Ryan Kaplan&lt;/a&gt; çš„ &lt;a href=&quot;http://rykap.com/objective-c/2015/05/09/synchronized.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;More than you want to know about @synchronized&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;å› ä¸ºåŸæ–‡ä¸€äº›å†…å®¹å†™çš„ä¸å¤ªå‡†ç¡®ï¼Œæˆ‘æŒ‰ç…§æˆ‘çš„ç†è§£åšå‡ºäº†æ‰¹æ³¨å’Œè¡¥å……ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;å¦‚æœä½ å·²ç»ä½¿ç”¨ Objective-C ç¼–å†™è¿‡ä»»ä½•å¹¶å‘ç¨‹åºï¼Œé‚£ä¹ˆæƒ³å¿…æ˜¯è§è¿‡ &lt;code&gt;@synchronized&lt;/code&gt; è¿™è´§äº†ã€‚&lt;code&gt;@synchronized&lt;/code&gt; ç»“æ„æ‰€åšçš„äº‹æƒ…è·Ÿé”ï¼ˆlockï¼‰ç±»ä¼¼ï¼šå®ƒé˜²æ­¢ä¸åŒçš„çº¿ç¨‹åŒæ—¶æ‰§è¡ŒåŒä¸€æ®µä»£ç ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç›¸æ¯”äºä½¿ç”¨ &lt;code&gt;NSLock&lt;/code&gt; åˆ›å»ºé”å¯¹è±¡ã€åŠ é”å’Œè§£é”æ¥è¯´ï¼Œ&lt;code&gt;@synchronized&lt;/code&gt; ç”¨ç€æ›´æ–¹ä¾¿ï¼Œå¯è¯»æ€§æ›´é«˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šè¿™ä¸è‹¹æœå®˜æ–¹æ–‡æ¡£å¯¹ &lt;code&gt;@synchronized&lt;/code&gt; çš„ä»‹ç»æœ‰å°‘è®¸å‡ºå…¥ï¼Œä½†æ„æ€å·®ä¸å¤šã€‚è‹¹æœå®˜æ–¹æ–‡æ¡£æ›´å¼ºè°ƒå®ƒâ€œé˜²æ­¢ä¸åŒçš„çº¿ç¨‹åŒæ—¶è·å–ç›¸åŒçš„é”â€ï¼Œå› ä¸ºæ–‡æ¡£åœ¨é›†ä¸­ä»‹ç»å¤šçº¿ç¨‹ç¼–ç¨‹å„ç§é”çš„ä½œç”¨ï¼Œæ‰€ä»¥æ›´å¼ºè°ƒâ€œç›¸åŒçš„é”â€è€Œä¸æ˜¯â€œåŒä¸€æ®µä»£ç â€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœä½ ä¹‹å‰æ²¡ç”¨è¿‡ &lt;code&gt;@synchronized&lt;/code&gt;ï¼Œæ¥ä¸‹æ¥æœ‰ä¸ªä½¿ç”¨å®ƒçš„ä¾‹å­ã€‚è¿™ç¯‡æ–‡ç« å®è´¨ä¸Šæ˜¯è°ˆè°ˆæœ‰å…³æˆ‘å¯¹ &lt;code&gt;@synchronized&lt;/code&gt; å®ç°åŸç†çš„ä¸€ä¸ªç®€çŸ­ç ”ç©¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç”¨åˆ°-synchronized-çš„ä¾‹å­&quot;&gt;&lt;a href=&quot;#ç”¨åˆ°-synchronized-çš„ä¾‹å­&quot; class=&quot;headerlink&quot; title=&quot;ç”¨åˆ° @synchronized çš„ä¾‹å­&quot;&gt;&lt;/a&gt;ç”¨åˆ° @synchronized çš„ä¾‹å­&lt;/h2&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬æ­£åœ¨ç”¨ Objective-C å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å¯èƒ½ä¼šè¿™ä¹ˆå¹²ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@implementation&lt;/span&gt; ThreadSafeQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSMutableArray *_elements;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLock *_lock;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self = &lt;span class=&quot;selector-attr&quot;&gt;[super init]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;if&lt;/span&gt; (self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _elements = &lt;span class=&quot;selector-attr&quot;&gt;[NSMutableArray array]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _lock = &lt;span class=&quot;selector-attr&quot;&gt;[[NSLock alloc]&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;init&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (void)&lt;span class=&quot;selector-tag&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(id)element&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-attr&quot;&gt;[_lock lock]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-attr&quot;&gt;[_elements addObject:element]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-attr&quot;&gt;[_lock unlock]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢çš„ &lt;code&gt;ThreadSafeQueue&lt;/code&gt; ç±»æœ‰ä¸ª &lt;code&gt;init&lt;/code&gt; æ–¹æ³•ï¼Œå®ƒåˆå§‹åŒ–äº†ä¸€ä¸ª &lt;code&gt;_elements&lt;/code&gt; æ•°ç»„å’Œä¸€ä¸ª &lt;code&gt;NSLock&lt;/code&gt; å®ä¾‹ã€‚è¿™ä¸ªç±»è¿˜æœ‰ä¸ª &lt;code&gt;push:&lt;/code&gt; æ–¹æ³•ï¼Œå®ƒå…ˆè·å–é”ã€ç„¶åå‘æ•°ç»„ä¸­æ’å…¥å…ƒç´ ã€æœ€ç»ˆé‡Šæ”¾é”ã€‚å¯èƒ½ä¼šæœ‰è®¸å¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨ &lt;code&gt;push:&lt;/code&gt; æ–¹æ³•ï¼Œä½†æ˜¯ &lt;code&gt;[_elements addObject:element]&lt;/code&gt; è¿™è¡Œä»£ç åœ¨ä»»ä½•æ—¶å€™å°†åªä¼šåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œã€‚æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¿ç¨‹ A è°ƒç”¨ &lt;code&gt;push:&lt;/code&gt; æ–¹æ³•&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ B è°ƒç”¨ &lt;code&gt;push:&lt;/code&gt; æ–¹æ³•&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ B è°ƒç”¨ &lt;code&gt;[_lock lock]&lt;/code&gt; - å› ä¸ºå½“å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰é”ï¼Œçº¿ç¨‹ B è·å¾—äº†é”&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ A è°ƒç”¨ &lt;code&gt;[_lock lock]&lt;/code&gt;ï¼Œä½†æ˜¯é”å·²ç»è¢«çº¿ç¨‹ B å äº†æ‰€ä»¥æ–¹æ³•è°ƒç”¨å¹¶æ²¡æœ‰è¿”å›-è¿™ä¼šæš‚åœçº¿ç¨‹ A çš„æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ B å‘ &lt;code&gt;_elements&lt;/code&gt; æ·»åŠ å…ƒç´ åè°ƒç”¨ &lt;code&gt;[_lock unlock]&lt;/code&gt;ã€‚å½“è¿™äº›å‘ç”Ÿæ—¶ï¼Œçº¿ç¨‹ A çš„ &lt;code&gt;[_lock lock]&lt;/code&gt; æ–¹æ³•è¿”å›ï¼Œå¹¶ç»§ç»­å°†è‡ªå·±çš„å…ƒç´ æ’å…¥ &lt;code&gt;_elements&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç”¨ &lt;code&gt;@synchronized&lt;/code&gt; ç»“æ„æ›´ç®€è¦åœ°å®ç°è¿™äº›ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@implementation&lt;/span&gt; ThreadSafeQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSMutableArray *_elements;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self = &lt;span class=&quot;selector-attr&quot;&gt;[super init]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;if&lt;/span&gt; (self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _elements = &lt;span class=&quot;selector-attr&quot;&gt;[NSMutableArray array]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (void)&lt;span class=&quot;selector-tag&quot;&gt;increment&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;variable&quot;&gt;@synchronized&lt;/span&gt; (self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-attr&quot;&gt;[_elements addObject:element]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œâ€synchronized blockâ€ ä¸ &lt;code&gt;[_lock lock]&lt;/code&gt; å’Œ &lt;code&gt;[_lock unlock]&lt;/code&gt; æ•ˆæœç›¸åŒã€‚ä½ å¯ä»¥æŠŠå®ƒå½“æˆæ˜¯é”ä½ &lt;code&gt;self&lt;/code&gt;ï¼Œä»¿ä½› &lt;code&gt;self&lt;/code&gt; å°±æ˜¯ä¸ª &lt;code&gt;NSLock&lt;/code&gt;ã€‚é”åœ¨å·¦æ‹¬å· &lt;code&gt;{&lt;/code&gt; åé¢çš„ä»»ä½•ä»£ç è¿è¡Œä¹‹å‰è¢«è·å–åˆ°ï¼Œåœ¨å³æ‹¬å· &lt;code&gt;}&lt;/code&gt; åé¢çš„ä»»ä½•ä»£ç è¿è¡Œä¹‹å‰è¢«é‡Šæ”¾æ‰ã€‚è¿™çˆ½å°±çˆ½åœ¨å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘å¿˜è®°è°ƒç”¨ &lt;code&gt;unlock&lt;/code&gt; äº†ï¼&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ç»™ä»»ä½• Objective-C å¯¹è±¡ä¸ŠåŠ ä¸ª &lt;code&gt;@synchronized&lt;/code&gt;ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ç”¨ &lt;code&gt;@synchronized(_elements)&lt;/code&gt; æ¥æ›¿ä»£ &lt;code&gt;@synchronized(self)&lt;/code&gt;ï¼Œæ•ˆæœæ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å›åˆ°ç ”ç©¶ä¸Šæ¥&quot;&gt;&lt;a href=&quot;#å›åˆ°ç ”ç©¶ä¸Šæ¥&quot; class=&quot;headerlink&quot; title=&quot;å›åˆ°ç ”ç©¶ä¸Šæ¥&quot;&gt;&lt;/a&gt;å›åˆ°ç ”ç©¶ä¸Šæ¥&lt;/h2&gt;&lt;p&gt;æˆ‘å¯¹ &lt;code&gt;@synchronized&lt;/code&gt; çš„å®ç°ååˆ†å¥½å¥‡å¹¶æœäº†ä¸€äº›å®ƒçš„ç»†èŠ‚ã€‚æˆ‘&lt;a href=&quot;http://stackoverflow.com/questions/1215330/how-does-synchronized-lock-unlock-in-objective-c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ‰¾åˆ°äº†&lt;/a&gt;&lt;a href=&quot;http://stackoverflow.com/questions/1215765/changing-the-locking-object-insde-synchronized-section&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä¸€äº›&lt;/a&gt;&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç­”æ¡ˆ&lt;/a&gt;ï¼Œä½†è¿™äº›è§£é‡Šéƒ½æ²¡æœ‰è¾¾åˆ°æˆ‘æƒ³è¦çš„æ·±åº¦ã€‚é”æ˜¯å¦‚ä½•ä¸ä½ ä¼ å…¥ &lt;code&gt;@synchronized&lt;/code&gt; çš„å¯¹è±¡å…³è”ä¸Šçš„ï¼Ÿ&lt;code&gt;@synchronized&lt;/code&gt;ä¼šä¿æŒï¼ˆretainï¼Œå¢åŠ å¼•ç”¨è®¡æ•°ï¼‰è¢«é”ä½çš„å¯¹è±¡ä¹ˆï¼Ÿå‡å¦‚ä½ ä¼ å…¥ &lt;code&gt;@synchronized&lt;/code&gt; çš„å¯¹è±¡åœ¨ &lt;code&gt;@synchronized&lt;/code&gt; çš„ block é‡Œé¢è¢«é‡Šæ”¾æˆ–è€…è¢«èµ‹å€¼ä¸º &lt;code&gt;nil&lt;/code&gt; å°†ä¼šæ€ä¹ˆæ ·ï¼Ÿè¿™äº›å…¨éƒ½æ˜¯æˆ‘æƒ³å›ç­”çš„é—®é¢˜ã€‚è€Œæˆ‘è¿™æ¬¡çš„æ”¶è·ï¼Œä¼šè¦ä½ å¥½çœ‹ğŸ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@synchronized&lt;/code&gt; çš„&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ–‡æ¡£&lt;/a&gt;å‘Šè¯‰æˆ‘ä»¬ &lt;code&gt;@synchronized&lt;/code&gt; block åœ¨è¢«ä¿æŠ¤çš„ä»£ç ä¸Šæš—ä¸­æ·»åŠ äº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†ã€‚ä¸ºçš„æ˜¯åŒæ­¥æŸå¯¹è±¡æ—¶å¦‚è‹¥æŠ›å‡ºå¼‚å¸¸ï¼Œé”ä¼šè¢«é‡Šæ”¾æ‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/1215330/how-does-synchronized-lock-unlock-in-objective-c/6047218#6047218&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SO ä¸Šçš„è¿™ç¯‡å¸–å­&lt;/a&gt; è¯´ &lt;code&gt;@synchronized&lt;/code&gt; block ä¼šå˜æˆ &lt;code&gt;objc_sync_enter&lt;/code&gt; å’Œ &lt;code&gt;objc_sync_exit&lt;/code&gt; çš„æˆå¯¹å„¿è°ƒç”¨ã€‚æˆ‘ä»¬ä¸çŸ¥é“è¿™äº›å‡½æ•°æ˜¯å¹²å•¥çš„ï¼Œä½†åŸºäºè¿™äº›äº‹å®æˆ‘ä»¬å¯ä»¥è®¤ä¸ºç¼–è¯‘å™¨å°†è¿™æ ·çš„ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight elixir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@synchronized&lt;/span&gt;(obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;regexp&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è½¬åŒ–æˆè¿™æ ·çš„ä¸œä¸œï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_enter(obj);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// do work&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;variable&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_exit(obj);    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;objc_sync_enter&lt;/code&gt; å’Œ &lt;code&gt;objc_sync_exit&lt;/code&gt; æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿå®ƒä»¬æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿåœ¨ Xcode ä¸­æŒ‰ä½ Command é”®å•å‡»å®ƒä»¬ï¼Œç„¶åè¿›åˆ°äº† &lt;code&gt;&amp;lt;objc/objc-sync.h&amp;gt;&lt;/code&gt;ï¼Œé‡Œé¢æœ‰æˆ‘ä»¬æ„Ÿå…´è¶£çš„è¿™ä¸¤ä¸ªå‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/** &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Begin synchronizing &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &#39;obj&#39;.  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Allocates recursive pthread_mutex associated &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; &#39;obj&#39; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; needed.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * @param obj The object &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; begin synchronizing &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * @&lt;span class=&quot;literal&quot;&gt;return&lt;/span&gt; OBJC_SYNC_SUCCESS once lock &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; acquired.  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT  int objc_sync_enter(&lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt; obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __OSX_AVAILABLE_STARTING(__MAC_10_3, __IPHONE_2_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/** &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * End synchronizing &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &#39;obj&#39;. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * @param obj The objet &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt; synchronizing &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * @&lt;span class=&quot;literal&quot;&gt;return&lt;/span&gt; OBJC_SYNC_SUCCESS &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; OBJC_SYNC_NOT_OWNING_THREAD_ERROR&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT  int objc_sync_exit(&lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt; obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __OSX_AVAILABLE_STARTING(__MAC_10_3, __IPHONE_2_0);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ–‡ä»¶åº•éƒ¨çš„ä¸€å¥è¯æé†’ç€æˆ‘ä»¬ï¼šè‹¹æœå·¥ç¨‹å¸ˆä¹Ÿæ˜¯äººå•Šå“ˆå“ˆ&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The wait/notify functions have never worked correctly and no longer exist.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT  &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; objc_sync_wait(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; milliSecondsMaxWait) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UN&lt;span class=&quot;built_in&quot;&gt;AVAILABLE_ATTRIBUTE&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT  &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; objc_sync_notify(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UN&lt;span class=&quot;built_in&quot;&gt;AVAILABLE_ATTRIBUTE&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJC_EXPORT  &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; objc_sync_notifyAll(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UN&lt;span class=&quot;built_in&quot;&gt;AVAILABLE_ATTRIBUTE&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨: æ­¤å¤„åŸæ–‡æ‘˜æŠ„çš„æºç è¾ƒæ—§ï¼Œæ‰€ä»¥æˆ‘æ›¿æ¢ä¸Šäº†æœ€æ–°çš„å¤´æ–‡ä»¶æºç ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸è¿‡ï¼Œ&lt;code&gt;objc_sync_enter&lt;/code&gt; çš„æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ä¸€äº›æ–°ä¸œè¥¿ï¼š &lt;code&gt;@synchronized&lt;/code&gt; ç»“æ„åœ¨å·¥ä½œæ—¶ä¸ºä¼ å…¥çš„å¯¹è±¡åˆ†é…äº†ä¸€ä¸ªé€’å½’é”ã€‚åˆ†é…å·¥ä½œä½•æ—¶å‘ç”Ÿï¼Œå¦‚ä½•å‘ç”Ÿå‘¢ï¼Ÿå®ƒæ€æ ·å¤„ç† &lt;code&gt;nil&lt;/code&gt;ï¼Ÿå¹¸è¿çš„æ˜¯ Objective-C runtime æ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é©¬ä¸Šé˜…è¯»æºç å¹¶æ‰¾åˆ°ç­”æ¡ˆï¼&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šé€’å½’é”åœ¨è¢«åŒä¸€çº¿ç¨‹é‡å¤è·å–æ—¶ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚ä½ å¯ä»¥åœ¨&lt;a href=&quot;https://en.wikipedia.org/wiki/Reentrant_mutex#Example&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™&lt;/a&gt;æ‰¾åˆ°ä¸€ä¸ªå®ƒå·¥ä½œåŸç†çš„ç²¾å·§æ¡ˆä¾‹ã€‚æœ‰ä¸ªå«åš &lt;code&gt;NSRecursiveLock&lt;/code&gt; çš„ç°æˆçš„ç±»ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œä½ å¯ä»¥è¯•è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;a href=&quot;http://www.opensource.apple.com/source/objc4/objc4-646/runtime/objc-sync.mm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ° &lt;code&gt;objc-sync&lt;/code&gt; çš„å…¨éƒ¨æºç ï¼Œä½†æˆ‘è¦å¸¦ç€ä½ çœ‹æºç ï¼Œè®©ä½ å±Œçš„é£èµ·ã€‚æˆ‘ä»¬å…ˆä»æ–‡ä»¶é¡¶éƒ¨çš„æ•°æ®ç»“æ„å¼€å§‹çœ‹ã€‚åœ¨ä»£ç å—çš„ä¸‹æ–¹æˆ‘å°†ç«‹åˆ»åšå‡ºè§£é‡Šï¼Œæ‰€ä»¥å°è¯•ç†è§£ä»£ç æ—¶åˆ«èŠ±å¤ªé•¿æ—¶é—´å“¦ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; SyncData &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    id object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;recursive_mutex_t&lt;/span&gt; mutex;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; SyncData* nextData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; threadCount;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; SyncData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; SyncList &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SyncData *data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;spinlock_t&lt;/span&gt; lock;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; SyncList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Use multiple parallel lists to decrease contention among unrelated objects.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; COUNT 16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; HASH(obj) ((((uintptr_t)(obj)) &amp;gt;&amp;gt; 5) &amp;amp; (COUNT - 1))&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; LOCK_FOR_OBJ(obj) sDataLists[HASH(obj)].lock&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; LIST_FOR_OBJ(obj) sDataLists[HASH(obj)].data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; SyncList sDataLists[COUNT];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª &lt;code&gt;struct SyncData&lt;/code&gt; çš„å®šä¹‰ã€‚è¿™ä¸ªç»“æ„ä½“åŒ…å«ä¸€ä¸ª &lt;code&gt;object&lt;/code&gt;ï¼ˆå—¯å°±æ˜¯æˆ‘ä»¬ç»™ &lt;code&gt;@synchronized&lt;/code&gt; ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡ï¼‰å’Œä¸€ä¸ªæœ‰å…³è”çš„ &lt;code&gt;recursive_mutex_t&lt;/code&gt;ï¼Œå®ƒå°±æ˜¯é‚£ä¸ªè·Ÿ &lt;code&gt;object&lt;/code&gt; å…³è”åœ¨ä¸€èµ·çš„é”ã€‚æ¯ä¸ª &lt;code&gt;SyncData&lt;/code&gt; ä¹ŸåŒ…å«ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ª &lt;code&gt;SyncData&lt;/code&gt; å¯¹è±¡çš„æŒ‡é’ˆï¼Œå«åš &lt;code&gt;nextData&lt;/code&gt;ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠæ¯ä¸ª &lt;code&gt;SyncData&lt;/code&gt; ç»“æ„ä½“çœ‹åšæ˜¯é“¾è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚æœ€åï¼Œæ¯ä¸ª &lt;code&gt;SyncData&lt;/code&gt; åŒ…å«ä¸€ä¸ª &lt;code&gt;threadCount&lt;/code&gt;ï¼Œè¿™ä¸ª &lt;code&gt;SyncData&lt;/code&gt; å¯¹è±¡ä¸­çš„é”ä¼šè¢«ä¸€äº›çº¿ç¨‹ä½¿ç”¨æˆ–ç­‰å¾…ï¼Œ&lt;code&gt;threadCount&lt;/code&gt; å°±æ˜¯æ­¤æ—¶è¿™äº›çº¿ç¨‹çš„æ•°é‡ã€‚å®ƒå¾ˆæœ‰ç”¨å¤„ï¼Œå› ä¸º &lt;code&gt;SyncData&lt;/code&gt; ç»“æ„ä½“ä¼šè¢«ç¼“å­˜ï¼Œ&lt;code&gt;threadCount==0&lt;/code&gt; å°±æš—ç¤ºäº†è¿™ä¸ª &lt;code&gt;SyncData&lt;/code&gt; å®ä¾‹å¯ä»¥è¢«å¤ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ &lt;code&gt;struct SyncList&lt;/code&gt; çš„å®šä¹‰ã€‚æ­£å¦‚æˆ‘åœ¨ä¸Šé¢æè¿‡ï¼Œä½ å¯ä»¥æŠŠ &lt;code&gt;SyncData&lt;/code&gt; å½“åšæ˜¯é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚æ¯ä¸ª &lt;code&gt;SyncList&lt;/code&gt; ç»“æ„ä½“éƒ½æœ‰ä¸ªæŒ‡å‘ &lt;code&gt;SyncData&lt;/code&gt; èŠ‚ç‚¹é“¾è¡¨å¤´éƒ¨çš„æŒ‡é’ˆï¼Œä¹Ÿæœ‰ä¸€ä¸ªç”¨äºé˜²æ­¢å¤šä¸ªçº¿ç¨‹å¯¹æ­¤åˆ—è¡¨åšå¹¶å‘ä¿®æ”¹çš„é”ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢ä»£ç å—çš„æœ€åä¸€è¡Œæ˜¯ &lt;code&gt;sDataLists&lt;/code&gt; çš„å£°æ˜ - ä¸€ä¸ª &lt;code&gt;SyncList&lt;/code&gt; ç»“æ„ä½“æ•°ç»„ï¼Œå¤§å°ä¸º16ã€‚é€šè¿‡å®šä¹‰çš„ä¸€ä¸ªå“ˆå¸Œç®—æ³•å°†ä¼ å…¥å¯¹è±¡æ˜ å°„åˆ°æ•°ç»„ä¸Šçš„ä¸€ä¸ªä¸‹æ ‡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªå“ˆå¸Œç®—æ³•è®¾è®¡çš„å¾ˆå·§å¦™ï¼Œæ˜¯å°†å¯¹è±¡æŒ‡é’ˆåœ¨å†…å­˜çš„åœ°å€è½¬åŒ–ä¸ºæ— ç¬¦å·æ•´å‹å¹¶å³ç§»äº”ä½ï¼Œå†è·Ÿ &lt;code&gt;0xF&lt;/code&gt; åšæŒ‰ä½ä¸è¿ç®—ï¼Œè¿™æ ·ç»“æœä¸ä¼šè¶…å‡ºæ•°ç»„å¤§å°ã€‚ &lt;code&gt;LOCK_FOR_OBJ(obj)&lt;/code&gt; å’Œ &lt;code&gt;LIST_FOR_OBJ(obj)&lt;/code&gt; è¿™ä¿©å®å°±æ›´å¥½ç†è§£äº†ï¼Œå…ˆæ˜¯å“ˆå¸Œå‡ºå¯¹è±¡çš„æ•°ç»„ä¸‹æ ‡ï¼Œç„¶åå–å‡ºæ•°ç»„å¯¹åº”å…ƒç´ çš„ &lt;code&gt;lock&lt;/code&gt; æˆ– &lt;code&gt;data&lt;/code&gt;ã€‚ä¸€åˆ‡éƒ½æ˜¯è¿™ä¹ˆé¡ºç†æˆç« å“ˆã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ è°ƒç”¨ &lt;code&gt;objc_sync_enter(obj)&lt;/code&gt; æ—¶ï¼Œå®ƒç”¨ &lt;code&gt;obj&lt;/code&gt; å†…å­˜åœ°å€çš„å“ˆå¸Œå€¼æŸ¥æ‰¾åˆé€‚çš„ &lt;code&gt;SyncData&lt;/code&gt;ï¼Œç„¶åå°†å…¶ä¸Šé”ã€‚å½“ä½ è°ƒç”¨ &lt;code&gt;objc_sync_exit(obj)&lt;/code&gt; æ—¶ï¼Œå®ƒæŸ¥æ‰¾åˆé€‚çš„ &lt;code&gt;SyncData&lt;/code&gt; å¹¶å°†å…¶è§£é”ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šä¸Šé¢çš„æºç å’Œå‡ æ®µè§£é‡Šæœ‰äº›åŸæ–‡è§£é‡Šä¸æ¸…å’Œç–æ¼çš„åœ°æ–¹ï¼Œæˆ‘çœ‹äº†æºç åæŒ‰ç…§è‡ªå·±çš„ç†è§£è¿›è¡Œäº†è¡¥å……å’Œä¿®æ­£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å™¢è€¶ï¼ç°åœ¨æˆ‘ä»¬çŸ¥é“äº† &lt;code&gt;@synchronized&lt;/code&gt; å¦‚ä½•å°†ä¸€ä¸ªé”å’Œä½ æ­£åœ¨åŒæ­¥çš„å¯¹è±¡å…³è”èµ·æ¥ï¼Œæˆ‘å¸Œæœ›èŠèŠå½“ä¸€ä¸ªå¯¹è±¡åœ¨ &lt;code&gt;@synchronized&lt;/code&gt; block å½“ä¸­è¢«é‡Šæ”¾æˆ–è®¾ä¸º &lt;code&gt;nil&lt;/code&gt; æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çœ‹äº†æºç ï¼Œä½ ä¼šæ³¨æ„åˆ° &lt;code&gt;objc_sync_enter&lt;/code&gt; é‡Œé¢æ²¡æœ‰ &lt;code&gt;retain&lt;/code&gt; å’Œ &lt;code&gt;release&lt;/code&gt;ã€‚æ‰€ä»¥å®ƒè¦ä¹ˆæ²¡æœ‰ä¿æŒä¼ é€’ç»™å®ƒçš„å¯¹è±¡ï¼Œè¦ä¹ˆæˆ–æ˜¯åœ¨ ARC ä¸‹è¢«ç¼–è¯‘ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¥åšä¸ªæµ‹è¯•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSDate&lt;/span&gt; *test = [&lt;span class=&quot;built_in&quot;&gt;NSDate&lt;/span&gt; date];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// This should always be `1`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;, @([test retainCount]));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@synchronized&lt;/span&gt; (test) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// This will be `2` if `@synchronized` somehow&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// retains `test`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;, @([test retainCount]));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸¤æ¬¡è¾“å‡ºç»“æœéƒ½æ˜¯ &lt;code&gt;1&lt;/code&gt;ã€‚é‚£ä¹ˆ &lt;code&gt;objc_sync_enter&lt;/code&gt; è²Œä¼¼æ˜¯æ²¡ä¿æŒè¢«ä¼ å…¥çš„å¯¹è±¡å•Šã€‚è¿™å°±æœ‰è¶£äº†ã€‚å¦‚æœä½ æ­£åœ¨åŒæ­¥çš„å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œç„¶åæœ‰å¯èƒ½å¦ä¸€ä¸ªæ–°çš„å¯¹è±¡åœ¨æ­¤å¤„ï¼ˆè¢«é‡Šæ”¾å¯¹è±¡çš„å†…å­˜åœ°å€ï¼‰è¢«åˆ†é…å†…å­˜ã€‚æœ‰å¯èƒ½æŸä¸ªå…¶ä»–çš„çº¿ç¨‹è¯•ç€å»åŒæ­¥é‚£ä¸ªæ–°çš„å¯¹è±¡ï¼ˆå°±æ˜¯é‚£ä¸ªåœ¨è¢«é‡Šæ”¾çš„æ—§å¯¹è±¡çš„å†…å­˜åœ°å€ä¸Šåˆšåˆšæ–°åˆ›å»ºçš„å¯¹è±¡ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹ç»“æŸå®ƒçš„åŒæ­¥ blockã€‚è¿™çœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆç³Ÿã€‚è¿™å¬èµ·æ¥åƒæ˜¯è¿™ç§äº‹æƒ…å®ç°è€…æ—©å°±çŸ¥é“å¹¶äºˆä»¥æ¥å—ã€‚æˆ‘æ²¡æœ‰é‡åˆ°è¿‡ä»»ä½•å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚å¯¹è±¡åœ¨ â€œsynchronized blockâ€ ä¸­è¢«è®¾æˆ &lt;code&gt;nil&lt;/code&gt; å‘¢ï¼Ÿæˆ‘ä»¬å›é¡¾ä¸‹æˆ‘ä»¬â€œæ‹¿è¡£æœï¼ˆnaiveï¼‰â€çš„å®ç°å§ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *test = &lt;span class=&quot;string&quot;&gt;@&quot;test&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Allocates a lock for test and locks it&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_enter(test);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    test = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Passed `nil`, so the lock allocated in `objc_sync_enter`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// above is never unlocked or deallocated&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_exit(test);   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;objc_sync_enter&lt;/code&gt; è¢«è°ƒç”¨æ—¶ä¼ å…¥çš„æ˜¯ &lt;code&gt;test&lt;/code&gt; è€Œ &lt;code&gt;objc_sync_exit&lt;/code&gt; è¢«è°ƒç”¨æ—¶ä¼ å…¥çš„æ˜¯ &lt;code&gt;nil&lt;/code&gt;ã€‚è€Œä¼ å…¥ &lt;code&gt;nil&lt;/code&gt; çš„æ—¶å€™ &lt;code&gt;objc_sync_exit&lt;/code&gt; æ˜¯ä¸ªç©ºæ“ä½œï¼Œæ‰€ä»¥å°†ä¸ä¼šæœ‰äººé‡Šæ”¾é”ã€‚è¿™çœŸæ“è›‹ï¼&lt;/p&gt;
&lt;p&gt;å¦‚æœ &lt;code&gt;Objective-C&lt;/code&gt; å®¹æ˜“å—è¿™ç§æƒ…å†µçš„å½±å“ï¼Œæˆ‘ä»¬çŸ¥é“ä¹ˆï¼Ÿä¸‹é¢çš„ä»£ç è°ƒç”¨ &lt;code&gt;@synchronized&lt;/code&gt; å¹¶åœ¨ &lt;code&gt;@synchronized&lt;/code&gt; block ä¸­å°†ä¸€ä¸ªæŒ‡é’ˆè®¾ä¸º &lt;code&gt;nil&lt;/code&gt;ã€‚ç„¶ååœ¨åå°çº¿ç¨‹å¯¹æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆè°ƒç”¨ &lt;code&gt;@synchronized&lt;/code&gt;ã€‚å¦‚æœåœ¨ &lt;code&gt;@synchronized&lt;/code&gt; block ä¸­è®¾ç½®ä¸€ä¸ªå¯¹è±¡ä¸º &lt;code&gt;nil&lt;/code&gt; ä¼šè®©é”æ­»é”ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒä¸ª &lt;code&gt;@synchronized&lt;/code&gt; ä¸­çš„ä»£ç å°†æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚æˆ‘ä»¬å°†ä¸ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹è§ä»»ä½•ä¸œè¥¿æ‰“å°å‡ºæ¥ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSNumber *&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; = @(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSNumber *thisPtrWillGoToNil = &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@synchronized (thisPtrWillGoToNil) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Here we &lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; thing &lt;span class=&quot;keyword&quot;&gt;that&lt;/span&gt; we&#39;re synchronizing &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; `nil`. If&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * implemented naively, &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; object would be passed &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; `objc_sync_enter`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; `nil` would be passed &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; `objc_sync_exit`, causing a lock &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * never be released.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    thisPtrWillGoToNil = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;), ^ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSCAssert(![NSThread isMainThread], @&lt;span class=&quot;string&quot;&gt;&quot;Must be run on background thread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * If, &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; mentioned &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; comment &lt;span class=&quot;keyword&quot;&gt;above&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; synchronized lock &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; never&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * released, &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt; we expect &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; wait forever &lt;span class=&quot;keyword&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; we &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; acquire&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; lock associated &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; `&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;`.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * This doesn&#39;t happen, so we conclude &lt;span class=&quot;keyword&quot;&gt;that&lt;/span&gt; `@synchronized` must deal&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; this correctly.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @synchronized (&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;This line does indeed get printed to stdout&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; å½“æˆ‘ä»¬æ‰§è¡Œä¸Šé¢çš„ä»£ç æ—¶ï¼Œé‚£è¡Œä»£ç &lt;strong&gt;ç¡®å®&lt;/strong&gt;æ‰“å°åˆ°æ§åˆ¶å°äº†ï¼æ‰€ä»¥ Objective-C å¾ˆå¥½åœ°å¤„ç†äº†è¿™ç§æƒ…å½¢ã€‚æˆ‘æ‰“èµŒæ˜¯ç¼–è¯‘å™¨åšäº†ç±»ä¼¼ä¸‹é¢çš„äº‹æƒ…æ¥è§£å†³è¿™äº‹å„¿çš„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSString *test = @&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;id &lt;span class=&quot;keyword&quot;&gt;synchronizeTarget &lt;/span&gt;= (id)test&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_enter(&lt;span class=&quot;keyword&quot;&gt;synchronizeTarget);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    test = nil&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; @finally &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_exit(&lt;span class=&quot;keyword&quot;&gt;synchronizeTarget); &lt;/span&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç”¨è¿™ç§æ–¹å¼å®ç°çš„è¯ï¼Œä¼ é€’ç»™ &lt;code&gt;objc_sync_enter&lt;/code&gt; å’Œ &lt;code&gt;objc_sync_exit&lt;/code&gt; æ€»æ˜¯ç›¸åŒçš„å¯¹è±¡ã€‚ä»–ä»¬åœ¨ä¼ å…¥ &lt;code&gt;nil&lt;/code&gt; æ—¶éƒ½æ˜¯ç©ºæ“ä½œã€‚è¿™å¸¦æ¥äº†ä¸ªæ£˜æ‰‹çš„ debug åœºæ™¯ï¼šå¦‚æœä½ å‘ &lt;code&gt;@synchronized&lt;/code&gt; ä¼ é€’ &lt;code&gt;nil&lt;/code&gt;ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šå¾—åˆ°ä»»ä½•é”è€Œä¸”ä½ çš„ä»£ç å°†ä¸ä¼šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä½ æ­£æ”¶åˆ°å‡ºä¹æ„æ–™çš„ç«æ€ï¼ˆraceï¼‰ï¼Œç¡®ä¿ä½ æ²¡å‘ä½ çš„ &lt;code&gt;@synchronized&lt;/code&gt; ä¼ å…¥ &lt;code&gt;nil&lt;/code&gt;ã€‚ä½ å¯ä»¥åœ¨ &lt;code&gt;objc_sync_nil&lt;/code&gt; ä¸Šè®¾ç½®ä¸€ä¸ªç¬¦å·æ–­ç‚¹æ¥è¾¾åˆ°æ­¤ç›®çš„ã€‚&lt;code&gt;objc_sync_nil&lt;/code&gt; æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œå½“ &lt;code&gt;objc_sync_enter&lt;/code&gt; å‡½æ•°è¢«ä¼ å…¥ &lt;code&gt;nil&lt;/code&gt; æ—¶ä¼šè¢«è°ƒç”¨ï¼ŒæŠ˜è®© debug æ›´å®¹æ˜“äº›ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šä¸‹é¢æ˜¯ &lt;code&gt;objc_sync_enter&lt;/code&gt; çš„æºç ï¼Œä¸»è¦é€»è¾‘å¾ˆå®¹æ˜“çœ‹æ‡‚ï¼ŒåŠ æ·±ç†è§£ &lt;code&gt;objc_sync_nil&lt;/code&gt;ï¼š&lt;br&gt;&lt;figure class=&quot;highlight nimrod&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; objc_sync_enter(id obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;OBJC_SYNC_SUCCESS&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;SyncData&lt;/span&gt;* data = id2data(obj, &lt;span class=&quot;type&quot;&gt;ACQUIRE&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        require_action_string(data != &lt;span class=&quot;type&quot;&gt;NULL&lt;/span&gt;, done, &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;OBJC_SYNC_NOT_INITIALIZED&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;id2data failed&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt; = recursive_mutex_lock(&amp;amp;data-&amp;gt;mutex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        require_noerr_string(&lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;, done, &lt;span class=&quot;string&quot;&gt;&quot;mutex_lock failed&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // @synchronized(&lt;span class=&quot;keyword&quot;&gt;nil&lt;/span&gt;) does nothing&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;DebugNilSync&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _objc_inform(&lt;span class=&quot;string&quot;&gt;&quot;NIL SYNC DEBUG: @synchronized(nil); set a breakpoint on objc_sync_nil to debug&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        objc_sync_nil();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;done: &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;result&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™å›ç­”äº†æˆ‘çœ¼ä¸‹çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½ è°ƒç”¨ &lt;code&gt;sychronized&lt;/code&gt; çš„æ¯ä¸ªå¯¹è±¡ï¼ŒObjective-C runtime éƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªé€’å½’é”å¹¶å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ &lt;code&gt;sychronized&lt;/code&gt; å†…éƒ¨å¯¹è±¡è¢«é‡Šæ”¾æˆ–è¢«è®¾ä¸º &lt;code&gt;nil&lt;/code&gt; çœ‹èµ·æ¥éƒ½ OKã€‚ä¸è¿‡è¿™æ²¡åœ¨æ–‡æ¡£ä¸­è¯´æ˜ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šå†ç”Ÿäº§ä»£ç ä¸­ä¾èµ–è¿™æ¡ã€‚&lt;/li&gt;
&lt;li&gt;æ³¨æ„ä¸è¦å‘ä½ çš„ &lt;code&gt;sychronized&lt;/code&gt; block ä¼ å…¥ &lt;code&gt;nil&lt;/code&gt;ï¼è¿™å°†ä¼šä»ä»£ç ä¸­ç§»èµ°çº¿ç¨‹å®‰å…¨ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ &lt;code&gt;objc_sync_nil&lt;/code&gt; ä¸ŠåŠ æ–­ç‚¹æ¥æŸ¥çœ‹æ˜¯å¦å‘ç”Ÿäº†è¿™æ ·çš„äº‹æƒ…ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç ”ç©¶çš„ä¸‹ä¸€æ­¥å°†æ˜¯ç ”ç©¶ä¸‹ â€œsynchronized blockâ€ è¾“å‡ºçš„æ±‡ç¼–ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦è·Ÿæˆ‘ä¸Šé¢çš„ä¾‹å­ç›¸ä¼¼ã€‚æˆ‘æ‰“èµŒ &lt;code&gt;@synchronized&lt;/code&gt; block çš„æ±‡ç¼–è¾“å‡ºä¸ä¼šè·Ÿä»»ä½•æˆ‘ä»¬è®¾è®¡çš„ Objective-C ä»£ç ç›¸åŒï¼Œä¸Šé¢çš„ä»£ç å……å…¶é‡æ˜¯ &lt;code&gt;@synchronized&lt;/code&gt; çš„å·¥ä½œæ¨¡å‹ã€‚ä½ èƒ½æƒ³åˆ°æ›´å¥½çš„æ¨¡å‹ä¹ˆï¼Ÿæˆ‘çš„æ¨¡å‹åœ¨å“ªäº›æƒ…å½¢ä¸‹ä¼šæœ‰ç‘•ç–µä¹ˆï¼Ÿå‘Šè¯‰æˆ‘å§ï¼&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª &lt;a href=&quot;http://rykap.com/about/&quot;&gt;Ryan Kaplan&lt;/a&gt; çš„ &lt;a href=&quot;http://rykap.com/objective-c/2015/05/09/synchronized.html&quot;&gt;More than you want to know about @synchronized&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;å› ä¸ºåŸæ–‡ä¸€äº›å†…å®¹å†™çš„ä¸å¤ªå‡†ç¡®ï¼Œæˆ‘æŒ‰ç…§æˆ‘çš„ç†è§£åšå‡ºäº†æ‰¹æ³¨å’Œè¡¥å……ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="http://yulingtianxia.com/tags/Objective-C/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yulingtianxia.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>å°è¯•å®ç° Web ä¸Šçš„çœ‹å›¾æ¨¡å¼</title>
    <link href="http://yulingtianxia.com/blog/2015/10/20/Try-to-implement-picture-browser-mode-on-webview/"/>
    <id>http://yulingtianxia.com/blog/2015/10/20/Try-to-implement-picture-browser-mode-on-webview/</id>
    <published>2015-10-20T13:49:18.000Z</published>
    <updated>2016-05-11T14:31:49.000Z</updated>
    
    <content type="html">&lt;p&gt;iOS ä¸Šæœ‰å¾ˆå¤šæµè§ˆå™¨éƒ½æœ‰â€œçœ‹å›¾æ¨¡å¼â€è¿™ä¸€åŠŸèƒ½ï¼Œå®ç°è¿™ä¸€åŠŸèƒ½å¯èƒ½æœ‰å¾ˆå¤šç§é€”å¾„ï¼Œæœ€è¿‘æ¥è§¦åˆ°äº†è¿™æ–¹é¢çš„å·¥ä½œï¼Œæ‰€ä»¥åœ¨æ­¤æŠŠæˆ‘çš„æ€è·¯è®°å½•ä¸‹æ¥ã€‚è¿‡ç¨‹è™½ç„¶æ¯”è¾ƒç®€çŸ­ï¼Œä½†æ—¥åå¯èƒ½ä¼šç”¨åˆ°ï¼Œå¦‚æœ‰æ›´å¥½çš„æ–¹æ¡ˆä¹Ÿå¯ä»¥å¯¹æ¯”ä¸‹ï¼Œå–é•¿è¡¥çŸ­ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;è¿™æ¬¡å¹¶ä¸ä¼šç”¨åˆ°ä»€ä¹ˆæ–°ç‰¹æ€§ï¼ˆæ¯”å¦‚ &lt;code&gt;WKWebView&lt;/code&gt;ï¼‰ã€‚è€Œä¸”æ–¹æ¡ˆå¾ˆç®€å•ï¼Œåˆ†ä¸‰æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·å–ç½‘é¡µä¸­çš„å›¾ç‰‡ï¼ˆé“¾æ¥ï¼‰&lt;/li&gt;
&lt;li&gt;å°†å›¾ç‰‡ï¼ˆé“¾æ¥ï¼‰ä¼ ç»™å›¾ç‰‡æŸ¥çœ‹å™¨&lt;/li&gt;
&lt;li&gt;å®Œæˆç‚¹å‡»å›¾ç‰‡çš„å›è°ƒåŠåŠ¨ç”»&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™é‡Œä¸å¯é¿å…çš„ä¼šè¦ç”¨åˆ° Javascript æ¥è·å– &lt;code&gt;&amp;lt;img&amp;gt;&lt;/code&gt; å…ƒç´ å†…å®¹ï¼Œæ·»åŠ ç‚¹å‡»äº‹ä»¶ç­‰ã€‚ç¬¬ä¸€æ­¥å¾ˆç®€å•ï¼Œå‡ è¡Œ js ä»£ç æå®šï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getAllImageUrl&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; imgs = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.getElementsByTagName(&lt;span class=&quot;string&quot;&gt;&quot;img&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; urlArray = [];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;i&amp;lt;imgs.length;i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; src = imgs[i].src;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       urlArray.push(src);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; urlArray.toString();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¬¬äºŒæ­¥ä¹Ÿä¸éš¾ï¼Œå› ä¸ºå›¾ç‰‡æŸ¥çœ‹å™¨å¯ä»¥ç”¨ç°æˆçš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚ &lt;code&gt;IDMPhotoBrowser&lt;/code&gt;ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ª &lt;code&gt;NSURL&lt;/code&gt; æ•°ç»„å°±è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰æ­¥éœ€è¦ç»•ä¸ªå¼¯å­ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯ç”¨ js ç»™å›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œè¿™ä¸ªç®€å•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setImage&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; imgs = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.getElementsByTagName(&lt;span class=&quot;string&quot;&gt;&quot;img&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;i&amp;lt;imgs.length;i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       imgs[i].setAttribute(&lt;span class=&quot;string&quot;&gt;&quot;onClick&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;imageClick(&quot;&lt;/span&gt;+i+&lt;span class=&quot;string&quot;&gt;&quot;)&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åæ˜¯åŠ¨ç”»ï¼Œè¿˜å¥½ &lt;code&gt;IDMPhotoBrowser&lt;/code&gt; æä¾›äº†ä¸€ä¸ªåŠ¨ç”»çš„æ¥å£ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight erlang&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;params&quot;&gt;(id)&lt;/span&gt;initWithPhotos:&lt;span class=&quot;params&quot;&gt;(NSArray *)&lt;/span&gt;photosArray animatedFromView:&lt;span class=&quot;params&quot;&gt;(UIView*)&lt;/span&gt;view&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦ä¼ å…¥ä¸€ä¸ª &lt;code&gt;view&lt;/code&gt; æ¥ä½œä¸ºåŠ¨ç”»çš„èµ·å§‹å‚æ•°ã€‚æˆ‘çš„åšæ³•æ˜¯åœ¨ &lt;code&gt;webView&lt;/code&gt; ä¸Šæ·»åŠ ä¸€ä¸ªå ä½è§†å›¾ï¼Œå¹¶æ­£å¥½è¦†ç›–åœ¨è¢«ç‚¹å‡»å›¾ç‰‡ä¹‹ä¸Šï¼Œå°†å…¶ä½œä¸ºåŠ¨ç”»çš„èµ·å§‹å‚æ•°ã€‚è¿™å°±éœ€è¦ä»ç½‘é¡µä¸Šè·å–è¢«ç‚¹å‡»å›¾ç‰‡çš„ &lt;code&gt;frame&lt;/code&gt;ï¼Œè¿˜æœ‰å›¾ç‰‡çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight qml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getImageRect&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;i&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; imgs = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.getElementsByTagName(&lt;span class=&quot;string&quot;&gt;&quot;img&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt; = imgs[i].getBoundingClientRect().left+&lt;span class=&quot;string&quot;&gt;&quot;::&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;+imgs[i].getBoundingClientRect().top+&lt;span class=&quot;string&quot;&gt;&quot;::&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;+imgs[i].width+&lt;span class=&quot;string&quot;&gt;&quot;::&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;+imgs[i].height;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getImageData&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;i&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; imgs = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.getElementsByTagName(&lt;span class=&quot;string&quot;&gt;&quot;img&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; img=imgs[i]; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; canvas=&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.createElement(&lt;span class=&quot;string&quot;&gt;&quot;canvas&quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; context=canvas.getContext(&lt;span class=&quot;string&quot;&gt;&quot;2d&quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   canvas.width=img.width; canvas.height=img.height; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   context.drawImage(img,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,img.width,img.height); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; canvas.toDataURL(&lt;span class=&quot;string&quot;&gt;&quot;image/png&quot;&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è·å–å›¾ç‰‡å†…å®¹æ—¶æˆ‘å¹¶æ²¡æœ‰é€šè¿‡å›¾ç‰‡çš„ url åœ¨ OC ä»£ç ä¸­é‡æ–°ä¸‹è½½ä¸€æ¬¡å›¾ç‰‡ï¼Œè€Œæ˜¯é€‰æ‹©å°† web ä¸­å·²ç»ä¸‹è½½å¥½çš„å›¾ç‰‡è½¬æˆ png æ ¼å¼ä¼ ç»™ OCã€‚ä½† &lt;code&gt;stringByEvaluatingJavaScriptFromString:&lt;/code&gt; æ–¹æ³•è¿”å›çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œä¸” js è¿”å›çš„æ•°æ®ç¼–ç è¿˜æ˜¯ base64 æ ¼å¼çš„ã€‚è¿™é‡Œç”¨åˆ° &lt;code&gt;skpsmtpmessage&lt;/code&gt; è¿™ä¸ªç¬¬ä¸‰æ–¹åº“å°†å…¶è§£ç ä¸º &lt;code&gt;NSData&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;NSString&lt;/span&gt; *javascript = [NSString &lt;span class=&quot;keyword&quot;&gt;stringWithFormat:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;                                &lt;span class=&quot;comment&quot;&gt;@&quot;getImageData(%d);&quot;, imgIndex];&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;NSString&lt;/span&gt; *&lt;span class=&quot;keyword&quot;&gt;stringData &lt;/span&gt;= [webView &lt;span class=&quot;keyword&quot;&gt;stringByEvaluatingJavaScriptFromString:javascript];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;stringData &lt;/span&gt;= [&lt;span class=&quot;keyword&quot;&gt;stringData &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;substringFromIndex:22]; &lt;/span&gt;// &lt;span class=&quot;keyword&quot;&gt;strip &lt;/span&gt;the &lt;span class=&quot;keyword&quot;&gt;string &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;data:image/png:base64,&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;NSData&lt;/span&gt; *&lt;span class=&quot;meta&quot;&gt;data&lt;/span&gt; = [NSData decodeWebSafeBase64ForString:&lt;span class=&quot;keyword&quot;&gt;stringData];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;UIImage&lt;/span&gt; *image = [UIImage imageWithData:&lt;span class=&quot;meta&quot;&gt;data&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å—¯ï¼Œæœ€åå®Œæˆå›¾ç‰‡ç‚¹å‡»äº‹ä»¶çš„å‡½æ•°ï¼Œåœ¨å…¶ä¸­è·å–è¢«ç‚¹å‡»å›¾ç‰‡çš„ frameï¼Œå¹¶æ‹¼å‡‘æˆä»¥ â€œclickgirlâ€ å¼€å¤´çš„ &lt;code&gt;url&lt;/code&gt;ï¼Œå½“ç„¶å¦‚æœä½ å–œæ¬¢ç”¨ â€œsexualgirlâ€ ä¹‹ç±»çš„ä¹Ÿå¯ä»¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight qml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;imageClick&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;i&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt; = getImageRect(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;url&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;clickgirl::&quot;&lt;/span&gt;+i+&lt;span class=&quot;string&quot;&gt;&quot;::&quot;&lt;/span&gt;+&lt;span class=&quot;built_in&quot;&gt;rect&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.location = &lt;span class=&quot;built_in&quot;&gt;url&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢çš„ &lt;code&gt;url&lt;/code&gt; åœ¨ &lt;code&gt;UIWebViewDelegate&lt;/code&gt; çš„ &lt;code&gt;- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType&lt;/code&gt; ä¸­ä¼šè·å–åˆ°ï¼Œæˆ‘è´´ä¸Šå®Œæ•´ä»£ç ï¼Œé¡ºä¾¿å»æ‰ä¸‹è®¨åŒçš„ç™¾åº¦æ¨å¹¿ã€‚ä¸è¦å¿˜äº†åœ¨ &lt;code&gt;browser&lt;/code&gt; å‡ºç°åå°†å ä½å›¾ç‰‡ç§»é™¤ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)webView:(&lt;span class=&quot;built_in&quot;&gt;UIWebView&lt;/span&gt; *)webView shouldStartLoadWithRequest:(&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *)request navigationType:(&lt;span class=&quot;built_in&quot;&gt;UIWebViewNavigationType&lt;/span&gt;)navigationType &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *requestString = [[request URL] absoluteString];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([requestString hasPrefix:&lt;span class=&quot;string&quot;&gt;@&quot;http://pos.baidu.com&quot;&lt;/span&gt;]) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// ignore baidu ad&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *components = [requestString componentsSeparatedByString:&lt;span class=&quot;string&quot;&gt;@&quot;::&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([components[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;clickgirl&quot;&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; imgIndex = [components[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] intValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;CGRect&lt;/span&gt; frame = &lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;([components[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;] floatValue], [components[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;] floatValue], [components[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;] floatValue], [components[&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;] floatValue]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; *showView = [[&lt;span class=&quot;built_in&quot;&gt;UIImageView&lt;/span&gt; alloc] initWithFrame:frame];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *javascript = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;string&quot;&gt;@&quot;getImageData(%d);&quot;&lt;/span&gt;, imgIndex];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *stringData = [webView stringByEvaluatingJavaScriptFromString:javascript];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        stringData = [stringData substringFromIndex:&lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;]; &lt;span class=&quot;comment&quot;&gt;// strip the string &quot;data:image/png:base64,&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *data = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; decodeWebSafeBase64ForString:stringData];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageWithData:data];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        showView.image = image;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [_webView addSubview:showView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *urls = [_webView stringByEvaluatingJavaScriptFromString:&lt;span class=&quot;string&quot;&gt;@&quot;getAllImageUrl();&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ID&lt;span class=&quot;built_in&quot;&gt;MPhotoBrowser&lt;/span&gt; *browser = [[ID&lt;span class=&quot;built_in&quot;&gt;MPhotoBrowser&lt;/span&gt; alloc] initWithPhotos:[ID&lt;span class=&quot;built_in&quot;&gt;MPhoto&lt;/span&gt; photosWithURLs:[urls componentsSeparatedByString:&lt;span class=&quot;string&quot;&gt;@&quot;,&quot;&lt;/span&gt;]] animatedFromView:showView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [browser setInitialPageIndex:imgIndex];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        browser.useWhiteBackgroundColor = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; presentViewController:browser animated:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt; completion:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [showView removeFromSuperview];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶å®æœ‰äº›ç½‘ç«™åªæ˜¯åœ¨æ‰‹æœºç«™ä¸ŠåŠ äº†ç™¾åº¦æ¨å¹¿ä¹‹ç±»çš„ï¼Œè€Œåœ¨ PC ç«¯å¯èƒ½å¹¶æ²¡æœ‰ã€‚è‡³äºç¬¦åˆæŸ¥çœ‹æ‰‹æœºä¸Š web çš„å¸ƒå±€ï¼Œå¯ä»¥åœ¨è°ƒè¯•æ—¶æ‰“å¼€ Mac ä¸Šçš„ Safariï¼Œç‚¹å‡»â€œå¼€å‘â€èœå•ï¼ˆæˆ‘ç›¸ä¿¡ä½ è‚¯å®šæ—©å·²å¼€å¯å¼€å‘æ¨¡å¼ï¼‰ï¼Œé€‰æ‹©ä½ è°ƒè¯•çš„é‚£å°è®¾å¤‡ï¼Œç„¶åä¼šçœ‹åˆ°ä½ æ­£åœ¨è°ƒè¯•çš„ç¨‹åºå’Œ &lt;code&gt;webview&lt;/code&gt; å½“å‰æ‰“å¼€çš„åŸŸåã€‚ç‚¹å‡»åå¯ä»¥å±•å¼€ Web æ£€æŸ¥å™¨ï¼Œä½¿ç”¨æ–¹æ³•è·Ÿ Mac ä¸Š Safari çš„ Web æ£€æŸ¥å™¨ä¸€æ ·ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20151022-0@2x.png&quot; alt=&quot;Web æ£€æŸ¥å™¨&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°±å¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šçš„ Web å…ƒç´ ï¼Œæ–¹ä¾¿æˆ‘ä»¬ js ä»£ç çš„ç¼–å†™ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®åœ¨åšå…¬å¸é¡¹ç›®æ—¶çœ‹äº†ä¸‹ &lt;code&gt;IDMPhotoBrowser&lt;/code&gt; çš„ä»£ç ï¼Œå¹¶åšäº†ä¸€ç‚¹å„¿ä¼˜åŒ–å’Œå®šåˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨åŠ¨ç”»æ–¹é¢ï¼Œè¿™ä¸ªæ§ä»¶è¿˜æœ‰å¾ˆå¤šæµç¨‹å’Œæ€§èƒ½ä¼˜åŒ–çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæ”¾ä¸Š Demo çš„ Githubï¼š&lt;a href=&quot;https://github.com/yulingtianxia/WebViewImageClick&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/yulingtianxia/WebViewImageClick&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;iOS ä¸Šæœ‰å¾ˆå¤šæµè§ˆå™¨éƒ½æœ‰â€œçœ‹å›¾æ¨¡å¼â€è¿™ä¸€åŠŸèƒ½ï¼Œå®ç°è¿™ä¸€åŠŸèƒ½å¯èƒ½æœ‰å¾ˆå¤šç§é€”å¾„ï¼Œæœ€è¿‘æ¥è§¦åˆ°äº†è¿™æ–¹é¢çš„å·¥ä½œï¼Œæ‰€ä»¥åœ¨æ­¤æŠŠæˆ‘çš„æ€è·¯è®°å½•ä¸‹æ¥ã€‚è¿‡ç¨‹è™½ç„¶æ¯”è¾ƒç®€çŸ­ï¼Œä½†æ—¥åå¯èƒ½ä¼šç”¨åˆ°ï¼Œå¦‚æœ‰æ›´å¥½çš„æ–¹æ¡ˆä¹Ÿå¯ä»¥å¯¹æ¯”ä¸‹ï¼Œå–é•¿è¡¥çŸ­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>When to Use Swift Structs and Classes</title>
    <link href="http://yulingtianxia.com/blog/2015/08/12/When-to-Use-Swift-Structs-and-Classes/"/>
    <id>http://yulingtianxia.com/blog/2015/08/12/When-to-Use-Swift-Structs-and-Classes/</id>
    <published>2015-08-12T02:05:20.000Z</published>
    <updated>2016-05-11T14:32:38.000Z</updated>
    
    <content type="html">&lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª Mike Ash çš„ &lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-07-17-when-to-use-swift-structs-and-classes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Friday Q&amp;amp;A 2015-07-17: When to Use Swift Structs and Classes&lt;/a&gt;  &lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;Swift åœˆä¸­æœ‰ä¸€ä¸ªè¢«åå¤è®¨è®ºçš„è¯é¢˜å·²ç»æˆä¸ºäº†:ä½•æ—¶ä½¿ç”¨&lt;code&gt;class&lt;/code&gt;,ä½•æ—¶ä½¿ç”¨&lt;code&gt;struct&lt;/code&gt;.æˆ‘è§‰å¾—ä»Šå¤©æˆ‘ä¹Ÿè¦ç»™å‡ºæˆ‘çš„ä¸ªäººè§‚ç‚¹.&lt;/p&gt;
&lt;h2 id=&quot;å€¼-VS-å¼•ç”¨&quot;&gt;&lt;a href=&quot;#å€¼-VS-å¼•ç”¨&quot; class=&quot;headerlink&quot; title=&quot;å€¼ VS å¼•ç”¨&quot;&gt;&lt;/a&gt;å€¼ VS å¼•ç”¨&lt;/h2&gt;&lt;p&gt;ç­”æ¡ˆçœŸçš„å¾ˆç®€å•äº†:å½“ä½ éœ€è¦ç”¨å€¼è¯­ä¹‰çš„æ—¶å€™ä½¿ç”¨&lt;code&gt;struct&lt;/code&gt;,éœ€è¦ç”¨å¼•ç”¨è¯­ä¹‰ä½¿ç”¨&lt;code&gt;class&lt;/code&gt;.å°±æ˜¯è¿™æ ·!&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸‹å‘¨å†è§â€¦&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç­‰ä¸‹&lt;/strong&gt;&lt;br&gt;å¹²å•¥?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿˜æ²¡å›ç­”æˆ‘çš„é—®é¢˜å‘¢&lt;/strong&gt;&lt;br&gt;ä½ å•¥æ„æ€?ç­”æ¡ˆä¸æ˜æ‘†ç€ä¹ˆ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å“¦,ä½†æ˜¯â€¦&lt;/strong&gt;&lt;br&gt;å•¥?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯å€¼/å¼•ç”¨è¯­ä¹‰?&lt;/strong&gt;&lt;br&gt;å“¦æˆ‘æ˜ç™½äº†,æˆ‘å¯èƒ½æ¥ä¸‹æ¥ä¼šæ¢è®¨ä¸‹.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿˜æœ‰ä»–ä»¬æ˜¯å¦‚ä½•å…³è”åˆ°&lt;code&gt;class&lt;/code&gt;å’Œ&lt;code&gt;struct&lt;/code&gt;ä¸Šçš„&lt;/strong&gt;&lt;br&gt;å—¯&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰éƒ½å½’æ ¹ç»“åº•åˆ°æ•°æ®ä»¥åŠæ•°æ®å­˜å‚¨çš„ä½ç½®.æˆ‘ä»¬æŠŠä¸œè¥¿å­˜åœ¨å±€éƒ¨å˜é‡,å‚æ•°,å±æ€§å’Œå…¨å±€å˜é‡ä¸­.ä»æ ¹æœ¬ä¸Šåˆåˆ’åˆ†ä¸ºä¸¤ç§ä¸åŒçš„&lt;em&gt;æ–¹å¼&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;å¯¹äºå€¼è¯­ä¹‰æ¥è¯´,æ•°æ®ç›´æ¥å­˜åœ¨äºå­˜å‚¨å•å…ƒä¸­.å¯¹äºå¼•ç”¨è¯­ä¹‰,æ•°æ®å­˜åœ¨äºå…¶ä»–åœ°æ–¹,å­˜å‚¨å•å…ƒå­˜å‚¨ä¸€ä¸ªå¯¹æ•°æ®çš„&lt;em&gt;å¼•ç”¨&lt;/em&gt;.å½“ä½ å­˜å‚¨æ•°æ®çš„æ—¶å€™è¿™ç§å·®å¼‚ä¸ä¸€å®šæ˜æ˜¾.è¦æ³¨æ„çš„æ˜¯æ‹·è´å­˜å‚¨çš„æ—¶å€™.å¯¹äºå€¼è¯­ä¹‰,ä½ å¾—åˆ°çš„æ˜¯æ•°æ®ä¸€ä»½æ–°æ‹·è´.å¯¹äºå¼•ç”¨è¯­ä¹‰,ä½ å¾—åˆ°çš„æ˜¯ä¸€ä»½æŒ‡å‘ç›¸åŒæ•°æ®å¼•ç”¨çš„æ–°æ‹·è´.&lt;/p&gt;
&lt;p&gt;çœŸæ˜¯æŠ½è±¡,æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­å§.æˆ‘ä»¬æš‚æ—¶å…ˆæŠŠ Swift è¿™èŒ¬æ”¾ä¸‹,æˆ‘ä»¬å…ˆçœ‹ä¸ª Objective-C çš„ä¾‹å­:&lt;/p&gt;
&lt;figure class=&quot;highlight autoit&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;@interface&lt;/span&gt; SomeClass : NSObject &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;@implementation&lt;/span&gt; SomeClass&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct SomeStruct &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SomeClass *reference = [[SomeClass alloc] init]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reference.&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SomeClass *reference2 = reference&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reference.&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;The number in reference2 is %d&quot;&lt;/span&gt;, reference2.&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct SomeStruct value = &amp;#123;&amp;#125;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value.&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct SomeStruct value2 = value&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value.&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;The number in value2 is %d&quot;&lt;/span&gt;, value2.&lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰“å°ç»“æœ:&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;The &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; reference2 &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;The &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; value2 &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸ºå•¥ä¸ä¸€æ ·å‘¢?&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SomeClass *reference = [[SomeClass alloc] init]&lt;/code&gt; è¿™è¡Œä»£ç åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;SomeClass&lt;/code&gt; çš„æ–°å®ä¾‹,ç„¶ååœ¨å˜é‡ä¸­æ”¾ç½®äº†ä¸€ä¸ªå¯¹é‚£ä¸ªå®ä¾‹çš„å¼•ç”¨. &lt;code&gt;reference2 = reference&lt;/code&gt; è¿™è¡Œä»£ç åœ¨æ–°å˜é‡ä¸­æ”¾ç½®äº†å¯¹ç›¸åŒå¯¹è±¡çš„å¼•ç”¨. &lt;code&gt;reference.number = 43&lt;/code&gt; è¿™è¡Œä»£ç ä¿®æ”¹çš„æ˜¯ä¸¤ä¸ªå˜é‡å½“å‰ä¸€èµ·æŒ‡å‘çš„å¯¹è±¡ä¸­å­˜å‚¨çš„æ•°å­—.ç»“æœå°±æ˜¯æ—¥å¿—æ‰“å°çš„æ˜¯å¯¹è±¡ä¸­çš„å€¼,å³&lt;code&gt;43&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;struct SomeStruct value = {}&lt;/code&gt; è¿™è¡Œä»£ç åœ¨å˜é‡ä¸­åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;SomeStruct&lt;/code&gt; çš„æ–°å®ä¾‹. &lt;code&gt;value2 = value&lt;/code&gt; å°†å®ä¾‹æ‹·è´åˆ°ç¬¬äºŒä¸ªå˜é‡.æ¯ä¸ªå˜é‡æœ‰å„è‡ªçš„æ•°æ®å—.&lt;/p&gt;
&lt;p&gt;Swift å¯¹åº”çš„ä¾‹å­:&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;class SomeClass &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; number: Int = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct SomeStruct &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; number: Int = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; reference = SomeClass()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reference&lt;span class=&quot;selector-class&quot;&gt;.number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; reference2 = reference&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reference&lt;span class=&quot;selector-class&quot;&gt;.number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;string&quot;&gt;&quot;The number in reference2 is \(reference2.number)&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; value = SomeStruct()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value&lt;span class=&quot;selector-class&quot;&gt;.number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; value2 = value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value&lt;span class=&quot;selector-class&quot;&gt;.number&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;string&quot;&gt;&quot;The number in value2 is \(value2.number)&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å‡ºç»“æœè·Ÿä»¥å‰ä¸€æ ·:&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;The &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; reference2 &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;The &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; value2 &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;å€¼ç±»å‹çš„ç»éªŒ&quot;&gt;&lt;a href=&quot;#å€¼ç±»å‹çš„ç»éªŒ&quot; class=&quot;headerlink&quot; title=&quot;å€¼ç±»å‹çš„ç»éªŒ&quot;&gt;&lt;/a&gt;å€¼ç±»å‹çš„ç»éªŒ&lt;/h2&gt;&lt;p&gt;å€¼ç±»å‹å¹¶ä¸æ˜¯æ–°é²œäº‹ç‰©,ä½†æ˜¯å¯¹äºå¾ˆå¤šäººæ¥è¯´è§‰å¾—å®ƒæ˜¯æ–°çš„.è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢?&lt;/p&gt;
&lt;p&gt;&lt;code&gt;struct&lt;/code&gt; åœ¨ç»å¤§éƒ¨åˆ† Objective-C ä»£ç ä¸­å¹¶ä¸æ˜¯å¾ˆå¸¸ç”¨.æˆ‘ä»¬å¶å°”ä»¥ &lt;code&gt;CGRect&lt;/code&gt; å’Œ &lt;code&gt;CGPoint&lt;/code&gt; ç­‰æ–¹å¼æ¥è§¦åˆ°å®ƒä»¬,ä½†å¾ˆå°‘ä¼šè‡ªå·±å»å†™.é¦–å…ˆ,å®ƒä»¬ä¸æ˜¯å¾ˆå®ç”¨.ç”¨ Objective-C åœ¨ &lt;code&gt;struct&lt;/code&gt; ä¸­æ­£ç¡®åœ°å­˜å‚¨å¯¹è±¡çš„å¼•ç”¨çš„ç¡®å¾ˆéš¾,å°¤å…¶æ˜¯ä½¿ç”¨ ARC çš„æ—¶å€™.&lt;/p&gt;
&lt;p&gt;å¾ˆå¤šå…¶ä»–è¯­è¨€å¹²è„†æ²¡æœ‰ç±»ä¼¼ &lt;code&gt;struct&lt;/code&gt; çš„ä¸œä¸œ.è®¸å¤šè¯­è¨€å¦‚åŒ Python å’Œ JavaScript ä¸€æ ·â€ä¸‡ç‰©çš†å¯¹è±¡â€,åªæœ‰å¼•ç”¨ç±»å‹.å¦‚æœä½ æ˜¯ä»è¿™ç±»è¯­è¨€è½¬å‹åˆ° Swift çš„, ä½ å¯èƒ½å¯¹ &lt;code&gt;struct&lt;/code&gt; çš„æ¦‚å¿µå°±æ›´é™Œç”Ÿäº†.&lt;/p&gt;
&lt;p&gt;ç­‰ä¸€ä¸‹!æœ‰ç§æƒ…å†µä¸‹å‡ ä¹æ‰€æœ‰è¯­è¨€éƒ½ä½¿ç”¨çš„å€¼ç±»å‹:æ•°å­—!ç¨å¾®æœ‰ç‚¹ç¼–ç¨‹ç»éªŒçš„ç¨‹åºå‘˜éƒ½ä¸ä¼šå¯¹ä¸‹é¢çš„è¡Œä¸ºæ„Ÿåˆ°æƒŠè®¶,è¿™è·Ÿè¯­è¨€æ— å…³:&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; x = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; x2 = x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;x++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;string&quot;&gt;&quot;x=\(x) x2=\(x2)&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// prints: x=43 x2=42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¾ˆå¯¹æˆ‘ä»¬æ¥è¯´å¦‚æ­¤æ˜¾è€Œæ˜“è§å’Œè‡ªç„¶ä»¥è‡³äºæˆ‘ä»¬ç”šè‡³æ²¡æ„è¯†åˆ°ç»“æœçš„å·®å¼‚,ä½†å®ƒå°±åœ¨æˆ‘ä»¬çœ¼å‰.ä½ ä»å¼€å§‹ç¼–ç¨‹ä¹‹æ—¥èµ·ä¸€ç›´åœ¨ä½¿ç”¨å€¼ç±»å‹,å³ä½¿ä½ æ²¡æ„è¯†åˆ°.&lt;/p&gt;
&lt;p&gt;å¾ˆå¤šè¯­è¨€å®é™…ä¸Šå°†æ•°å­—å®ç°ä¸ºå¼•ç”¨ç±»å‹,å› ä¸ºå®ƒä»¬æ˜¯â€ä¸‡ç‰©çš†å¯¹è±¡â€å“²å­¦çš„æ­»å¿ ç²‰.ç„¶è€Œ,å®ƒä»¬æ˜¯&lt;em&gt;ä¸å¯å˜&lt;/em&gt;ç±»å‹,å€¼ç±»å‹ä¸ä¸å¯å˜å¼•ç”¨ç±»å‹ä¹‹é—´çš„å·®å¼‚å¾ˆéš¾å¯Ÿè§‰.å®ƒä»¬è¡¨ç°å¾—ä¸å€¼ç±»å‹ç›¸åŒ,å°½ç®¡å®ç°æ–¹å¼å¯èƒ½ä¸åŒ.&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ç†è§£å€¼å’Œå¼•ç”¨ç±»å‹é‡è¦çš„ä¸€ç¯.å½“æ•°æ®å˜åŒ–æ—¶,å·®å¼‚ä¸»è¦å…³ç³»åˆ°è¯­æ³•æ–¹é¢.å‡å¦‚æ•°æ®æ˜¯ä¸å¯å˜çš„,é‚£ä¹ˆå€¼å’Œå¼•ç”¨çš„å·®åˆ«å°±æ¶ˆå¤±äº†,æˆ–è‡³å°‘å˜æˆäº†ä»…æ˜¯æ€§èƒ½é—®é¢˜è€Œä¸æ˜¯è¯­æ³•å·®å¼‚.&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Š Objective-C çš„ &lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2012-07-27-lets-build-tagged-pointers.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;tagged pointers&lt;/a&gt; å¯¹æ­¤æåˆ°è¿‡.ä¸€ä¸ªå¯¹è±¡é‡ä¸Šäº† tagged pointer çš„å¤„ç†,ç„¶åå­˜å‚¨åœ¨æŒ‡é’ˆçš„å€¼ä¸­,å°±æˆäº†å€¼ç±»å‹.æ‹·è´æ“ä½œè¿™æ—¶æ‹·è´çš„å°±æ˜¯å¯¹è±¡å†…å®¹äº†.è¡¨é¢ä¸Šæ²¡å·®å¼‚,å› ä¸º Objective-C å‡½æ•°åº“å°å¿ƒç¿¼ç¿¼åœ°ä»…å°†ä¸å¯å˜ç±»å‹æ”¾åˆ° tagged pointer ä¸­.æœ‰äº› &lt;code&gt;NSNumber&lt;/code&gt; å¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹è€Œæœ‰äº›æ˜¯å€¼ç±»å‹,ä½†ç”¨èµ·æ¥æ²¡ä»€ä¹ˆå·®åˆ«.&lt;/p&gt;
&lt;h2 id=&quot;åšå‡ºæŠ‰æ‹©&quot;&gt;&lt;a href=&quot;#åšå‡ºæŠ‰æ‹©&quot; class=&quot;headerlink&quot; title=&quot;åšå‡ºæŠ‰æ‹©&quot;&gt;&lt;/a&gt;åšå‡ºæŠ‰æ‹©&lt;/h2&gt;&lt;p&gt;æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†å€¼ç±»å‹çš„å·¥ä½œåŸç†,æˆ‘ä»¬æ”¹ä¸ºè‡ªå·±çš„æ•°æ®ç±»å‹é€‰æ‹©é‚£ç§æ–¹å¼å‘¢?&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ç§ç±»å‹æ ¹æœ¬çš„åŒºåˆ«å°±æ˜¯å½“å¯¹å…¶ä½¿ç”¨&lt;code&gt;=&lt;/code&gt;æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ.å€¼ç±»å‹æ˜¯è¢«æ‹·è´,è€Œå¼•ç”¨ç±»å‹åªæ˜¯å¾—åˆ°å¦ä¸€ä¸ªæ–°å¼•ç”¨.&lt;/p&gt;
&lt;p&gt;å› æ­¤åœ¨é€‰æ‹©ä½¿ç”¨å“ªç§ç±»å‹æ—¶é¢å¯¹çš„æ ¹æœ¬é—®é¢˜æ˜¯:æ‹·è´å®ƒæœ‰æ„ä¹‰ä¹ˆ?æ‹·è´æ“ä½œæ˜¯ä½ æƒ³è¦å˜å¾—ç®€å•,å¹¶ç»å¸¸ä½¿ç”¨çš„ä¹ˆ?&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆçœ‹äº›æç«¯çš„,æ˜¾è€Œæ˜“è§çš„ä¾‹å­.æ•´å‹æ•°æ˜æ˜¾æ˜¯å¯ä»¥æ‹·è´çš„,åº”è¯¥æ˜¯å€¼ç±»å‹.ç½‘ç»œå¥—æ¥å­—æ„Ÿè§‰æ˜¯ä¸èƒ½è¢«æ‹·è´,åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹.åƒæ˜¯ç”¨ x,y å¯¹å„¿çš„ç‚¹åæ ‡æ˜¯å¯æ‹·è´çš„,åº”è¯¥æ˜¯å€¼ç±»å‹.ç”¨æ¥è¡¨ç¤ºç£ç›˜çš„æ§åˆ¶å™¨æ„Ÿè§‰ä¸Šä¸å¤ªå®¹æ˜“è¢«æ‹·è´,åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹.&lt;/p&gt;
&lt;p&gt;æœ‰äº›ç±»å‹å¯ä»¥è¢«æ‹·è´,ä½†å®ƒä»¬ä¸æ€»æ˜¯ä½ å¸Œæœ›çš„é‚£æ ·.å»ºè®®æŠŠå®ƒä»¬è®¾ä¸ºå¼•ç”¨ç±»å‹.æ¯”å¦‚å±å¹•ä¸Šçš„ä¸€ä¸ªæŒ‰é’®ä»æ¦‚å¿µä¸Šè®²æ˜¯å¯ä»¥æ‹·è´çš„.å‰¯æœ¬æŒ‰é’®ä¸ä¼šè·ŸåŸæ¥çš„æŒ‰é’®å®Œå…¨ä¸€æ ·.ç‚¹å‡»å‰¯æœ¬æŒ‰é’®å°†ä¸ä¼šæ¿€æ´»åŸæ¥çš„æŒ‰é’®.å‰¯æœ¬ä¸ä¼šå ç”¨ç›¸åŒçš„å±å¹•ä½ç½®.å¦‚æœä½ å°†æŒ‰é’®ä¼ é€’åˆ°å‘¨å›´æˆ–æ”¾åˆ°ä¸€ä¸ªæ–°çš„å˜é‡é‡Œ,ä½ å¤§æ¦‚å°†æƒ³å¼•ç”¨åŸæœ¬çš„æŒ‰é’®,é™¤éæ˜ç¡®è¢«è¯·æ±‚è¦åšä¸€ä»½æ‹·è´.è¿™æ„å‘³ç€ä½ çš„æŒ‰é’®ç±»å‹åº”è¯¥æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹.&lt;/p&gt;
&lt;p&gt;è§†å›¾å’Œçª—å£æ§åˆ¶å™¨æ˜¯ç±»ä¼¼çš„ä¾‹å­.å®ƒä»¬å¯èƒ½æƒ³è±¡ä¸Šæ˜¯èƒ½æ‹·è´çš„,ä½†å®ƒå‡ ä¹ä»æ¥éƒ½ä¸æ˜¯ä½ æƒ³è¦çš„é‚£æ ·.å®ƒä»¬åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹.&lt;/p&gt;
&lt;p&gt;ç”¨äº Model çš„ç±»å‹è¯¥æ€ä¹ˆæ?æ¯”æ–¹ä½ æœ‰ä¸ª &lt;code&gt;User&lt;/code&gt; ç±»å‹æ¥è¡¨ç¤ºç³»ç»Ÿä¸­çš„ç”¨æˆ·,æˆ–è€… &lt;code&gt;Crime&lt;/code&gt; ç±»å‹æ¥è¡¨ç¤ºç”¨æˆ·çš„æ´»åŠ¨.è¿™äº›éƒ½æ˜¯å¯å®Œç¾æ‹·è´çš„,æ‰€ä»¥å®ƒä»¬æˆ–è®¸åº”è¯¥æ˜¯å€¼ç±»å‹.ç„¶è€Œ,ä½ å¯èƒ½å¸Œæœ›ä½ ç¨‹åºä¸­æŸå¤„å¯¹ &lt;code&gt;User&lt;/code&gt; çš„ &lt;code&gt;Crime&lt;/code&gt; ä¸Šçš„æ›´æ–°åœ¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹ä¹Ÿå¯è§.è¿™å°±å»ºè®® &lt;code&gt;User&lt;/code&gt; åº”è¯¥è¢«æŸç§ç”¨æˆ·æ§åˆ¶å™¨æ¥ç®¡ç†,è€Œä¸”å®ƒåº”è¯¥æ˜¯å¼•ç”¨ç±»å‹.&lt;/p&gt;
&lt;p&gt;é›†åˆæ˜¯ä¸ªæœ‰è¶£çš„ä¾‹å­.è¿™åŒ…æ‹¬æ¯”å¦‚æ•°ç»„å’Œå­—å…¸ä¹‹ç±»çš„ä¸œè¥¿,ä»¥åŠå­—ç¬¦ä¸².å®ƒä»¬æ˜¯å¯æ‹·è´çš„ä¹ˆ?æ˜¾è€Œæ˜“è§.ä½ æƒ³è¦åšçš„æ‹·è´æ“ä½œæ˜¯å¦æ˜“å‘ç”Ÿä¸”ç»å¸¸å‘ç”Ÿå‘¢?è¿™ä¸å¥½è¯´.&lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°è¯­è¨€å¯¹æ­¤è¯´â€ä¸â€,è€Œæ˜¯å®ç°ä¸ºå¼•ç”¨ç±»å‹. Objective-C,Java,Python,JavaScript å’Œå‡ ä¹å…¶ä»–æ‰€æœ‰æˆ‘èƒ½æƒ³åˆ°çš„è¯­è¨€éƒ½æ˜¯è¿™ä¹ˆå¹²çš„.(ä¸€ä¸ªä¸»è¦çš„ä¾‹å¤–å°±æ˜¯ C++ çš„ STL ä¸­çš„é›†åˆç±»å‹,ä½†æ˜¯ C++ æ˜¯è¯­è¨€ä¸–ç•Œä¸­èƒ¡è¨€ä¹±è¯­çš„ç–¯å­,å®ƒä¸èµ°å¯»å¸¸è·¯.)&lt;/p&gt;
&lt;p&gt;Swift è¯´â€ä¸é”™â€,è¿™æ„å‘³ç€å¦‚ &lt;code&gt;Array&lt;/code&gt;,&lt;code&gt;Dictionary&lt;/code&gt; å’Œ &lt;code&gt;String&lt;/code&gt; éƒ½æ˜¯ &lt;code&gt;struct&lt;/code&gt; è€Œä¸æ˜¯ &lt;code&gt;class&lt;/code&gt;. å®ƒä»¬åœ¨èµ‹å€¼å’Œä½œä¸ºå‚æ•°ä¼ é€’æ—¶è¢«æ‹·è´.åªè¦æ‹·è´çš„å¼€é”€å°,è¿™å°±æ˜¯ä¸ªå½»åº•æ˜æ™ºçš„é€‰æ‹©,è€ŒSwiftè´¹äº†å¾ˆå¤§åŠ›æ°”å»å®ç°è¿™ç‚¹.&lt;/p&gt;
&lt;h2 id=&quot;åµŒå¥—ç±»å‹&quot;&gt;&lt;a href=&quot;#åµŒå¥—ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;åµŒå¥—ç±»å‹&quot;&gt;&lt;/a&gt;åµŒå¥—ç±»å‹&lt;/h2&gt;&lt;p&gt;åµŒå¥—ä½¿ç”¨å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¼šæœ‰å››ç§ç»„åˆæ–¹å¼.åªæ˜¯å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£.&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå¼•ç”¨ç±»å‹åŒ…å«äº†å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹,æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„å‘ç”Ÿ.ä»»ä½•æŒ‡å‘å…¶å†…éƒ¨æˆ–å¤–éƒ¨å€¼çš„å¼•ç”¨é€šå¸¸éƒ½èƒ½ä¿®æ”¹å®ƒ.æ¯ä¸ªäººéƒ½ä¼šçœ‹åˆ°å‘ç”Ÿçš„å˜æ›´.&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå€¼ç±»å‹åŒ…å«äº†å¦ä¸€ä¸ªå€¼ç±»å‹,è¿™å®é™…ä¸Šåªæ˜¯è®©å…¶å ç”¨ç©ºé—´æ›´å¤š.å†…éƒ¨å€¼æ˜¯å¤–éƒ¨å€¼çš„ä¸€éƒ¨åˆ†.å¦‚æœä½ å°†å¤–éƒ¨å€¼æ”¾è¿›æŸä¸ªæ–°çš„å­˜å‚¨åŒº,æ‰€æœ‰çš„å€¼éƒ½ä¼šè¢«æ‹·è´,åŒ…æ‹¬å†…éƒ¨å€¼.å¦‚æœä½ å°†å†…éƒ¨å€¼æ”¾å…¥æŸä¸ªæ–°çš„å­˜å‚¨,å®ƒä¼šè¢«æ‹·è´.&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå¼•ç”¨ç±»å‹åŒ…å«äº†ä¸€ä¸ªå€¼ç±»å‹å®é™…ä¸Šè®©è¢«å¼•ç”¨çš„å€¼å ç”¨ç©ºé—´æ›´å¤§äº†.æ‹¥æœ‰å¯¹å¤–éƒ¨å€¼çš„å¼•ç”¨å°±å¯ä»¥æ“ä½œå…¨éƒ¨å€¼,åŒ…æ‹¬è¢«åµŒå…¥çš„å€¼.è¢«åµŒå…¥å€¼çš„æ‰€æœ‰å˜æ›´å¯¹æŒ‡å‘å¤–éƒ¨å€¼çš„å¼•ç”¨æ˜¯å¯è§çš„.å¦‚æœä½ å°†å†…éƒ¨å€¼æ”¾å…¥æŸä¸ªæ–°çš„å­˜å‚¨åŒº,å®ƒä¼šè¢«æ‹·è´è‡³é‚£é‡Œ.&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå€¼ç±»å‹åŒ…å«ç€ä¸€ä¸ªå¼•ç”¨ç±»å‹é‚£å°±ä¸è¿™ä¹ˆç®€å•äº†.ä½ å®é™…ä¸Šæš—åœ°é‡Œç ´åäº†ä½ æƒ³è¦ç”¨çš„å€¼ç±»å‹è¯­ä¹‰.è¿™æ ·åšæˆ–å¥½åå,å–å†³äºä½ æ€æ ·å»åš.å½“ä½ æŠŠä¸€ä¸ªå¼•ç”¨ç±»å‹æ”¾å…¥åˆ°ä¸€ä¸ªå€¼ç±»å‹ä¸­,å½“ä½ æŠŠå®ƒæ”¾å…¥æ–°çš„å­˜å‚¨åŒºæ—¶å¤–éƒ¨å€¼ä¼šè¢«æ‹·è´,ä½†æ˜¯æ‹·è´åçš„å‰¯æœ¬æœ‰ä¸€ä¸ªæŒ‡å‘&lt;em&gt;ç›¸åŒå†…åµŒçš„åŸå§‹å¯¹è±¡&lt;/em&gt;çš„å¼•ç”¨.è¿™æœ‰ä¸ªä¾‹å­:&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;class Inner &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; value = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct Outer &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; value = &lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; inner = Inner()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; outer = Outer()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; outer2 = outer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;outer&lt;span class=&quot;selector-class&quot;&gt;.value&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;outer&lt;span class=&quot;selector-class&quot;&gt;.inner&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.value&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;string&quot;&gt;&quot;outer2.value=\(outer2.value) outer2.inner.value=\(outer2.inner.value)&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å‡ºæ˜¯:&lt;/p&gt;
&lt;figure class=&quot;highlight ceylon&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.inner.&lt;span class=&quot;keyword&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;43&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è™½ç„¶ &lt;code&gt;outer2&lt;/code&gt; å¾—åˆ°ä¸€ä»½ &lt;code&gt;value&lt;/code&gt; çš„æ‹·è´,ä½†å®ƒåªæ‹·è´äº† &lt;code&gt;inner&lt;/code&gt; çš„*å¼•ç”¨,äºæ˜¯è¿™ä¸¤ä¸ª &lt;code&gt;struct&lt;/code&gt; æœ€ç»ˆå…±äº«åŒä¸€ä¸ª &lt;code&gt;Inner&lt;/code&gt; å®ä¾‹.å› æ­¤å¯¹ &lt;code&gt;outer.inner.value&lt;/code&gt; çš„æ›´æ–°ä¼šå½±å“åˆ° &lt;code&gt;outer2.inner.value&lt;/code&gt;. å”‰å‘€å¦ˆå‘€!&lt;/p&gt;
&lt;p&gt;è¿™ç§åšæ³•çœŸçš„å¾ˆæ–¹ä¾¿.ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åˆ›å»ºä¸ªèƒ½å¤Ÿæ‰§è¡Œå†™æ—¶æ‹·è´çš„ &lt;code&gt;struct&lt;/code&gt;,è¿˜èƒ½å®ç°è®©å€¼è¯­ä¹‰å®é™…ä¸Šä¸åˆ°å¤„æ‹·è´ä¸€å¨å¨çš„æ•°æ®.è¿™å°±æ˜¯ Swift ä¸­çš„é›†åˆçš„å·¥ä½œåŸç†,ä½ è‡ªå·±ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„é›†åˆç±»å‹.æƒ³è¦çŸ¥é“æ›´å¤šè¯¦ç»†ä¿¡æ¯,å¯ä»¥çœ‹çœ‹ &lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-04-17-lets-build-swiftarray.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Letâ€™s Build Swift.Array&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;è¿™ä¹ˆåšä¹Ÿå¯èƒ½å˜å¾—æå…¶å±é™©.æ¯”æ–¹è¯´ä½ åˆ›å»ºäº†ä¸ª &lt;code&gt;Person&lt;/code&gt; ç±»å‹.å®ƒè¢«ç”¨ä½œ Model ç±»å½“ç„¶ä¹Ÿæ˜¯å¯æ‹·è´çš„,æ‰€ä»¥å¯ä»¥ç”¨ &lt;code&gt;struct&lt;/code&gt; å®ç°å’¯.çªå‘ä¸€é˜µå¯¹ OC çš„æ€€æ—§,ä½ å†³å®šç”¨ &lt;code&gt;NSString&lt;/code&gt; ä½œä¸º &lt;code&gt;Person&lt;/code&gt; çš„ &lt;code&gt;name&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight capnproto&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   var name: NSString&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åä½ åˆ›å»ºæŒ‰äº†ä¸€å¯¹å„¿ &lt;code&gt;Person&lt;/code&gt; å®ä¾‹,æ‹¼æ¥å­—ç¬¦ä¸²æ„å»ºå‡º &lt;code&gt;name&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;let &lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt; = NSMutableString()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;.appendString(&lt;span class=&quot;string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;.appendString(&lt;span class=&quot;string&quot;&gt;&quot; &quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;.appendString(&lt;span class=&quot;string&quot;&gt;&quot;Josephsonson&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let bob = Person(&lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;.appendString(&lt;span class=&quot;string&quot;&gt;&quot;, Jr.&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let bobjr = Person(&lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åè¾“å‡ºå®ƒä»¬:&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(bob.name)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(bobjr.name)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç»“æœäº§ç”Ÿäº†:&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Bob &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;Josephsonson, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;Jr.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;Bob &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;Josephsonson, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;Jr.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é !&lt;/p&gt;
&lt;p&gt;å‘ç”Ÿäº†ä»€ä¹ˆ?åŒºåˆ«äº Swift çš„ &lt;code&gt;String&lt;/code&gt; ç±»å‹, &lt;code&gt;NSString&lt;/code&gt; æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹.å®ƒæ˜¯ä¸å¯å˜çš„,ä½†å®ƒæœ‰ä¸ªå¯å˜çš„å­ç±», &lt;code&gt;NSMutableString&lt;/code&gt;. å½“ &lt;code&gt;bob&lt;/code&gt; åˆ›å»ºæ—¶,å®ƒåˆ›å»ºäº†ä¸€ä¸ªå¯¹ &lt;code&gt;name&lt;/code&gt; å­—ç¬¦ä¸²çš„å¼•ç”¨.å½“é‚£ä¸ªå­—ç¬¦ä¸²éšåè¢«ä¿®æ”¹æ—¶,å˜æ›´ä¼šé€šè¿‡ &lt;code&gt;bob&lt;/code&gt; å±•ç°å‡ºæ¥.è¦æ³¨æ„åˆ°å³ä½¿ &lt;code&gt;bob&lt;/code&gt; æ˜¯è¢« &lt;code&gt;let&lt;/code&gt; çº¦æŸçš„å€¼ç±»å‹,ä½†å®é™…ä¸Šæ”¹å˜äº† &lt;code&gt;bob&lt;/code&gt;.è¿™&lt;em&gt;ç®—ä¸ä¸ŠçœŸçš„&lt;/em&gt;ä¿®æ”¹äº† &lt;code&gt;bob&lt;/code&gt;,åªæ˜¯ä¿®æ”¹äº† &lt;code&gt;bob&lt;/code&gt; ä¸­å¼•ç”¨çš„ä¸€ä¸ªå€¼,ä½†å› ä¸ºé‚£ä¸ªå€¼æ˜¯ &lt;code&gt;bob&lt;/code&gt; æ•°æ®çš„ä¸€éƒ¨åˆ†,ä»è¯­ä¹‰ä¸Šè®©äººæ„Ÿåˆ°åƒæ˜¯å¯¹ &lt;code&gt;bob&lt;/code&gt; ä½œäº†ä¿®æ”¹.&lt;/p&gt;
&lt;p&gt;è¿™ç§äº‹æƒ…åœ¨ Objective-C ä¸­&lt;em&gt;ä¸€ç›´&lt;/em&gt;åœ¨å‘ç”Ÿ.æ¯ä¸ªæœ‰ç»éªŒçš„ Objective-C ç¨‹åºå‘˜éƒ½æœ‰åˆ°å¤„å†™é˜²å¾¡æ‹·è´çš„ä¹ æƒ¯.å› ä¸ºä¸€ä¸ª &lt;code&gt;NSString&lt;/code&gt; å®ä¾‹å¯èƒ½å®é™…ä¸Šå´æ˜¯ &lt;code&gt;NSMutableString&lt;/code&gt;, ä¸ºäº†é¿å…ç¾éš¾,ä½ è¦å°†å±æ€§å®šä¹‰ä¸º &lt;code&gt;copy&lt;/code&gt;,æˆ–è€…åœ¨åˆå§‹åŒ–æ—¶æ˜¾å¼è°ƒç”¨ &lt;code&gt;copy&lt;/code&gt; æ–¹æ³•.è¿™åŒæ ·é€‚ç”¨äº Cocoa ä¸­å„ç§å„æ ·çš„é›†åˆç±»å‹.&lt;/p&gt;
&lt;p&gt;åœ¨ Swift ä¸­è§£å†³æ–¹æ¡ˆæ›´ç®€å•äº›:ä½¿ç”¨å€¼ç±»å‹è€Œä¸æ˜¯å¼•ç”¨ç±»å‹.åœ¨è¿™ç§æƒ…å†µä¸‹,è®© &lt;code&gt;name&lt;/code&gt; æˆä¸º &lt;code&gt;String&lt;/code&gt;.å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ— æ„ä¸­æŠŠå¼•ç”¨å…±äº«å’¯.&lt;/p&gt;
&lt;p&gt;åœ¨å…¶ä»–æƒ…å†µä¸‹,è§£å†³æ–¹æ¡ˆå¯èƒ½æ›´ç®€å•.æ¯”å¦‚,ä½ åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«è§†å›¾çš„ &lt;code&gt;struct&lt;/code&gt;,è€Œè§†å›¾æ˜¯å¼•ç”¨ç±»å‹ä¸”ä¸èƒ½æ”¹æˆå€¼ç±»å‹.è¿™&lt;em&gt;æˆ–è®¸&lt;/em&gt;æ˜¯ä¸ªå¥½çš„è¿¹è±¡è¡¨æ˜ä½ ä¸è¯¥ç”¨ &lt;code&gt;struct&lt;/code&gt;, å› ä¸ºä½ ä¸ç®¡æ€æ ·éƒ½ä¸èƒ½ç»´æŒå€¼è¯­ä¹‰.&lt;/p&gt;
&lt;h2 id=&quot;ç»“è®º&quot;&gt;&lt;a href=&quot;#ç»“è®º&quot; class=&quot;headerlink&quot; title=&quot;ç»“è®º&quot;&gt;&lt;/a&gt;ç»“è®º&lt;/h2&gt;&lt;p&gt;å½“ç§»åŠ¨å€¼ç±»å‹æ—¶å®ƒä»¬ä¼šè¢«æ‹·è´,ç„¶è€Œå¼•ç”¨ç±»å‹åªæ˜¯å¾—åˆ°äº†ä¸€ä¸ªå¯¹ç›¸åŒåº•å±‚å¯¹è±¡æ–°å¼•ç”¨.è¿™æ„å‘³ç€å¯¹å¼•ç”¨ç±»å‹çš„ä¿®æ”¹åœ¨æ¯ä¸ªå¼•ç”¨ä¸Šéƒ½çœ‹çš„åˆ°,ç„¶è€Œå¯¹å€¼ç±»å‹çš„ä¿®æ”¹åªä¼šå½±å“ä½ ä¿®æ”¹çš„é‚£å—å­˜å‚¨åŒº.å½“é€‰æ‹©ä½¿ç”¨å“ªç§ç±»å‹æ—¶,æ€è€ƒä¸‹å¦‚ä½•æ‹·è´ä½ çš„ç±»å‹æ¯”è¾ƒæ°å½“,å¦‚æœéœ€è¦æ·±å±‚æ‹·è´å°±å€¾å‘äºé€‰æ‹©å€¼ç±»å‹.æœ€å,è°¨é˜²å€¼ç±»å‹ä¸­åµŒå…¥çš„å¼•ç”¨ç±»å‹,ç¨æœ‰ä¸æ…å°±ä¼šé­æ®ƒ.&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª Mike Ash çš„ &lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-07-17-when-to-use-swift-structs-and-classes.html&quot;&gt;Friday Q&amp;amp;A 2015-07-17: When to Use Swift Structs and Classes&lt;/a&gt;  &lt;/p&gt;
    
    </summary>
    
    
      <category term="Swift" scheme="http://yulingtianxia.com/tags/Swift/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yulingtianxia.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>åˆè¯†Core Data(4)</title>
    <link href="http://yulingtianxia.com/blog/2015/07/25/%E5%88%9D%E8%AF%86Core-Data-4/"/>
    <id>http://yulingtianxia.com/blog/2015/07/25/åˆè¯†Core-Data-4/</id>
    <published>2015-07-25T05:23:17.000Z</published>
    <updated>2016-05-11T14:31:49.000Z</updated>
    
    <content type="html">&lt;p&gt;è¿™å…¶å®æ˜¯ä¸€ç¯‡ WWDC 2015 Session 220 çš„å­¦ä¹ ç¬”è®°,é¡ºä¾¿æ•´ç†äº†ä¸‹ Core Data æ‰¹é‡æ“ä½œå’Œèšåˆæ“ä½œçš„å°æŠ€å·§.&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;æ‰¹é‡æ“ä½œ&quot;&gt;&lt;a href=&quot;#æ‰¹é‡æ“ä½œ&quot; class=&quot;headerlink&quot; title=&quot;æ‰¹é‡æ“ä½œ&quot;&gt;&lt;/a&gt;æ‰¹é‡æ“ä½œ&lt;/h2&gt;&lt;p&gt;Core Data æŠŠæ•°æ®åº“å°è£…æˆäº†â€object graph(å¯¹è±¡å›¾)â€,è™½ç„¶å¯¹äºé¢å‘å¯¹è±¡ç¼–ç¨‹æ¥è¯´æœ‰äº†ç®¡ç† Model é—´ç»§æ‰¿ä¸å…³ç³»çš„ä¾¿åˆ©æ€§,ä½†åŒæ ·ä¹Ÿç‰ºç‰²äº†æ€§èƒ½.æ¯”å¦‚æ‰¹é‡æ“ä½œæ—¶å°±éœ€è¦å°†æ¯æ¡è®°å½•ä½œä¸º &lt;code&gt;NSManagedObject&lt;/code&gt; å¯¹è±¡è¯»å–åˆ°å†…å­˜ä¸­,ä¿®æ”¹ä¹‹åå†å­˜å…¥æ•°æ®åº“.ç„¶è€Œç”¨ SQL è¯­å¥æ‰§è¡Œæ—¢æ–¹ä¾¿åˆé«˜æ•ˆ.  &lt;/p&gt;
&lt;p&gt;äºæ˜¯è‹¹æœåœ¨ iOS8 å‘å¸ƒæ—¶é¡ºä¾¿å¼„äº†ä¸ªâ€Batch Updatesâ€,åœ¨ iOS9 å‘å¸ƒæ—¶åˆå¼„äº†ä¸ªâ€Batch Deletionsâ€.è¿™ä¸¤ä¸ªâ€æ–°æŠ€æœ¯â€è¯´ç™½äº†å°±æ˜¯ç›´æ¥æ“ä½œæŒä¹…å±‚æ•°æ®åº“,ç„¶åè¿˜éœ€è¦æ‰‹åŠ¨æ›´æ–°/åˆ é™¤å†…å­˜ä¸­çš„ context å¥½ä½¿å¾—æˆ‘ä»¬çš„ UI ä» context è¯»å–çš„å†…å®¹ä¸ä¼šå‡ºé”™.è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯çœå»äº†å‘å†…å­˜çš„ä¸€æ¬¡å†™æ“ä½œå’ŒæŸ¥æ‰¾æ“ä½œ,è€Œè¶Šè¿‡ context ç›´æ¥æ“ä½œæŒä¹…å±‚,æœ€åæˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨å°†æŒä¹…å±‚çš„å˜æ›´ç»“æœ(&lt;code&gt;BatchResult&lt;/code&gt;)é‡æ–°å†™å…¥ context.åªæœ‰å½“éœ€è¦æ›´æ–°/åˆ é™¤å¤§æ‰¹é‡æ•°æ®çš„æ—¶å€™æ‰éœ€è¦ç”¨åˆ°è¿™ä¸¤ä¸ªæŠ€æœ¯.&lt;/p&gt;
&lt;p&gt;ç„¶è€Œè‹¹æœè‡³ä»Šæœªæä¾›äºŒè€…çš„æ–‡æ¡£,å…³äºâ€Batch Updatesâ€æˆ‘åœ¨&lt;a href=&quot;http://yulingtianxia.com/blog/2014/08/05/coredatachu-li-hai-liang-shu-ju/&quot;&gt;CoreDataå¤„ç†æµ·é‡æ•°æ®&lt;/a&gt;ä¸­ç»™å‡ºäº†ç”¨æ³•å’Œä¾‹å­.çœ‹äº† WWDC2015 Session 220 åè§‰å¾— â€œBatch Deletionsâ€ åº”è¯¥ä¸ â€œBatch Updatesâ€ ç”¨æ³•ç±»ä¼¼,å¹¶ä¸”å‘çˆ¹. PS: æˆ‘åœ¨ iOS9 ä¸Šæµ‹è¯• â€œBatch Updatesâ€ å‘ç°äº†ä¸€ä¸ª bug, æ¯æ¬¡æ›´æ–° context éƒ½ä¼šæ¼æ‰ä¸€æ¡è®°å½•,è¿™è®©æˆ‘ååˆ†éƒé—·.  &lt;/p&gt;
&lt;h2 id=&quot;èšåˆæ“ä½œ&quot;&gt;&lt;a href=&quot;#èšåˆæ“ä½œ&quot; class=&quot;headerlink&quot; title=&quot;èšåˆæ“ä½œ&quot;&gt;&lt;/a&gt;èšåˆæ“ä½œ&lt;/h2&gt;&lt;p&gt;è¯´å®Œäº†æ‰¹é‡æ“ä½œ,å†è°ˆè°ˆèšåˆæ“ä½œ.åœ¨ SQL è¯­æ³•ä¸­æœ‰ä¸€ç±»èšåˆå‡½æ•°,æ¯”å¦‚ &lt;code&gt;count()&lt;/code&gt;,&lt;code&gt;sum()&lt;/code&gt;,&lt;code&gt;max()&lt;/code&gt;,&lt;code&gt;min()&lt;/code&gt;,&lt;code&gt;avg()&lt;/code&gt; ç­‰,å®ƒä»¬ä¸€èˆ¬æ­é…ç€ &lt;code&gt;group by&lt;/code&gt; ç”šè‡³ &lt;code&gt;having&lt;/code&gt; æ¥ä½¿ç”¨.ç„¶è€Œåœ¨å·ç§°â€object graphâ€çš„ Core Data ä¸­,è¿™ç§èšåˆæ“ä½œåœ¨ &lt;code&gt;NSFetchRequest&lt;/code&gt; ä¸­ä¹Ÿæ˜¯æœ‰æ›¿ä»£å“çš„.ä¸‹é¢çš„ä¾‹å­å–è‡ª&lt;a href=&quot;http://www.cimgf.com/2015/06/25/core-data-and-aggregate-fetches-in-swift/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CORE DATA AND AGGREGATE FETCHES IN SWIFT&lt;/a&gt;: &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.cimgf.com/wp-content/uploads/2015/06/AcmeHatCoDataTable.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æƒ³è®¡ç®—å‡ºæ¯æ¡äº§å“çº¿çš„é”€å”®é‡å’Œé€€è´§é‡,å¯ä»¥ç”¨ä¸‹é¢çš„ SQL è¯­å¥æå®š:&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; ProductLine, &lt;span class=&quot;keyword&quot;&gt;SUM&lt;/span&gt;(Sold) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; SoldCount, &lt;span class=&quot;keyword&quot;&gt;SUM&lt;/span&gt;(Returned) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; ReturnedCount &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; Products &lt;span class=&quot;keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;BY&lt;/span&gt; ProductLine&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;NSFetchRequest&lt;/code&gt; æœ‰ä¸ª &lt;code&gt;propertiesToGroupBy&lt;/code&gt; å±æ€§,æ­£å¥½å¯¹åº”ç€ &lt;code&gt;group by&lt;/code&gt; è¯­å¥:&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Build out our fetch request the usual way&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; request = NSFetchRequest(entityName: &lt;span class=&quot;built_in&quot;&gt;self&lt;/span&gt;.entityName)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// This is the column we are grouping by. Notice this is the only non aggregate column.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request.propertiesToGroupBy = &lt;span class=&quot;meta&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;productLine&quot;&lt;/span&gt;&lt;span class=&quot;meta&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸‹é¢è¿˜éœ€è¦æ˜ å°„ SQL è¯­å¥ä¸­èšåˆå‡½æ•°åŠå…¶è®¡ç®—åçš„ç»“æœ,æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨åˆ° &lt;code&gt;NSExpressionDescription&lt;/code&gt; å’Œ &lt;code&gt;NSExpression&lt;/code&gt; æ¥æ›¿æ¢ SQL ä¸­çš„ &lt;code&gt;ProductLine, SUM(Sold) as SoldCount, SUM(Returned) as ReturnedCount&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Create&lt;/span&gt; an &lt;span class=&quot;built_in&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; AnyObject since it needs &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; contain multiple types&lt;span class=&quot;comment&quot;&gt;--strings and&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// NSExpressionDescriptions&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; expressionDescriptions = [AnyObject]()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// We want productLine &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; be one &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;columns&lt;/span&gt; returned, so just &lt;span class=&quot;keyword&quot;&gt;add&lt;/span&gt; it &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; a &lt;span class=&quot;keyword&quot;&gt;string&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescriptions.append(&lt;span class=&quot;string&quot;&gt;&quot;productLine&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Create&lt;/span&gt; an expression description &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; our SoldCount &lt;span class=&quot;keyword&quot;&gt;column&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; expressionDescription = NSExpressionDescription()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Name&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;column&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription.name = &lt;span class=&quot;string&quot;&gt;&quot;SoldCount&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Use&lt;/span&gt; an expression &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; specify what &lt;span class=&quot;keyword&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;action&lt;/span&gt; we want &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; take &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; which column. &lt;span class=&quot;keyword&quot;&gt;In&lt;/span&gt; this &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; the sold &lt;span class=&quot;keyword&quot;&gt;column&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription.expression = NSExpression(&lt;span class=&quot;keyword&quot;&gt;format&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;@sum.sold&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Specify the &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt; we expect&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription.expressionResultType = .Integer32AttributeType&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Append the description &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; our &lt;span class=&quot;built_in&quot;&gt;array&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescriptions.append(expressionDescription)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Create&lt;/span&gt; an expression description &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; our ReturnedCount &lt;span class=&quot;keyword&quot;&gt;column&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription = NSExpressionDescription()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Name&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;column&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription.name = &lt;span class=&quot;string&quot;&gt;&quot;ReturnedCount&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Use&lt;/span&gt; an expression &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; specify what &lt;span class=&quot;keyword&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;action&lt;/span&gt; we want &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; take &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; which column. &lt;span class=&quot;keyword&quot;&gt;In&lt;/span&gt; this &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; the returned &lt;span class=&quot;keyword&quot;&gt;column&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription.expression = NSExpression(&lt;span class=&quot;keyword&quot;&gt;format&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;@sum.returned&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Specify the &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt; we expect&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescription.expressionResultType = .Integer32AttributeType&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Append the description &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; our &lt;span class=&quot;built_in&quot;&gt;array&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expressionDescriptions.append(expressionDescription)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;NSExpressionDescription&lt;/code&gt; æ˜¯ç”¨äºè¡¨ç¤ºé‚£äº›æŠ“å–ç»“æœä¸­å®ä½“ä¸­ä¸å­˜åœ¨çš„åˆ—å,æ¯”å¦‚æˆ‘ä»¬è¿™æ¬¡ç”¨çš„èšåˆå‡½æ•°æ‰€è®¡ç®—çš„ç»“æœå¹¶ä¸èƒ½åœ¨å®ä½“ä¸­æ‰¾åˆ°å¯¹åº”çš„åˆ—,äºæ˜¯æˆ‘ä»¬å°±å¾—ç»™å®ƒèµ·ä¸ªæ–°åå­—,è¿™å°±ç›¸å½“äº SQL ä¸­çš„ &lt;code&gt;as&lt;/code&gt;,è¿™é‡Œå¯¹åº”ç€ &lt;code&gt;NSExpressionDescription&lt;/code&gt; çš„ &lt;code&gt;name&lt;/code&gt; å±æ€§.è€Œèšåˆå‡½æ•°è¡¨è¾¾å¼å°±éœ€è¦ç”¨ &lt;code&gt;NSExpression&lt;/code&gt; å¯¹è±¡æ¥è¡¨ç¤º,æ¯”å¦‚ &lt;code&gt;NSExpression(format: &amp;quot;@sum.returned&amp;quot;)&lt;/code&gt; å°±æ˜¯å¯¹â€returnedâ€è¿™åˆ—æ±‚å’Œ.&lt;/p&gt;
&lt;p&gt;åƒæœ¬ä¾‹ä¸­è¿™æ ·åˆå§‹åŒ– &lt;code&gt;NSExpression&lt;/code&gt; éœ€è¦å¯¹æ ¼å¼åŒ–è¯­æ³•è¾ƒä¸ºç†Ÿæ‚‰(æ¯”å¦‚&lt;code&gt;&amp;quot;@sum.returned&amp;quot;&lt;/code&gt;),åˆå­¦è€…å»ºè®®çœ‹çœ‹å®˜æ–¹çš„ä¾‹å­,ä½¿ç”¨å®¹æ˜“ç†è§£çš„æ„é€ æ–¹æ³•ä¸€æ­¥æ­¥æ‹¼å‡‘æˆæƒ³è¦çš„ç»“æœ:&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CoreData/Articles/cdFetching.html#//apple_ref/doc/uid/TP40002484-SW6&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Core Data Programming Guide&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å°†ä»¥ä¸Šè¿™ä¸‰ä¸ªâ€åˆ—æè¿°â€ä¾æ¬¡æ·»åŠ åˆ° &lt;code&gt;expressionDescriptions&lt;/code&gt; æ•°ç»„ä¸­,æœ€åè¦èµ‹å€¼ç»™ &lt;code&gt;NSFetchRequest&lt;/code&gt; çš„ &lt;code&gt;propertiesToFetch&lt;/code&gt; å±æ€§:&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Hand off our expression descriptions to the propertiesToFetch field. Expressed as strings&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// these are [&quot;productLine&quot;, &quot;SoldCount&quot;, &quot;ReturnedCount&quot;] where productLine is the value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// we are grouping by.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request&lt;span class=&quot;selector-class&quot;&gt;.propertiesToFetch&lt;/span&gt; = expressionDescriptions&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;propertiesToFetch&lt;/code&gt; å±æ€§å…¶å®æ˜¯ä¸ª &lt;code&gt;NSPropertyDescription&lt;/code&gt; ç±»å‹æ•°ç»„,èƒ½è¡¨ç¤ºå±æ€§,ä¸€å¯¹ä¸€å…³ç³»å’Œè¡¨è¾¾å¼.æ—¢ç„¶æ˜¯ä¸ªå¤§æ‚çƒ©,&lt;code&gt;NSPropertyDescription&lt;/code&gt; ä¹Ÿå°±æœ‰ä¸€äº›å­ç±»:&lt;code&gt;NSAttributeDescription&lt;/code&gt;,&lt;code&gt;NSExpressionDescription&lt;/code&gt;,&lt;code&gt;NSFetchedPropertyDescription&lt;/code&gt;,&lt;code&gt;NSRelationshipDescription&lt;/code&gt;.æˆ‘ä»¬è¿™é‡Œç”¨åˆ°çš„ä¾¿æ˜¯ &lt;code&gt;NSExpressionDescription&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;åœ¨è®¾å®š &lt;code&gt;propertiesToFetch&lt;/code&gt; å±æ€§&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;å¿…éœ€è¦è®¾å®šå¥½ &lt;code&gt;NSFetchRequest&lt;/code&gt; çš„ &lt;code&gt;entity&lt;/code&gt; å±æ€§,å¦åˆ™ä¼šæŠ›å‡º &lt;code&gt;NSInvalidArgumentException&lt;/code&gt; ç±»å‹çš„å¼‚å¸¸.å¹¶ä¸”åªæœ‰å½“ &lt;code&gt;resultType&lt;/code&gt; ç±»å‹è®¾ä¸º &lt;code&gt;NSDictionaryResultType&lt;/code&gt; æ—¶æ‰ç”Ÿæ•ˆ:&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Specify we want dictionaries to be returned&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request&lt;span class=&quot;selector-class&quot;&gt;.resultType&lt;/span&gt; = .DictionaryResultType&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ€ç»ˆç»“æœ:&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;string&quot;&gt;&quot;SoldCount&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;48&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;productLine&quot;&lt;/span&gt;: Bowler, &lt;span class=&quot;string&quot;&gt;&quot;ReturnedCount&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;], &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;string&quot;&gt;&quot;SoldCount&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;142&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;productLine&quot;&lt;/span&gt;: Stetson, &lt;span class=&quot;string&quot;&gt;&quot;ReturnedCount&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;], &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;string&quot;&gt;&quot;SoldCount&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;productLine&quot;&lt;/span&gt;: Top Hat, &lt;span class=&quot;string&quot;&gt;&quot;ReturnedCount&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;WWDC2015-Core-Data-çš„ä¸€äº›æ–°ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#WWDC2015-Core-Data-çš„ä¸€äº›æ–°ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;WWDC2015 Core Data çš„ä¸€äº›æ–°ç‰¹æ€§&quot;&gt;&lt;/a&gt;WWDC2015 Core Data çš„ä¸€äº›æ–°ç‰¹æ€§&lt;/h2&gt;&lt;p&gt;è‹¹æœå·ç§°æœ‰è¶…è¿‡40ä¸‡ä¸ª APP ä½¿ç”¨ Core Data,å¹¶èƒ½è®©å¼€å‘è€…å°‘å†™50%~70%çš„ä»£ç .å¹¶åœ¨å†…å­˜æ€§èƒ½ä¸Šå¼ºè°ƒå“è¶Šçš„å†…å­˜æ‹“å±•å’Œä¸»åŠ¨å¼æƒ°æ€§åŠ è½½,ç‚«è€€äº†å®ƒè·Ÿ UI è‰¯å¥½çš„ç»‘å®šæœºåˆ¶,è¿˜æä¾›äº†å‡ ç§å¤šé‡å†™å…¥çš„åˆå¹¶ç­–ç•¥.ç„¶è€Œè¿™ä¸èƒ½é˜»æ­¢å¼€å‘è€…å¯¹ Core Data çš„åæ§½,æ¯•ç«Ÿå»ºç«‹äºæŒä¹…å±‚ä¹‹ä¸Šçš„â€object graphâ€è¿˜åšä¸åˆ°åƒ SQL é‚£æ ·é¢é¢ä¿±åˆ°,äºæ˜¯ä»Šå¹´é’ˆå¯¹ Core Data æ–°å¢çš„ API æ›´åƒæ˜¯æŸ¥ç¼ºè¡¥æ¼,å¹¶æ²¡æœ‰å¸¦æ¥é‡å¤§åŠŸèƒ½æ›´æ–°.&lt;/p&gt;
&lt;h3 id=&quot;NSManagedObject-æ–°å¢-API&quot;&gt;&lt;a href=&quot;#NSManagedObject-æ–°å¢-API&quot; class=&quot;headerlink&quot; title=&quot;NSManagedObject æ–°å¢ API&quot;&gt;&lt;/a&gt;NSManagedObject æ–°å¢ API&lt;/h3&gt;&lt;h4 id=&quot;hasPersistentChangedValues&quot;&gt;&lt;a href=&quot;#hasPersistentChangedValues&quot; class=&quot;headerlink&quot; title=&quot;hasPersistentChangedValues&quot;&gt;&lt;/a&gt;hasPersistentChangedValues&lt;/h4&gt;&lt;figure class=&quot;highlight actionscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; hasPersistentChangedValues: Bool &amp;#123; &lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç”¨æ­¤å±æ€§å¯ç¡®å®š &lt;code&gt;NSManagedObject&lt;/code&gt; çš„å€¼ä¸ â€œpersistent storeâ€ æ˜¯å¦ç›¸åŒ.&lt;/p&gt;
&lt;h4 id=&quot;objectIDsForRelationshipNamed&quot;&gt;&lt;a href=&quot;#objectIDsForRelationshipNamed&quot; class=&quot;headerlink&quot; title=&quot;objectIDsForRelationshipNamed&quot;&gt;&lt;/a&gt;objectIDsForRelationshipNamed&lt;/h4&gt;&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;objectIDsForRelationshipNamed&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; key: String)&lt;/span&gt;&lt;/span&gt; -&amp;gt; [&lt;span class=&quot;type&quot;&gt;NSManagedObjectID&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€‚ç”¨äºå¤§é‡çš„å¤šå¯¹å¤šå…³ç³».ç”±äºæˆ‘ä»¬ä¸æƒ³å°†æ•´ä¸ªå…³ç³»ç½‘ç»œåŠ è½½åˆ°å†…å­˜ä¸­,æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä»…è¿”å›ç›¸å…³è”çš„ ID.ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:&lt;/p&gt;
&lt;figure class=&quot;highlight nix&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;relations&lt;/span&gt; = person.objectIDsForRelationshipNamed(&lt;span class=&quot;string&quot;&gt;&quot;family&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;fetchFamily&lt;/span&gt; = NSFetchRequest(entityName:&lt;span class=&quot;string&quot;&gt;&quot;Person&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fetchFamily.&lt;span class=&quot;attr&quot;&gt;fetchBatchSize&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fetchFamily.&lt;span class=&quot;attr&quot;&gt;predicate&lt;/span&gt; = NSPredicate(format: &lt;span class=&quot;string&quot;&gt;&quot;self IN %@&quot;&lt;/span&gt;, relations)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;batchedRelations&lt;/span&gt; = managedObjectContext.executeFetchRequest(fetchFamily)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for relative &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; batchedRelations &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	//work &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; relations &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt; rows at a time&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡ç»™å‡ºçš„å…³ç³»åç§° â€œfamilyâ€ æ¥è·å–å¯¹åº”çš„ ID, å¹¶æ¯æ¬¡éå†100è¡Œè®°å½•,å®ç°äº†å†…å­˜å ç”¨çš„å¯æ§æ€§.&lt;/p&gt;
&lt;h3 id=&quot;NSManagedObjectContext-æ–°å¢-API&quot;&gt;&lt;a href=&quot;#NSManagedObjectContext-æ–°å¢-API&quot; class=&quot;headerlink&quot; title=&quot;NSManagedObjectContext æ–°å¢ API&quot;&gt;&lt;/a&gt;NSManagedObjectContext æ–°å¢ API&lt;/h3&gt;&lt;h4 id=&quot;refreshAllObjects&quot;&gt;&lt;a href=&quot;#refreshAllObjects&quot; class=&quot;headerlink&quot; title=&quot;refreshAllObjects&quot;&gt;&lt;/a&gt;refreshAllObjects&lt;/h4&gt;&lt;figure class=&quot;highlight autoit&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;refreshAllObjects&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­£å¦‚å…¶åå­—æ‰€æè¿°çš„é‚£æ ·,å®ƒçš„åŠŸèƒ½å°±æ˜¯åˆ·æ–° context ä¸­æ‰€æœ‰å¯¹è±¡,ä½†ä¼šä¿ç•™æœªä¿å­˜çš„å˜æ›´.ç›¸æ¯”&lt;code&gt;reset&lt;/code&gt; æ–¹æ³•ä¸åŒçš„æ˜¯å®ƒä¼šä¾ç„¶ä¿ç•™ &lt;code&gt;NSManagedObject&lt;/code&gt; å¯¹è±¡çš„æœ‰æ•ˆæ€§,æˆ‘ä»¬æ— éœ€é‡æ–°æŠ“å–ä»»ä½•å¯¹è±¡.æ­£å› å¦‚æ­¤,å®ƒå¾ˆé€‚ç”¨äºæ‰“ç ´ä¸€äº›å› éå†åŒå‘å…³ç³»å¾ªç¯è€Œäº§ç”Ÿçš„ä¿ç•™ç¯.&lt;/p&gt;
&lt;h4 id=&quot;mergeChangesFromRemoteContextSave&quot;&gt;&lt;a href=&quot;#mergeChangesFromRemoteContextSave&quot; class=&quot;headerlink&quot; title=&quot;mergeChangesFromRemoteContextSave&quot;&gt;&lt;/a&gt;mergeChangesFromRemoteContextSave&lt;/h4&gt;&lt;figure class=&quot;highlight haskell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; func mergeChangesFromRemoteContextSave(&lt;span class=&quot;title&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;changeNotificationData&lt;/span&gt;: [&lt;span class=&quot;type&quot;&gt;NSObject&lt;/span&gt; : &lt;span class=&quot;type&quot;&gt;AnyObject&lt;/span&gt;], &lt;span class=&quot;title&quot;&gt;intoContexts&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;contexts&lt;/span&gt;: [&lt;span class=&quot;type&quot;&gt;NSManagedObjectContext&lt;/span&gt;])&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ store ä¸­ä½¿ç”¨å¤šä¸ª coordinator æ—¶,è¿™ä¸ªæ–¹æ³•å°†ä¼šä»ä¸€ä¸ª coordinator æ¥å—ä¸€ä¸ªé€šçŸ¥,å¹¶å°†å…¶åº”ç”¨åˆ°å¦ä¸€ä¸ª coordinator ä¸­çš„ context ä¸Š.è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰ context ä¸­å­˜æœ‰æœ€æ–°çš„æ•°æ®,Core Data ä¼šç»´æŠ¤å¥½æ‰€æœ‰çš„ context.&lt;/p&gt;
&lt;h4 id=&quot;shouldDeleteInaccessibleFaults&quot;&gt;&lt;a href=&quot;#shouldDeleteInaccessibleFaults&quot; class=&quot;headerlink&quot; title=&quot;shouldDeleteInaccessibleFaults&quot;&gt;&lt;/a&gt;shouldDeleteInaccessibleFaults&lt;/h4&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;var&lt;/span&gt; shouldDeleteInaccessibleFaults: Bool&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Core Data å¶å°”ä¼šæŠ›å¼‚å¸¸,ä½†Core Data ä¸èƒ½åŠ è½½æ•…éšœ, å› ä¸ºå®ƒçš„ä¸»åŠ¨å¼æƒ°æ€§åŠ è½½å¯¹è±¡ä½¿å¾—å†…å­˜ä¸­åªä¿ç•™å¯¹è±¡å›¾ä¸­çš„ä¸€éƒ¨åˆ†.æ‰€ä»¥å¾ˆæœ‰å¯èƒ½å½“æˆ‘éå†å…³ç³»æ—¶è¦è¯•å›¾å›åˆ°ç£ç›˜ä¸ŠæŸ¥æ‰¾,ä½†æ­¤æ—¶å¯¹è±¡æ—©å·²è¢«åˆ é™¤äº†.äºæ˜¯ &lt;code&gt;shouldDeleteInaccessibleFaults&lt;/code&gt; å±æ€§åº”è¿è€Œç”Ÿ,é»˜è®¤å€¼ä¸º &lt;code&gt;YES&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬åœ¨æŸå¤„é‡åˆ°äº†æ•…éšœ,æˆ‘ä»¬ä¼šå°†å…¶æ ‡è®°ä¸ºå·²åˆ é™¤.ä»»ä½•ä¸¢å¤±çš„å±æ€§å°†ä¼šè¢«è®¾ä¸º&lt;code&gt;null&lt;/code&gt;,&lt;code&gt;nil&lt;/code&gt;æˆ–&lt;code&gt;0&lt;/code&gt;.è¿™å°±ä½¿å¾—æˆ‘ä»¬çš„ app ç»§ç»­è¿è¡Œ,å¹¶è®¤ä¸ºå‘ç”Ÿæ•…éšœçš„å¯¹è±¡å·²è¢«åˆ é™¤.è¿™æ ·ç¨‹åºå°±ä¸ä¼šå†å´©æºƒ.&lt;/p&gt;
&lt;h3 id=&quot;NSPersistentStoreCoordinator-æ–°å¢-API&quot;&gt;&lt;a href=&quot;#NSPersistentStoreCoordinator-æ–°å¢-API&quot; class=&quot;headerlink&quot; title=&quot;NSPersistentStoreCoordinator æ–°å¢ API&quot;&gt;&lt;/a&gt;NSPersistentStoreCoordinator æ–°å¢ API&lt;/h3&gt;&lt;p&gt;å¢åŠ è¿™ä¸¤ä¸ªæ–°çš„ API çš„åŸå› æ˜¯å¾ˆå¤šå¼€å‘è€…ç»•è¿‡ Core Data çš„ API æ¥ç›´æ¥æ“ä½œåº•å±‚æ•°æ®åº“æ–‡ä»¶.å› ä¸º&lt;code&gt;NSFileManager&lt;/code&gt; å’Œ POSIX å¯¹æ•°æ®åº“éƒ½ä¸å‹å¥½,å¹¶ä¸”å¦‚æœæ­¤æ—¶æ–‡ä»¶çš„ open è¿æ¥æ²¡å…³é—­çš„è¯ä¼šæŸåæ–‡ä»¶.  &lt;/p&gt;
&lt;h4 id=&quot;destroyPersistentStoreAtURL&quot;&gt;&lt;a href=&quot;#destroyPersistentStoreAtURL&quot; class=&quot;headerlink&quot; title=&quot;destroyPersistentStoreAtURL&quot;&gt;&lt;/a&gt;destroyPersistentStoreAtURL&lt;/h4&gt;&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;destroyPersistentStoreAtURL&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; url: NSURL, withType storeType: String, options options: [NSObject : AnyObject]?)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¼ å…¥çš„é€‰é¡¹ä¸ &lt;code&gt;addPersistentStoreWithType&lt;/code&gt; æ–¹æ³•è¦ä¸€æ ·,åˆ é™¤å¯¹åº”ç±»å‹çš„ persistent store.&lt;/p&gt;
&lt;h4 id=&quot;replacePersistentStoreAtURL&quot;&gt;&lt;a href=&quot;#replacePersistentStoreAtURL&quot; class=&quot;headerlink&quot; title=&quot;replacePersistentStoreAtURL&quot;&gt;&lt;/a&gt;replacePersistentStoreAtURL&lt;/h4&gt;&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;replacePersistentStoreAtURL&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; destinationURL: NSURL, destinationOptions destinationOptions: [NSObject : AnyObject]?, withPersistentStoreFromURL sourceURL: NSURL, sourceOptions sourceOptions: [NSObject : AnyObject]?, storeType storeType: String)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸ä¸Šé¢çš„ destroy ä¸€ä¸ªå¥—è·¯,å°±æ˜¯ replace è€Œå·².å¦‚æœç›®æ ‡ä½ç½®ä¸å­˜åœ¨æ•°æ®åº“,é‚£ä¹ˆè¿™ä¸ª replace å°±ç›¸å½“äºæ‹·è´æ“ä½œäº†.&lt;/p&gt;
&lt;h3 id=&quot;Unique-Constraints&quot;&gt;&lt;a href=&quot;#Unique-Constraints&quot; class=&quot;headerlink&quot; title=&quot;Unique Constraints&quot;&gt;&lt;/a&gt;Unique Constraints&lt;/h3&gt;&lt;p&gt;å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¹‹å‰ä¼šæŸ¥çœ‹å®ƒæ˜¯å¦å·²ç»å­˜åœ¨,å¦‚æœå­˜åœ¨çš„è¯å°±ä¼šæ›´æ–°å®ƒ,å¦åˆ™å°±åˆ›å»ºå¯¹è±¡.è¿™å¾ˆå¯èƒ½äº§ç”Ÿä¸€ä¸ªç«æ€æ¡ä»¶,å¦‚æœå¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç , å¾ˆå¯èƒ½å°±åˆ›å»ºäº†å¤šä¸ªé‡å¤çš„å¯¹è±¡:&lt;/p&gt;
&lt;figure class=&quot;highlight nix&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;managedObjectContext.performBlock &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;createRequest&lt;/span&gt; = NSFetchRequest(entityName: &lt;span class=&quot;string&quot;&gt;&quot;Recipe&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	createRequest.&lt;span class=&quot;attr&quot;&gt;resultType&lt;/span&gt; = ManagedObjectIDResultType&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;predicate&lt;/span&gt; = NSPredicate(format: &lt;span class=&quot;string&quot;&gt;&quot;source = %@&quot;&lt;/span&gt;, source)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;results&lt;/span&gt; = managedObjectContext.executeFetchRequest(createRequest)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (results.count) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		//update it!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		//create it!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç°åœ¨ Core Data å¯ä»¥æå®šè¿™ä¸ªäº‹æƒ…äº†.æˆ‘ä»¬è®¾å®šå±æ€§çš„å€¼å”¯ä¸€,ç±»ä¼¼äº SQL ä¸­çš„ &lt;code&gt;unique&lt;/code&gt; çº¦æŸ.è¯¸å¦‚ç”µå­é‚®ä»¶,ç”µè¯å·, ISBN ç­‰åœºæ™¯éƒ½é€‚ç”¨æ­¤.åŒæ—¶åˆ«å¿˜äº† Core Data çš„å¯¹è±¡å›¾ä¸­å®ä½“çš„ç»§æ‰¿å…³ç³»,è¿™é‡Œè§„å®šå­ç±»ä¼šä»çˆ¶ç±»ç»§æ‰¿åˆ°å…·æœ‰ Unique çº¦æŸçš„å±æ€§,å¹¶å¯ä»¥å°†æ›´å¤šçš„å±æ€§è®¾ä¸º Unique.&lt;/p&gt;
&lt;p&gt;ä¸ºå®ä½“è®¾ç½® Unique å±æ€§ååˆ†ç®€å•,åªéœ€è¦åœ¨ Xcode ä¸­é€‰ä¸­å¯¹åº”çš„å®ä½“,æ‰“å¼€ â€œData Model inspectorâ€ å°±å¯ä»¥çœ‹åˆ° â€œConstraintsâ€, ç‚¹å‡»åŠ å·æ·»åŠ å°±å¥½:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150726-1@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Model-Caching&quot;&gt;&lt;a href=&quot;#Model-Caching&quot; class=&quot;headerlink&quot; title=&quot;Model Caching&quot;&gt;&lt;/a&gt;Model Caching&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ä¸ªè½»é‡çº§çš„æ•°æ®ç‰ˆæœ¬è‡ªåŠ¨è¿ç§»è§£å†³æ–¹æ¡ˆ.å®ƒä¼šç¼“å­˜æ—§ç‰ˆæœ¬æ•°æ®ä¸­å·²åˆ›å»ºçš„ &lt;code&gt;NSManagedObject&lt;/code&gt; å¯¹è±¡ä¼šè¢«ç¼“å­˜åˆ° store ä¸­,å¹¶è¢«è¿ç§»åˆ°åˆé€‚çš„ store ä¸­.&lt;/p&gt;
&lt;h3 id=&quot;Generated-Subclasses&quot;&gt;&lt;a href=&quot;#Generated-Subclasses&quot; class=&quot;headerlink&quot; title=&quot;Generated Subclasses&quot;&gt;&lt;/a&gt;Generated Subclasses&lt;/h3&gt;&lt;p&gt;åœ¨ Xcode7 ä¸­,è‡ªåŠ¨åˆ›å»º &lt;code&gt;NSManagedObject&lt;/code&gt; å­ç±»æ—¶å°†ä¸å†åœ¨å¯¹åº”å®ä½“å­ç±»æ–‡ä»¶ä¸­è‡ªåŠ¨å¡«å……æ¨¡æ¿ä»£ç ,è€Œæ˜¯åŒæ—¶åˆ›å»ºCategory(Objective-Cæ–‡ä»¶) æˆ– extension(Swiftæ–‡ä»¶),å¹¶å°†æ¨¡æ¿ä»£ç è‡ªåŠ¨å¡«å†™è¿›å».è¿™æ ·å¸¦æ¥çš„å¥½å¤„æ˜¯å°†æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç è·Ÿ Xcode ç”Ÿæˆçš„æ¨¡æ¿ä»£ç åˆ†å¼€,æ›´æ˜“äºæ›´æ–°ç»´æŠ¤.&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™å…¶å®æ˜¯ä¸€ç¯‡ WWDC 2015 Session 220 çš„å­¦ä¹ ç¬”è®°,é¡ºä¾¿æ•´ç†äº†ä¸‹ Core Data æ‰¹é‡æ“ä½œå’Œèšåˆæ“ä½œçš„å°æŠ€å·§.&lt;/p&gt;
    
    </summary>
    
    
      <category term="Core Data" scheme="http://yulingtianxia.com/tags/Core-Data/"/>
    
  </entry>
  
  <entry>
    <title>SpriteKitåœ¨iOS9å’ŒOSX10.11ä¸­çš„æ–°ç‰¹æ€§</title>
    <link href="http://yulingtianxia.com/blog/2015/06/12/SpriteKit%E5%9C%A8iOS9%E5%92%8COSX10-11%E4%B8%AD%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <id>http://yulingtianxia.com/blog/2015/06/12/SpriteKitåœ¨iOS9å’ŒOSX10-11ä¸­çš„æ–°ç‰¹æ€§/</id>
    <published>2015-06-12T08:21:30.000Z</published>
    <updated>2016-05-11T14:32:38.000Z</updated>
    
    <content type="html">&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡ WWDC2015 Session 604 çš„å­¦ä¹ ç¬”è®°,åœ¨çœ‹ WWDC2014 çš„ Session æ—¶ä¹Ÿæ€»ç»“è¿‡ä¸€ç¯‡&lt;a href=&quot;http://yulingtianxia.com/blog/2014/08/08/spritekitzai-ios8he-osx10-dot-10zhong-de-xin-te-xing/&quot;&gt;SpriteKitåœ¨iOS8å’ŒOSX10.10ä¸­çš„æ–°ç‰¹æ€§&lt;/a&gt;,ä» iOS7 å‘å¸ƒ SpriteKit ä»¥æ¥æˆ‘ä¸€ç›´åˆ©ç”¨è¯¾ä½™æ—¶é—´åšäº›å°æ¸¸æˆ,æ„Ÿå—ç€ SpriteKit çš„ä¸€è·¯æˆé•¿.è¿™æ¬¡ä¹Ÿåœ¨ç¬¬ä¸€æ—¶é—´æ€»ç»“äº†ä¸‹ ä»Šå¹´ WWDC SpriteKit çš„æ–°ç‰¹æ€§.&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Viewport-å’Œ-SKCameraNode&quot;&gt;&lt;a href=&quot;#Viewport-å’Œ-SKCameraNode&quot; class=&quot;headerlink&quot; title=&quot;Viewport å’Œ SKCameraNode&quot;&gt;&lt;/a&gt;Viewport å’Œ SKCameraNode&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-1@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;viewport&quot;&gt;  &lt;/p&gt;
&lt;p&gt;Viewport(è§†å£) æŒ‡çš„æ˜¯å½“å‰åœºæ™¯ä¸­å“ªäº›éƒ¨åˆ†æ˜¯å¯è§çš„.ä¹Ÿå°±æ˜¯è¯´åœºæ™¯å¾ˆå¤§æ—¶,æˆ‘ä»¬è¦è®¡ç®—å“ªå—åŒºåŸŸæ˜¯è¦å‘ˆç°ç»™ç©å®¶çš„,è¿™å—åŒºåŸŸæ˜¯å¯ä»¥ç§»åŠ¨çš„.å°±åƒæ˜¯æ‘„åƒå¤´è·Ÿç€ç©å®¶åœ¨ä¸€å¼ å¤§åœ°å›¾ä¸­è·‘ä¸€æ ·,è¿™äº›å·¥ä½œç°åœ¨å¯ä»¥äº¤ç»™ SpriteKit äº†, &lt;code&gt;SKCameraNode&lt;/code&gt; å°±æ˜¯å¹²è¿™ä¸ªçš„.æœ‰äº†å®ƒå°±èƒ½ç¡®å®šå“ªäº›éƒ¨åˆ†æ˜¯å¯è§çš„.å®ƒç›¸å½“äºviewportçš„ä¸­å¿ƒ,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç§»åŠ¨åœºæ™¯çš„æ‘„åƒå¤´,è€Œä¸ç”¨åƒä»¥å‰é‚£æ ·ç§»åŠ¨æ•´ä¸ªåœºæ™¯. SpriteKit ç»ˆäºä¹Ÿèƒ½åƒå…¶ä»–æ¸¸æˆæ¡†æ¶ä¸€æ ·ç§»åŠ¨æ‘„åƒå¤´å•¦!&lt;code&gt;SKScene&lt;/code&gt; ä¸­æœ‰ä¸ª &lt;code&gt;camera&lt;/code&gt; å±æ€§,ç±»å‹å°±æ˜¯ &lt;code&gt;SKCameraNode&lt;/code&gt;.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™åœºæ™¯ä»»æ„ä¸€ä¸ªé€‰æ‹©åˆé€‚çš„æ‘„åƒå¤´.æ›´ä»¤äººæ¬£å–œçš„æ˜¯ &lt;code&gt;SKCameraNode&lt;/code&gt; ä¹Ÿæ˜¯ä¸ª &lt;code&gt;SKNode&lt;/code&gt;,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™æ‘„åƒå¤´åŠ ä¸ŠåŠ¨ä½œ,çº¦æŸ,æ—‹è½¬å’Œç¼©æ”¾.(è¿™é‡Œè‡ªè¡Œè„‘è¡¥é•¿é•œå¤´,è§†è§’è·Ÿè¸ª,å¤©æ—‹åœ°è½¬,é¼ æ ‡æ»šè½®)  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-2@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;SKCameraNode&quot;&gt;  &lt;/p&gt;
&lt;p&gt;å…¶å®ç°åŸç†å¤§è‡´æ˜¯å°†&lt;code&gt;SKCameraNode&lt;/code&gt;çš„ &lt;code&gt;xScale&lt;/code&gt;, &lt;code&gt;yScale&lt;/code&gt;, å’Œ &lt;code&gt;zRotation&lt;/code&gt; å¯¹åœºæ™¯æ‰€æœ‰èŠ‚ç‚¹åšé€†è¿ç®—.å¹¶ä¸”åªæ¸²æŸ“ viewport çš„é‚£éƒ¨åˆ†åœºæ™¯.  &lt;/p&gt;
&lt;p&gt;å…¶å®æ‘„åƒå¤´æ—©å°±è¯¥åŠ äº†,è¿™æ˜¯ä¸“ä¸šçš„æ¸¸æˆæ¡†æ¶ä¸å¯æˆ–ç¼ºçš„å…ƒç´ .  &lt;/p&gt;
&lt;h2 id=&quot;SKAudioNode&quot;&gt;&lt;a href=&quot;#SKAudioNode&quot; class=&quot;headerlink&quot; title=&quot;SKAudioNode&quot;&gt;&lt;/a&gt;SKAudioNode&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-3@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;SKAudioNode&quot;&gt;  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;SKAudioNode&lt;/code&gt; çš„åŠ å…¥æ›´æ˜¯ä»¤äººæ¿€åŠ¨.æˆ‘ä»¬å¯ä»¥åœ¨æ¸¸æˆåœºæ™¯ä¸­çš„æŸä¸ªä½ç½®åŠ å…¥å£°æº,è®©ç©å®¶èº«ä¸´å…¶å¢ƒ.æ­¤å‰æ— è®ºä½ çš„éŸ³æ•ˆå†æ€ä¹ˆç‹‚æ‹½å±Œç‚¸å¤©,éƒ½åªèƒ½æ˜¯èƒŒæ™¯éŸ³ä¹çš„æ•ˆæœ.è¿™æ¬¡ç»ˆäºèƒ½å‘æŒ¥ä¸‹æˆ‘ä»¬çš„åŒè€³æ•ˆåº”äº†.æƒ³è±¡ä¸‹åœ¨æ¸¸æˆä¸­ä¸€è¾† F1 èµ›è½¦ä»ä½ èº«è¾¹é£šè¿‡çš„å£°éŸ³.ç„¶è€Œè¿™æœ¬èº«å°±æ˜¯æ¸¸æˆæ¡†æ¶çš„æ ‡é…, SpriteKit è¿™æ¬¡åªæ˜¯åŠªåŠ›è¿½èµ¶è€Œå·².  &lt;/p&gt;
&lt;h2 id=&quot;å¼•ç”¨ä¸å®ä¾‹åŒ–&quot;&gt;&lt;a href=&quot;#å¼•ç”¨ä¸å®ä¾‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;å¼•ç”¨ä¸å®ä¾‹åŒ–&quot;&gt;&lt;/a&gt;å¼•ç”¨ä¸å®ä¾‹åŒ–&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-6@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;å¼•ç”¨ä¸å®ä¾‹åŒ–&quot;&gt;  &lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯å°†åŠ¨ä½œå’ŒèŠ‚ç‚¹å°è£…æˆå®ä¾‹,è¿™æ ·å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨å®ƒä»¬,ä»¥è¾¾åˆ°ç»„ä»¶é‡ç”¨çš„æ•ˆæœ.  &lt;/p&gt;
&lt;h3 id=&quot;SKReferenceNode&quot;&gt;&lt;a href=&quot;#SKReferenceNode&quot; class=&quot;headerlink&quot; title=&quot;SKReferenceNode&quot;&gt;&lt;/a&gt;SKReferenceNode&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-4@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;SKReferenceNode&quot;&gt;  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;SKReferenceNode&lt;/code&gt; ä½¿æˆ‘ä»¬èƒ½é‡å¤åˆ©ç”¨&lt;code&gt;SKNode&lt;/code&gt;.åœ¨ Xcode7 åœºæ™¯ç¼–è¾‘å™¨ä¸­ç›´æ¥å°†æƒ³è¦é‡ç”¨çš„ sksæ–‡ä»¶æ‹–æ‹½åˆ°åœºæ™¯ä¸­, Xcode7 ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»º &lt;code&gt;SKReferenceNode&lt;/code&gt;.æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ URL æˆ–æ–‡ä»¶åæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª &lt;code&gt;SKReferenceNode&lt;/code&gt; å¯¹è±¡.å› ä¸ºè¿™é‡Œæ˜¯å¼•ç”¨, Xcode7 ä¼šä» Bundle ä¸­åŠ è½½æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶.  &lt;/p&gt;
&lt;p&gt;è€Œåœ¨ Xcode6 çš„åœºæ™¯ç¼–è¾‘å™¨ä¸­, sks æ–‡ä»¶ä¼šæŠŠå®ƒä½¿ç”¨çš„ç´ æéƒ½æ‹·è´ä¸€ä»½,å½“æˆ‘æƒ³æ›´æ”¹Images.xcassetsä¸­ç´ æçš„åå­—æˆ–å†…å®¹çš„æ—¶å€™, sks æ–‡ä»¶ä¸­çš„ç´ æå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–.ä¸€å¼€å§‹æˆ‘å¾ˆæƒ³æŠ“ç‹‚,ç›´è¾¾åæ¥æˆ‘æ‰¾åˆ°äº†ä¿®å¤çš„æ–¹æ³•:åœ¨ Finder ä¸­æ‰¾åˆ° sks æ–‡ä»¶,å°†å…¶æ‹–æ‹½åˆ°å·¥ç¨‹å¤–é¢çš„ç›®å½•å¹¶æ‰“å¼€,è¿™é‡Œæœ€å¥½å¤šæ‰“å¼€å…³é—­å‡ æ¬¡,ç„¶åå†å°†å…¶æ‹–æ‹½å›åŸæ¥åœ¨é¡¹ç›®å·¥ç¨‹ä¸­çš„ä½ç½®,ç„¶åå›åˆ° Xcode6 ä¸­æŸ¥çœ‹æ˜¯å¦æˆåŠŸ.å¦‚æœè¿™æ ·è¿˜ä¸è¡Œ,å°±åœ¨Xcode6 ä¸­åˆ æ‰ sks æ–‡ä»¶å¹¶é‡æ–°å¯¼å…¥è¯•è¯•.    &lt;/p&gt;
&lt;p&gt;ä¸å¾—ä¸åæ§½ä¸‹ä¹‹å‰çš„åœºæ™¯ç¼–è¾‘å™¨,ç«Ÿç„¶ä¸èƒ½é‡å¤ä½¿ç”¨ä¸€äº›ç»„ä»¶,ç”šè‡³ä¸èƒ½å¼•ç”¨æˆ‘åšçš„ç²’å­æ•ˆæœ sks æ–‡ä»¶åˆ°åœºæ™¯ä¸­.ä½†è¿™æœ¬æ¥åº”è¯¥æ˜¯ä¸€ä¸ªæ¸¸æˆåœºæ™¯ç¼–è¾‘å™¨æœ¬è¯¥æœ‰çš„åŠŸèƒ½å•Š!  &lt;/p&gt;
&lt;h3 id=&quot;Named-SKActions&quot;&gt;&lt;a href=&quot;#Named-SKActions&quot; class=&quot;headerlink&quot; title=&quot;Named SKActions&quot;&gt;&lt;/a&gt;Named SKActions&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-5@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;Named SKActions&quot;&gt;  &lt;/p&gt;
&lt;p&gt;å—¯åŠ¨ä½œ(Action)ä¹Ÿèƒ½ä»¥æ–‡ä»¶çš„æ–¹å¼å…±äº«äº†.æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªsks æ–‡ä»¶ç”¨äºä¿å­˜è‡ªå®šä¹‰åŠ¨ä½œ. Xcode7 ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›åŸºæœ¬åŠ¨ä½œå¯¹è±¡,å¯ä»¥æ‹–æ‹½åˆ°ç¼–è¾‘å™¨ä¸­:  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-7@2x.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™äº› &lt;code&gt;SKAction&lt;/code&gt; æ–°åŠ å…¥çš„ API æ¥ä» sks æ–‡ä»¶ä¸­åŠ è½½è‡ªå®šä¹‰åŠ¨ä½œ:  &lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;actionNamed:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;actionNamed:&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;duration:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;actionNamed:&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;fromURL:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;actionNamed:&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;fromURL:&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;duration:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤å¤–,è¿™å› &lt;code&gt;SKAction&lt;/code&gt; è¿˜å¢æ·»äº†ä¸€äº›æ–°åŠ¨ä½œ:  &lt;/p&gt;
&lt;figure class=&quot;highlight autohotkey&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;play //ç”¨äº `SKAudioNode` çš„æ’­æ”¾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pause //ç”¨äº `SKAudioNode` çš„æš‚åœ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;changePlaybackRateTo:duration:&lt;/span&gt; //è°ƒèŠ‚ `SKAudioNode` çš„æ’­æ”¾é€Ÿç‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;changeVolumeTo:duration:&lt;/span&gt; //è°ƒèŠ‚ `SKAudioNode` çš„æ’­æ”¾éŸ³é‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;animateWithNormalTextures:&lt;/span&gt; //ä½¿ `SKSpriteNode` çš„æ³•çº¿è´´å›¾æŒ‰ç…§ç»™å®šè´´å›¾æ•°ç»„çš„é¡ºåºåŠ¨èµ·æ¥&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„åŠ¨ä½œä¸­åªæä¾›äº†è´´å›¾åˆ‡æ¢çš„åŠ¨ä½œ,è€Œæ²¡æœ‰æ³•çº¿è´´å›¾åˆ‡æ¢çš„åŠ¨ä½œ,è¿™å°±è®©å…‰ç…§æ•ˆæœåªèƒ½åº”ç”¨åœ¨è´´å›¾å›ºå®šçš„&lt;code&gt;SKSpriteNode&lt;/code&gt;ä¸­.è¿™å›æˆ‘ä»¬å¯ä»¥è®©æ³•çº¿è´´å›¾å’Œè·Ÿç€åŠ¨èµ·æ¥äº†!    &lt;/p&gt;
&lt;h2 id=&quot;ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#ä¼˜åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä¼˜åŒ–&quot;&gt;&lt;/a&gt;ä¼˜åŒ–&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-8@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;Metal&quot;&gt;  &lt;/p&gt;
&lt;p&gt;è‹¹æœæ€»ä¸ä¼šå¿˜è®°å¤¸èµè‡ªå·±åœ¨åº•å±‚ä¼˜åŒ–æ‰€ä½œå‡ºçš„åŠªåŠ›. SpriteKit ä¼šè‡ªåŠ¨ä½¿ç”¨ Metal æŠ€æœ¯,å°†å…¶ CPU ä½¿ç”¨ç‡é™ä½,æ€§èƒ½æ›´èµä¹‹ç±»çš„. æœ€å…³é”®çš„æ˜¯è¿™äº›äº‹è‹¹æœå·²ç»å¸®ä½ åšå¥½äº†,ç¨‹åºå‘˜ä»¬å¾®ç¬‘æ¥å—.å› ä¸ºè¿™ç§ä¼˜åŒ–ä¸éœ€è¦æˆ‘ä»¬é‡æ–°ç¼–è¯‘é¡¹ç›®,å°±èƒ½åœ¨æ”¯æŒ Metal çš„è®¾å¤‡ä¸Šè‡ªåŠ¨ä½¿ç”¨å®ƒ.  &lt;/p&gt;
&lt;p&gt;å—ç›Šäº Swift ç±»å‹å®‰å…¨çš„æå‡, Objective-C æ³›å‹çš„åŠ å…¥,è¿˜æœ‰å¯¹ nullability çš„æ”¹è¿›, SpriteKit çš„ API ä¹Ÿè·Ÿç€åšå‡ºäº†ä¸€ç³»åˆ—ä¼˜åŒ–è°ƒæ•´.æ— è®ºæ˜¯ä½¿ç”¨ Swift è¿˜æ˜¯ Objective-C, æˆ‘ä»¬éƒ½èƒ½ç©è½¬ SpriteKit.  &lt;/p&gt;
&lt;h2 id=&quot;SceneKit&quot;&gt;&lt;a href=&quot;#SceneKit&quot; class=&quot;headerlink&quot; title=&quot;SceneKit&quot;&gt;&lt;/a&gt;SceneKit&lt;/h2&gt;&lt;p&gt;SpriteKit å’Œ SceneKit è¿™å¯¹å„¿éš¾å…„éš¾å¼Ÿè™½ç„¶ä¸€ç›´ä¸å—æ¸¸æˆå¼€å‘è€…çš„å® çˆ±,ä½†å®ƒä»¬æ€»æ˜¯å–œæ¬¢ç›¸äº’æåŸº.å¯ä»¥åœ¨ SceneKit ä¸­æ¸²æŸ“ SpriteKit çš„å†…å®¹,åä¹‹äº¦ç„¶.ä»Šå¹´æåŸºçš„æ–¹å¼åˆå¤šäº†:  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ä»¥åœ¨ SceneKit ä¸­ä½¿ç”¨ &lt;code&gt;SKTransition&lt;/code&gt; è¿›è¡Œè½¬åœº,å„ç§è½¬åœºæ•ˆæœéšä½ æŒ‘.&lt;/li&gt;
&lt;li&gt;SceneKit ä¹Ÿæ”¯æŒ Metal äº†,å¯ä»¥ä¸€èµ·èººåœ¨ Metal ä¸Šé¢æåŸºäº†.&lt;/li&gt;
&lt;li&gt;è¦ä¹ˆéƒ½åœ¨ Metal ä¸ŠæåŸº,è¦ä¹ˆéƒ½åœ¨ OpenGL ä¸Šå¼€æ,è‡ªåŠ¨åŒ¹é…ç›¸åŒçš„â€å¤§åºŠâ€.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;GameplayKit&quot;&gt;&lt;a href=&quot;#GameplayKit&quot; class=&quot;headerlink&quot; title=&quot;GameplayKit&quot;&gt;&lt;/a&gt;GameplayKit&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-9@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;GameplayKit&quot;&gt;  &lt;/p&gt;
&lt;p&gt;GameplayKit æ˜¯ä¸ªæ–°æ¨å‡ºçš„æ¡†æ¶,å®ƒèƒ½å¸®æˆ‘ä»¬æ„å»ºä¸€äº›æ¸¸æˆä¸­çš„é€»è¾‘,æ¯”å¦‚çŠ¶æ€æœº, AI å’Œè·¯å¾„æŸ¥æ‰¾.æˆ‘æœ¬å·²ç»è¿«ä¸åŠå¾…åœ°æƒ³ä½¿ç”¨å®ƒäº†,å¯æƒœåœ¨ iOS9 beta ä¸­æˆ‘ç”¨ SpriteKit å†™çš„æ¸¸æˆå¡é¡¿ä¸¥é‡,æˆ‘æƒ³è¿˜æ˜¯å†ç­‰ç­‰å§.&lt;/p&gt;
&lt;h2 id=&quot;SpriteKitå·¥å…·&quot;&gt;&lt;a href=&quot;#SpriteKitå·¥å…·&quot; class=&quot;headerlink&quot; title=&quot;SpriteKitå·¥å…·&quot;&gt;&lt;/a&gt;SpriteKitå·¥å…·&lt;/h2&gt;&lt;h3 id=&quot;Texture-atlas&quot;&gt;&lt;a href=&quot;#Texture-atlas&quot; class=&quot;headerlink&quot; title=&quot;Texture atlas&quot;&gt;&lt;/a&gt;Texture atlas&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ æœ‰æ¸¸æˆç¼–ç¨‹çš„ç»éªŒï¼Œé‚£ä¹ˆä½ ä¸€å®šå¯¹å›¾ç‰‡æ‹¼åˆçš„æ¦‚å¿µå¾ˆç†Ÿæ‚‰ï¼Œå›¾ç‰‡èƒ½å¤Ÿåœ¨å±å¹•ä¸Šç‹¬ç«‹åœ°å˜æ›´ä½ç½®ã€‚å›¾ç‰‡æ‹¼åˆåå¯ä»¥æ‰“åŒ…æ•´åˆåˆ°ä¸€å¼ å¤§å›¾ä¸Šä¸€æ¬¡æ€§è½½å…¥ã€‚ç›¸æ¯”å¤šæ¬¡è½½å…¥ä¸åŒçš„å›¾ç‰‡ï¼Œè¿™æ ·åšèƒ½å¤Ÿå¸¦æ¥å¾ˆå¤šæ–¹é¢çš„å¥½å¤„ï¼šå†…å­˜ä½¿ç”¨ï¼Œè½½å…¥æ—¶é—´ï¼Œæ¸²æŸ“æ€§èƒ½ç­‰ç­‰.&lt;/p&gt;
&lt;p&gt;2Dæ¸¸æˆå¼•æ“å¦‚Cocos2Dä½¿ç”¨äº†æ‹¼åˆæŠ€æœ¯ï¼Œå®ƒä½¿ç”¨OpenGLæ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚  &lt;/p&gt;
&lt;p&gt;ä½†æœ‰äº† Xcode ,æˆ‘ä»¬å°†å¤šä¸ªå›¾ç‰‡åŠ å…¥å›¾å†Œä¸­å°±å¯ä»¥äº†,æ— éœ€è‡ªå·±æ‰‹åŠ¨åˆ›å»ºä¸€å¼ å¤§çš„è´´å›¾,å¹¶è®¡ç®—å…¶ä¸­æ¯éƒ¨åˆ†çš„è¾¹ç•Œ.è¿™çš„ç¡®å¾ˆçœäº‹,è¿˜è®°å¾—æ¸¸æˆè®¾è®¡æ¦‚è®ºè¯¾çš„å®éªŒä¸Š,æˆ‘ä»¬çš„æ¸¸æˆç´ æéƒ½éœ€è¦æ‰‹åŠ¨å°†äººç‰©çš„å¥½å‡ éƒ¨åˆ†æ‹¼åˆåˆ°ä¸€å¼ å¤§å›¾ä¸Š,å½“äººç‰©å¥”è·‘æ—¶å°±åœ¨å¤§å›¾ä¸Šåˆ‡æ¢edgeå¹¶è¯»å–. åšè¿‡æ¸¸æˆçš„äººéƒ½ä½“ä¼šè¿‡è¿™ä¸€ç‚¹,ç°åœ¨ Xcode å¸®æˆ‘ä»¬åšäº†.è¿™é¡¹åŠŸèƒ½ä¹‹å‰å°±æœ‰äº†,ä»Šå¹´æ‹¿å‡ºæ¥å¿½æ‚ ä¸€éåªæ˜¯å› ä¸ºä»–ä»¬åšå¾—æ›´å¥½äº†.  &lt;/p&gt;
&lt;h3 id=&quot;Texture-atlas-in-Asset-Catalog&quot;&gt;&lt;a href=&quot;#Texture-atlas-in-Asset-Catalog&quot; class=&quot;headerlink&quot; title=&quot;Texture atlas in Asset Catalog&quot;&gt;&lt;/a&gt;Texture atlas in Asset Catalog&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-10@2x.png&quot; alt=&quot;Texture atlas in Asset Catalog&quot;&gt;  &lt;/p&gt;
&lt;p&gt;å¥½å¤„éƒ½æœ‰å•¥:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ç›´æ¥åœ¨ç•Œé¢ä¸Šæ“ä½œæ¥åŒºåˆ†ä¸åŒè®¾å¤‡ä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡.&lt;/li&gt;
&lt;li&gt;é€šè¿‡ App thinning æ¥ä½¿æ¸¸æˆä½“ç§¯æ›´å°.å› ä¸ºç”¨æˆ·ä» AppStore ä¸‹è½½æ¸¸æˆæ—¶,åªä¼šä¸‹è½½ä»–ä»¬è®¾å¤‡æ‰€å¯¹åº”çš„å›¾ç‰‡.èŠ‚çœæ—¶é—´å’Œç©ºé—´.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;Texture-atlas-with-On-Demand-Resources&quot;&gt;&lt;a href=&quot;#Texture-atlas-with-On-Demand-Resources&quot; class=&quot;headerlink&quot; title=&quot;Texture atlas with On Demand Resources&quot;&gt;&lt;/a&gt;Texture atlas with On Demand Resources&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-11@2x.png&quot; alt=&quot;Texture atlas with On Demand Resources&quot;&gt;  &lt;/p&gt;
&lt;p&gt;On Demand Resources ä¹‹å‰çš„ Session æåˆ°è¿‡,å®ƒæ˜¯å±äº App thinning ä¸­çš„ä¸€éƒ¨åˆ†.é€šè¿‡ç»™å›¾ç‰‡æ‰“ä¸Š On Demand Resources æ ‡ç­¾,å¹¶å¯ä»¥é€šè¿‡ç½‘ç»œåœ¨åå°ä¸‹è½½å¯¹åº”æ ‡ç­¾çš„å›¾ç‰‡.æ¯”å¦‚åœ¨æ¸¸æˆä¸­å¿«è¦è¿›å…¥åˆ°ç¬¬ä¸€å…³,å¯ä»¥åœ¨åå°ä½¿ç”¨â€Level1â€æ ‡ç­¾è·å–å¯¹åº”çš„é‚£äº›å›¾ç‰‡.è¿™æ ·æ¸¸æˆçš„ä½“ç§¯ä¹Ÿä¼šå¤§å¤§ç¼©å°,å› ä¸ºå¾ˆå¤šå›¾ç‰‡åªæ˜¯åœ¨å³å°†ç”¨åˆ°çš„æ—¶å€™è¢«ä¸‹è½½ä¸‹æ¥.ä¸€ä¸ªå›¾ç‰‡æœ‰å¤šä¸ªæ ‡ç­¾æ—¶,åªéœ€è¦ä½¿ç”¨å…¶ä¸­ä»»ä¸€ä¸ªæ ‡ç­¾å°±å¯ä»¥å°†å…¶ä¸‹è½½.  &lt;/p&gt;
&lt;h3 id=&quot;ç²’å­ç¼–è¾‘å™¨&quot;&gt;&lt;a href=&quot;#ç²’å­ç¼–è¾‘å™¨&quot; class=&quot;headerlink&quot; title=&quot;ç²’å­ç¼–è¾‘å™¨&quot;&gt;&lt;/a&gt;ç²’å­ç¼–è¾‘å™¨&lt;/h3&gt;&lt;p&gt;åˆæ˜¯è€æŠŠæˆé‡æ–°ç‚«è€€,å¯ä»¥åœ¨ç•Œé¢ä¸Šå®æ—¶ä¿®æ”¹å‚æ•°(æ®è¯´49ä¸ªå‘¢)æ¥è§‚å¯Ÿæ•ˆæœ,æ— éœ€å†™ä»£ç æ— éœ€é‡æ–°ç¼–è¯‘,å—¯.  &lt;/p&gt;
&lt;h3 id=&quot;Xcode-Quicklook&quot;&gt;&lt;a href=&quot;#Xcode-Quicklook&quot; class=&quot;headerlink&quot; title=&quot;Xcode Quicklook&quot;&gt;&lt;/a&gt;Xcode Quicklook&lt;/h3&gt;&lt;p&gt;ç»§ç»­æ‰¯è€æŠŠæˆ,æ¯”å¦‚åœ¨ Playground é‡Œé¢èƒ½æ˜¾ç¤º SpriteKit ç¨‹åºçš„æ•ˆæœå›¾.è¿™æ—©å°±å¯ä»¥äº†å¥½ä¹ˆ?å»å¹´è¿˜æ‹¿è¿™ä¸ªåšä¾‹å­å‘¢!æ°”çƒé‚£ä¸ª!è¿˜æœ‰åœ¨ debug æ—¶æ˜¾ç¤ºèŠ‚ç‚¹å½“å‰çš„ç¼©ç•¥å›¾,æˆ‘è®°å¾—è¿™ä¸ªå»å¹´ä¹Ÿæ—©å°±æœ‰äº†:  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-12@2x.png&quot; alt=&quot;Quicklook&quot;&gt;  &lt;/p&gt;
&lt;h3 id=&quot;2D-ç¼–è¾‘å™¨&quot;&gt;&lt;a href=&quot;#2D-ç¼–è¾‘å™¨&quot; class=&quot;headerlink&quot; title=&quot;2D ç¼–è¾‘å™¨&quot;&gt;&lt;/a&gt;2D ç¼–è¾‘å™¨&lt;/h3&gt;&lt;p&gt;æ–°çš„ç¼–è¾‘å™¨å¯ä»¥æ¨¡æ‹Ÿå’Œé¢„è§ˆåœºæ™¯äº†,ä¼šåŠ¨äº†.ä¹‹å‰ Xcode6 å·²ç»æ”¯æŒç¼–è¾‘ç²’å­æ•ˆæœå’Œæ•´ä¸ªæ¸¸æˆåœºæ™¯,ä»Šå¹´ Xcode7 è¿˜åŠ å…¥äº†åŠ¨ç”»å’ŒåŠ¨ä½œæ•ˆæœ.æƒ³æƒ³ä¸€è¡Œä»£ç éƒ½ä¸ç”¨å†™å°±èƒ½åšå‡ºä¼šåŠ¨çš„åœºæ™¯,è¶Šæ¥è¶Šé è¿‘ Unity ç­‰ä¸“ä¸šçš„æ¸¸æˆå¹³å°æ¡†æ¶äº†.(å‡­æˆ‘çš„ç»éªŒè‚¯å®šè¿™è‚¯å®šä¼šè®© Mac ç…é¸¡è›‹,å› ä¸ºåœ¨ä¹‹å‰ä»…æ˜¯é™æ€åœºæ™¯ä¸‹æ¨¡æ‹Ÿå…‰ç…§å°±å·²ç»å‘çƒ­æœ‰äº›ä¸¥é‡äº†,æ›´åˆ«ææ¨¡æ‹Ÿç‰©ç†è®¡ç®—è®©åœºæ™¯å†…å®¹åŠ¨èµ·æ¥äº†)  &lt;/p&gt;
&lt;h3 id=&quot;æ–°çš„é™„åŠ éƒ¨ä»¶&quot;&gt;&lt;a href=&quot;#æ–°çš„é™„åŠ éƒ¨ä»¶&quot; class=&quot;headerlink&quot; title=&quot;æ–°çš„é™„åŠ éƒ¨ä»¶&quot;&gt;&lt;/a&gt;æ–°çš„é™„åŠ éƒ¨ä»¶&lt;/h3&gt;&lt;p&gt;ä¹‹å‰æåˆ°çš„ SKCameraNode, SKAudioNode å’Œ SKReferenceNode,Xcode7 éƒ½æ˜¯ç»™äºˆæ¿€æƒ…æ”¯æŒçš„:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-14@2x.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Xcode7 ä¸­é¢„è§ˆæ—¶æ„Ÿå—æ‘„åƒå¤´çš„ç§»åŠ¨ç¼©æ”¾,æ„Ÿå—å£°éŸ³ç”±è¿œåŠè¿‘èº«ä¸´å…¶å¢ƒ,å½“ç„¶è¿™åœ¨ Unity ä¸­æ—©å°±æœ‰äº†, SpriteKit ä¸€ç›´åœ¨åŠªåŠ›è¿½èµ¶.  &lt;/p&gt;
&lt;p&gt;è®©å¼ºè¿«ç—‡æ¿€åŠ¨çš„æ˜¯åœºæ™¯ç¼–è¾‘å™¨ç»ˆäºæ”¯æŒå°† Node è®¾ä¸ºè‡ªå®šä¹‰ç±»äº†.è¿™çœŸæ˜¯å¤ªèµäº†!  &lt;/p&gt;
&lt;h3 id=&quot;åŠ¨ä½œç¼–è¾‘å™¨&quot;&gt;&lt;a href=&quot;#åŠ¨ä½œç¼–è¾‘å™¨&quot; class=&quot;headerlink&quot; title=&quot;åŠ¨ä½œç¼–è¾‘å™¨&quot;&gt;&lt;/a&gt;åŠ¨ä½œç¼–è¾‘å™¨&lt;/h3&gt;&lt;p&gt;æœ€è®©äººæ¿€åŠ¨çš„æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨åŠ¨ä½œç¼–è¾‘å™¨ä¸­åƒåšè§†é¢‘ä¸€æ ·åŸºäºæ—¶é—´çº¿æ„å»ºå‡ºå¤æ‚çš„äº¤äº’åŠ¨ç”»!æ”¯æŒ 2D å’Œ 3D, å¹¶èƒ½å®æ—¶é¢„è§ˆ:  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/QQ20150612-15@2x.png?imageView2/2/w/800/q/75|watermark/2/text/eXVsaW5ndGlhbnhpYQ==/font/Y29taWMgc2FucyBtcw==/fontsize/500/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10&quot; alt=&quot;Action&quot;&gt;  &lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;è€å®è¯´ä½œä¸ºä¸€ä¸ªæ¸¸æˆå¼•æ“, SpriteKit è¿™æ¬¡å¸¦æ¥çš„æ–°åŠŸèƒ½å¤§éƒ¨åˆ†ä¾ç„¶æ˜¯å…¶ä»–å„å¤§æ¸¸æˆå¼•æ“æ—©å°±æœ‰çš„æ ‡é…,ä½†è‹¹æœæœ€å¸å¼•äººçš„åœ°æ–¹å°±æ˜¯å®ƒå­¦å¾—å¾ˆå¿«,æ¯æ¬¡æ€»ä¼šç»™å¤§å®¶å¸¦æ¥æ–°çš„å˜åŒ–,ä¼šè®©å®ƒçš„ç²‰ä¸ä»¬çœ‹åˆ°å¸Œæœ›. SpriteKit å’Œ SceneKit è¿™ä¸¤ä¸ªè‹¹æœè‡ªå®¶çš„æ¸¸æˆå¼•æ“ä¸€ç›´ä¸æ¸©ä¸ç«,ä¸€æ˜¯ä¸å¤Ÿæˆç†Ÿ,äºŒæ˜¯ä¸èƒ½è·¨å¹³å°,ä½†æˆ‘ç›¸ä¿¡è‹¹æœæ¯å¹´éƒ½ä¼šç»™å®ƒä»¬å¸¦æ¥æ›´æ–°æ›´ç‚«çš„åŠŸèƒ½,è®©å¼€å‘è€…æ¥å—å®ƒä»¬.  &lt;/p&gt;
&lt;p&gt;è¿™æ¬¡æ²¡æ¥å¾—åŠåš Demo, ä½†ç­‰åˆ° iOS9 ç¨³å®šå,æˆ‘è‚¯å®šä¼šç»§ç»­åœ¨&lt;a href=&quot;http://coloratom.yulingtianxia.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ColorAtom&lt;/a&gt; å’Œ &lt;a href=&quot;http://spiral.yulingtianxia.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Spiral&lt;/a&gt; ä¸Šåˆ†åˆ«ç”¨ Objective-C å’Œ Swift æ¥å†™ä¸€äº›æ–°çš„æ¸¸æˆæ¨¡å¼ä½œä¸º SpriteKit æ–°ç‰¹æ€§çš„æ¼”ç¤º Demo.  &lt;/p&gt;
&lt;p&gt;æœ€å, Apple ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª SpriteKit å’Œ GameplayKit çš„ &lt;a href=&quot;https://developer.apple.com/library/prerelease/ios/samplecode/DemoBots/Introduction/Intro.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Demo&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ˜¯ä¸€ç¯‡ WWDC2015 Session 604 çš„å­¦ä¹ ç¬”è®°,åœ¨çœ‹ WWDC2014 çš„ Session æ—¶ä¹Ÿæ€»ç»“è¿‡ä¸€ç¯‡&lt;a href=&quot;http://yulingtianxia.com/blog/2014/08/08/spritekitzai-ios8he-osx10-dot-10zhong-de-xin-te-xing/&quot;&gt;SpriteKitåœ¨iOS8å’ŒOSX10.10ä¸­çš„æ–°ç‰¹æ€§&lt;/a&gt;,ä» iOS7 å‘å¸ƒ SpriteKit ä»¥æ¥æˆ‘ä¸€ç›´åˆ©ç”¨è¯¾ä½™æ—¶é—´åšäº›å°æ¸¸æˆ,æ„Ÿå—ç€ SpriteKit çš„ä¸€è·¯æˆé•¿.è¿™æ¬¡ä¹Ÿåœ¨ç¬¬ä¸€æ—¶é—´æ€»ç»“äº†ä¸‹ ä»Šå¹´ WWDC SpriteKit çš„æ–°ç‰¹æ€§.&lt;br&gt;
    
    </summary>
    
    
      <category term="SpriteKit" scheme="http://yulingtianxia.com/tags/SpriteKit/"/>
    
  </entry>
  
  <entry>
    <title>ReactiveCocoa å’Œ MVVM å…¥é—¨</title>
    <link href="http://yulingtianxia.com/blog/2015/05/21/ReactiveCocoa-and-MVVM-an-Introduction/"/>
    <id>http://yulingtianxia.com/blog/2015/05/21/ReactiveCocoa-and-MVVM-an-Introduction/</id>
    <published>2015-05-21T13:43:37.000Z</published>
    <updated>2016-05-11T14:31:48.000Z</updated>
    
    <content type="html">&lt;p&gt;ç¿»è¯‘è‡ª&lt;a href=&quot;http://www.sprynthesis.com/2014/12/06/reactivecocoa-mvvm-introduction&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ReactiveCocoa and MVVM,  an Introduction&lt;/a&gt;. &lt;del&gt;æ–‡ä¸­å¼•ç”¨çš„ Gist å¯èƒ½æ— æ³•æ˜¾ç¤º. ä¸ºäº†å’Œè°ç¤¾ä¼š, è¯·&lt;a href=&quot;http://tizipro.com/?r=ee0508bc191f5651&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç§‘å­¦ä¸Šç½‘&lt;/a&gt;ğŸ˜‚&lt;/del&gt;   &lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;MVC&quot;&gt;&lt;a href=&quot;#MVC&quot; class=&quot;headerlink&quot; title=&quot;MVC&quot;&gt;&lt;/a&gt;MVC&lt;/h2&gt;&lt;p&gt;ä»»ä½•ä¸€ä¸ªæ­£ç»å¼€å‘è¿‡ä¸€é˜µå­è½¯ä»¶çš„äººéƒ½ç†Ÿæ‚‰&lt;strong&gt;MVC&lt;/strong&gt;. å®ƒæ„æ€æ˜¯&lt;strong&gt;Model View Controller&lt;/strong&gt;, æ˜¯ä¸€ä¸ªåœ¨å¤æ‚åº”ç”¨è®¾è®¡ä¸­ç»„ç»‡ä»£ç çš„å…¬è®¤æ¨¡å¼. å®ƒä¹Ÿè¢«è¯å®åœ¨ iOS å¼€å‘ä¸­æœ‰ç€ç¬¬äºŒç§å«ä¹‰:  &lt;strong&gt;Massive View Controller(é‡é‡çº§è§†å›¾æ§åˆ¶å™¨)&lt;/strong&gt;. å®ƒè®©è®¸å¤šç¨‹åºå‘˜ç»å°½è„‘æ±å¦‚ä½•å»ä½¿ä»£ç è¢«è§£è€¦å’Œç»„ç»‡åœ°è®©äººæ»¡æ„. æ€»çš„æ¥è¯´, iOS å¼€å‘è€…å·²ç»å¾—å‡ºç»“è®º: ä»–ä»¬éœ€è¦&lt;a href=&quot;http://www.objc.io/issue-1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç»™è§†å›¾æ§åˆ¶å™¨ç˜¦èº«&lt;/a&gt;, å¹¶è¿›ä¸€æ­¥åˆ†ç¦»äº‹ç‰©;ä½†è¯¥æ€ä¹ˆåšå‘¢?  &lt;/p&gt;
&lt;h2 id=&quot;MVVM&quot;&gt;&lt;a href=&quot;#MVVM&quot; class=&quot;headerlink&quot; title=&quot;MVVM&quot;&gt;&lt;/a&gt;MVVM&lt;/h2&gt;&lt;p&gt;äºæ˜¯&lt;strong&gt;MVVM&lt;/strong&gt;æµè¡Œèµ·æ¥, å®ƒä»£è¡¨&lt;strong&gt;Model View View-Model&lt;/strong&gt;, å®ƒåœ¨è¿™å¸®åŠ©æˆ‘ä»¬åˆ›å»ºæ›´æ˜“å¤„ç†, æ›´ä½³è®¾è®¡çš„ä»£ç .   &lt;/p&gt;
&lt;p&gt;æœ‰æ—¶å€™è¿èƒŒè‹¹æœå»ºè®®çš„ç¼–ç æ–¹å¼å¹¶ä¸æ˜¯ä¸ªå¥½åšæ³•. æˆ‘ä¸æ˜¯è¯´ä¸èµæˆè¿™æ ·å­, æˆ‘æŒ‡çš„æ˜¯å¯èƒ½ä¼šå¼Šå¤§äºåˆ©. æ¯”å¦‚æˆ‘ä¸å»ºè®®ä½ å»å®ç°ä¸ªè‡ªå·±çš„ view controller åŸºç±»å¹¶è¯•ç€è‡ªå·±å¤„ç†è§†å›¾ç”Ÿå‘½å‘¨æœŸ.   &lt;/p&gt;
&lt;p&gt;å¸¦ç€è¿™ç§æƒ…ç»ª, æˆ‘æƒ³æä¸ªé—®é¢˜: &lt;strong&gt;ä½¿ç”¨é™¤è‹¹æœæ¨èçš„ MVC ä¹‹å¤–çš„åº”ç”¨è®¾è®¡æ¨¡å¼æ˜¯æ„šè ¢çš„ä¹ˆ?&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸&lt;/strong&gt;. æœ‰ä¸¤ä¸ªåŸå› .   &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è‹¹æœæ²¡æœ‰ä¸ºè§£å†³é‡é‡çº§è¯•å›¾æ§åˆ¶å™¨é—®é¢˜æä¾›çœŸæ­£çš„æŒ‡å¯¼. ä»–ä»¬ç•™ç»™æˆ‘ä»¬æ¥è§£å†³å¦‚ä½•å‘ä»£ç æ·»åŠ æ›´å¤šæ¸…æ™°çš„æ€è·¯. ç”¨ MVVM æ¥å®ç°è¿™ä¸ªç›®çš„æƒ³å¿…æ˜¯æå¥½å“’. (åœ¨ä»Šå¹´ WWDC çš„ä¸€äº›è§†é¢‘ä¸­, è‹¹æœå·¥ç¨‹å¸ˆåœ¨å±å¹•ä¸Šçš„ç¤ºä¾‹ä»£ç çš„ç¡®å°‘è®¸å‡ºç°äº† view-model, ä¸çŸ¥é“æ˜¯å¦å› ä¸ºæœ‰å®ƒæ‰æˆä¸ºäº†ç¤ºä¾‹ä»£ç )&lt;/li&gt;
&lt;li&gt;MVVM,  è‡³å°‘æ˜¯æˆ‘å°†è¦åœ¨è¿™é‡Œå±•ç¤ºçš„ MVVM çš„é£æ ¼, éƒ½è·Ÿ MVC ååˆ†å…¼å®¹. ä»¿ä½›æˆ‘ä»¬å°† MVC è¿›è¡Œåˆ°ä¸‹ä¸€ä¸ªé€»è¾‘æ­¥éª¤. &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä¸ä¼šæåŠ MVC/MVVM çš„å†å², å› ä¸ºå…¶ä»–åœ°æ–¹å·²ç»æœ‰æ‰€ä»‹ç», å¹¶ä¸”æˆ‘ä¹Ÿä¸ç²¾é€š. æˆ‘å°†ä¼šå…³æ³¨å¦‚ä½•ç”¨å®ƒè¿›è¡Œ iOS/Mac å¼€å‘.   &lt;/p&gt;
&lt;h3 id=&quot;å®šä¹‰-MVVM&quot;&gt;&lt;a href=&quot;#å®šä¹‰-MVVM&quot; class=&quot;headerlink&quot; title=&quot;å®šä¹‰ MVVM&quot;&gt;&lt;/a&gt;å®šä¹‰ MVVM&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Model&lt;/strong&gt; - model åœ¨ MVVM ä¸­æ²¡æœ‰çœŸæ­£çš„å˜åŒ–. å–å†³äºä½ çš„åå¥½, ä½ çš„ model å¯èƒ½ä¼šæˆ–å¯èƒ½ä¸ä¼šå°è£…ä¸€äº›é¢å¤–çš„ä¸šåŠ¡é€»è¾‘å·¥ä½œ. æˆ‘æ›´å€¾å‘äºæŠŠå®ƒå½“åšä¸€ä¸ªå®¹çº³è¡¨ç°æ•°æ®-æ¨¡å‹å¯¹è±¡ä¿¡æ¯çš„ç»“æ„ä½“, å¹¶åœ¨ä¸€ä¸ªå•ç‹¬çš„ç®¡ç†ç±»ä¸­ç»´æŠ¤çš„åˆ›å»º/ç®¡ç†æ¨¡å‹çš„ç»Ÿä¸€é€»è¾‘. &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;View&lt;/strong&gt; - view åŒ…å«å®é™… UI æœ¬èº«(ä¸è®ºæ˜¯ &lt;code&gt;UIView&lt;/code&gt; ä»£ç , storyboard å’Œ xib), ä»»ä½•è§†å›¾ç‰¹å®šçš„é€»è¾‘, å’Œå¯¹ç”¨æˆ·è¾“å…¥çš„åé¦ˆ. åœ¨ iOS ä¸­è¿™ä¸ä»…éœ€è¦ &lt;code&gt;UIView&lt;/code&gt; ä»£ç å’Œé‚£äº›æ–‡ä»¶, è¿˜åŒ…æ‹¬å¾ˆå¤šéœ€ç”± &lt;code&gt;UIViewController&lt;/code&gt; å¤„ç†çš„å·¥ä½œ. &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;View-Model&lt;/strong&gt; - è¿™ä¸ªæœ¯è¯­æœ¬èº«ä¼šå¸¦æ¥å›°æƒ‘, å› ä¸ºå®ƒæ··æ­äº†ä¸¤ä¸ªæˆ‘ä»¬å·²çŸ¥çš„æœ¯è¯­, ä½†å´æ˜¯å®Œå…¨ä¸åŒçš„ä¸œä¸œ. å®ƒä¸æ˜¯ä¼ ç»Ÿæ•°æ®-æ¨¡å‹ç»“æ„ä¸­æ¨¡å‹çš„æ„æ€(åˆæ¥äº†, åªæ˜¯æˆ‘å–œæ¬¢è¿™ä¸ªä¾‹å­). å®ƒçš„èŒè´£ä¹‹ä¸€å°±æ˜¯ä½œä¸ºä¸€ä¸ªè¡¨ç°è§†å›¾æ˜¾ç¤ºè‡ªèº«æ‰€éœ€æ•°æ®çš„é™æ€æ¨¡å‹;ä½†å®ƒä¹Ÿæœ‰æ”¶é›†, è§£é‡Šå’Œè½¬æ¢é‚£äº›æ•°æ®çš„è´£ä»». è¿™ç•™ç»™äº† view (controller) ä¸€ä¸ªæ›´åŠ æ¸…æ™°æ˜ç¡®çš„ä»»åŠ¡: å‘ˆç°ç”± view-model æä¾›çš„æ•°æ®. &lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;å…³äº-view-model-çš„æ›´å¤šå†…å®¹&quot;&gt;&lt;a href=&quot;#å…³äº-view-model-çš„æ›´å¤šå†…å®¹&quot; class=&quot;headerlink&quot; title=&quot;å…³äº view-model çš„æ›´å¤šå†…å®¹&quot;&gt;&lt;/a&gt;å…³äº view-model çš„æ›´å¤šå†…å®¹&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;view-model&lt;/strong&gt; ä¸€è¯çš„ç¡®ä¸èƒ½å……åˆ†è¡¨è¾¾æˆ‘ä»¬çš„æ„å›¾. ä¸€ä¸ªæ›´å¥½çš„æœ¯è¯­å¯èƒ½æ˜¯ â€œView Coordinatorâ€(æ„Ÿè°¢&lt;a href=&quot;https://twitter.com/kastiglione&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Dave Lee&lt;/a&gt;æçš„è¿™ä¸ª â€œView Coordinatorâ€ æœ¯è¯­, çœŸæ˜¯ä¸ªå¥½ç‚¹å­). ä½ å¯ä»¥è®¤ä¸ºå®ƒå°±åƒæ˜¯ç”µè§†æ–°é—»ä¸»æ’­èƒŒåçš„ç ”ç©¶äººå‘˜å’Œä½œå®¶å›¢é˜Ÿ. å®ƒä»å¿…è¦çš„èµ„æº(æ•°æ®åº“, ç½‘ç»œæœåŠ¡è°ƒç”¨, ç­‰)ä¸­è·å–åŸå§‹æ•°æ®, è¿ç”¨é€»è¾‘, å¹¶å¤„ç†æˆ view (controller) çš„å±•ç¤ºæ•°æ®. å®ƒ(é€šå¸¸é€šè¿‡å±æ€§)æš´éœ²ç»™è§†å›¾æ§åˆ¶å™¨éœ€è¦çŸ¥é“çš„ä»…å…³äºæ˜¾ç¤ºè§†å›¾å·¥ä½œçš„ä¿¡æ¯(ç†æƒ³åœ°ä½ ä¸ä¼šæš´æ¼ä½ çš„ data-model å¯¹è±¡). å®ƒè¿˜è´Ÿè´£å¯¹ä¸Šæ¸¸æ•°æ®çš„ä¿®æ”¹(æ¯”å¦‚æ›´æ–°æ¨¡å‹/æ•°æ®åº“, API POST è°ƒç”¨). &lt;/p&gt;
&lt;h2 id=&quot;MVC-ä¸–ç•Œä¸­çš„-MVVM&quot;&gt;&lt;a href=&quot;#MVC-ä¸–ç•Œä¸­çš„-MVVM&quot; class=&quot;headerlink&quot; title=&quot;MVC ä¸–ç•Œä¸­çš„ MVVM&quot;&gt;&lt;/a&gt;MVC ä¸–ç•Œä¸­çš„ MVVM&lt;/h2&gt;&lt;p&gt;æˆ‘è®¤ä¸º MVVM è¿™ä¸ªé¦–å­—æ¯ç¼©å†™å¦‚åŒ view-model æœ¯è¯­ä¸€æ ·, å¯¹å¦‚ä½•ä½¿ç”¨å®ƒä»¬è¿›è¡Œ iOS å¼€å‘ä½“ç°å¾—æœ‰ç‚¹ä¸å¤ªå‡†ç¡®. è®©æˆ‘ä»¬å†æ£€æŸ¥ä¸‹è¿™ä¸ªé¦–å­—æ¯ç¼©å†™, äº†è§£ä¸‹å®ƒæ˜¯æ€ä¹ˆä¸ MVC èä¸ºä¸€ä½“çš„.   &lt;/p&gt;
&lt;p&gt;ä¸ºäº†å›¾è§£è¡¨ç¤º, æˆ‘ä»¬é¢ å€’äº† &lt;strong&gt;MVC&lt;/strong&gt; ä¸­çš„ &lt;strong&gt;V&lt;/strong&gt; å’Œ &lt;strong&gt;C&lt;/strong&gt;, äºæ˜¯é¦–å­—æ¯ç¼©å†™æ›´èƒ½å‡†ç¡®åœ°åæ˜ å‡ºç»„ä»¶é—´çš„å…³ç³»æ–¹ä½, ç»™æˆ‘ä»¬å¸¦æ¥ &lt;strong&gt;MCV&lt;/strong&gt;. æˆ‘ä¹Ÿä¼šå¯¹ &lt;strong&gt;MVVM&lt;/strong&gt; è¿™ä¹ˆå¹², å°† &lt;strong&gt;V(iew)&lt;/strong&gt; ç§»åˆ° &lt;strong&gt;VM&lt;/strong&gt; çš„å³è¾¹æœ€ç»ˆæˆä¸ºäº† &lt;strong&gt;MVMV&lt;/strong&gt;. (æˆ‘ç›¸ä¿¡è¿™äº›é¦–å­—æ¯ç¼©å†™èµ·åˆä¸æ’æˆè¿™æ ·æ›´åˆç†çš„é¡ºåºæ˜¯æœ‰åŸå› çš„. )  &lt;/p&gt;
&lt;p&gt;è¿™æ˜¯è¿™ä¸¤ç§æ¨¡å¼å¦‚ä½•åœ¨ iOS ä¸­ç»„è£…åœ¨ä¸€èµ·çš„ç®€å•æ˜ å°„:   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/MCVMVMV.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘è¯•å›¾éµå¾ªåŒºå—å°ºå¯¸(éå¸¸)å¤§è‡´å¯¹åº”å®ƒä»¬è´Ÿè´£çš„å·¥ä½œé‡. &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://i0.kym-cdn.com/photos/images/newsfeed/000/228/269/demotivational-posters-theres-your-problem.jpg&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ³¨æ„åˆ°è§†å›¾æ§åˆ¶å™¨æœ‰å¤šå¤§?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·¨å¤§çš„è§†å›¾æ§åˆ¶å™¨å’Œ view-model ä¹‹é—´æœ‰å¤§å—å·¥ä½œä¸Šçš„é‡åˆ. &lt;/li&gt;
&lt;li&gt;ä½ ä¹Ÿå¯ä»¥çœ‹çœ‹è§†å›¾æ§åˆ¶å™¨åœ¨ MVVM ä¸­çš„è¶³è¿¹æœ‰å¤šå¤§ä¸€éƒ¨åˆ†æ˜¯è·Ÿè§†å›¾é‡åˆçš„. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¤§å¯å®‰å¿ƒè·çŸ¥æˆ‘ä»¬å¹¶æ²¡æœ‰çœŸçš„å»é™¤è§†å›¾æ§åˆ¶å™¨çš„æ¦‚å¿µæˆ–æŠ›å¼ƒ â€œcontrollerâ€ æœ¯è¯­æ¥åŒ¹é… MVVM. (å”·. )æˆ‘ä»¬æ­£è¦å°†é‡åˆçš„é‚£å—å·¥ä½œå‰¥ç¦»åˆ° view-model ä¸­, å¹¶è®©è§†å›¾æ§åˆ¶å™¨çš„ç”Ÿæ´»æ›´åŠ ç®€å•.   &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å®é™…ä¸Šæœ€ç»ˆä»¥ &lt;strong&gt;MVMCV&lt;/strong&gt; å‘Šç»ˆ. &lt;strong&gt;M&lt;/strong&gt;odel &lt;strong&gt;V&lt;/strong&gt;iew-&lt;strong&gt;M&lt;/strong&gt;odel &lt;strong&gt;C&lt;/strong&gt;ontroller &lt;strong&gt;V&lt;/strong&gt;iew. æˆ‘ç¡®ä¿¡æˆ‘æ— æ‹˜æ— æŸçš„åº”ç”¨è®¾è®¡æ¨¡å¼éª‡å®¢è¡Œä¸ºä¼šè®©äººå¤§åƒä¸€æƒŠ.   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/MCVMVMV.gif&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬çš„ç»“æœ: &lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/MVMCV.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;ç°åœ¨è§†å›¾æ§åˆ¶å™¨ä»…å…³æ³¨äºç”¨ view-model çš„æ•°æ®é…ç½®å’Œç®¡ç†å„ç§å„æ ·çš„è§†å›¾, å¹¶åœ¨å…ˆå…³ç”¨æˆ·è¾“å…¥æ—¶è®© view-model è·çŸ¥å¹¶éœ€è¦å‘ä¸Šæ¸¸ä¿®æ”¹æ•°æ®. è§†å›¾æ§åˆ¶å™¨ä¸éœ€è¦äº†è§£å…³äºç½‘ç»œæœåŠ¡è°ƒç”¨, Core Data, æ¨¡å‹å¯¹è±¡ç­‰. (äº‹å®ä¸Šæœ‰æ—¶é€šè¿‡ view-model å¤´æ–‡ä»¶è€Œä¸æ˜¯å¤åˆ¶ä¸€å¤§å †å±æ€§æ¥æš´æ¼ model æ˜¯å¾ˆåŠ¡å®çš„, åé¢è¿˜ä¼šæœ‰)  &lt;/p&gt;
&lt;p&gt;view-model ä¼šåœ¨è§†å›¾æ§åˆ¶å™¨ä¸Šä»¥ä¸€ä¸ªå±æ€§çš„æ–¹å¼å­˜åœ¨. è§†å›¾æ§åˆ¶å™¨çŸ¥é“ view-model å’Œå®ƒçš„å…¬æœ‰å±æ€§, ä½†æ˜¯ view-model å¯¹è§†å›¾æ§åˆ¶å™¨ä¸€æ— æ‰€çŸ¥. ä½ æ—©å°±è¯¥å¯¹è¿™ä¸ªè®¾è®¡æ„Ÿè§‰å¥½å¤šäº†å› ä¸ºæˆ‘ä»¬çš„å…³æ³¨ç‚¹åœ¨è¿™å„¿è¿›è¡Œæ›´å¥½åœ°åˆ†ç¦».   &lt;/p&gt;
&lt;p&gt;å¸®åŠ©ä½ ç†è§£æˆ‘ä»¬å¦‚ä½•æŠŠç»„ä»¶ç»„è£…åœ¨ä¸€èµ·è¿˜æœ‰ç»„ä»¶å¯¹åº”èŒè´£çš„å¦ä¸€ç§æ–¹å¼, å°±æ˜¯ç€çœ¼äºæˆ‘ä»¬æ–°çš„åº”ç”¨æ„å»ºæ¨¡å—å±‚çº§å›¾.   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/mvvm-layers.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;(æ„Ÿè°¢&lt;a href=&quot;https://twitter.com/kastiglione&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Dave Lee @kastiglione&lt;/a&gt;)&lt;/p&gt;
&lt;h2 id=&quot;View-Model-å’Œ-View-Controller-åœ¨ä¸€èµ·ï¼Œä½†ç‹¬ç«‹&quot;&gt;&lt;a href=&quot;#View-Model-å’Œ-View-Controller-åœ¨ä¸€èµ·ï¼Œä½†ç‹¬ç«‹&quot; class=&quot;headerlink&quot; title=&quot;View-Model å’Œ View Controller,  åœ¨ä¸€èµ·ï¼Œä½†ç‹¬ç«‹&quot;&gt;&lt;/a&gt;View-Model å’Œ View Controller,  åœ¨ä¸€èµ·ï¼Œä½†ç‹¬ç«‹&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸ªç®€å•çš„ view-model å¤´æ–‡ä»¶æ¥å¯¹æˆ‘ä»¬æ–°æ„ä»¶çš„é•¿ç›¸æœ‰ä¸ªæ›´å¥½åœ°æ¦‚å¿µ. ä¸ºäº†æƒ…èŠ‚ç®€å•, æˆ‘ä»¬æ„å»ºæŒ‰äº†ä¸€ä¸ªä¼ªé€ çš„æ¨ç‰¹å®¢æˆ·ç«¯æ¥æŸ¥çœ‹ä»»ä½•æ¨ç‰¹ç”¨æˆ·çš„æœ€æ–°å›å¤, é€šè¿‡è¾“å…¥ä»–ä»¬çš„å§“åå¹¶ç‚¹å‡» â€œGoâ€.  æˆ‘ä»¬çš„æ ·ä¾‹ç•Œé¢å°†ä¼šæ˜¯è¿™æ ·:   &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰ä¸€ä¸ªè®©ç”¨æˆ·è¾“å…¥ä»–ä»¬å§“åçš„ &lt;code&gt;UITextField&lt;/code&gt; , å’Œä¸€ä¸ªå†™ç€ â€œGoâ€ çš„ &lt;code&gt;UIButton&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æœ‰æ˜¾ç¤ºè¢«æŸ¥çœ‹çš„å½“å‰ç”¨æˆ·å¤´åƒå’Œå§“åçš„ &lt;code&gt;UIImageView&lt;/code&gt; å’Œ &lt;code&gt;UILabel&lt;/code&gt; å„ä¸€ä¸ª&lt;/li&gt;
&lt;li&gt;ä¸‹é¢æ”¾ç€ä¸€ä¸ªæ˜¾ç¤ºæœ€æ–°å›å¤æ¨æ–‡çš„ &lt;code&gt;UITableView&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…è®¸æ— é™æ»šåŠ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/tweeboatplus.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;h3 id=&quot;View-Model-å®ä¾‹&quot;&gt;&lt;a href=&quot;#View-Model-å®ä¾‹&quot; class=&quot;headerlink&quot; title=&quot;View-Model å®ä¾‹&quot;&gt;&lt;/a&gt;View-Model å®ä¾‹&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬çš„ view-model å¤´æ–‡ä»¶åº”è¯¥é•¿è¿™æ ·:   &lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//MYTwitterLookupViewModel.h&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MYTwitterLookupViewModel&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, getter=isUsernameValid) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; usernameValid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *userFullName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *userAvatarImage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *tweets;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; allTweetsLoaded;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readwrite&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *username;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) getTweetsForCurrentUsername;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) loadMoreTweets;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç›¸å½“ç›´æˆªäº†å½“çš„å¡«å……. æ³¨æ„åˆ°è¿™äº›&lt;strong&gt;å£®ä¸½çš„ &lt;code&gt;readonly&lt;/code&gt; å±æ€§&lt;/strong&gt;äº†ä¹ˆ?è¿™ä¸ª view-model æš´æ¼äº†è§†å›¾æ§åˆ¶å™¨æ‰€å¿…éœ€çš„æœ€å°é‡ä¿¡æ¯, è§†å›¾æ§åˆ¶å™¨å®é™…ä¸Šå¹¶ä¸åœ¨ä¹ view-model æ˜¯å¦‚ä½•è·å¾—è¿™äº›ä¿¡æ¯çš„. ç°åœ¨æˆ‘ä»¬ä¸¤è€…éƒ½ä¸åœ¨ä¹. ä»…ä»…å‡å®šä½ ä¹ æƒ¯äºæ ‡å‡†çš„ç½‘ç»œæœåŠ¡è¯·æ±‚, æ ¡éªŒ, æ•°æ®æ“ä½œå’Œå­˜å‚¨.   &lt;/p&gt;
&lt;h4 id=&quot;view-model-ä¸åšçš„äº‹å„¿&quot;&gt;&lt;a href=&quot;#view-model-ä¸åšçš„äº‹å„¿&quot; class=&quot;headerlink&quot; title=&quot;view-model ä¸åšçš„äº‹å„¿&quot;&gt;&lt;/a&gt;view-model ä¸åšçš„äº‹å„¿&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¯¹è§†å›¾æ§åˆ¶å™¨ä»¥ä»»ä½•å½¢å¼ç›´æ¥èµ·ä½œç”¨æˆ–ç›´æ¥é€šå‘Šå…¶å˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;View-Controller-è§†å›¾æ§åˆ¶å™¨&quot;&gt;&lt;a href=&quot;#View-Controller-è§†å›¾æ§åˆ¶å™¨&quot; class=&quot;headerlink&quot; title=&quot;View Controller(è§†å›¾æ§åˆ¶å™¨)&quot;&gt;&lt;/a&gt;View Controller(è§†å›¾æ§åˆ¶å™¨)&lt;/h3&gt;&lt;h4 id=&quot;è§†å›¾æ§åˆ¶å™¨ä»-view-model-è·å–çš„æ•°æ®å°†ç”¨æ¥&quot;&gt;&lt;a href=&quot;#è§†å›¾æ§åˆ¶å™¨ä»-view-model-è·å–çš„æ•°æ®å°†ç”¨æ¥&quot; class=&quot;headerlink&quot; title=&quot;è§†å›¾æ§åˆ¶å™¨ä» view-model è·å–çš„æ•°æ®å°†ç”¨æ¥:&quot;&gt;&lt;/a&gt;è§†å›¾æ§åˆ¶å™¨ä» view-model è·å–çš„æ•°æ®å°†ç”¨æ¥:&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å½“ &lt;code&gt;usernameValid&lt;/code&gt; çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ â€œGoâ€ æŒ‰é’®çš„ &lt;code&gt;enabled&lt;/code&gt; å±æ€§&lt;/li&gt;
&lt;li&gt;å½“ &lt;code&gt;usernameValid&lt;/code&gt; ç­‰äº &lt;code&gt;NO&lt;/code&gt; æ—¶è°ƒæ•´æŒ‰é’®çš„ &lt;code&gt;alpha&lt;/code&gt; å€¼ä¸º0. 5(ç­‰äº &lt;code&gt;YES&lt;/code&gt; æ—¶è®¾ä¸º1. 0)&lt;/li&gt;
&lt;li&gt;æ›´æ–° &lt;code&gt;UILable&lt;/code&gt; çš„ &lt;code&gt;text&lt;/code&gt; å±æ€§ä¸ºå­—ç¬¦ä¸² &lt;code&gt;userFullName&lt;/code&gt; çš„å€¼&lt;/li&gt;
&lt;li&gt;æ›´æ–° &lt;code&gt;UIImageView&lt;/code&gt; çš„ &lt;code&gt;image&lt;/code&gt; å±æ€§ä¸º &lt;code&gt;userAvatarImage&lt;/code&gt; çš„å€¼&lt;/li&gt;
&lt;li&gt;ç”¨ &lt;code&gt;tweets&lt;/code&gt; æ•°ç»„ä¸­çš„å¯¹è±¡è®¾ç½®è¡¨æ ¼è§†å›¾ä¸­çš„ cell (åé¢ä¼šæåˆ°)&lt;/li&gt;
&lt;li&gt;å½“æ»‘åˆ°è¡¨æ ¼è§†å›¾åº•éƒ¨æ—¶å¦‚æœ &lt;code&gt;allTweetsLoaded&lt;/code&gt; ä¸º &lt;code&gt;NO&lt;/code&gt;, æä¾›ä¸€ä¸ª æ˜¾ç¤º â€œloadingâ€ çš„ cell&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;è§†å›¾æ§åˆ¶å™¨å°†å¯¹-view-model-èµ·å¦‚ä¸‹ä½œç”¨&quot;&gt;&lt;a href=&quot;#è§†å›¾æ§åˆ¶å™¨å°†å¯¹-view-model-èµ·å¦‚ä¸‹ä½œç”¨&quot; class=&quot;headerlink&quot; title=&quot;è§†å›¾æ§åˆ¶å™¨å°†å¯¹ view-model èµ·å¦‚ä¸‹ä½œç”¨:&quot;&gt;&lt;/a&gt;è§†å›¾æ§åˆ¶å™¨å°†å¯¹ view-model èµ·å¦‚ä¸‹ä½œç”¨:&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ¯å½“ &lt;code&gt;UITextField&lt;/code&gt; ä¸­çš„æ–‡æœ¬å‘ç”Ÿå˜åŒ–, æ›´æ–° view-model ä¸Šä»…æœ‰çš„ &lt;code&gt;readwrite&lt;/code&gt; å±æ€§ &lt;code&gt;username&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å½“ â€œGoâ€ æŒ‰é’®è¢«æŒ‰ä¸‹æ—¶è°ƒç”¨ view-model ä¸Šçš„ &lt;code&gt;getTweetsForCurrentUsername&lt;/code&gt; æ–¹æ³•&lt;/li&gt;
&lt;li&gt;å½“åˆ°è¾¾è¡¨æ ¼ä¸­çš„ â€œloadingâ€ cell æ—¶è°ƒç”¨ view-model ä¸Šçš„ &lt;code&gt;loadMoreTweets&lt;/code&gt; æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;è§†å›¾æ§åˆ¶å™¨ä¸åšçš„äº‹å„¿&quot;&gt;&lt;a href=&quot;#è§†å›¾æ§åˆ¶å™¨ä¸åšçš„äº‹å„¿&quot; class=&quot;headerlink&quot; title=&quot;è§†å›¾æ§åˆ¶å™¨ä¸åšçš„äº‹å„¿:&quot;&gt;&lt;/a&gt;è§†å›¾æ§åˆ¶å™¨ä¸åšçš„äº‹å„¿:&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å‘èµ·ç½‘ç»œæœåŠ¡è°ƒç”¨&lt;/li&gt;
&lt;li&gt;ç®¡ç† &lt;code&gt;tweets&lt;/code&gt; æ•°ç»„&lt;/li&gt;
&lt;li&gt;åˆ¤å®š &lt;code&gt;username&lt;/code&gt; å†…å®¹æ˜¯å¦æœ‰æ•ˆ&lt;/li&gt;
&lt;li&gt;å°†ç”¨æˆ·çš„å§“å’Œåæ ¼å¼åŒ–ä¸ºå…¨å&lt;/li&gt;
&lt;li&gt;ä¸‹è½½ç”¨æˆ·å¤´åƒå¹¶è½¬æˆ &lt;code&gt;UIImage&lt;/code&gt;(å¦‚æœä½ ä¹ æƒ¯åœ¨ &lt;code&gt;UIImageView&lt;/code&gt; ä¸Šä½¿ç”¨ç±»åˆ«ä»ç½‘ç»œåŠ è½½å›¾ç‰‡, ä½ å¯ä»¥æš´æ¼ URL è€Œä¸æ˜¯å›¾ç‰‡. è¿™æ ·å°±ç»™ view-model ä¸ UIKit ä¹‹é—´ä¸€ä¸ªæ›´æ¸…æ™°çš„åˆ’åˆ†, ä½†æˆ‘è§† &lt;code&gt;UIImage&lt;/code&gt; ä¸ºæ•°æ®è€Œéæ•°æ®çš„ç¡®åˆ‡æ˜¾ç¤º. è¿™äº›ä¸œè¥¿ä¸æ˜¯å›ºå®šæ­»çš„. )&lt;/li&gt;
&lt;li&gt;æµæ±—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·å†æ¬¡æ³¨æ„è§†å›¾æ§åˆ¶å™¨æ€»çš„è´£ä»»æ˜¯å¤„ç† view-model ä¸­çš„å˜åŒ–. &lt;/p&gt;
&lt;h2 id=&quot;å­-View-Model&quot;&gt;&lt;a href=&quot;#å­-View-Model&quot; class=&quot;headerlink&quot; title=&quot;å­ View-Model&quot;&gt;&lt;/a&gt;å­ View-Model&lt;/h2&gt;&lt;p&gt;æˆ‘æåˆ°è¿‡ä½¿ç”¨ view-model ä¸Šçš„ &lt;code&gt;tweets&lt;/code&gt; æ•°ç»„ä¸­çš„å¯¹è±¡é…ç½®è¡¨æ ¼è§†å›¾çš„ cell.é€šå¸¸ä½ ä¼šæœŸå¾…å±•ç° &lt;code&gt;tweets&lt;/code&gt; çš„æ˜¯æ•°æ®-æ¨¡å‹å¯¹è±¡. ä½ å¯èƒ½å·²ç»å¯¹å…¶æ„Ÿåˆ°å¥‡æ€ª, å› ä¸ºæˆ‘ä»¬è¯•å›¾é€šè¿‡ MVVM æ¨¡å¼ä¸æš´æ¼æ•°æ®-æ¨¡å‹å¯¹è±¡. (å‰é¢æåˆ°è¿‡çš„)  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;view-model ä¸å¿…åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ‰€æœ‰ä¸œè¥¿. &lt;/strong&gt;ä½ å¯ç”¨å­ view-model æ¥ä»£è¡¨å±å¹•ä¸Šæ›´å°, æ›´æ½œåœ¨è¢«å°è£…çš„éƒ¨åˆ†. å¦‚æœä¸€ä¸ªè§†å›¾ä¸Šçš„ä¸€å°å—å„¿(æ¯”å¦‚è¡¨æ ¼çš„ cell)åœ¨ app ä¸­å¯ä»¥è¢«é‡ç”¨ä»¥åŠ(æˆ–)è¡¨ç°å¤šä¸ªæ•°æ®-æ¨¡å‹å¯¹è±¡, å­ view-model ä¼šæ ¼å¤–æœ‰åˆ©.   &lt;/p&gt;
&lt;p&gt;ä½ ä¸æ€»æ˜¯éœ€è¦å­ view-model.  æ¯”å¦‚, æˆ‘å¯èƒ½ç”¨è¡¨æ ¼ header è§†å›¾æ¥æ¸²æŸ“æˆ‘ä»¬â€œtweetboat plusâ€åº”ç”¨çš„é¡¶éƒ¨. å®ƒä¸æ˜¯ä¸ªå¯é‡ç”¨çš„ç»„ä»¶, æ‰€ä»¥æˆ‘å¯èƒ½ä»…æ˜¯å°†æˆ‘ä»¬å·²ç»ç»™è§†å›¾æ§åˆ¶å™¨ç”¨è¿‡çš„ç›¸åŒçš„ view-model ä¼ ç»™é‚£ä¸ªè‡ªå®šä¹‰çš„ header è§†å›¾. å®ƒä¼šç”¨åˆ° view-model ä¸­å®ƒéœ€è¦çš„ä¿¡æ¯, è€Œæ— è§†ä½™ä¸‹çš„éƒ¨åˆ†. è¿™å¯¹äºä¿æŒå­è§†å›¾åŒæ­¥æ˜¯æå¥½çš„æ–¹å¼, å› ä¸ºå®ƒä»¬å¯ä»¥æœ‰æ•ˆåœ°ä¸ä¿¡æ¯ä¸­ç›¸åŒç¡®åˆ‡çš„ä¸Šä¸‹æ–‡ä½œç”¨, å¹¶è§‚å¯Ÿç¡®åˆ‡ç›¸åŒå±æ€§çš„æ›´æ–°.   &lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­,  &lt;code&gt;tweets&lt;/code&gt; æ•°ç»„å°†ä¼šè¢«ä¸‹é¢è¿™æ ·çš„å­ view-model å……æ»¡: &lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//MyTweetCellViewModel.h&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;MYTweetCellViewModel&lt;/span&gt;: NSObject&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt; (nonatomic, strong, readonly) NSString *tweetAuthorFullName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt; (nonatomic, strong, readonly) UIImage *tweetAuthorAvatarImage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt; (nonatomic, strong, readonly) NSString *tweetContent;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½ å¯èƒ½è®¤ä¸ºè¿™ä¹Ÿå¤ªåƒæ™®é€šâ€æ¨ç‰¹â€é‡Œçš„æ•°æ®-æ¨¡å‹å¯¹è±¡äº†å§. ä¸ºå•¥è¦å¹²å°†å…¶è½¬åŒ–æˆ view-model çš„å·¥ä½œ?å³ä½¿ç±»ä¼¼,  view-model è®©æˆ‘ä»¬é™åˆ¶ä¿¡æ¯åªæš´éœ²ç»™æˆ‘ä»¬éœ€è¦çš„åœ°æ–¹, æä¾›é¢å¤–æ•°æ®è½¬æ¢çš„å±æ€§, æˆ–ä¸ºç‰¹å®šçš„è§†å›¾è®¡ç®—æ•°æ®. (æ­¤å¤–, å½“å¯ä»¥ä¸æš´éœ²å¯å˜æ•°æ®-æ¨¡å‹å¯¹è±¡æ—¶ä¹Ÿæ˜¯æå¥½çš„, å› ä¸ºæˆ‘ä»¬å¸Œæœ› view-model è‡ªå·±æ‰¿æ‹…èµ·æ›´æ–°å®ƒä»¬çš„ä»»åŠ¡, è€Œä¸æ˜¯é è§†å›¾æˆ–è§†å›¾æ§åˆ¶å™¨. )  &lt;/p&gt;
&lt;h3 id=&quot;View-Model-ä»å“ªæ¥&quot;&gt;&lt;a href=&quot;#View-Model-ä»å“ªæ¥&quot; class=&quot;headerlink&quot; title=&quot;View-Model ä»å“ªæ¥?&quot;&gt;&lt;/a&gt;View-Model ä»å“ªæ¥?&lt;/h3&gt;&lt;p&gt;é‚£ä¹ˆ view-model æ˜¯ä½•æ—¶ä½•å¤„è¢«åˆ›å»ºçš„å‘¢?è§†å›¾æ§åˆ¶å™¨åˆ›å»ºå®ƒä»¬è‡ªå·±çš„ view-model ä¹ˆ?  &lt;/p&gt;
&lt;h4 id=&quot;View-Model-äº§ç”Ÿ-View-Model&quot;&gt;&lt;a href=&quot;#View-Model-äº§ç”Ÿ-View-Model&quot; class=&quot;headerlink&quot; title=&quot;View-Model äº§ç”Ÿ View-Model&quot;&gt;&lt;/a&gt;View-Model äº§ç”Ÿ View-Model&lt;/h4&gt;&lt;p&gt;ä¸¥æ ¼æ¥è¯´, ä½ åº”è¯¥ä¸º app delegate ä¸­çš„é¡¶çº§è§†å›¾æ§åˆ¶å™¨åˆ›å»ºä¸€ä¸ª view-model. å½“å±•ç¤ºä¸€ä¸ªæ–°çš„è§†å›¾æ§åˆ¶å™¨æ—¶, æˆ–å¾ˆå°çš„è§†å›¾è¢« view-model è¡¨ç°æ—¶, ä½ åº”è¦æ±‚å½“å‰çš„ view-model ä¸ºä½ åˆ›å»ºä¸€ä¸ªå­ view-model.   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/child-view-models.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;åŠ å…¥æˆ‘ä»¬æƒ³è¦åœ¨ç”¨æˆ·è½»æ‹åº”ç”¨é¡¶éƒ¨çš„å¤´åƒæ—¶æ·»åŠ ä¸€ä¸ªèµ„æ–™è§†å›¾æ§åˆ¶å™¨. æˆ‘ä»¬å¯ä»¥ä¸ºä¸€çº§ view-model æ·»åŠ ç±»ä¼¼å¦‚ä¸‹æ–¹æ³•:   &lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (MYTwitterUserProfileViewModel *) viewModelForCurrentUser;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨æˆ‘ä»¬çš„ä¸€çº§è§†å›¾æ§åˆ¶å™¨ä¸­è¿™ä¹ˆç”¨å®ƒ:   &lt;/p&gt;
&lt;figure class=&quot;highlight pf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//MYMainViewController.m &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (IBAction) didTapPrimaryUserAvatar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MYTwitterUserProfileViewModel *&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;ProfileViewModel = [&lt;span class=&quot;literal&quot;&gt;self&lt;/span&gt;.viewModel viewModelForCurrentUser];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MYTwitterUserProfileViewController *&lt;span class=&quot;keyword&quot;&gt;profile&lt;/span&gt;ViewController = &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [[MYTwitterUserProfileViewController alloc] initWithViewModel: &lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;ProfileViewModel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;literal&quot;&gt;self&lt;/span&gt;.navigationController pushViewController: &lt;span class=&quot;keyword&quot;&gt;profile&lt;/span&gt;ViewController animated:YES];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘å°†ä¼šå±•ç°å½“å‰ç”¨æˆ·çš„èµ„æ–™è§†å›¾æ§åˆ¶å™¨, ä½†æ˜¯æˆ‘çš„èµ„æ–™è§†å›¾æ§åˆ¶å™¨éœ€è¦ä¸€ä¸ª view-model. æˆ‘è¿™çš„ä¸»è§†å›¾æ§åˆ¶å™¨ä¸çŸ¥é“(ä¹Ÿä¸è¯¥çŸ¥é“)ç”¨äºåˆ›å»ºå…³è”ç›¸å…³ç”¨æˆ· view-model çš„å…¨éƒ¨å¿…è¦æ•°æ®, æ‰€ä»¥å®ƒè¯·æ±‚å®ƒè‡ªå·±çš„ view-model æ¥å¹²è¿™ç§åˆ›å»ºæ–° view-model çš„è‹¦å·®äº‹.   &lt;/p&gt;
&lt;h4 id=&quot;View-Model-åˆ—è¡¨&quot;&gt;&lt;a href=&quot;#View-Model-åˆ—è¡¨&quot; class=&quot;headerlink&quot; title=&quot;View-Model åˆ—è¡¨&quot;&gt;&lt;/a&gt;View-Model åˆ—è¡¨&lt;/h4&gt;&lt;p&gt;è‡³äºæˆ‘ä»¬çš„æ¨ç‰¹ cell, å½“æ•°æ®é©±åŠ¨å±å¹•(åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ–è®¸æ˜¯é€šè¿‡ç½‘ç»œæœåŠ¡è°ƒç”¨)èšåˆ°ä¸€èµ·æ—¶, æˆ‘å°†ä¼šä»£è¡¨æ€§åœ°æå‰ä¸ºå¯¹åº”çš„ cell åˆ›å»ºæ‰€æœ‰çš„ view-model.  æ‰€ä»¥åœ¨æˆ‘ä»¬è¿™ä¸ªæ–¹æ¡ˆä¸­,  &lt;code&gt;tweets&lt;/code&gt; å°†ä¼šæ˜¯ä¸€ä¸ª &lt;code&gt;MYTweetCellViewModel&lt;/code&gt; å¯¹è±¡æ•°ç»„. åœ¨æˆ‘çš„è¡¨æ ¼è§†å›¾ä¸­çš„ &lt;code&gt;cellForRowAtIndexPath&lt;/code&gt; æ–¹æ³•ä¸­, æˆ‘å°†ä¼šåœ¨æ­£ç¡®çš„ç´¢å¼•ä¸Šç®€å•åœ°æŠ“å– view-model,  å¹¶æŠŠå®ƒèµ‹å€¼ç»™æˆ‘çš„ cell ä¸Šçš„ view-model å±æ€§.   &lt;/p&gt;
&lt;h2 id=&quot;Functional-Core-Imperative-Shell&quot;&gt;&lt;a href=&quot;#Functional-Core-Imperative-Shell&quot; class=&quot;headerlink&quot; title=&quot;Functional Core,  Imperative Shell&quot;&gt;&lt;/a&gt;Functional Core,  Imperative Shell&lt;/h2&gt;&lt;p&gt;view-model è¿™ç§é€šå¾€åº”ç”¨è®¾è®¡çš„æ–¹æ³•æ˜¯ä¸€å—åº”ç”¨è®¾è®¡ä¹‹è·¯ä¸Šçš„å«è„šçŸ³, è¿™ç§è¢«ç§°ä½œ&lt;a href=&quot;https://www.destroyallsoftware.com/screencasts/catalog/functional-core-imperative-shell&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;â€œFunctional Core,  Imperative Shellâ€&lt;/a&gt;çš„åº”ç”¨è®¾è®¡ç”±&lt;a href=&quot;https://twitter.com/garybernhardt&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Gary Bernhardt&lt;/a&gt;åˆ›é€ . (æˆ‘æœ€è¿‘ååˆ†æœ‰å¹¸å»å¬&lt;a href=&quot;http://andymatuschak.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Andy Matuschak&lt;/a&gt;å…³äºè¿™æ–¹é¢çš„æ¼”è®², ä»–ä¸ºâ€èƒ–çš„æ•°å€¼å±‚, ç˜¦çš„å¯¹è±¡å±‚â€æå‡ºå……åˆ†ç†ç”±. è™½ç„¶è§‚ç‚¹ç›¸ä¼¼, ä½†å…³æ³¨äºæˆ‘ä»¬æ€æ ·ç§»é™¤å¯¹è±¡å’Œå®ƒä»¬çŠ¶æ€çš„è¾¹ç•Œå½±å“æ€§è´¨, å¹¶ç”¨ Swift ä¸­çš„æ–°æ•°æ®ç»“æ„æ„å»ºæ›´åŠ å‡½æ•°å¼, å¯æµ‹è¯•çš„æ•°å€¼å±‚. )&lt;/p&gt;
&lt;h3 id=&quot;Functional-Core&quot;&gt;&lt;a href=&quot;#Functional-Core&quot; class=&quot;headerlink&quot; title=&quot;Functional Core&quot;&gt;&lt;/a&gt;Functional Core&lt;/h3&gt;&lt;p&gt;view-model å°±æ˜¯ &lt;a href=&quot;http://www.smashingmagazine.com/2014/07/02/dont-be-scared-of-functional-programming/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;â€œfunctional coreâ€&lt;/a&gt;, å°½ç®¡å®é™…ä¸Šåœ¨ iOS/Objective-C ä¸­è¾¾åˆ°çº¯å‡½æ•°æ°´å¹³æ˜¯å¾ˆæ£˜æ‰‹çš„(Swift æä¾›äº†ä¸€äº›é™„åŠ çš„å‡½æ•°æ€§, è¿™ä¼šè®©æˆ‘ä»¬æ›´æ¥è¿‘). å¤§æ„æ˜¯è®©æˆ‘ä»¬çš„ view-model å°½å¯èƒ½å°‘çš„å¯¹å‰©ä½™çš„â€åº”ç”¨ä¸–ç•Œâ€çš„ä¾èµ–å’Œå½±å“. é‚£æ„å‘³ç€ä»€ä¹ˆ?æƒ³èµ·ä½ ç¬¬ä¸€æ¬¡å­¦ç¼–ç¨‹æ—¶å¯èƒ½å­¦åˆ°çš„ç®€å•å‡½æ•°å§. å®ƒä»¬å¯èƒ½æ¥å—ä¸€ä¸¤ä¸ªå‚æ•°å¹¶è¾“å‡ºä¸€ä¸ªç»“æœ. &lt;strong&gt;æ•°æ®è¾“å…¥, æ•°æ®è¾“å‡º.&lt;/strong&gt;è¿™ä¸ªå‡½æ•°å¯èƒ½æ˜¯åšä¸€äº›æ•°å­¦è¿ç®—æˆ–æ˜¯å°†å§“å’Œåç»“åˆåˆ°ä¸€èµ·. æ— è®ºåº”ç”¨çš„å…¶ä»–åœ°æ–¹å‘ç”Ÿå•¥, è¿™ä¸ªå‡½æ•°æ€»æ˜¯å¯¹ç›¸åŒçš„è¾“å…¥äº§ç”Ÿç›¸åŒçš„è¾“å‡º. è¿™å°±æ˜¯å‡½æ•°å¼æ–¹é¢.   &lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯æˆ‘ä»¬ä¸º view-model è°‹æ±‚çš„ä¸œè¥¿. ä»–ä»¬å¯Œæœ‰é€»è¾‘å’Œè½¬æ¢æ•°æ®å¹¶å°†ç»“æœå­˜åˆ°å±æ€§çš„åŠŸèƒ½. ç†æƒ³ä¸Šç›¸åŒçš„è¾“å…¥(æ¯”å¦‚ç½‘ç»œæœåŠ¡å“åº”)å°†ä¼šå¯¼å‡ºç›¸åŒçš„è¾“å‡º(å±æ€§çš„å€¼). è¿™æ„å‘³ç€å°½å¯èƒ½å¤šåœ°æ¶ˆé™¤ç”±â€åº”ç”¨ä¸–ç•Œâ€å‰©ä½™éƒ¨åˆ†å¸¦æ¥çš„å¯èƒ½å½±å“è¾“å‡ºçš„å› ç´ , &lt;a href=&quot;http://www.sprynthesis.com/2014/06/15/why-reactivecocoa/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ¯”å¦‚ä½¿ç”¨ä¸€å †çŠ¶æ€. &lt;/a&gt;&lt;strong&gt;ä¸€ä¸ªå¥½çš„ç¬¬ä¸€æ­¥å°±æ˜¯ä¸è¦å† view-model å¤´æ–‡ä»¶ä¸­å¼•å…¥ UIKit.h.&lt;/strong&gt;(è¿™æ˜¯ä¸ªé‡å¤§åŸåˆ™, ä½†ä¹Ÿæœ‰äº›ç°è‰²åŒºåŸŸ. æ¯”å¦‚, ä½ å¯èƒ½è®¤ä¸º &lt;code&gt;UIImage&lt;/code&gt; æ˜¯æ•°æ®è€Œä¸æ˜¯å±•ç¤ºä¿¡æ¯. PS:  æˆ‘çˆ±è¿™ä¹ˆå¹². æ—¢ç„¶è¿™æ ·çš„è¯å°±å¾—å¼•å…¥ UIKit. h ä»¥ä¾¿ä½¿ç”¨ &lt;code&gt;UIImage&lt;/code&gt; ç±»)UIKit å…¶æ€§è´¨å°±æ˜¯å°†è¦å½±å“è®¸å¤šåº”ç”¨ä¸–ç•Œ. å®ƒåŒ…å«å¾ˆå¤šâ€å‰¯ä½œç”¨â€, å‡­å€Ÿæ”¹å˜ä¸€ä¸ªå€¼æˆ–è°ƒç”¨ä¸€ä¸ªå‡½æ•°å°†è§¦å‘å¾ˆå¤šé—´æ¥(ç”šè‡³æœªçŸ¥)çš„æ”¹å˜.   &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°:&lt;/strong&gt; åˆšåˆšçœ‹äº† Andy åœ¨&lt;a href=&quot;http://2014.funswiftconf.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å‡½æ•°å¼ Swift ä¼šè®®&lt;/a&gt;ä¸Šç»™å‡ºçš„å¦ä¸€ä¸ªè¶…èµçš„æ¼”è®², äºæ˜¯åˆæƒ³åˆ°äº†ä¸€äº›. è¦æ¸…æ¥šä½ çš„ view-model &lt;em&gt;ä»ç„¶&lt;/em&gt;åªæ˜¯ä¸€ä¸ªå¯¹è±¡, è€Œä¸ç”¨ç»´æŠ¤ä¸€äº›çŠ¶æ€(å¦åˆ™å®ƒå°†ä¸ä¼šæ˜¯ä½ è§†å›¾ä¸­éå¸¸å¥½ç”¨çš„æ¨¡å‹äº†. )ä½†ä½ ä»è¯¥åŠªåŠ›å°†å°½å¯èƒ½å¤šçš„é€»è¾‘ç§»åˆ°æ— çŠ¶æ€çš„å‡½æ•°â€å€¼â€ä¸­. å†é‡å¤ä¸€æ¬¡, Swiftåœ¨è¿™æ–¹é¢æ¯” Objective-C æ›´åŠ å¯è¡Œ. &lt;/p&gt;
&lt;h3 id=&quot;Imperative-Declarative-Shell&quot;&gt;&lt;a href=&quot;#Imperative-Declarative-Shell&quot; class=&quot;headerlink&quot; title=&quot;Imperative (Declarative?) Shell&quot;&gt;&lt;/a&gt;Imperative (Declarative?) Shell&lt;/h3&gt;&lt;p&gt;å‘½ä»¤å¼å¤–å£³ (Imperative Shell) æ˜¯æˆ‘ä»¬éœ€è¦åšæ‰€æœ‰çš„çŠ¶æ€è½¬æ¢, åº”ç”¨ä¸–ç•Œæ”¹å˜çš„è‹¦å·®äº‹çš„åœ°æ–¹, ä¸ºçš„æ˜¯å°† view-model æ•°æ®è½¬æˆç»™ç”¨æˆ·åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„ä¸œè¥¿. è¿™æ˜¯æˆ‘ä»¬çš„è§†å›¾(æ§åˆ¶å™¨), å®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™åˆ†ç¦» UIKit çš„å·¥ä½œ. æˆ‘ä»å°†ç‰¹åˆ«æ³¨æ„å°½å¯èƒ½æ¶ˆé™¤çŠ¶æ€å¹¶ç”¨ ReactiveCocoa è¿™ç§é™ˆè¿°æ€§è´¨çš„ä¸œè¥¿åšè¿™æ–¹é¢å·¥ä½œ, è€Œ iOS å’Œ UIKit åœ¨è®¾è®¡ä¸Šæ˜¯å‘½ä»¤å¼çš„.  (è¡¨æ ¼çš„ data source å°±æ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­, å› ä¸ºå®ƒçš„å§”æ‰˜æ¨¡å¼å¼ºåˆ¶å°†çŠ¶æ€åº”ç”¨åˆ°å§”æ‰˜ä¸­, ä¸ºäº†å½“è¯·æ±‚å‘ç”Ÿæ—¶èƒ½å¤Ÿä¸ºè¡¨æ ¼è§†å›¾æä¾›ä¿¡æ¯. å®é™…ä¸Šå§”æ‰˜æ¨¡å¼é€šå¸¸å¼ºåˆ¶ä¸€å¤§å †çŠ¶æ€çš„ä½¿ç”¨)&lt;/p&gt;
&lt;h3 id=&quot;å¯æµ‹è¯•çš„æ ¸å¿ƒ&quot;&gt;&lt;a href=&quot;#å¯æµ‹è¯•çš„æ ¸å¿ƒ&quot; class=&quot;headerlink&quot; title=&quot;å¯æµ‹è¯•çš„æ ¸å¿ƒ&quot;&gt;&lt;/a&gt;å¯æµ‹è¯•çš„æ ¸å¿ƒ&lt;/h3&gt;&lt;p&gt;iOS çš„å•å…ƒæµ‹è¯•æ˜¯ä¸ªè„, è‹¦, ä¹±çš„æ´»å„¿. è‡³å°‘æˆ‘å»åšçš„æ—¶å€™å¾—å‡ºçš„æ˜¯è¿™ä¹ˆä¸ªç»“è®º. å°±è¿™æ–¹é¢æˆ‘è¿˜å‡ºè¯»è¿‡ä¸€ä¸¤æœ¬ä¹¦, ä½†å½“å¼€å§‹åšè§†å›¾æ§åˆ¶å™¨çš„ mocking å’Œ swizzling ä½¿å…¶ä¸€äº›é€»è¾‘å¯æµ‹è¯•æ—¶, æˆ‘ç›®å…‰å‘†æ». æˆ‘æœ€ç»ˆæŠŠå•å…ƒæµ‹è¯•å½’å…¥æ¨¡å‹å’Œä»»ä½•åŒç±»åˆ«æ¨¡å‹ç®¡ç†ç±»ä¸­. (è¯‘è€…æ³¨:  mock æ˜¯æµ‹è¯•å¸¸ç”¨çš„æ‰‹æ®µ, è€Œ method swizzling æ˜¯åŸºäº Objective-C Runtime äº¤æ¢æ–¹æ³•å®ç°çš„é»‘é­”æ³•)  &lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå‡½æ•°å¼æ ¸å¿ƒä¸€æ ·çš„ view-model çš„æœ€å¤§ä¼˜ç‚¹, é™¤äº† bug æ•°é‡éšç€çŠ¶æ€æ•°é€’å‡ä¹‹å¤–, å°±æ˜¯&lt;em&gt;å˜å¾—éå¸¸èƒ½å¤Ÿè¿›è¡Œå•å…ƒæµ‹è¯•&lt;/em&gt;. å¦‚æœä½ æœ‰é‚£ç§æ¯æ¬¡è¾“å…¥ç›¸åŒè€Œäº§ç”Ÿçš„è¾“å‡ºä¹Ÿç›¸åŒçš„æ–¹æ³•, é‚£å°±éå¸¸é€‚åˆå•å…ƒæµ‹è¯•çš„ä¸–ç•Œ. æˆ‘ä»¬ç°åœ¨å°†æˆ‘ä»¬çš„æ•°æ®ç”¨è·å–/é€»è¾‘/è½¬æ¢æå–å‡º, é¿å…äº†è§†å›¾æ§åˆ¶å™¨çš„å¤æ‚æ€§. é‚£æ„å‘³ç€æ„å»ºæ£’æ£’å“’æµ‹è¯•æ—¶ä¸éœ€è¦ç”¨ç–¯ç‹‚çš„ mock å¯¹è±¡,  method swizzling,  æˆ–å…¶ä»–ç–¯ç™«çš„å˜é€šæ–¹æ³•(å¸Œæœ›èƒ½æœ‰).   &lt;/p&gt;
&lt;h2 id=&quot;è¿æ¥ä¸€åˆ‡&quot;&gt;&lt;a href=&quot;#è¿æ¥ä¸€åˆ‡&quot; class=&quot;headerlink&quot; title=&quot;è¿æ¥ä¸€åˆ‡&quot;&gt;&lt;/a&gt;è¿æ¥ä¸€åˆ‡&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;é‚£ä¹ˆå½“ view-model çš„å…±æœ‰å±æ€§å‘ç”Ÿå˜åŒ–æ—¶æˆ‘ä»¬å¦‚ä½•æ›´æ–°æˆ‘ä»¬çš„è§†å›¾å‘¢?&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;ç»å¤§éƒ¨åˆ†æ—¶é—´æˆ‘ä»¬ç”¨å¯¹åº”çš„ view-model æ¥åˆå§‹åŒ–è§†å›¾æ§åˆ¶å™¨, æœ‰ç‚¹ç±»ä¼¼æˆ‘ä»¬åˆšåˆšåœ¨ä¸Šæ–‡è§åˆ°çš„:   &lt;/p&gt;
&lt;figure class=&quot;highlight inform7&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MYTwitterUserProfileViewController *profileViewController =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;[&lt;span class=&quot;comment&quot;&gt;[MYTwitterUserProfileViewController alloc]&lt;/span&gt; initWithViewModel:  userProfileViewModel]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ‰æ—¶ä½ æ— æ³•åœ¨åˆå§‹åŒ–æ—¶å°† view-model ä¼ å…¥, æ¯”å¦‚åœ¨ storyboard segue æˆ– cell dequeuing çš„æƒ…å†µä¸‹. è¿™æ—¶ä½ åº”è¯¥åœ¨è®¨è®ºä¸­çš„è§†å›¾(æ§åˆ¶å™¨)ä¸­æš´éœ²ä¸€ä¸ªå…¬æœ‰å¯å†™çš„ view-model å±æ€§.   &lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MYTwitterUserCell *cell =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.tableView &lt;span class=&quot;string&quot;&gt;dequeueReusableCellWithIdentifier:&lt;/span&gt; @&lt;span class=&quot;string&quot;&gt;&quot;MYTwitterUserCell&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;forIndexPath:&lt;/span&gt; indexPath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// grab the cell view-model from the vc view-model and assign it&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cell.viewModel = self.viewModel. tweets[indexPath. row];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ‰æ—¶æˆ‘ä»¬å¯ä»¥åœ¨é’©å­ç¨‹åºè°ƒç”¨å‰ä¼ å…¥ view-model,  æ¯”å¦‚ &lt;code&gt;init&lt;/code&gt; å’Œ &lt;code&gt;viewDidLoad&lt;/code&gt;,  æˆ‘ä»¬å¯ä»¥ä»view-model çš„å±æ€§åˆå§‹åŒ–æ‰€æœ‰ UI å…ƒç´ çš„çŠ¶æ€.   &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//dontDoThis1.m &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;) initWithViewModel:(MYTwitterLookupViewModel *) viewModel &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _viewModel = viewModel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) viewDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewDidLoad];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _goButton.enabled = viewModel.isUsernameValid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _goButton.alpha = viewModel.isUsernameValid ? &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// etc&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¥½æ£’!æˆ‘ä»¬å·²ç»é…ç½®å¥½äº†åˆå§‹å€¼. å½“ view-model ä¸Šçš„æ•°æ®æ”¹å˜æ—¶æ€ä¹ˆåŠ? å½“â€goâ€ æŒ‰é’®åœ¨ä»€ä¹ˆæ—¶å€™å¯ç”¨äº†æ€ä¹ˆåŠ?å½“ç”¨æˆ·æ ‡ç­¾å’Œå¤´åƒåœ¨ä»€ä¹ˆæ—¶å€™ä»ç½‘ç»œä¸Šä¸‹è½½å¹¶å¡«å……äº†æ€ä¹ˆåŠ?  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å°†è§†å›¾æ§åˆ¶å™¨æš´éœ²ç»™ view-model,  ä»¥ä¾¿äºå½“ç›¸å…³æ•°æ®å˜åŒ–æˆ–ç±»ä¼¼äº‹ä»¶å‘é€æ—¶å®ƒå¯ä»¥è°ƒç”¨ä¸€ä¸ª â€œupdateUIâ€ æ–¹æ³•. (åˆ«è¿™ä¹ˆå¹². )åœ¨ view-model ä¸Šå°†è§†å›¾æ§åˆ¶å™¨ä½œä¸ºä¸€ä¸ªå§”æ‰˜?å½“ view-model å†…å®¹æœ‰å˜åŒ–æ—¶å‘ä¸ªé€šçŸ¥?(ä¸ä¸ä¸ä¸. )&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„è§†å›¾æ§åˆ¶å™¨ä¼šæ„ŸçŸ¥ä¸€äº›å˜åŒ–çš„å‘ç”Ÿ. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä» &lt;code&gt;UITextfield&lt;/code&gt; å¾—æ¥çš„å§”æ‰˜æ–¹æ³•åœ¨æ¯å½“æœ‰å­—ç¬¦å˜åŒ–æ—¶é€šè¿‡æ£€æŸ¥ view-model æ¥æ›´æ–°æŒ‰é’®çš„çŠ¶æ€.   &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//dontDoThisEither.m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)textFieldDidChange:(&lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *)sender &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// update the view-model&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel.username = sender.text;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// check if things are now valid&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton.enabled = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel.isUsernameValid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton.alpha = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel.isUsernameValid ? &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•è§£å†³çš„åœºæ™¯æ˜¯åœ¨åªæœ‰å†æ–‡æœ¬æ¡†å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šå½±å“ view-model ä¸­çš„ &lt;code&gt;isUsernameValid&lt;/code&gt; å€¼. å‡ä½¿è¿˜æœ‰å…¶ä»–å˜é‡/åŠ¨ä½œæ”¹å˜ &lt;code&gt;isUsernameValid&lt;/code&gt; çš„çŠ¶æ€å°†ä¼šæ€ä¹ˆæ ·?å¯¹äº view-model ä¸­çš„ç½‘ç»œè°ƒç”¨ä¼šæ€ä¹ˆæ ·?æˆ–è®¸æˆ‘ä»¬è¯¥ä¸º view-model ä¸Šçš„æ–¹æ³•åŠ ä¸€ä¸ªå®Œæˆåå›è°ƒå¤„ç†, è¿™æ ·æˆ‘ä»¬æ­¤æ—¶å°±å¯ä»¥æ›´æ–° UI çš„ä¸€åˆ‡ä¸œè¥¿äº†?ä½¿ç”¨çè´µè€Œç¬¨é‡çš„ KVO æ–¹æ³•æ€ä¹ˆæ ·?&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æˆ–è®¸æœ€ç»ˆä½¿ç”¨å¤šç§å¤šæ ·æˆ‘ä»¬ç†Ÿæ‚‰çš„æœºåˆ¶å°† view-model å’Œè§†å›¾æ§åˆ¶å™¨æ‰€æœ‰çš„æ¥è§¦ç‚¹éƒ½è¿èµ·æ¥, ä½†ä½ å·²ç»çŸ¥é“äº†&lt;a href=&quot;http://www.sprynthesis.com/2014/06/15/why-reactivecocoa/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ ‡é¢˜ä¸Šä¸æ˜¯è¿™ä¹ˆå†™çš„&lt;/a&gt;. è¿™æ ·åœ¨ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡çš„å…¥å£ç‚¹, ä»…ä»…ä¸ºäº†ç®€å•çš„æ›´æ–° UI å°±è¦åœ¨ä»£ç ä¸­å®Œå…¨é‡æ–°åˆ›å»ºåº”ç”¨çŠ¶æ€ä¸Šä¸‹æ–‡. &lt;/p&gt;
&lt;h2 id=&quot;è¿›å…¥-ReactiveCocoa&quot;&gt;&lt;a href=&quot;#è¿›å…¥-ReactiveCocoa&quot; class=&quot;headerlink&quot; title=&quot;è¿›å…¥ ReactiveCocoa&quot;&gt;&lt;/a&gt;è¿›å…¥ ReactiveCocoa&lt;/h2&gt;&lt;p&gt;ReactiveCocoa(RAC) æ˜¯æ¥æ‹¯æ•‘æˆ‘ä»¬çš„, å¹¶æ°å¥½è¿”å›ç»™æˆ‘ä»¬ä¸€ç‚¹ç†æ™º. è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åšåˆ°.   &lt;/p&gt;
&lt;p&gt;æ€è€ƒåœ¨ä¸€ä¸ªæ–°çš„ç”¨æˆ·é¡µé¢ä¸Šæ§åˆ¶ä¿¡æ¯çš„æµåŠ¨, å½“è¡¨å•åˆæ³•æ—¶æ›´æ–°æäº¤æŒ‰é’®çš„çŠ¶æ€. ä½ ç°åœ¨å¯èƒ½ä¼šç…§ä¸‹é¢è¿™ä¹ˆåš:   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/new-user-form-imperative.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;ä½ æœ€åé€šè¿‡ä½¿ç”¨çŠ¶æ€, å°å¿ƒç¿¼ç¿¼åœ°ä»£ç ä¸­è®¸å¤šä¸åŒä¸”é›¶ç¢æ— å…³çš„å†…å®¹ç©¿åˆ°ç®€å•çš„é€»è¾‘ä¸Š. çœ‹çœ‹ä½ ä¿¡æ¯æµä¸­æ‰€æœ‰ä¸åŒçš„å…¥å£ç‚¹?(è¿™è¿˜åªæ˜¯&lt;em&gt;ä¸€ä¸ª&lt;/em&gt; UI å…ƒç´ ä¸­çš„&lt;em&gt;ä¸€æ¡&lt;/em&gt;é€»è¾‘çº¿. )&lt;a href=&quot;http://www.sprynthesis.com/2014/06/15/why-reactivecocoa/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æˆ‘ä»¬ç¨‹åºä¸­ç°åœ¨ç”¨çš„æŠ½è±¡æ¦‚å¿µè¿˜ä¸å¤Ÿå‰å®³&lt;/a&gt;, ä¸èƒ½ä¸ºæˆ‘ä»¬è¿½è¸ªæ‰€æœ‰äº‹ç‰©çš„å…³ç³», æ‰€ä»¥æˆ‘ä»¬åœæ­¢è‡ªå·±å»å¹²è¿™è›‹ç–¼äº‹å„¿.   &lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹é™ˆè¿°ç‰ˆæœ¬: &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/new-user-form-declarative.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;è¿™çœ‹èµ·æ¥å¯èƒ½åƒæ˜¯ä¸ºæˆ‘ä»¬åº”ç”¨æµç¨‹æ–‡æ¡£ä¸­çš„ä¸€å¼ è€æ—§çš„è®¡ç®—æœºç§‘å­¦å›¾è§£. é€šè¿‡é™ˆè¿°å¼çš„ç¼–ç¨‹, æˆ‘ä»¬ä½¿ç”¨äº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡, æ¥è®©æˆ‘ä»¬å®é™…ç¼–ç¨‹æ›´é è¿‘æˆ‘ä»¬åœ¨è„‘æµ·ä¸­è®¾è®¡æµç¨‹çš„æ–¹å¼. æˆ‘ä»¬è®©ç”µè„‘ä¸ºæˆ‘ä»¬åšæ›´å¤šå·¥ä½œ. å®é™…çš„ä»£ç æ›´åŠ åƒè¿™å¹…å›¾äº†.   &lt;/p&gt;
&lt;h3 id=&quot;RACSignal&quot;&gt;&lt;a href=&quot;#RACSignal&quot; class=&quot;headerlink&quot; title=&quot;RACSignal&quot;&gt;&lt;/a&gt;RACSignal&lt;/h3&gt;&lt;p&gt;&lt;code&gt;RACSignal&lt;/code&gt; (ä¿¡å·)å°± RAC æ¥è¯´æ˜¯æ„é€ å•å…ƒ. å®ƒä»£è¡¨æˆ‘ä»¬æœ€ç»ˆå°†è¦æ”¶åˆ°çš„ä¿¡æ¯. å½“ä½ èƒ½å°†æœªæ¥æŸæ—¶åˆ»æ”¶åˆ°çš„æ¶ˆæ¯å…·ä½“è¡¨ç¤ºå‡ºæ¥æ—¶, &lt;strong&gt;ä½ å¯ä»¥å¼€å§‹é¢„å…ˆ(é™ˆè¿°æ€§)è¿ç”¨é€»è¾‘å¹¶æ„å»ºä½ çš„ä¿¡æ¯æµ,&lt;/strong&gt;è€Œä¸æ˜¯å¿…é¡»ç­‰åˆ°äº‹ä»¶å‘ç”Ÿ(å‘½ä»¤å¼).   &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¿¡å·ä¼šä¸ºäº†æ§åˆ¶é€šè¿‡åº”ç”¨çš„ä¿¡æ¯æµè€Œè·å¾—æ‰€æœ‰è¿™äº›å¼‚æ­¥æ–¹æ³•(å§”æ‰˜, å›è°ƒ block,  é€šçŸ¥,  KVO, target/action äº‹ä»¶è§‚å¯Ÿ, ç­‰)å¹¶å°†å®ƒä»¬ç»Ÿä¸€åˆ°ä¸€ä¸ªæ¥å£ä¸‹.&lt;/strong&gt;è¿™åªæ˜¯ç›´è§‚ç†è§£. ä¸ä»…æ˜¯è¿™äº›, å› ä¸ºä¿¡æ¯ä¼šæµè¿‡ä½ çš„åº”ç”¨, å®ƒè¿˜æä¾›ç»™ä½ è½»æ¾è½¬æ¢/åˆ†è§£/åˆå¹¶/è¿‡æ»¤ä¿¡æ¯çš„èƒ½åŠ›.   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/replace-async-tools.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;h4 id=&quot;é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¿¡å·å‘¢-è¿™æ˜¯ä¸€ä¸ªä¿¡å·&quot;&gt;&lt;a href=&quot;#é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¿¡å·å‘¢-è¿™æ˜¯ä¸€ä¸ªä¿¡å·&quot; class=&quot;headerlink&quot; title=&quot;é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¿¡å·å‘¢?è¿™æ˜¯ä¸€ä¸ªä¿¡å·:&quot;&gt;&lt;/a&gt;é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¿¡å·å‘¢?è¿™æ˜¯ä¸€ä¸ªä¿¡å·:&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/signal-no-subscribers.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;ä¿¡å·æ˜¯ä¸€ä¸ªå‘é€ä¸€è¿ä¸²å€¼çš„ç‰©ä½“. ä½†æ˜¯æˆ‘ä»¬è¿™å„¿çš„ä¿¡å·å•¥ä¹Ÿä¸å¹², å› ä¸ºå®ƒè¿˜æ²¡æœ‰è®¢é˜…è€…. å¦‚æœæœ‰è®¢é˜…è€…ç›‘å¬æ—¶(å·²è®¢é˜…)ä¿¡å·æ‰ä¼šå‘ä¿¡æ¯. å®ƒå°†ä¼šå‘é‚£ä¸ªè®¢é˜…è€…å‘é€0æˆ–å¤šä¸ªè½½æœ‰æ•°å€¼çš„â€nextâ€äº‹ä»¶, åé¢è·Ÿç€ä¸€ä¸ªâ€completeâ€äº‹ä»¶æˆ–ä¸€ä¸ªâ€errorâ€äº‹ä»¶. (ä¿¡å·ç±»ä¼¼äºå…¶ä»–è¯­è¨€/å·¥å…·åŒ…ä¸­çš„ â€œpromiseâ€, ä½†æ›´å¼ºå¤§, å› ä¸ºå®ƒä¸ä»…é™äºå‘å®ƒçš„è®¢é˜…è€…ä¸€æ¬¡åªä¼ é€’ä¸€ä¸ªè¿”å›å€¼. )  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/signal-with-subscriber.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„, å¦‚æœè§‰å¾—éœ€è¦çš„è¯ä½ å¯ä»¥è¿‡æ»¤, è½¬æ¢, åˆ†è§£å’Œåˆå¹¶é‚£äº›å€¼. ä¸åŒçš„è®¢é˜…è€…å¯èƒ½éœ€è¦ä½¿ç”¨ä¿¡å·é€šè¿‡ä¸åŒæ–¹å¼å‘é€çš„å€¼.   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/signal-map.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;h4 id=&quot;ä¿¡å·å‘é€çš„å€¼æ˜¯ä»å“ªè·å¾—çš„&quot;&gt;&lt;a href=&quot;#ä¿¡å·å‘é€çš„å€¼æ˜¯ä»å“ªè·å¾—çš„&quot; class=&quot;headerlink&quot; title=&quot;ä¿¡å·å‘é€çš„å€¼æ˜¯ä»å“ªè·å¾—çš„?&quot;&gt;&lt;/a&gt;ä¿¡å·å‘é€çš„å€¼æ˜¯ä»å“ªè·å¾—çš„?&lt;/h4&gt;&lt;p&gt;ä¿¡å·æ˜¯ä¸€äº›ç­‰å¾…æŸäº‹å‘ç”Ÿçš„å¼‚æ­¥ä»£ç , ç„¶åæŠŠç»“æœå€¼å‘é€ç»™å®ƒä»¬çš„è®¢é˜…è€…. ä½ å¯ä»¥ç”¨ &lt;code&gt;RACSignal&lt;/code&gt; çš„ç±»æ–¹æ³• &lt;code&gt;createSignal:&lt;/code&gt; æ‰‹åŠ¨åˆ›å»ºä¿¡å·:   &lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//networkSignal.m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *networkSignal = [RACSignal &lt;span class=&quot;string&quot;&gt;createSignal:&lt;/span&gt;^RACDisposable *(id&amp;lt;RACSubscriber&amp;gt; subscriber) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NetworkOperation *operation = [NetworkOperation &lt;span class=&quot;string&quot;&gt;getJSONOperationForURL:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;http://someurl&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [operation &lt;span class=&quot;string&quot;&gt;setCompletionBlockWithSuccess:&lt;/span&gt;^(NetworkOperation *theOperation, id *result) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [subscriber &lt;span class=&quot;string&quot;&gt;sendNext:&lt;/span&gt;result];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [subscriber sendCompleted];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;string&quot;&gt;failure:&lt;/span&gt;^(NetworkOperation *theOperation, NSError *error) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [subscriber &lt;span class=&quot;string&quot;&gt;sendError:&lt;/span&gt;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘åœ¨è¿™ç”¨ä¸€ä¸ªå…·æœ‰æˆåŠŸå’Œå¤±è´¥ block (ä¼ªé€ )çš„ç½‘ç»œæ“ä½œåˆ›å»ºäº†ä¸€ä¸ªä¿¡å·. (å¦‚æœæˆ‘æƒ³è®©ä¿¡å·åœ¨è¢«è®¢é˜…æ—¶æ‰è®©ç½‘ç»œè¯·æ±‚å‘ç”Ÿ, è¿˜å¯ä»¥ç”¨ &lt;code&gt;RACSignal&lt;/code&gt; çš„ç±»æ–¹æ³• &lt;code&gt;defer&lt;/code&gt;. )æˆ‘åœ¨æˆåŠŸçš„ block é‡Œä½¿ç”¨æä¾›çš„ &lt;code&gt;subscriber&lt;/code&gt; å¯¹è±¡è°ƒç”¨ &lt;code&gt;sendNext:&lt;/code&gt; å’Œ &lt;code&gt;sendCompleted:&lt;/code&gt; æ–¹æ³•, æˆ–åœ¨å¤±è´¥çš„ block ä¸­è°ƒç”¨ &lt;code&gt;sendError:&lt;/code&gt;. ç°åœ¨æˆ‘å¯ä»¥è®¢é˜…è¿™ä¸ªä¿¡å·å¹¶å°†åœ¨å“åº”è¿”å›æ—¶æ¥æ”¶åˆ° json å€¼æˆ–æ˜¯ error.   &lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯,  RAC çš„åˆ›é€ è€…å®é™…ä¸Šä½¿ç”¨å®ƒä»¬è‡ªå·±çš„åº“æ¥åˆ›å»ºçœŸçš„äº‹ç‰©(æ‰æ‘¸ä¸€ä¸‹), æ‰€ä»¥å¯¹äºæˆ‘ä»¬åœ¨æ—¥å¸¸éœ€è¦ä»€ä¹ˆ, ä»–ä»¬æœ‰å¾ˆå¼ºçƒˆçš„æƒ³æ³•. ä»–ä»¬ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šæœºåˆ¶, æ¥ä»æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ç°å­˜çš„å¼‚æ­¥æ¨¡å¼ä¸­æ‹‰å–ä¿¡å·. åˆ«å¿˜äº†å¦‚æœä½ æœ‰ä¸€ä¸ªæ²¡æœ‰è¢«æŸä¸ªå†…å»ºä¿¡å·è¦†ç›–åˆ°çš„å¼‚æ­¥ä»»åŠ¡, ä½ å¯ä»¥&lt;em&gt;å¾ˆå®¹æ˜“åœ°&lt;/em&gt;ç”¨ &lt;code&gt;createSignal:&lt;/code&gt; æˆ–ç±»ä¼¼æ–¹æ³•æ¥åˆ›å»ºä¿¡å·.   &lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè¢«æä¾›çš„æœºåˆ¶å°±æ˜¯ &lt;code&gt;RACObserve()&lt;/code&gt; å®. (å¦‚æœä½ ä¸å–œæ¬¢å®, ä½ å¯ä»¥ç®€å•åœ°çœ‹çœ‹ç½©å­ä¸‹é¢å¹¶ç”¨ç¨å¾®å¤šäº›å†—æ‚çš„æè¿°. è¿™ä¹Ÿéå¸¸å¥½. åœ¨æˆ‘ä»¬å¾—åˆ° &lt;a href=&quot;https://github.com/ReactiveCocoa/ReactiveCocoa/pull/1382&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Swift ç‰ˆæœ¬çš„æ›¿ä»£&lt;/a&gt;ä¹‹å‰, è¿™ä¹Ÿæœ‰&lt;a href=&quot;http://blog.scottlogic.com/2014/07/24/mvvm-reactivecocoa-swift.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åœ¨ Swift ä¸­ä½¿ç”¨ RAC&lt;/a&gt; çš„è§£å†³æ–¹æ¡ˆ. )è¿™ä¸ªå®æ˜¯ RAC ä¸­å¯¹ KVO ä¸­é‚£äº›æ‚²æƒ¨çš„ API çš„æ›¿ä»£. ä½ åªéœ€è¦ä¼ å…¥å¯¹è±¡å’Œä½ æƒ³è§‚å¯Ÿçš„é‚£ä¸ªå¯¹è±¡æŸå±æ€§çš„ keypath. ç»™å‡ºè¿™äº›å‚æ•°å,  &lt;code&gt;RACObserve&lt;/code&gt; ä¼šåˆ›å»ºä¸€ä¸ªä¿¡å·, ä¸€æ—¦å®ƒæœ‰äº†è®¢é˜…è€…, å®ƒå°±ç«‹åˆ»å‘é€é‚£ä¸ªå±æ€§çš„å½“å‰å€¼, å¹¶åœ¨å‘é€é‚£ä¸ªå±æ€§åœ¨è¿™ä¹‹åçš„ä»»ä½•å˜åŒ–.   &lt;/p&gt;
&lt;figure class=&quot;highlight lisp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *usernameValidSignal = RACObserve(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;.viewModel,  usernameIsValid)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/signal-racobserve.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;è¿™ä»…æ˜¯æä¾›ç”¨äºåˆ›å»ºä¿¡å·çš„ä¸€ä¸ªå·¥å…·. è¿™é‡Œæœ‰å‡ ä¸ªç«‹å³å¯ç”¨çš„æ–¹å¼, æ¥ä»å†…ç½®æ§åˆ¶æµæœºåˆ¶ä¸­æ‹‰å–ä¿¡å·:   &lt;/p&gt;
&lt;figure class=&quot;highlight xquery&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//signals.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *controlUpdate = [myButton rac_signalForControlEvents:UIControlEventTouchUpInside];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // signals &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; UIControl events send the control event &lt;span class=&quot;keyword&quot;&gt;value&lt;/span&gt; (UITextField, UIButton, UISlider, etc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // subscribeNext:^(UIButton *button) &amp;#123; NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;%@&quot;&lt;/span&gt;, button); // UIButton instance &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *textChange = [myTextField rac_textSignal];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // &lt;span class=&quot;keyword&quot;&gt;some&lt;/span&gt; special methods are provided &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; commonly needed control event values off certain controls&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // subscribeNext:^(UITextField *textfield) &amp;#123; NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;%@&quot;&lt;/span&gt;, textfield.text); // &lt;span class=&quot;string&quot;&gt;&quot;Hello!&quot;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *alertButtonClicked = [myAlertView rac_buttonClickedSignal];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // signals &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;some&lt;/span&gt; delegate methods send the delegate params &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // e.g. UIAlertView, UIActionSheet, UIImagePickerControl, etc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // (limited &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; methods that &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; void)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // subscribeNext:^(NSNumber *buttonIndex) &amp;#123; NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;%@&quot;&lt;/span&gt;, buttonIndex); // &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *viewAppeared = [self rac_signalForSelector:@selector(viewDidAppear:)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // signals &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; arbitrary selectors that &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; void, send the method params &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // works &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; built &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; or your own methods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // subscribeNext:^(NSNumber *animated) &amp;#123; NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;viewDidAppear %@&quot;&lt;/span&gt;, animated); // &lt;span class=&quot;string&quot;&gt;&quot;viewDidAppear 1&quot;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è®°ä½ä½ ä¹Ÿèƒ½è½»æ¾åˆ›å»ºè‡ªå·±çš„ä¿¡å·, åŒ…æ‹¬&lt;a href=&quot;http://spin.atomicobject.com/2014/02/03/objective-c-delegate-pattern/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ›¿ä»£é‚£äº›æ²¡æœ‰å†…å»ºæ”¯æŒçš„å…¶ä»–å§”æ‰˜&lt;/a&gt;. æˆ‘ä»¬ç°åœ¨èƒ½å¤Ÿä»æ‰€æœ‰è¿™äº›ä¸è¿è´¯çš„å¼‚æ­¥/æ§åˆ¶æµå·¥å…·ä¸­æ‹‰å–å‡ºä¿¡å·å¹¶å°†ä»–ä»¬åˆå¹¶, è¯•æƒ³æƒ³è¿™è¯¥å¤šé…·!è¿™äº›ä¼šæˆä¸ºæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é™ˆè¿°æ€§å›¾è¡¨ä¸­çš„èŠ‚ç‚¹. çœŸæ˜¯å…´å¥‹. &lt;/p&gt;
&lt;h4 id=&quot;ä»€ä¹ˆæ˜¯è®¢é˜…è€…&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯è®¢é˜…è€…&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯è®¢é˜…è€…?&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯è®¢é˜…è€…?&lt;/h4&gt;&lt;p&gt;ç®€è¨€ä¹‹, è®¢é˜…è€…å°±æ˜¯ä¸€æ®µä»£ç , å®ƒç­‰å¾…ä¿¡å·ç»™å®ƒå‘é€ä¸€äº›å€¼, ç„¶åè®¢é˜…è€…å°±èƒ½å¤„ç†è¿™äº›å€¼äº†. (å®ƒä¹Ÿå¯ä»¥ä½œç”¨äº â€œcompleteâ€ å’Œ â€œerrorâ€ äº‹ä»¶. )&lt;/p&gt;
&lt;p&gt;è¿™æœ‰ä¸€ä¸ªç®€å•çš„è®¢é˜…è€…, æ˜¯é€šè¿‡å‘ä¿¡å·çš„å®ä¾‹æ–¹æ³• &lt;code&gt;subscribeNext&lt;/code&gt; ä¼ å…¥ä¸€ä¸ª block æ¥åˆ›å»ºçš„. æˆ‘ä»¬åœ¨è¿™é€šè¿‡ &lt;code&gt;RACObserve()&lt;/code&gt; å®åˆ›å»ºä¿¡å·æ¥è§‚å¯Ÿä¸€ä¸ªå¯¹è±¡ä¸Šå±æ€§çš„å½“å‰å€¼, å¹¶æŠŠå®ƒèµ‹å€¼ç»™ä¸€ä¸ªå†…éƒ¨å±æ€§.   &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) viewDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// . . . &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// create and get a reference to the signal&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RACSignal *usernameValidSignal = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  isUsernameValid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// update the local property when this value changes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [usernameValidSignal subscribeNext: ^(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *isValidNumber) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.usernameIsValid = isValidNumber. boolValue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ RAC åªå¤„ç†å¯¹è±¡, è€Œä¸å¤„ç†åƒ &lt;code&gt;BOOL&lt;/code&gt; è¿™æ ·çš„åŸå§‹å€¼. ä¸è¿‡ä¸ç”¨æ‹…å¿ƒ,  RAC é€šå¸¸ä¼šå¸®ä½ è¿™äº›è½¬æ¢.   &lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ RAC çš„åˆ›é€ è€…ä¹Ÿæ„è¯†åˆ°è¿™ç§ç»‘å®šè¡Œä¸ºçš„æ™®éå¿…è¦æ€§, æ‰€ä»¥ä»–ä»¬æä¾›äº†å¦ä¸€ä¸ªå® &lt;code&gt;RAC()&lt;/code&gt;.  ä¸ &lt;code&gt;RACObserve()&lt;/code&gt; ç›¸åŒ, ä½ æä¾›æƒ³è¦ä¸å³å°†åˆ°æ¥çš„å€¼ç»‘å®šçš„å¯¹è±¡å’Œå‚æ•°, åœ¨å…¶å†…éƒ¨å®ƒæ‰€åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…å¹¶æ›´æ–°å…¶å±æ€§çš„å€¼. æˆ‘ä»¬çš„ä¾‹å­ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:   &lt;/p&gt;
&lt;figure class=&quot;highlight gcode&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- &lt;span class=&quot;comment&quot;&gt;(void)&lt;/span&gt; viewDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//. . . &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC&lt;span class=&quot;comment&quot;&gt;(self,  usernameIsValid)&lt;/span&gt; = RACObserve&lt;span class=&quot;comment&quot;&gt;(self.viewModel,  isUsernameValid)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è€ƒè™‘ä¸‹æˆ‘ä»¬çš„ç›®æ ‡, è¿™ä¹ˆå¹²æœ‰ç‚¹å‚»å•Š. æˆ‘ä»¬ä¸éœ€è¦å°†ä¿¡å·å‘é€çš„å€¼å­˜åˆ°å±æ€§ä¸­(è¿™ä¼šåˆ›å»ºçŠ¶æ€), æˆ‘ä»¬çœŸæ­£è¦åšçš„æ˜¯ç”¨ä»é‚£ä¸ªå€¼è·å–åˆ°ä¿¡æ¯æ¥æ›´æ–° UI. &lt;/p&gt;
&lt;h4 id=&quot;è½¬æ¢æ•°æ®æµ&quot;&gt;&lt;a href=&quot;#è½¬æ¢æ•°æ®æµ&quot; class=&quot;headerlink&quot; title=&quot;è½¬æ¢æ•°æ®æµ&quot;&gt;&lt;/a&gt;è½¬æ¢æ•°æ®æµ&lt;/h4&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬è¿›å…¥ RAC ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºè½¬æ¢æ•°å€¼æµçš„æ–¹æ³•. æˆ‘ä»¬å°†ä¼šåˆ©ç”¨ &lt;code&gt;RACSignal&lt;/code&gt; çš„å®ä¾‹æ–¹æ³• &lt;code&gt;map&lt;/code&gt;. &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//transformingStreams.m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) viewDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RACSignal *usernameIsValidSignal = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel, isUsernameValid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton, enabled) = usernameIsValidSignal;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton, alpha) = [usernameIsValidSignal&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *usernameIsValid) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; usernameIsValid.boolValue ? @&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt; : @&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·ç°åœ¨æˆ‘ä»¬å°† view-model ä¸Šçš„ &lt;code&gt;isUsernameValid&lt;/code&gt; å‘ç”Ÿçš„å˜åŒ–ç›´æ¥ç»‘å®šåˆ° &lt;code&gt;goButton&lt;/code&gt; çš„ &lt;code&gt;enabled&lt;/code&gt; å±æ€§ä¸Š. é…·å§?å¯¹ &lt;code&gt;alpha&lt;/code&gt; çš„ç»‘å®šæ›´é…·, å› ä¸ºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ &lt;code&gt;map&lt;/code&gt; æ–¹æ³•å°†å€¼è½¬æ¢æˆä¸ &lt;code&gt;alpha&lt;/code&gt; å±æ€§ç›¸å…³çš„å€¼. (æ³¨æ„åœ¨è¿™é‡Œæˆ‘ä»¬è¿”å›çš„æ˜¯ä¸€ä¸ª &lt;code&gt;NSNumber&lt;/code&gt; å¯¹è±¡è€Œä¸æ˜¯åŸå§‹floatå€¼. è¿™åŸºæœ¬ä¸Šæ˜¯å”¯ä¸€çš„æ±¡ç‚¹: ä½ éœ€è¦è´Ÿè´£ä¸º RAC å°†åŸå§‹å€¼è½¬åŒ–ä¸ºå¯¹è±¡, å› ä¸ºå®ƒä¸èƒ½å¸®ä½ å¯¼å‡ºæ¥.   &lt;/p&gt;
&lt;h3 id=&quot;å¤šä¸ªè®¢é˜…è€…-å‰¯ä½œç”¨-æ˜‚è´µçš„æ“ä½œ&quot;&gt;&lt;a href=&quot;#å¤šä¸ªè®¢é˜…è€…-å‰¯ä½œç”¨-æ˜‚è´µçš„æ“ä½œ&quot; class=&quot;headerlink&quot; title=&quot;å¤šä¸ªè®¢é˜…è€…, å‰¯ä½œç”¨, æ˜‚è´µçš„æ“ä½œ&quot;&gt;&lt;/a&gt;å¤šä¸ªè®¢é˜…è€…, å‰¯ä½œç”¨, æ˜‚è´µçš„æ“ä½œ&lt;/h3&gt;&lt;p&gt;è®¢é˜…ä¿¡å·é“¾æ—¶è¦æ˜ç™½é‡è¦çš„ä¸€ä»¶äº‹æ˜¯æ¯å½“ä¸€ä¸ªæ–°å€¼é€šè¿‡ä¿¡å·é“¾è¢«å‘é€å‡ºå»æ—¶, å®é™…ä¸Šä¼šç»™æ¯ä¸ªè®¢é˜…è€…éƒ½å‘é€ä¸€æ¬¡. ç›´åˆ°æ„è¯†åˆ°è¿™å°±æˆ‘ä»¬è€Œè¨€æ˜¯æœ‰æ„ä¹‰çš„, ä¿¡å·å‘å‡ºçš„å€¼ä¸å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹(é™¤äº† RAC åœ¨å†…éƒ¨å®ç°ä¸­). å½“ä¿¡å·éœ€è¦å‘é€ä¸€ä¸ªæ–°çš„å€¼æ—¶, å®ƒä¼šéå†æ‰€æœ‰çš„è®¢é˜…è€…å¹¶ç»™æ¯ä¸ªè®¢é˜…è€…å‘é€é‚£ä¸ªå€¼. (è¿™æ˜¯å¯¹ä¿¡å·é“¾å®é™…å·¥ä½œçš„ç®€åŒ–è¯´æ˜, ä½†åŸºæœ¬æƒ³æ³•æ˜¯å¯¹çš„)  &lt;/p&gt;
&lt;p&gt;è¿™ä¸ºä»€ä¹ˆé‡è¦?è¿™æ„å‘³ç€ä¿¡å·é“¾æŸå¤„å­˜åœ¨çš„ä»»ä½•å‰¯ä½œç”¨, ä»»ä½•å½±å“åº”ç”¨ä¸–ç•Œçš„è½¬å˜, å°†ä¼šå‘ç”Ÿå¤šæ¬¡. è¿™å¯¹æ–°æ¥è§¦ RAC çš„ç”¨æˆ·æ¥è¯´æ˜¯æ„æƒ³ä¸åˆ°çš„. (è¿™ä¹Ÿè¿åäº†å‡½æ•°å¼æ„å»ºçš„ç†å¿µ-æ•°æ®è¾“å…¥, æ•°æ®è¾“å‡º).   &lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªåšä½œçš„ä¾‹å­å¯èƒ½æ˜¯: ä¿¡å·é“¾æŸå¤„çš„ä¿¡å·åœ¨æ¯æ¬¡æŒ‰é’®è¢«æŒ‰ä¸‹æ—¶æ›´æ–° &lt;code&gt;self&lt;/code&gt; ä¸­çš„ä¸€ä¸ªè®¡æ•°å™¨å±æ€§. å¦‚æœä¿¡å·é“¾æœ‰å¤šä¸ªè®¢é˜…è€…, è®¡æ•°å™¨çš„å¢é•¿å°†ä¼šæ¯”ä½ æƒ³çš„è¿˜è¦å¤š. ä½ éœ€è¦åŠªåŠ›ä»ä¿¡å·é“¾ä¸­å°½å¯èƒ½å‰”é™¤å‰¯ä½œç”¨. å½“å‰¯ä½œç”¨ä¸å¯é¿å…æ—¶, ä½ å¯ä»¥ä½¿ç”¨ä¸€äº›æ°å½“çš„é¢„é˜²æœºåˆ¶. æˆ‘å°†ä¼šåœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­æ¢ç´¢.   &lt;/p&gt;
&lt;p&gt;é™¤å‰¯ä½œç”¨ä¹‹å¤–, ä½ éœ€è¦æ³¨æ„å¸¦æœ‰æ˜‚è´µæ“ä½œå’Œå¯å˜æ•°æ®çš„ä¿¡å·é“¾. ç½‘ç»œè¯·æ±‚å°±æ˜¯ä¸€ä¸ªä¸‰è€…å…¼å¾—çš„ä¾‹å­:   &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç½‘ç»œè¯·æ±‚å½±å“äº†åº”ç”¨çš„ç½‘ç»œå±‚(å‰¯ä½œç”¨). &lt;/li&gt;
&lt;li&gt;ç½‘ç»œè¯·æ±‚ä¸ºä¿¡å·é“¾å¼•å…¥äº†å¯å˜æ•°æ®. (ä¸¤ä¸ªå®Œå…¨ä¸€æ ·è¯·æ±‚å¯èƒ½è¿”å›äº†ä¸åŒçš„æ•°æ®. )&lt;/li&gt;
&lt;li&gt;ç½‘ç»œè¯·æ±‚ååº”æ…¢å•Š. &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚, ä½ å¯èƒ½æœ‰ä¸ªä¿¡å·åœ¨æ¯æ¬¡æŒ‰é’®æŒ‰ä¸‹æ—¶å‘é€ä¸€ä¸ªå€¼, è€Œä½ æƒ³å°†è¿™ä¸ªå€¼è½¬æ¢æˆç½‘ç»œè¯·æ±‚çš„ç»“æœ. å¦‚æœæœ‰å¤šä¸ªè®¢é˜…è€…è¦è¿™ä¸ªå¤„ç†ä¿¡å·é“¾ä¸Šè¿”å›çš„è¿™ä¸ªå€¼, ä½ å°†å‘èµ·å¤šä¸ªç½‘ç»œè¯·æ±‚.   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/signal-side-effect.svg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;ç½‘ç»œè¯·æ±‚æ˜æ˜¾æ˜¯ç»å¸¸éœ€è¦çš„. æ­£å¦‚ä½ æ‰€æœŸæœ›,  RAC æä¾›è¿™äº›æƒ…å†µçš„è§£å†³æ–¹æ¡ˆ, ä¹Ÿå°±æ˜¯ &lt;code&gt;RACCommand&lt;/code&gt; å’Œå¤šç‚¹å¹¿æ’­. æˆ‘å°†ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æ›´æ·±å…¥åœ°åˆ†æ.   &lt;/p&gt;
&lt;h2 id=&quot;Tweetboat-Plus&quot;&gt;&lt;a href=&quot;#Tweetboat-Plus&quot; class=&quot;headerlink&quot; title=&quot;Tweetboat Plus&quot;&gt;&lt;/a&gt;Tweetboat Plus&lt;/h2&gt;&lt;p&gt;æ—¢ç„¶ç®€çŸ­çš„ä»‹ç»(å—¯å“¼)æ‰¯è¿œäº†, è®©æˆ‘ä»¬ç€çœ¼äºå¦‚ä½•ç”¨ ReactiveCocoa å°† view-model ä¸è§†å›¾æ§åˆ¶å™¨è¿æ¥èµ·æ¥. &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// View Controller&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) viewDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewDidLoad];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  username) = [myTextfield rac_textSignal];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RACSignal *usernameIsValidSignal = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  usernameValid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton,  alpha) = [usernameIsValidSignal&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        map:  ^(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *valid) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; valid. boolValue ? @&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; :  @&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton,  enabled) = usernameIsValidSignal;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.avatarImageView,  image) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  userAvatarImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.userNameLabel,  text) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  userFullName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @weakify(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[[RACSignal merge: @[RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  tweets), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  allTweetsLoaded)]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        bufferWithTime: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; onScheduler: [RACScheduler mainThreadScheduler]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subscribeNext: ^(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; value) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            @strongify(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tableView reloadData];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton rac_signalForControlEvents: &lt;span class=&quot;built_in&quot;&gt;UIControlEventTouchUpInside&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subscribeNext:  ^(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; value) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            @strongify(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel getTweetsForCurrentUsername];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(&lt;span class=&quot;built_in&quot;&gt;UITableViewCell&lt;/span&gt;*)tableView: (&lt;span class=&quot;built_in&quot;&gt;UITableView&lt;/span&gt; *)tableView cellForRowAtIndexPath: (&lt;span class=&quot;built_in&quot;&gt;NSIndexPath&lt;/span&gt; *)indexPath &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// if table section is the tweets section&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (indexPath. section == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MYTwitterUserCell *cell =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tableView dequeueReusableCellWithIdentifier: &lt;span class=&quot;string&quot;&gt;@&quot;MYTwitterUserCell&quot;&lt;/span&gt; forIndexPath: indexPath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// grab the cell view model from the vc view model and assign it&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cell.viewModel = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel. tweets[indexPath. row];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; cell;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// else if the section is our loading cell&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MYLoadingCell *cell =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tableView dequeueReusableCellWithIdentifier: &lt;span class=&quot;string&quot;&gt;@&quot;MYLoadingCell&quot;&lt;/span&gt; forIndexPath: indexPath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel loadMoreTweets];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; cell;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// MYTwitterUserCell&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// this could also be in cell init&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) awakeFromNib &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; awakeFromNib];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.avatarImageView,  image) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;,  viewModel. tweetAuthorAvatarImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.userNameLabel,  text) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;,  viewModel. tweetAuthorFullName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tweetTextLabel,  text) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;,  viewModel. tweetContent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è®©æˆ‘ä»¬è¿‡ä¸€éè¿™ä¸ªä¾‹å­.   &lt;/p&gt;
&lt;figure class=&quot;highlight accesslog&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;RAC(self.viewModel,  username) = &lt;span class=&quot;string&quot;&gt;[myTextfield rac_textSignal]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è¿™æˆ‘ä»¬ç”¨ RAC åº“ä¸­çš„æ–¹æ³•ä» &lt;code&gt;UITextField&lt;/code&gt; æ‹‰å–ä¸€ä¸ªä¿¡å·. è¿™è¡Œä»£ç å°† view-model ä¸Šçš„å¯è¯»å†™å±æ€§ &lt;code&gt;username&lt;/code&gt; ç»‘å®šåˆ°æ–‡æœ¬æ¡†ä¸Šçš„ç”¨æˆ·è¾“å…¥çš„ä»»ä½•æ›´æ–°.   &lt;/p&gt;
&lt;figure class=&quot;highlight elixir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;RACSignal *usernameIsValidSignal = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.viewModel,  usernameValid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton,  alpha) = [usernameIsValidSignal&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;symbol&quot;&gt;map:&lt;/span&gt;  ^(NSNumber *valid) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; valid. boolValue ? &lt;span class=&quot;variable&quot;&gt;@1&lt;/span&gt; :  &lt;span class=&quot;variable&quot;&gt;@0&lt;/span&gt;. &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.goButton,  enabled) = usernameIsValidSignal;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è¿™æˆ‘ä»¬ç”¨ &lt;code&gt;RACObserve&lt;/code&gt; æ–¹æ³•åœ¨ view-model çš„ &lt;code&gt;usernameValid&lt;/code&gt; å±æ€§ä¸Šåˆ›å»ºäº†ä¸€ä¸ªä¿¡å· &lt;code&gt;usernameIsValidSignal&lt;/code&gt;.  æ— è®ºä½•æ—¶å±æ€§å‘ç”Ÿå˜åŒ–, å®ƒå°†ä¼šæ²¿ç€ç®¡é“å‘é€ä¸€ä¸ªæ–°çš„ &lt;code&gt;@YES&lt;/code&gt; æˆ– &lt;code&gt;@NO&lt;/code&gt;. æˆ‘ä»¬æ‹¿åˆ°é‚£ä¸ªå€¼å¹¶å°†å…¶ç»‘å®šåˆ° &lt;code&gt;goButton&lt;/code&gt; çš„ä¸¤ä¸ªå±æ€§ä¸Š. é¦–å…ˆæˆ‘ä»¬å°† &lt;code&gt;alpha&lt;/code&gt; åˆ†åˆ«å¯¹åº” YES æˆ– NO æ›´æ–°åˆ°1æˆ–0. 5(è®°ç€åœ¨è¿™å¿…é¡»è¿”å› &lt;code&gt;NSNumber&lt;/code&gt;). ç„¶åæˆ‘ä»¬ç›´æ¥å°†ä¿¡å·ç»‘å®šåˆ° &lt;code&gt;enabled&lt;/code&gt; å±æ€§, å› ä¸º YES å’Œ NO åœ¨è¿™æ— éœ€è½¬æ¢å°±èƒ½å®Œç¾åœ°è¿ä½œ.   &lt;/p&gt;
&lt;figure class=&quot;highlight lisp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;RAC(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;.avatarImageView,  image) = RACObserve(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;.viewModel,  userAvatarImage)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RAC(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;.userNameLabel,  text) = RACObserve(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;.viewModel,  userFullName)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ä¸ºè¡¨å¤´çš„å›¾åƒè§†å›¾å’Œç”¨æˆ·æ ‡ç­¾åˆ›å»ºç»‘å®š, å†æ¬¡åœ¨ view-model ä¸Šå¯¹åº”çš„å±æ€§ä¸Šç”¨ &lt;code&gt;RACObserve&lt;/code&gt; å®åˆ›å»ºä¿¡å·.   &lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@weakify&lt;/span&gt;(self);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-attr&quot;&gt;[[[RACSignal merge: @[RACObserve(self.viewModel,  tweets), &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                     RACObserve(self.viewModel,  allTweetsLoaded)]&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;bufferWithTime&lt;/span&gt;: &lt;span class=&quot;selector-tag&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;onScheduler&lt;/span&gt;: &lt;span class=&quot;selector-attr&quot;&gt;[RACScheduler mainThreadScheduler]&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-tag&quot;&gt;subscribeNext&lt;/span&gt;: ^(id value) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;variable&quot;&gt;@strongify&lt;/span&gt;(self);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-attr&quot;&gt;[self.tableView reloadData]&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™è´§çœ‹ä¸Šå»æœ‰ç‚¹è¯¡å¼‚, æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸Šå¤šèŠ±ç‚¹æ—¶é—´. æˆ‘ä»¬æƒ³åœ¨ view-model ä¸Š &lt;code&gt;tweets&lt;/code&gt; æ•°ç»„æˆ– &lt;code&gt;allTweetsLoaded&lt;/code&gt; å±æ€§å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°è¡¨æ ¼è§†å›¾. (åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬è¦ç”¨ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥é‡æ–°åŠ è½½æ•´å¼ è¡¨. )æ‰€ä»¥æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªå±æ€§è¢«è§‚å¯Ÿååˆ›å»ºçš„ä¸¤ä¸ªä¿¡å·åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„ä¿¡å·, å½“ä¸¤ä¸ªå±æ€§ä¸­æœ‰ä¸€ä¸ªå‘ç”Ÿå˜åŒ–, è¿™ä¸ªä¿¡å·å°±ä¼šå‘é€å€¼. (ä½ ä¸€è´¯è®¤ä¸ºä¿¡å·çš„å€¼æ˜¯åŒç±»å‹çš„, ä¸ä¼šåƒè¿™ä¸ªä¿¡å·æœ‰ä¸€æ ·æ··æ‚çš„å€¼. è¿™å¾ˆå¯èƒ½åœ¨ Swift ç‰ˆæœ¬çš„ RAC ä¸­å¼ºåˆ¶è¦æ±‚, ä½†åœ¨è¿™æˆ‘ä»¬ä¸å…³å¿ƒå‘å‡ºçš„çœŸå®å€¼, æˆ‘ä»¬åªæ˜¯ç”¨å®ƒæ¥è§¦å‘è¡¨æ ¼å¼å›¾çš„é‡æ–°åŠ è½½. )  &lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè¿™å„¿çœ‹èµ·æ¥æœ€å“äººçš„éƒ¨åˆ†å¯èƒ½æ˜¯ä¿¡å·é“¾ä¸­çš„ &lt;code&gt;bufferWithTime: onScheduler:&lt;/code&gt; æ–¹æ³•. éœ€è¦å®ƒæ¥å›´ç»• UIKit ä¸­çš„ä¸€ä¸ªé—®é¢˜è¿›è¡Œå˜é€š.  &lt;code&gt;tweets&lt;/code&gt; å’Œ &lt;code&gt;allTweetsLoaded&lt;/code&gt; è¿™ä¸¤ä¸ªå±æ€§æˆ‘ä»¬éƒ½éœ€è¦è¿½è¸ª, ä¸‡ä¸€ &lt;code&gt;tweets&lt;/code&gt; å˜åŒ–å’Œ &lt;code&gt;allTweetsLoaded&lt;/code&gt; ä¸ºå¦(ä¸ç®¡æ€æ ·æˆ‘ä»¬éƒ½å¾—é‡æ–°åŠ è½½è¡¨æ ¼). æœ‰æ—¶ä¸¤ä¸ªå±æ€§éƒ½å°†åœ¨åŒä¸€å‡†ç¡®çš„æ—¶é—´å‘ç”Ÿå˜åŒ–, æ„å‘³ç€åˆå¹¶åçš„å¤§ä¿¡å·ä¸­çš„ä¸¤ä¸ªä¿¡å·éƒ½ä¼šå‘é€ä¸€ä¸ªå€¼, é‚£ä¹ˆ &lt;code&gt;reloadData&lt;/code&gt; æ–¹æ³•å°†ä¼šåœ¨åŒä¸€ä¸ªè¿è¡Œå¾ªç¯ä¸­è¢«è°ƒç”¨ä¸¤æ¬¡.  UIKit ä¸å–œæ¬¢è¿™æ ·.  &lt;code&gt;bufferWithTime:&lt;/code&gt; åœ¨ç»™æ˜çš„æ—¶é—´å†…æŠ“å–æ‰€æœ‰ä¸‹ä¸€ä¸ªåˆ°æ¥çš„å€¼, å½“ç»™å®šçš„æ—¶é—´è¿‡åå°†æ‰€æœ‰å€¼åˆåœ¨ä¸€èµ·å‘ç»™è®¢é˜…è€…. é€šè¿‡ä¼ å…¥0ä½œä¸ºæ—¶é—´,  &lt;code&gt;bufferWithTime:&lt;/code&gt; å°†ä¼šæŠ“å–é‚£ä¸ªåˆå¹¶ä¿¡å·åœ¨ç‰¹å®šçš„è¿è¡Œå¾ªç¯ä¸­å‘å‡ºçš„å…¨éƒ¨å€¼, å¹¶å°†ä»–ä»¬ä¸€èµ·å‘é€å‡ºå». (&lt;code&gt;NSTimer&lt;/code&gt; ä»¥åŒæ ·çš„æ–¹å¼å·¥ä½œ, è¿™ä¸æ˜¯å·§åˆ, å› ä¸º &lt;code&gt;bufferWithTime:&lt;/code&gt; æ˜¯ç”¨ &lt;code&gt;NSTimer&lt;/code&gt; æ„å»ºçš„. )æš‚æ—¶ä¸ç”¨æ‹…å¿ƒ scheduler, è¯•æŠŠå®ƒæƒ³åšæŒ‡æ˜è¿™äº›å€¼å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸Šè¢«å‘é€. ç°åœ¨æˆ‘ä»¬ç¡®ä¿ &lt;code&gt;reloadData&lt;/code&gt; æ¯æ¬¡è¿è¡Œå¾ªç¯åªè¢«è°ƒç”¨ä¸€æ¬¡.   &lt;/p&gt;
&lt;p&gt;&lt;em&gt;æ³¨æ„æˆ‘åœ¨è¿™ç”¨ &lt;code&gt;@weakify/@strongify&lt;/code&gt; å®åˆ‡æ¢ strong å’Œ weak.  è¿™åœ¨åˆ›å»ºæ‰€æœ‰è¿™äº› block æ—¶éå¸¸é‡è¦. åœ¨ RAC çš„ block ä¸­ä½¿ç”¨ &lt;code&gt;self&lt;/code&gt; æ—¶&lt;code&gt;self&lt;/code&gt; å°†ä¼šè¢«æ•è·ä¸ºå¼ºå¼•ç”¨å¹¶å¾—åˆ°ä¿ç•™ç¯, é™¤éä½ å°¤å…¶æ„è¯†åˆ°è¦ç ´é™¤ä¿ç•™ç¯&lt;/em&gt;  &lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[self.goButton rac_signalForControlEvents: UIControlEventTouchUpInside]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    subscribeNext:  ^(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; value) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @strongify(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [self.viewModel getTweetsForCurrentUsername]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘å°†ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­åœ¨è¿™é‡Œå¼•å…¥ &lt;code&gt;RACCommand&lt;/code&gt;,  ä½†ç›®å‰æˆ‘ä»¬åªæ˜¯å½“æŒ‰é’®è¢«è§¦ç¢°æ—¶æ‰‹åŠ¨è°ƒç”¨ view-model çš„ &lt;code&gt;getTweetsForCurrentUsername&lt;/code&gt; æ–¹æ³•.   &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»æå®šäº† &lt;code&gt;cellForRowAtIndexPath&lt;/code&gt; çš„ç¬¬ä¸€éƒ¨åˆ†, é‚£ä¹ˆæˆ‘åœ¨è¿™å°†åªè¯´ä¸‹ loading cell: &lt;/p&gt;
&lt;figure class=&quot;highlight pf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MYLoadingCell *cell =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;literal&quot;&gt;self&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;table&lt;/span&gt;View dequeueReusableCellWithIdentifier: @&lt;span class=&quot;string&quot;&gt;&quot;MYLoadingCell&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;IndexPath: indexPath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;literal&quot;&gt;self&lt;/span&gt;.viewModel &lt;span class=&quot;built_in&quot;&gt;load&lt;/span&gt;MoreTweets];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;return cell;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ˜¯å¦ä¸€å—æˆ‘ä»¬ä»¥åå°†åˆ©ç”¨åˆ° &lt;code&gt;RACCommand&lt;/code&gt; çš„åœ°æ–¹, ä½†ç›®å‰æˆ‘ä»¬åªæ˜¯è°ƒç”¨ view-model çš„ &lt;code&gt;loadMoreTweets&lt;/code&gt; æ–¹æ³•. æˆ‘ä»¬å°†åªæ˜¯ä¿¡ä»»å¦‚æœ cell æ˜¾ç¤ºæˆ–éšè—å¤šæ¬¡çš„è¯ view-model ä¼šé¿å…å¤šæ¬¡å†…éƒ¨è°ƒç”¨.   &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) awakeFromNib &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; awakeFromNib];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.avatarImageView,  image) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;,  viewModel. tweetAuthorAvatarImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.userNameLabel,  text) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;,  viewModel. tweetAuthorFullName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tweetTextLabel,  text) = RACObserve(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;,  viewModel. tweetContent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ®µç°åœ¨åº”è¯¥éå¸¸ç›´æ¥äº†, é™¤æ­¤ä¹‹å¤–æˆ‘æƒ³æŒ‡å‡ºä¸€ç‚¹. æˆ‘ä»¬æ­£åœ¨å°†å›¾ç‰‡å’Œæ–‡å­—ç»‘å®šåˆ° UI ä¸Šå¯¹åº”çš„å±æ€§, ä½†æ³¨æ„ &lt;code&gt;viewModel&lt;/code&gt; å‡ºç°åœ¨ &lt;code&gt;RACObserve&lt;/code&gt; å®ä¸­é€—å·å³è¾¹. è¿™äº› cell ç»ˆå°†è¢«é‡ç”¨, æ–°çš„ view-models å°†ä¼šè¢«èµ‹å€¼. å¦‚æœæˆ‘ä»¬ä¸å°† &lt;code&gt;viewModel&lt;/code&gt; æ”¾åœ¨é€—å·å³è¾¹, é‚£å°±ä¼šç›‘å¬ &lt;code&gt;viewModel&lt;/code&gt; å±æ€§çš„å˜åŒ–ç„¶åæ¯æ¬¡éƒ½è¦é‡æ–°è®¾ç½®ç»‘å®š;å¦‚æœæ”¾åœ¨é€—å·å³è¾¹,  &lt;code&gt;RACObserve&lt;/code&gt; å°†ä¼šä¸ºæˆ‘ä»¬è´Ÿè´£è¿™äº›äº‹å„¿. å› æ­¤æˆ‘ä»¬åªéœ€è¦è®¾å®šä¸€æ¬¡ç»‘å®šå¹¶è®© Reactive Cocoa åšå‰©ä½™çš„éƒ¨åˆ†. è¿™æ˜¯åœ¨ç»‘å®šè¡¨æ ¼ cell æ—¶ä¸ºäº†æ€§èƒ½éœ€è¦è®°ä½çš„å¥½ä¸œè¥¿. æˆ‘åœ¨å®è·µä¸­å³ä½¿æ˜¯æœ‰å¾ˆå¤šè¡¨æ ¼ cell ä¾ç„¶æ²¡æœ‰å‡ºè¿‡é—®é¢˜.   &lt;/p&gt;
&lt;h4 id=&quot;ç¦åˆ©-æ¶ˆé™¤æ›´å¤šçš„çŠ¶æ€&quot;&gt;&lt;a href=&quot;#ç¦åˆ©-æ¶ˆé™¤æ›´å¤šçš„çŠ¶æ€&quot; class=&quot;headerlink&quot; title=&quot;ç¦åˆ©-æ¶ˆé™¤æ›´å¤šçš„çŠ¶æ€&quot;&gt;&lt;/a&gt;ç¦åˆ©-æ¶ˆé™¤æ›´å¤šçš„çŠ¶æ€&lt;/h4&gt;&lt;p&gt;æœ‰æ—¶å€™ä½ å¯ä»¥åœ¨ view-model ä¸­æš´éœ² &lt;code&gt;RACSignal&lt;/code&gt; å¯¹è±¡æ¥æ›¿ä»£åƒå­—ç¬¦ä¸²å’Œå›¾åƒè¿™æ ·çš„å±æ€§, è¿™èƒ½åœ¨ view-model ä¸Šæ¶ˆé™¤æ›´å¤šçš„çŠ¶æ€. ç„¶åè§†å›¾æ§åˆ¶å™¨å°±ä¸éœ€è¦è‡ªå·±ç”¨ &lt;code&gt;RACObserve&lt;/code&gt; åˆ›å»ºä¿¡å·äº†, å¹¶åªæ˜¯ç›´æ¥å½±å“è¿™äº›ä¿¡å·. è¦æ„è¯†åˆ°å¦‚æœä½ çš„ä¿¡å·åœ¨è¢« UI è®¢é˜…/ç»‘å®šåˆ° UI ä¹‹å‰å‘å‡ºè¿‡ä¸€ä¸ªå€¼, é‚£ä¹ˆä½ å°†ä¸ä¼šæ”¶åˆ°é‚£ä¸ªâ€åˆå§‹â€çš„å€¼. &lt;/p&gt;
&lt;h2 id=&quot;ç»“è®º&quot;&gt;&lt;a href=&quot;#ç»“è®º&quot; class=&quot;headerlink&quot; title=&quot;ç»“è®º&quot;&gt;&lt;/a&gt;ç»“è®º&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ç¯‡å¹…ç•¥é•¿, ä½†åˆ«è¢«å“ç€. è¿™è¿˜æœ‰å¥½å¤šæ²¡è®²çš„, è€Œä¸”æ˜¯å¹²è´§å„¿, æ˜¯èˆ’å±•ä½ å¤§è„‘çš„å¥½æ–¹æ³•. è¿™æ¯«æ— ç–‘é—®æ˜¯&lt;em&gt;ä¸åŒçš„&lt;/em&gt;ç¼–ç¨‹é£æ ¼. èŠ±ä¸€ä¼šå„¿åŠŸå¤«åœæ­¢æœºæ¢°åœ°è¯•å›¾ç”¨å‘½ä»¤å¼æ–¹æ¡ˆå»è§£å†³é—®é¢˜. å³ä½¿ä½ ä¸€å¼€å§‹ä¸æ˜¯ç»å¸¸ç”¨è¿™ç§ç¼–ç¨‹é£æ ¼, æˆ‘è®¤ä¸ºè¿™æœ‰åŠ©äºç†è§£å’Œæé†’æˆ‘ä»¬æœ‰æˆªç„¶ä¸åŒçš„é€”å¾„æ¥è§£å†³æˆ‘ä»¬ç¨‹åºå‘˜çš„å›°æƒ‘.   &lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ¬¡æˆ‘å°†ç¨å¾®æ·±å…¥ view-model å†…éƒ¨ä¸­æœ¬æ–‡æ²¡æåˆ°çš„å†…å®¹, å¹¶ä»‹ç»ä¸‹ &lt;code&gt;RACCommand&lt;/code&gt;(å¸Œæœ›ç¯‡å¹…èƒ½çŸ­å¾ˆå¤š). ç„¶åæˆ‘ä»¬å°†æŠ•å…¥åˆ°ä¸€ä¸ªçœŸå®æ¡ˆä¾‹ä¸­, é‚£æ˜¯æˆ‘çš„ä¸€ä¸ªå«åš&lt;a href=&quot;http://www.threecentsapp.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Three Cents&lt;/a&gt;çš„ app ä¸­çš„ä¸€ä¸ªç›¸å½“å¤æ‚çš„é¡µé¢, å®ƒæ··åˆäº†ç½‘ç»œè°ƒç”¨, CoreData, å¤šé‡ UI çŠ¶æ€, ç­‰ç­‰!&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.sprynthesis.com/assets/images/ThreeCentsExplore.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;æ‹“å±•é˜…è¯»&quot;&gt;&lt;a href=&quot;#æ‹“å±•é˜…è¯»&quot; class=&quot;headerlink&quot; title=&quot;æ‹“å±•é˜…è¯»&quot;&gt;&lt;/a&gt;æ‹“å±•é˜…è¯»&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.objc.io/issue-13/mvvm.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Introduction to MVVM&lt;/a&gt; by Ash Furrow&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://leanpub.com/iosfrp/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Functional Reactive Programming on iOS&lt;/a&gt; by Ash Furrow&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/AshFurrow/C-41&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;A sample app by Ash Furrow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cocoamanifest.net/articles/2013/10/mvc-mvvm-frp-and-building-bridges.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MVC,  MVVM,  FRP,  And Building Bridges&lt;/a&gt; by Jonathan Penn&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.raywenderlich.com/74106/mvvm-tutorial-with-reactivecocoa-part-1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MVVM Tutorial with ReactiveCocoa&lt;/a&gt; by Colin Eberhardt on the Ray Wenderlich site. &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cocoasamurai.blogspot.jp/2013/03/basic-mvvm-with-reactivecocoa.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Basic MVVM with ReactiveCocoa&lt;/a&gt; by Colin Wheeler&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://twocentstudios.com/blog/2014/06/08/on-mvvm-and-architecture-questions/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;On MVVM,  and Architecture Questions&lt;/a&gt; by Chris Trott&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ç¿»è¯‘è‡ª&lt;a href=&quot;http://www.sprynthesis.com/2014/12/06/reactivecocoa-mvvm-introduction&quot;&gt;ReactiveCocoa and MVVM,  an Introduction&lt;/a&gt;. &lt;del&gt;æ–‡ä¸­å¼•ç”¨çš„ Gist å¯èƒ½æ— æ³•æ˜¾ç¤º. ä¸ºäº†å’Œè°ç¤¾ä¼š, è¯·&lt;a href=&quot;http://tizipro.com/?r=ee0508bc191f5651&quot;&gt;ç§‘å­¦ä¸Šç½‘&lt;/a&gt;ğŸ˜‚&lt;/del&gt;   &lt;/p&gt;
    
    </summary>
    
    
      <category term="RAC" scheme="http://yulingtianxia.com/tags/RAC/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yulingtianxia.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>Appä¸Extensionsé—´é€šä¿¡å…±äº«æ•°æ®</title>
    <link href="http://yulingtianxia.com/blog/2015/04/06/Communication-between-your-App-and-Extensions/"/>
    <id>http://yulingtianxia.com/blog/2015/04/06/Communication-between-your-App-and-Extensions/</id>
    <published>2015-04-06T12:30:54.000Z</published>
    <updated>2016-05-11T14:31:46.000Z</updated>
    
    <content type="html">&lt;p&gt;æœ€è¿‘ç©äº†ç©ï£¿Watchå¼€å‘ï¼Œè€Œç›®å‰ï£¿Watchçš„ä¸»è¦é€»è¾‘å¤„ç†éƒ½æ˜¯æ”¾åœ¨WatchKit Extensionã€‚çœŸæ­£çš„Host Appï¼Œä¹Ÿå°±æ˜¯WatchKit Appåªæ˜¯ç”¨æ¥åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºæ•°æ®çš„ã€‚äºæ˜¯å®è·µäº†ä¸‹containing appä¸app extensionä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®å…±äº«ã€‚  &lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;App-Groups-amp-Framework&quot;&gt;&lt;a href=&quot;#App-Groups-amp-Framework&quot; class=&quot;headerlink&quot; title=&quot;App Groups &amp;amp; Framework&quot;&gt;&lt;/a&gt;App Groups &amp;amp; Framework&lt;/h2&gt;&lt;p&gt;è¿™ä¸¤æ ·å…µå™¨å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ã€‚æƒ³è¦å…±äº«æ•°æ®å°±éœ€è¦å¼€å¯App Groupsï¼Œç»™groupèµ·ä¸€ä¸ªé£éªšçš„åå­—ï¼Œè¿™æ ·æ— è®ºæ˜¯&lt;code&gt;NSUserDefaults&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;NSFileManager&lt;/code&gt;éƒ½èƒ½é€šè¿‡App Groupså…±äº«æŒä¹…å±‚æ•°æ®äº†ã€‚Core Dataä¹Ÿéœ€è¦&lt;code&gt;NSFileManager&lt;/code&gt;æä¾›å­˜å‚¨çš„URLæ”¯æŒï¼Œè€Œå­˜å–Core Dataä¸­çš„æ•°æ®éœ€è¦å¤§é‡çš„æ¨¡æ¿ä»£ç ï¼Œåœ¨æŒä¹…å±‚æ–‡ä»¶å…±äº«ä¹‹åï¼Œä»£ç ä¹Ÿåº”è¯¥åšåˆ°å…±äº«ï¼Œæ‰€ä»¥å°†èƒ½å¤Ÿé‡ç”¨çš„ä»£ç æ‰“åŒ…æˆFrameworkå°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚(é™¤éæ˜¯ä¸ºäº†åšæ¯•è®¾å‡‘ä»£ç é‡)  &lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯ä»¥&lt;a href=&quot;https://github.com/yulingtianxia/HardChoice&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;HardChoice&lt;/a&gt;ä¸ºä¾‹ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªç±»å‹ä¸ºCocoa Touch Frameworkçš„targetï¼Œåå­—å«DataKitã€‚æ–°å»ºä¸€ä¸ªDataAccess.swiftæ–‡ä»¶å¹¶å°†ä»¥å‰AppDelegate.swiftä¸­è‡ªåŠ¨ç”Ÿæˆçš„Core Dataæ¨¡ç‰ˆä»£ç è½¬ç§»è¿‡æ¥ã€‚å¾—ç›ŠäºSwift1.2çš„æ”¹è¿›ï¼Œæ„é€ ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼å˜å¾—æ— æ¯”ç®€å•ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight smali&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;private&lt;span class=&quot;keyword&quot;&gt; static&lt;/span&gt; let&lt;span class=&quot;built_in&quot;&gt; instance &lt;/span&gt;= DataAccess()&lt;span class=&quot;keyword&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public&lt;/span&gt; class var sharedInstance&lt;span class=&quot;keyword&quot;&gt; :&lt;/span&gt; DataAccess &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt; return &lt;/span&gt;instance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;éœ€è¦æ³¨æ„Swiftçš„æƒé™æ§åˆ¶é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æš´æ¼ç»™æ¡†æ¶ä½¿ç”¨è€…çš„å…¬å¼€æ¥å£å’Œå±æ€§å‰åŠ ä¸Š&lt;code&gt;public&lt;/code&gt;å…³é”®å­—ä¿®é¥°ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°Core DataæŒä¹…å±‚å…±äº«ï¼Œéœ€è¦ä¿®æ”¹åŸå…ˆçš„&lt;code&gt;applicationDocumentsDirectory&lt;/code&gt;å±æ€§ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;lazy var applicationDocumentsDirectory: &lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// The directory the application uses to store the Core Data store file. This code uses a directory named &quot;com.yxy.iCloudCoreDataTest&quot; in the application&#39;s documents Application Support directory.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//        let urls = NSFileManager.defaultManager().URLsForDirectory(.DocumentDirectory, inDomains: .UserDomainMask)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//        return urls[urls.count-1] as! NSURL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   var sharedContainerURL:&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt;? = &lt;span class=&quot;built_in&quot;&gt;NSFileManager&lt;/span&gt;.defaultManager().containerURLForSecurityApplicationGroupIdentifier(appGroupIdentifier)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sharedContainerURL ?? &lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è¿™é‡Œ&lt;code&gt;containerURLForSecurityApplicationGroupIdentifier&lt;/code&gt;æ–¹æ³•èµ·åˆ°äº†è‡³å…³ä½œç”¨ã€‚  &lt;/p&gt;
&lt;p&gt;åŒæ ·èƒ½å¤Ÿå…±äº«çš„ä»£ç å°±æ˜¯Modelå±‚ï¼Œå®ƒä»¬éƒ½æ˜¯&lt;code&gt;NSManagedObject&lt;/code&gt;çš„å­ç±»ï¼Œç”¨äºå­˜å‚¨Core Dataä¸­çš„æ•°æ®å®ä¾‹ã€‚åœ¨æŠŠå®ƒä»¬ä»åŸæ¥çš„ä½ç½®æ‹–æ‹½è¿‡æ¥æ—¶åˆ«å¿˜äº†æ›´æ”¹ä¸‹æ–‡ä»¶çš„targetï¼šâ€File inspectorâ€-&amp;gt;â€Target Membershipâ€ï¼Œé€‰ä¸­DataKitã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨å¤„ç†iCloudä¸Core DataåŒæ­¥æ•°æ®æ—¶ï¼Œæˆ‘å¯¹&lt;code&gt;NSPersistentStoreCoordinatorStoresWillChangeNotification&lt;/code&gt;ã€&lt;code&gt;NSPersistentStoreCoordinatorStoresDidChangeNotification&lt;/code&gt;å’Œ&lt;code&gt;NSPersistentStoreDidImportUbiquitousContentChangesNotification&lt;/code&gt;è¿™ä¸‰ä¸ªæ•°æ®æ›´æ–°çš„é€šçŸ¥è¿›è¡Œäº†è§‚å¯Ÿå’Œå¤„ç†ï¼Œä½†æ˜¯å†™åœ¨äº†&lt;code&gt;persistentStoreCoordinator&lt;/code&gt;è®¡ç®—å±æ€§çš„getæ–¹æ³•ä¸­ã€‚ç°åœ¨ä½¿ç”¨&lt;code&gt;lazy&lt;/code&gt;å…³é”®å­—è¿›è¡Œæƒ°æ€§åŠ è½½ï¼Œå¯¼è‡´å¯¹è¿™ä¸‰ä¸ªæ•°æ®æ›´æ–°é€šçŸ¥çš„è§‚å¯Ÿå»¶åï¼Œè¿™ä¼šå¼•å‘ä¸¥é‡çš„é”™è¯¯ã€‚æ‰€ä»¥éœ€è¦å°†é‚£ä¸‰ä¸ª&lt;code&gt;addObserverForName(name, object, queue, usingBlock)&lt;/code&gt;æ–¹æ³•æŒªåˆ°&lt;code&gt;init()&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´è§‚å¯Ÿé€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ååœ¨AppDelegate.swiftä¸­æ·»åŠ &lt;code&gt;import DataKit&lt;/code&gt;ï¼Œæ›¿æ¢æ‰ä¸­çš„&lt;code&gt;application(application, didFinishLaunchingWithOptions) -&amp;gt; Bool&lt;/code&gt;æ–¹æ³•ä¸­&lt;code&gt;controller.managedObjectContext = managedObjectContext&lt;/code&gt;ä¸º&lt;code&gt;controller.managedObjectContext = DataAccess.sharedInstance.managedObjectContext&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ä¸å†ä½¿ç”¨ä»¥å‰çš„æ¨¡æ¿ä»£ç ä¸­çš„ä¸Šä¸‹æ–‡å®ä¾‹ï¼Œè€Œæ˜¯ç”¨DataAccesså•ä¾‹ä¸­çš„&lt;code&gt;managedObjectContext&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;åŒç†ï¼Œ&lt;code&gt;applicationWillTerminate(application)&lt;/code&gt;æ–¹æ³•ä¸­çš„&lt;code&gt;saveContext()&lt;/code&gt;ä¹Ÿè¦æ›¿æ¢æˆ&lt;code&gt;DataAccess.sharedInstance.saveContext()&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;äºæ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨App Extensionsä¸­importè¿›æ¥DataKitï¼Œè¿›è¡Œåœ°å­˜å–Core Dataä¸­çš„æ•°æ®å•¦ã€‚è€Œä¸”ç”¨çš„æ˜¯åŒä¸€æ®µä»£ç ï¼ŒåŒä¸€å—æ•°æ®ã€‚ç®€ç›´æ˜¯åŒä¸€ä¸ªä¸–ç•Œï¼ŒåŒä¸€ä¸ªæ¢¦æƒ³å•Šã€‚  &lt;/p&gt;
&lt;h2 id=&quot;Container-app-ä¸-Extensionçš„é€šä¿¡&quot;&gt;&lt;a href=&quot;#Container-app-ä¸-Extensionçš„é€šä¿¡&quot; class=&quot;headerlink&quot; title=&quot;Container app ä¸ Extensionçš„é€šä¿¡&quot;&gt;&lt;/a&gt;Container app ä¸ Extensionçš„é€šä¿¡&lt;/h2&gt;&lt;p&gt;è¦çŸ¥é“ä¹‹å‰åšçš„å…±äº«æ•°æ®åªèƒ½æ˜¯ä¸»åŠ¨è·å–æ•°æ®ï¼Œå¹¶ä¸èƒ½åœ¨æ•°æ®å˜åŒ–æ—¶å®æ—¶è·å–é€šçŸ¥ã€‚å¦‚æœç”¨æˆ·åœ¨iPhoneä¸Šæ›´æ”¹äº†æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ï£¿Watchä¸Šå®æ—¶æ›´æ”¹ç•Œé¢ä¸Šæ•°æ®çš„æ˜¾ç¤ºã€‚è¿™ç‚¹&lt;code&gt;NSNotificationCenter&lt;/code&gt;æ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºå®ƒåªåœ¨Appå†…éƒ¨å·¥ä½œè€Œä¸ä¼šåœ¨ä¸¤ä¸ªAppä¹‹é—´å‘é€šçŸ¥ã€‚åŒæ ·KVOä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼Œè‡ªå·±æ‰‹å†™å§”æ‰˜ä»€ä¹ˆçš„æ›´æ˜¯åˆ«æƒ³äº†(å› ä¸ºæˆ‘è¯•è¿‡äº†)ã€‚ç›´åˆ°æˆ‘åœ¨&lt;a href=&quot;https://medium.com/@saberjack/ios-sending-notifications-between-your-apps-3fe7422d6a41&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;æ‰¾åˆ°äº†æ•‘ä¸–ä¸»ï¼Œé—®é¢˜è¿åˆƒè€Œè§£ï¼š  &lt;/p&gt;
&lt;h3 id=&quot;CFNotificationCenterGetDarwinNotifyCenter&quot;&gt;&lt;a href=&quot;#CFNotificationCenterGetDarwinNotifyCenter&quot; class=&quot;headerlink&quot; title=&quot;CFNotificationCenterGetDarwinNotifyCenter&quot;&gt;&lt;/a&gt;CFNotificationCenterGetDarwinNotifyCenter&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯CoreFoundationåº“ä¸­ä¸€ä¸ªç³»ç»Ÿçº§çš„é€šçŸ¥ä¸­å¿ƒï¼Œè‹¹æœçš„ç³»ç»Ÿè‡ªå·±ä¹Ÿåœ¨ç”¨å®ƒï¼Œçœ‹æ¸…äº†â€Darwinâ€äº†æ²¡æœ‰ï¼Ÿå“ˆå“ˆï¼çœ‹äº†ä¸‹&lt;code&gt;CFNotificationCenter&lt;/code&gt;ç›¸å…³çš„APIï¼Œè·Ÿ&lt;code&gt;NSNotificationCenter&lt;/code&gt;æœ‰ç‚¹åƒã€‚éœ€è¦ç”¨åˆ°Toll-Bridgeçš„çŸ¥è¯†ä¸CoreFoundationç›¸å…³çš„ç±»è¿›è¡Œæ¡¥æ¥ï¼Œè¿™è™½ä¸å¸¸ç”¨ä½†ä¹Ÿä¸éš¾ã€‚è¿˜éœ€è¦æ³¨æ„ä¸‹ä¸ªåˆ«å‚æ•°çš„ä½¿ç”¨ã€‚  &lt;/p&gt;
&lt;h3 id=&quot;MMWormhole&quot;&gt;&lt;a href=&quot;#MMWormhole&quot; class=&quot;headerlink&quot; title=&quot;MMWormhole&quot;&gt;&lt;/a&gt;MMWormhole&lt;/h3&gt;&lt;p&gt;æ›´æœ‰è¶£çš„æ˜¯å‡ ä¹åŒæ—¶æˆ‘ä¹Ÿå‘ç°äº†&lt;a href=&quot;https://github.com/mutualmobile/MMWormhole&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MMWormhole&lt;/a&gt;è¿™ä¸ªå¼€æºåº“ï¼Œå®ƒä¸“é—¨ç”¨äºåœ¨Container app ä¸ Extensioné—´ä¼ é€’æ¶ˆæ¯ã€‚æˆ‘è¯»äº†ä¸‹å®ƒçš„ä»£ç ï¼Œè™½ç„¶åªæœ‰ä¸€ä¸ªç±»ï¼Œä½†æ˜¯ä¾ç„¶å­¦åˆ°äº†å¾ˆå¤šã€‚è™½ç„¶åœ¨æˆ‘çš„&lt;a href=&quot;https://github.com/yulingtianxia/HardChoice&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;HardChoice&lt;/a&gt;ä¸Šå®Œå…¨å¯ä»¥åªç”¨&lt;code&gt;CFNotificationCenter&lt;/code&gt;è¿›è¡Œé€šçŸ¥å°±å¯ä»¥äº†ï¼Œå®Œå…¨ä¸éœ€è¦ä½¿ç”¨MMWormholeæ¥æŒä¹…åŒ–æ•°æ®å’Œä¼ é€’æ•°æ®ã€‚ä½†æˆ‘è§‰å¾—ä»¥åè¿˜å¯èƒ½ä¼šç”¨åˆ°MMWormholeï¼Œäºæ˜¯æˆ‘ç”¨Swift1.2é‡æ–°å†™äº†ä¸€ä¸ª&lt;a href=&quot;https://github.com/yulingtianxia/HardChoice/blob/master/HardChoice/DataKit/Wormhole.swift&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Wormhole.swift&lt;/a&gt;ï¼Œæ”¾åœ¨äº†DataKité‡Œã€‚  &lt;/p&gt;
&lt;h3 id=&quot;Swiftä¸CoreFoundation&quot;&gt;&lt;a href=&quot;#Swiftä¸CoreFoundation&quot; class=&quot;headerlink&quot; title=&quot;Swiftä¸CoreFoundation&quot;&gt;&lt;/a&gt;Swiftä¸CoreFoundation&lt;/h3&gt;&lt;p&gt;åŸæ¥OCå†™çš„ä¸¤ç™¾å¤šè¡Œçš„MMWormholeè¢«æˆ‘ç”¨150è¡Œâ€œæ¸…æ–°ä¼˜é›…â€çš„Swiftä»£ç å–ä»£ã€‚ä¹‹æ‰€ä»¥æ‰“ä¸Šå¼•å·æ˜¯å› ä¸ºSwiftä¸CoreFoundationä¹‹é—´çš„æ¡¥æ¥æœ‰äº›ä¸æ„‰å¿«ã€‚å› ä¸ºCoreFoundationä¸­éƒ½æ˜¯Cçš„APIï¼ŒCä¸­çš„æŒ‡é’ˆå’Œç±»å‹è½¬æ¢å¾ˆå‡ºæ ¼ï¼Œæœ‰å®‰å…¨éšæ‚£ã€‚Swiftæ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œä½†ä¸ºäº†è°ƒç”¨ç”±å†å²åŸå› é€ æˆçš„ä¸å®‰å…¨çš„Cçš„APIï¼ŒSwiftä¸­å¼•å…¥äº†å¾ˆå¤šç±»å‹æ¥æ˜ å°„Cä¸­çš„ç±»å‹ï¼Œå‚è€ƒ&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/InteractingWithCAPIs.html#//apple_ref/doc/uid/TP40014216-CH8-XID_11&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Interacting with C APIs&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;Swiftä¸­ä¸ç”¨åƒOCé‚£æ ·ä½¿ç”¨&lt;code&gt;__bridge&lt;/code&gt;å’Œç±»å‹è½¬æ¢ã€å†…å­˜ç®¡ç†äº¤æ¥ï¼Œå› ä¸ºè¿™äº›å…¨éƒ½äº¤ç»™Swiftäº†ï¼šå¦‚æœSwiftä¸­å­˜åœ¨ç±»å‹æ˜ å°„åˆ°Cçš„APIæ‰€éœ€çš„å‚æ•°ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†å…¶ä¼ å…¥APIã€‚æ­¤å¤–å†…å­˜ç®¡ç†ä¹Ÿå½’Swiftä¸­çš„ARCç»Ÿä¸€ç®¡ç†ã€‚äºæ˜¯Swiftå¤§å¤§ç®€åŒ–äº†ä¸CoreFoundationæ‰“äº¤é“çš„è¿‡ç¨‹ã€‚  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœ€å…³å¿ƒçš„æ˜¯æŒ‡é’ˆï¼Œ&lt;code&gt;UnsafePointer&amp;lt;SwiftType&amp;gt;&lt;/code&gt;å¯¹åº”äº†&lt;code&gt;const CType *&lt;/code&gt;ï¼Œ&lt;code&gt;UnsafeMutablePointer&amp;lt;SwiftType&amp;gt;&lt;/code&gt;å¯¹åº”äº†&lt;code&gt;CType *&lt;/code&gt;ã€‚å½“ç„¶SwiftTypeä¸CTypeä¹Ÿæ˜¯å¯¹åº”çš„ï¼š  &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;C Type&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Swift Type&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CBool&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;char, signed char&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CChar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unsigned char&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CUnsignedChar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;short&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CShort&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unsigned short&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CUnsignedShort&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CInt&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unsigned int&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CUnsignedInt&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;long&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CLong&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unsigned long&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CUnsignedLong&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;long long&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CLongLong&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unsigned long long&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CUnsignedLongLong&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;wchar_t&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CWideChar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;char16_t&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CChar16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;char32_t&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CChar32&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;float&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CFloat&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;double&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CDouble&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ›´å¤šçš„è½¬æ¢è§„åˆ™ï¼Œåœ¨ä¸Šé¢æåˆ°çš„å®˜æ–¹æ–‡æ¡£æœ‰å¾ˆè¯¦ç»†çš„æè¿°ï¼Œè¿™é‡Œåªè¯´ä¸‰ä¸ªtipsï¼š  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨Swiftä¸­å°†&lt;code&gt;self&lt;/code&gt;è½¬æˆ&lt;code&gt;UnsafePointer&amp;lt;Void&amp;gt;&lt;/code&gt;(ä¹Ÿå°±æ˜¯&lt;code&gt;const void *&lt;/code&gt;)åªéœ€ç”¨è¿™ä¸ªå‡½æ•°ï¼š&lt;code&gt;unsafeAddressOf(self)&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;CoreFoundationåº“ä¸­åç¼€ä¸ºâ€Refâ€çš„ç±»åœ¨Swiftä¸­å·²ç»å»æ‰åç¼€ã€‚  &lt;/li&gt;
&lt;li&gt;Swiftä¸­å‡½æ•°æŒ‡é’ˆè¢«è¡¨ç¤ºä¸º&lt;code&gt;CFunctionPointer&amp;lt;Type&amp;gt;&lt;/code&gt;ï¼ŒTypeå°±æ˜¯å‡½æ•°çš„ç±»å‹ï¼Œä½†è¿˜ä¸å…è®¸ä½ å°†Swiftå†™çš„å‡½æ•°æˆ–é—­åŒ…è½¬åŒ–æˆ&lt;code&gt;CFunctionPointer&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯å¹²è„†æ²¡æä¾›å»ºç«‹&lt;code&gt;CFunctionPointer&lt;/code&gt;å®ä¾‹çš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡å¤–éƒ¨å¼•å…¥Cçš„å‡½æ•°ã€‚è¿™å°±æ¶‰åŠåˆ°äº†Swiftä¸OCæ··ç¼–ï¼Œè¯·æˆ³&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html#//apple_ref/doc/uid/TP40014216-CH10-XID_77&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Swift and Objective-C in the Same Project&lt;/a&gt;  &lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;åœ¨Frameworkä¸­æ··ç¼–OC&quot;&gt;&lt;a href=&quot;#åœ¨Frameworkä¸­æ··ç¼–OC&quot; class=&quot;headerlink&quot; title=&quot;åœ¨Frameworkä¸­æ··ç¼–OC&quot;&gt;&lt;/a&gt;åœ¨Frameworkä¸­æ··ç¼–OC&lt;/h3&gt;&lt;p&gt;æˆ‘ä¹‹æ‰€ä»¥éœ€è¦åšè¿™ç§ç ´åå·¥ç¨‹çº¯æ´æ€§çš„äº‹å„¿ï¼Œæ˜¯å› ä¸ºè¦ç”¨åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•æ¥å¯¹é€šçŸ¥è¿›è¡Œè§‚å¯Ÿï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CFNotificationCenterAddObserver&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(center: CFNotificationCenter!, observer: UnsafePointer&amp;lt;Void&amp;gt;, callBack: CFNotificationCallback, name: CFString!, object: UnsafePointer&amp;lt;Void&amp;gt;, suspensionBehavior: CFNotificationSuspensionBehavior)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é™¤äº†ç±»å‹ä¸º&lt;code&gt;CFNotificationCallback&lt;/code&gt;çš„å‚æ•°ï¼Œå…¶ä½™çš„éƒ½å¥½è¯´ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typealias &lt;span class=&quot;type&quot;&gt;CFNotificationCallback&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;CFunctionPointer&lt;/span&gt;&amp;lt;((&lt;span class=&quot;type&quot;&gt;CFNotificationCenter&lt;/span&gt;!, &lt;span class=&quot;type&quot;&gt;UnsafeMutablePointer&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;Void&lt;/span&gt;&amp;gt;, &lt;span class=&quot;type&quot;&gt;CFString&lt;/span&gt;!, &lt;span class=&quot;type&quot;&gt;UnsafePointer&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;Void&lt;/span&gt;&amp;gt;, &lt;span class=&quot;type&quot;&gt;CFDictionary&lt;/span&gt;!) -&amp;gt; &lt;span class=&quot;type&quot;&gt;Void&lt;/span&gt;)&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;äºæ˜¯å°±å›åˆ°äº†&lt;code&gt;CFunctionPointer&lt;/code&gt;è¿™å—è›‹ç–¼åœ°ä¸Šäº†ï¼Œåªå¥½åœ¨OCé‡Œå†™Cå‡½æ•°ç„¶åè°ƒç”¨ä¹‹ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; WormholeNotificationName = &lt;span class=&quot;string&quot;&gt;@&quot;WormholeNotificationName&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HelpMethod&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _callback = wormholeNotificationCallback;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; wormholeNotificationCallback(&lt;span class=&quot;built_in&quot;&gt;CFNotificationCenterRef&lt;/span&gt; center,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * observer,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  &lt;span class=&quot;built_in&quot;&gt;CFStringRef&lt;/span&gt; name,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; * object,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  &lt;span class=&quot;built_in&quot;&gt;CFDictionaryRef&lt;/span&gt; userInfo) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *identifier = (__bridge &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] postNotificationName:WormholeNotificationName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                        object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      userInfo:@&amp;#123;&lt;span class=&quot;string&quot;&gt;@&quot;identifier&quot;&lt;/span&gt; : identifier&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨Swiftä¸­è¿™æ ·å†™å°±å¯ä»¥äº†ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight lisp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CFNotificationCenterAddObserver(&lt;span class=&quot;name&quot;&gt;center&lt;/span&gt;, unsafeAddressOf(&lt;span class=&quot;name&quot;&gt;self&lt;/span&gt;), helpMethod.callback, identifier, &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;, CFNotificationSuspensionBehavior.DeliverImmediately)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨Swiftä¸­ä½¿ç”¨OCå†™çš„ç±»æœ¬æ¥æ˜¯ä¸€ä»¶å¾ˆeasyçš„äº‹å„¿ï¼Œä½†æ˜¯åˆ°äº†Frameworkä¸­å°±å˜å¾—ä¸å¯»å¸¸ã€‚æˆ‘åœ¨DataKitä¸­æ–°å»ºäº†&lt;code&gt;HelpMethod&lt;/code&gt;ç±»ï¼Œå¹¶å»ºç«‹â€DataKit-Bridging-Header.hâ€æ–‡ä»¶ï¼Œå°†HelpMethod.hå¤´æ–‡ä»¶å¼•å…¥ï¼Œç„¶ååœ¨DataKit targetä¸‹çš„â€Build Settingsâ€ -&amp;gt; â€œSwift Complier-Code Generationâ€ -&amp;gt; â€œObjective-C Bridging Headerâ€ä¸‹å¡«å…¥â€DataKit-Bridging-Header.hâ€ï¼Œç¼–è¯‘å‡ºé”™ï¼š&lt;strong&gt;using bridging headers with framework targets is unsupported&lt;/strong&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨stackoverflowä¸Šæ‰¾åˆ°äº†&lt;a href=&quot;http://stackoverflow.com/questions/24875745/xcode-6-beta-4-using-bridging-headers-with-framework-targets-is-unsupported&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è§£å†³æ–¹æ¡ˆ&lt;/a&gt;ï¼Œäºæ˜¯åˆ é™¤ä¹‹å‰çš„â€DataKit-Bridging-Header.hâ€æ–‡ä»¶å¹¶æ¸…é™¤â€Build Settingsâ€å…³äºBridging Headerçš„å¼•ç”¨ï¼›åœ¨DataKit.hæ·»åŠ &lt;code&gt;#import &amp;quot;HelpMethod.h&amp;quot;&lt;/code&gt;ï¼Œå¹¶åœ¨HelpMethod.hæ–‡ä»¶çš„ â€œFile inspectorâ€-&amp;gt;â€Target Membershipâ€ä¸­DataKitå³ä¾§å°†â€projectâ€ä¿®æ”¹ä¸ºâ€publicâ€(å¦åˆ™ä¼šå‡ºç°&lt;strong&gt;include of non-modular header inside framework module â€˜DataKitâ€™&lt;/strong&gt;çš„ç¼–è¯‘é”™è¯¯)ã€‚  &lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨&lt;code&gt;HelpMethod&lt;/code&gt;ç±»ä¸­å®ç°ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå¹¶åœ¨Wormhole.swiftæ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæ¥ä¸º&lt;code&gt;CFunctionPointer&lt;/code&gt;ç±»å‹çš„å‚æ•°ä¼ å€¼ã€‚  &lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;æ¥ä¸ªæ•ˆæœå›¾ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7ni3rk.com1.z0.glb.clouddn.com/hardchoice.gif&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™ï£¿Watchçš„App(åºŸè¯è°ä¸æ˜¯ç¬¬ä¸€æ¬¡)ï¼Œç»éªŒå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œä¹Ÿå› ä¸ºSwift1.2è¿˜æœªæ­£å¼å‘å¸ƒï¼Œé‡åˆ°äº†ä¸€äº›å‘ã€‚å¥½æ­¹æœ€åå…‹æœäº†ï¼Œä½†ä¹Ÿä¸¢äº†è´æ“(æ¯•ç«Ÿä¸æ˜¯çº¯Swiftçš„Appäº†)ã€‚æœ‰ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤šå¤šæŒ‡æ•™ã€‚éšç€Swiftçš„ä¸æ–­å®Œå–„ï¼Œå¸Œæœ›ä»¥åèƒ½å¤Ÿæ”¯æŒåˆ›å»º&lt;code&gt;CFunctionPointer&lt;/code&gt;å¯¹è±¡ï¼Œè¿™æ ·å®ƒå¥½æˆ‘ä¹Ÿå¥½ğŸ˜„&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ç©äº†ç©ï£¿Watchå¼€å‘ï¼Œè€Œç›®å‰ï£¿Watchçš„ä¸»è¦é€»è¾‘å¤„ç†éƒ½æ˜¯æ”¾åœ¨WatchKit Extensionã€‚çœŸæ­£çš„Host Appï¼Œä¹Ÿå°±æ˜¯WatchKit Appåªæ˜¯ç”¨æ¥åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºæ•°æ®çš„ã€‚äºæ˜¯å®è·µäº†ä¸‹containing appä¸app extensionä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®å…±äº«ã€‚  &lt;/p&gt;
    
    </summary>
    
    
      <category term="Swift" scheme="http://yulingtianxia.com/tags/Swift/"/>
    
      <category term="iOS" scheme="http://yulingtianxia.com/tags/iOS/"/>
    
      <category term="AppGroups" scheme="http://yulingtianxia.com/tags/AppGroups/"/>
    
      <category term="App Extensions" scheme="http://yulingtianxia.com/tags/App-Extensions/"/>
    
  </entry>
  
  <entry>
    <title>æ‚Ÿç©º!</title>
    <link href="http://yulingtianxia.com/blog/2015/03/08/Insight-of-Null/"/>
    <id>http://yulingtianxia.com/blog/2015/03/08/Insight-of-Null/</id>
    <published>2015-03-08T12:06:02.000Z</published>
    <updated>2016-05-11T14:31:45.000Z</updated>
    
    <content type="html">&lt;p&gt;æ–—æˆ˜èƒœä½›ä¼ è®°ã€‚ã€‚ã€‚  &lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;NULLå’Œnullptr&quot;&gt;&lt;a href=&quot;#NULLå’Œnullptr&quot; class=&quot;headerlink&quot; title=&quot;NULLå’Œnullptr&quot;&gt;&lt;/a&gt;NULLå’Œnullptr&lt;/h2&gt;&lt;p&gt;åœ¨Clang 6.0 çš„stddef.hæ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°&lt;code&gt;NULL&lt;/code&gt;å’Œ&lt;code&gt;nullptr&lt;/code&gt;çš„å£°æ˜ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;undef&lt;/span&gt; NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __cplusplus&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#  &lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; !defined(__MINGW32__) &amp;amp;&amp;amp; !defined(_MSC_VER)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#    &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; NULL __null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#  &lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#    &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; NULL 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#  &lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#  &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; NULL ((void*)0)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __cplusplus&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; defined(_MSC_EXTENSIONS) &amp;amp;&amp;amp; defined(_NATIVE_NULLPTR_SUPPORTED)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt; &amp;#123; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;decltype&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;literal&quot;&gt;nullptr&lt;/span&gt;)&lt;/span&gt; nullptr_t&lt;/span&gt;; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; ::&lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::&lt;span class=&quot;keyword&quot;&gt;nullptr_t&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ—©åœ¨1972å¹´ï¼ŒCè¯­è¨€è¯ç”Ÿçš„åˆæœŸï¼Œå¸¸æ•°0å¸¦æœ‰å¸¸æ•°åŠç©ºæŒ‡é’ˆçš„åŒé‡èº«åˆ†ã€‚ Cä½¿ç”¨preprocessor macro &lt;code&gt;NULL&lt;/code&gt;è¡¨ç¤ºç©ºæŒ‡é’ˆï¼Œè®©&lt;code&gt;NULL&lt;/code&gt;åŠ&lt;code&gt;0&lt;/code&gt;åˆ†åˆ«ä»£è¡¨ç©ºæŒ‡é’ˆåŠå¸¸æ•°0ã€‚ &lt;code&gt;NULL&lt;/code&gt;å¯è¢«å®šä¹‰ä¸º&lt;code&gt;((void*)0)&lt;/code&gt;æˆ–æ˜¯&lt;code&gt;0&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;C++å¹¶ä¸é‡‡ç”¨Cçš„è§„åˆ™ï¼Œä¸å…è®¸å°†&lt;code&gt;void*&lt;/code&gt;éšå¼è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„æŒ‡é’ˆã€‚ä¸ºäº†ä½¿ä»£ç &lt;code&gt;char* c = NULL;&lt;/code&gt;èƒ½é€šè¿‡ç¼–è¯‘ï¼Œ&lt;code&gt;NULL&lt;/code&gt;åªèƒ½å®šä¹‰ä¸º&lt;code&gt;0&lt;/code&gt;ã€‚è¿™æ ·çš„å†³å®šä½¿å¾—å‡½æ•°é‡è½½æ— æ³•åŒºåˆ†ä»£ç çš„è¯­ä¹‰ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight aspectj&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;C++å»ºè®®&lt;code&gt;NULL&lt;/code&gt;åº”å½“å®šä¹‰ä¸º&lt;code&gt;0&lt;/code&gt;ï¼Œæ‰€ä»¥&lt;code&gt;foo(NULL);&lt;/code&gt;å°†ä¼šè°ƒç”¨&lt;code&gt;foo(int)&lt;/code&gt;ï¼Œè¿™å¹¶ä¸æ˜¯ç¨‹åºå‘˜æƒ³è¦çš„è¡Œä¸ºï¼Œä¹Ÿè¿åäº†ä»£ç çš„ç›´è§‚æ€§ã€‚0çš„æ­§ä¹‰åœ¨æ­¤å¤„é€ æˆå›°æ‰°ã€‚&lt;/p&gt;
&lt;p&gt;C++11å¼•å…¥äº†æ–°çš„å…³é”®å­—æ¥ä»£è¡¨ç©ºæŒ‡é’ˆå¸¸æ•°ï¼š&lt;code&gt;nullptr&lt;/code&gt;ï¼Œå°†ç©ºæŒ‡é’ˆå’Œæ•´æ•°0çš„æ¦‚å¿µæ‹†å¼€ã€‚ &lt;code&gt;nullptr&lt;/code&gt;çš„ç±»å‹ä¸º&lt;code&gt;nullptr_t&lt;/code&gt;ï¼Œèƒ½éšå¼è½¬æ¢ä¸ºä»»ä½•æŒ‡é’ˆæˆ–æ˜¯æˆå‘˜æŒ‡é’ˆçš„ç±»å‹ï¼Œä¹Ÿèƒ½å’Œå®ƒä»¬è¿›è¡Œç›¸ç­‰æˆ–ä¸ç­‰çš„æ¯”è¾ƒã€‚è€Œ&lt;code&gt;nullptr&lt;/code&gt;ä¸èƒ½éšå¼è½¬æ¢ä¸ºæ•´æ•°ï¼Œä¹Ÿä¸èƒ½å’Œæ•´æ•°åšæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼Œ&lt;code&gt;0&lt;/code&gt;ä»å¯ä»£è¡¨ç©ºæŒ‡é’ˆå¸¸æ•°ã€‚  &lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* pc = &lt;span class=&quot;literal&quot;&gt;nullptr&lt;/span&gt;;     &lt;span class=&quot;comment&quot;&gt;// OK&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; * pi = &lt;span class=&quot;literal&quot;&gt;nullptr&lt;/span&gt;;     &lt;span class=&quot;comment&quot;&gt;// OK&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;    i = &lt;span class=&quot;literal&quot;&gt;nullptr&lt;/span&gt;;     &lt;span class=&quot;comment&quot;&gt;// error&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;foo(pc);           &lt;span class=&quot;comment&quot;&gt;// å‘¼å«foo(char *)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;PSï¼š&lt;code&gt;__MINGW32__&lt;/code&gt;æ˜¯MinGWç¼–è¯‘å™¨çš„é¢„å®šä¹‰å®ã€‚&lt;code&gt;_MSC_VER&lt;/code&gt;æ˜¯å¾®è½¯C/C++ç¼–è¯‘å™¨â€”â€”cl.exe ç¼–è¯‘ä»£ç æ—¶é¢„å®šä¹‰çš„ä¸€ä¸ªå®ã€‚&lt;code&gt;_MSC_VER&lt;/code&gt;çš„å€¼è¡¨ç¤ºclçš„ç‰ˆæœ¬ã€‚éœ€è¦é’ˆå¯¹clç‰¹å®šç‰ˆæœ¬ç¼–å†™ä»£ç æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥å®è¿›è¡Œæ¡ä»¶ç¼–è¯‘ã€‚&lt;/p&gt;
&lt;h2 id=&quot;nilå’ŒNil&quot;&gt;&lt;a href=&quot;#nilå’ŒNil&quot; class=&quot;headerlink&quot; title=&quot;nilå’ŒNil&quot;&gt;&lt;/a&gt;nilå’ŒNil&lt;/h2&gt;&lt;h3 id=&quot;Objective-C&quot;&gt;&lt;a href=&quot;#Objective-C&quot; class=&quot;headerlink&quot; title=&quot;Objective-C&quot;&gt;&lt;/a&gt;Objective-C&lt;/h3&gt;&lt;p&gt;&lt;code&gt;nil&lt;/code&gt;å®šä¹‰ä¸ºå®ä¾‹å¯¹è±¡çš„ç©ºå€¼(a null instance)&lt;br&gt;&lt;code&gt;Nil&lt;/code&gt;å®šä¹‰ä¸ºç±»å¯¹è±¡çš„ç©ºå€¼(a null class)&lt;br&gt;&lt;code&gt;nil&lt;/code&gt;å’Œ&lt;code&gt;Nil&lt;/code&gt;åœ¨objc.hå’ŒMacTypes.hæ–‡ä»¶ä¸­å‡æœ‰ç­‰ä»·çš„å£°æ˜ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifndef&lt;/span&gt; Nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; __has_feature(cxx_nullptr)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; Nil nullptr&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; Nil __DARWIN_NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifndef&lt;/span&gt; nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; __has_feature(cxx_nullptr)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; nil nullptr&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#   &lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; nil __DARWIN_NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# &lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ ¹æ®Clang 3.7 æ–‡æ¡£å¯¹&lt;code&gt;__has_feature&lt;/code&gt;çš„æè¿°: â€œ&lt;code&gt;__has_feature&lt;/code&gt; evaluates to 1 if the feature is both supported by Clang and standardized in the current language standard or 0 if notâ€ï¼Œ&lt;code&gt;__has_feature(cxx_nullptr)&lt;/code&gt;æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ”¯æŒC++11ä¸­çš„&lt;code&gt;nullptr&lt;/code&gt;ç‰¹æ€§çš„ã€‚åœ¨Objective-Cä¸­&lt;code&gt;nil&lt;/code&gt;å’Œ&lt;code&gt;Nil&lt;/code&gt;éƒ½æ˜¯&lt;code&gt;__DARWIN_NULL&lt;/code&gt;å®å®šä¹‰ã€‚æŒ‰ä½CMDé¼ æ ‡ç‚¹å‡»è¿›å…¥&lt;code&gt;_types.h&lt;/code&gt;:  &lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __cplusplus&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __GNUG__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; __DARWIN_NULL __null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* ! __GNUG__ */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __LP64__&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; __DARWIN_NULL (0L)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* !__LP64__ */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; __DARWIN_NULL 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* __LP64__ */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* __GNUG__ */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* ! __cplusplus */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; __DARWIN_NULL ((void *)0)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* __cplusplus */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å› ä¸ºObjective-Cä¸æ˜¯C++ä»£ç ï¼Œæ‰€ä»¥å€’æ•°ç¬¬äºŒè¡Œ&lt;code&gt;#define __DARWIN_NULL ((void *)0)&lt;/code&gt;æ­¤æ—¶é«˜äº®ï¼Œæ„å‘³ç€æœ€ç»ˆ&lt;code&gt;nil&lt;/code&gt;å’Œ&lt;code&gt;Nil&lt;/code&gt;æœ¬è´¨éƒ½ä¸º&lt;code&gt;((void *)0)&lt;/code&gt;  &lt;/p&gt;
&lt;p&gt;PSï¼šå…¶å®å¦‚æœåªçœ‹Objective-Cä¸­çš„&lt;code&gt;nil&lt;/code&gt;å’Œ&lt;code&gt;Nil&lt;/code&gt;å®šä¹‰ä¸ç”¨è¿™ä¹ˆéº»çƒ¦çš„ï¼Œåªéœ€æŸ¥çœ‹Objective-C Runtime Referenceä¸­çš„â€Constants-&amp;gt;Null Valuesâ€å³å¯ã€‚  &lt;/p&gt;
&lt;h3 id=&quot;Swift&quot;&gt;&lt;a href=&quot;#Swift&quot; class=&quot;headerlink&quot; title=&quot;Swift&quot;&gt;&lt;/a&gt;Swift&lt;/h3&gt;&lt;p&gt;Swift 1.2 ç›®å‰åªæœ‰&lt;code&gt;nil&lt;/code&gt;è€Œæ²¡æœ‰&lt;code&gt;Nil&lt;/code&gt;ã€‚ä¸ºäº†å®‰å…¨æ€§Swiftæ–°å¢äº†&lt;code&gt;Optional&lt;/code&gt;ç±»å‹æ¥ä½œä¸ºä¸€ä¸ªå®¹å™¨ã€‚å¥½æ¯”ä¸€ä¸ªç®±å­é‡Œé¢å¯èƒ½è£…æœ‰æŸç§ç±»å‹çš„å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ç©ºçš„(&lt;code&gt;nil&lt;/code&gt;)ã€‚ç®±å­ä¹Ÿå¯ä»¥åµŒå¥—ï¼Œä¹Ÿå¯ä»¥å»æ‰ï¼Œä½†è¿™éƒ½åŸºäºå®‰å…¨çš„è§£æã€ç»‘å®šç­‰ã€‚Swift çš„nilå’Œ Objective-C ä¸­çš„nilå¹¶ä¸ä¸€æ ·ã€‚åœ¨ Objective-C ä¸­ï¼Œ&lt;code&gt;nil&lt;/code&gt;æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸å­˜åœ¨å¯¹è±¡çš„æŒ‡é’ˆã€‚åœ¨ Swift ä¸­ï¼Œ&lt;code&gt;nil&lt;/code&gt;ä¸æ˜¯æŒ‡é’ˆâ€”â€”å®ƒæ˜¯ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œç”¨æ¥è¡¨ç¤ºå€¼ç¼ºå¤±ã€‚ä»»ä½•ç±»å‹çš„å¯é€‰å€¼éƒ½å¯ä»¥è¢«è®¾ç½®ä¸º&lt;code&gt;nil&lt;/code&gt;ï¼Œä¸åªæ˜¯å¯¹è±¡ï¼ˆobjectï¼‰ç±»å‹ã€‚  &lt;/p&gt;
&lt;p&gt;PS:æœ‰å…³Swiftä¸­çš„&lt;code&gt;Optional&lt;/code&gt;ç±»å‹çš„æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšæ–‡ï¼š&lt;a href=&quot;http://yulingtianxia.com/blog/2014/06/17/optionals-and-optional-chaining-in-swift/#Nil_Coalescing_Operator&quot;&gt;Optionals and Optional Chaining in Swift&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;PSï¼šæ›¾å‡ ä½•æ—¶ï¼ŒSwiftçš„&lt;code&gt;nil&lt;/code&gt;è¿˜ä¸æ˜¯å­—é¢é‡ï¼Œè€Œæ˜¯&lt;code&gt;NilType&lt;/code&gt;ç±»å‹çš„å”¯ä¸€å®ä¾‹ã€‚ä½†è¿™ä¸€åˆ‡éƒ½æ˜¯å†å²äº†ã€‚  &lt;/p&gt;
&lt;h2 id=&quot;NSNull&quot;&gt;&lt;a href=&quot;#NSNull&quot; class=&quot;headerlink&quot; title=&quot;NSNull&quot;&gt;&lt;/a&gt;NSNull&lt;/h2&gt;&lt;p&gt;&lt;code&gt;NSNull&lt;/code&gt;åœ¨NSNull.hä¸­çš„å®šä¹‰ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;NSNull :&lt;/span&gt; NSObject &amp;lt;NSCopying, NSSecureCoding&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (NSNull *)&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;NSNull&lt;/code&gt;æ˜¯ä¸ªå•ä¾‹ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•&lt;code&gt;null&lt;/code&gt;ï¼Œä¹Ÿç”¨æ¥è¡¨ç¤ºç©ºå€¼ã€‚ä½†å®ƒå‡ºç°åœ¨ä¸€äº›&lt;code&gt;nil&lt;/code&gt;æ— æ³•èƒœä»»çš„åœºæ™¯æ¥æ›¿ä»£&lt;code&gt;nil&lt;/code&gt;æ¥è¡¨ç¤ºç©ºå€¼ã€‚æ¯”å¦‚&lt;code&gt;NSArray&lt;/code&gt;å’Œ&lt;code&gt;NSDictionary&lt;/code&gt;ä¸­&lt;code&gt;nil&lt;/code&gt;ä»£è¡¨æ•°ç»„æˆ–å­—å…¸çš„æœ«å°¾(å³ä½¿&lt;code&gt;nil&lt;/code&gt;ä¸å‡ºç°åœ¨æœ«å°¾ï¼Œä¹Ÿä¼šå°†å…¶åˆ‡æ–­ï¼Œ&lt;code&gt;nil&lt;/code&gt;åé¢çš„å€¼ä¼šä¸¢å¤±)ï¼Œæ­¤æ—¶åªèƒ½ç”¨NSNullå¯¹è±¡æ¥è¡¨ç¤ºç©ºå€¼ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSNull&lt;/span&gt; *nullValue = [&lt;span class=&quot;built_in&quot;&gt;NSNull&lt;/span&gt; null];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *arrayWithNull = @[nullValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;arrayWithNull: %@&quot;&lt;/span&gt;, arrayWithNull);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Output: &quot;arrayWithNull: (&amp;lt;null&amp;gt;)&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è™½ç„¶&lt;code&gt;NSNull&lt;/code&gt;è¯­ä¹‰ä¸Šç­‰åŒäº&lt;code&gt;nil&lt;/code&gt;ï¼Œä½†å´å¹¶ä¸å®Œå…¨ç­‰äº&lt;code&gt;nil&lt;/code&gt;ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; aValue = [arrayWithNull objectAtIndex:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (aValue == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;equals nil&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (aValue == [&lt;span class=&quot;built_in&quot;&gt;NSNull&lt;/span&gt; null]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;equals NSNull instance&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([aValue isEqual:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;isEqual:nil&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Output: &quot;equals NSNull instance&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;&lt;a href=&quot;#å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒ&quot;&gt;&lt;/a&gt;å‚è€ƒ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://zh.wikipedia.org/wiki/C%2B%2B11#.E9.80.9A.E7.94.A8.E6.99.BA.E8.83.BD.E6.8C.87.E9.87.9D&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç»´åŸºç™¾ç§‘C++11&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://clang.llvm.org/docs/LanguageExtensions.html#langext-has-feature-back-compat&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clang 3.7 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ–—æˆ˜èƒœä½›ä¼ è®°ã€‚ã€‚ã€‚  &lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>UIDynamics in Swift</title>
    <link href="http://yulingtianxia.com/blog/2015/03/01/UIDynamics-in-Swift/"/>
    <id>http://yulingtianxia.com/blog/2015/03/01/UIDynamics-in-Swift/</id>
    <published>2015-03-01T06:46:51.000Z</published>
    <updated>2016-05-11T14:32:38.000Z</updated>
    
    <content type="html">&lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª&lt;a href=&quot;http://www.bignerdranch.com/blog/uidynamics-in-swift/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BigNerdRanch&lt;/a&gt;ï¼Œä½œè€…&lt;a href=&quot;http://www.bignerdranch.com/about-us/nerds/steve-sparks/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Steve Sparks&lt;/a&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;å°±åƒæˆ‘ä»¬å‡ ä¹æ‰€æœ‰çš„iOSå¼€å‘è€…é‚£æ ·ï¼Œæˆ‘ä¹Ÿç©äº†ç©Swiftã€‚ç°åœ¨è°ˆåŠå®ƒåœ¨æˆ‘iOSå¼€å‘ä»»åŠ¡ä¸­çš„ä½œç”¨è¿˜ä¸ºæ—¶è¿‡æ—©ï¼Œå› ä¸ºå®ƒå¯¹äºåº”ç”¨çš„ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨è¿˜æœ‰äº›ä¸æˆç†Ÿã€‚ï¼ˆWWDCä¸€å‘¨è¿‡åï¼Œè‹¹æœå°±é‡æ–°æ„é€ äº†æ•°ç»„çš„è¿ä½œæ–¹å¼ã€‚é‚£å¯æ˜¯æ•°ç»„å•Šï¼ï¼‰  &lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œåœ¨WWDCä¹‹å‰ï¼Œæˆ‘ä¸€ç›´åœ¨ä½¿ç”¨UIDynamicsï¼Œæ‰€ä»¥æˆ‘è¸ä¸ŠSwiftçš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯å°è¯•ç”¨è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œè¿™ä¼¼ä¹åˆä¹é€»è¾‘ã€‚ç»“è®ºæ˜¯ï¼ŒSwiftä¸­çš„UIDynamicsè·Ÿåœ¨Objective-Cä¸­ä½¿ç”¨æ²¡å•¥å·®åˆ«ã€‚æˆ‘ä»¬åªéœ€è¦å°†å…¶å¥—ä¸ŠSwifté£æ ¼çš„å…»åˆ†ï¼Œå®ƒä¼šåƒæˆ‘ä»¬é¢„æœŸçš„é‚£æ ·å¥æ•ˆã€‚  &lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¤ºèŒƒï¼Œæˆ‘ä»¬åŒ†åŒ†æ‹¼å‡‘äº†ä¸€ä¸ªæ•æ·å·¥ç¨‹ã€‚ä½¿ç”¨Xcode 6ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Swiftå•è§†å›¾å·¥ç¨‹ã€‚æˆ‘ç§°å®ƒæ˜¯æˆ‘çš„â€œ&lt;a href=&quot;https://github.com/stevesparks/RockBox&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Rock Box&lt;/a&gt;â€ã€‚  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.bignerdranch.com/img/blog/2014/07/newproj.jpg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ— éœ€ç”¨åˆ°Storyboardï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨&lt;code&gt;ViewController.swift&lt;/code&gt;æ–‡ä»¶ä¸­åŠ å…¥ä¸‹é¢çš„ä»£ç ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; box : &lt;span class=&quot;type&quot;&gt;UIView&lt;/span&gt;?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addBox&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(location: CGRect)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; newBox = &lt;span class=&quot;type&quot;&gt;UIView&lt;/span&gt;(frame: location)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   newBox.backgroundColor = &lt;span class=&quot;type&quot;&gt;UIColor&lt;/span&gt;.redColor()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   view.insertSubview(newBox, atIndex: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   box = newBox&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨&lt;code&gt;viewDidLoad()&lt;/code&gt;ä¸­åŠ ä¸Šä¸€è¡Œä»£ç æ¥è°ƒç”¨å®ƒã€‚  &lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;viewDidLoad&lt;/span&gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   super&lt;span class=&quot;selector-class&quot;&gt;.viewDidLoad&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Do any additional setup after loading the view, typically from a nib.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;selector-tag&quot;&gt;addBox&lt;/span&gt;(CGRectMake(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿è¡Œç¨‹åºï¼Œä¼šçœ‹åˆ°ä¸€ä¸ªçº¢è‰²çš„ç®±å­ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.bignerdranch.com/img/blog/2014/07/initial.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;å®ƒä¸åŠ¨ï¼›å•¥éƒ½æ²¡åŠ¨ã€‚é‚£ä¹Ÿå¤ªæ— èŠäº†ã€‚æˆ‘ä»¬è®¾ç½®å®ƒåŠ¨èµ·æ¥å§ã€‚  &lt;/p&gt;
&lt;h2 id=&quot;é­é¦–ï¼šUIDynamicAnimator&quot;&gt;&lt;a href=&quot;#é­é¦–ï¼šUIDynamicAnimator&quot; class=&quot;headerlink&quot; title=&quot;é­é¦–ï¼šUIDynamicAnimator&quot;&gt;&lt;/a&gt;é­é¦–ï¼šUIDynamicAnimator&lt;/h2&gt;&lt;p&gt;è¿™å‡ºæˆçš„é­é¦–æ˜¯&lt;code&gt;UIDynamicAnimator&lt;/code&gt;ã€‚æŒ‰ç…§ç»™å‡ºçš„ä¸€ç³»åˆ—è§„åˆ™ï¼Œanimatoråœ¨å±å¹•æ¯æ¬¡é‡ç»˜æ—¶è°ƒæ•´æ¯ä¸ªç‰©ä½“çš„ä½ç½®ã€‚å°±å…¶æœ¬èº«è€Œè¨€ï¼Œanimatoræ ¹æœ¬ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å®ƒéœ€è¦çš„è§„åˆ™è¢«ç§°ä¸ºè¡Œä¸ºï¼ˆbehaviorï¼‰ã€‚è¡Œä¸ºæè¿°çš„äº‹ç‰©ç±»ä¼¼äºä¸€ä¸ªå†²é‡ï¼Œä¾‹å¦‚æ¨ä¸€ä¸‹ï¼Œæˆ–é‡åŠ›é‚£ç§æŒä¹…çš„åŠ›ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå®ƒä»¬çš„æ‘©æ“¦åŠ›ï¼Œå¼¹åŠ›ç­‰ç­‰ã€‚animatorä¸åšä»»ä½•å¯¹è‡ªå·±åˆ¶å®šçš„è§„åˆ™ï¼›å®ƒåªæ˜¯é­é¦–ã€‚æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚å°†ä¼šå£°æ˜å®ƒçš„ä¸€ä¸ªå®ä¾‹ã€‚  &lt;/p&gt;
&lt;h2 id=&quot;æœ€ç®€å•çš„è¡Œä¸ºï¼šUIGravityBehavior&quot;&gt;&lt;a href=&quot;#æœ€ç®€å•çš„è¡Œä¸ºï¼šUIGravityBehavior&quot; class=&quot;headerlink&quot; title=&quot;æœ€ç®€å•çš„è¡Œä¸ºï¼šUIGravityBehavior&quot;&gt;&lt;/a&gt;æœ€ç®€å•çš„è¡Œä¸ºï¼šUIGravityBehavior&lt;/h2&gt;&lt;p&gt;è®©æˆ‘ä»¬ä»ä¸€ä¸ªé‡åŠ›è¡Œä¸ºå¼€å§‹ï¼Œç»“æœä¾¿æ˜¯æˆ‘ä»¬çš„çº¢è‰²ç®±å­æ‰è½åˆ°å±å¹•åº•éƒ¨ã€‚å®ƒæ˜¯ä»æ¦‚å¿µä¸Šæœ€å®¹æ˜“ç†è§£çš„è¡Œä¸ºäº†ï¼›ä¸€ä¸ªå·²çŸ¥æ–¹å‘çš„æ‹‰åŠ›ä¼šåœ¨æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸå‘ç‰©ä½“æ–½åŠ é€Ÿåº¦ã€‚æˆ‘ä»¬æ‰“ç®—æ–½åŠ å‚ç›´å‘ä¸‹çš„é‡åŠ›ã€‚  &lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; animator:&lt;span class=&quot;type&quot;&gt;UIDynamicAnimator&lt;/span&gt;? = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; gravity = &lt;span class=&quot;type&quot;&gt;UIGravityBehavior&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;createAnimatorStuff&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   animator = &lt;span class=&quot;type&quot;&gt;UIDynamicAnimator&lt;/span&gt;(referenceView:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   animator?.addBehavior(collider)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   gravity.addItem(box);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   gravity.gravityDirection = &lt;span class=&quot;type&quot;&gt;CGVectorMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.8&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   animator?.addBehavior(gravity);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‡è¦çš„æ˜¯æ³¨æ„&lt;code&gt;UIDynamicAnimator&lt;/code&gt;åé¢æ ‡è®°çš„é—®å·æ„æ€æ˜¯å˜é‡å¯èƒ½ä¸º&lt;code&gt;nil&lt;/code&gt;ã€‚äº‹å®ä¸Šï¼Œæˆ‘å°±åœ¨è¿™é‡ŒæŠŠå®ƒè®¾ä¸º&lt;code&gt;nil&lt;/code&gt;ã€‚åŸå› æœ‰äº›å¾®å¦™ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;animatoræ˜¯åœ¨ç±»ä¸­å£°æ˜çš„ï¼Œè¿™æ„å‘³ç€å½“view controllerçš„&lt;code&gt;init&lt;/code&gt;è°ƒç”¨æ—¶å¿…éœ€å¯¹å…¶è¿›è¡Œèµ‹å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;self.view&lt;/code&gt; å¿…é¡»åœ¨ &lt;code&gt;init&lt;/code&gt; ä¹‹åè°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;animatorçš„æ„é€ å™¨éœ€è¦ä¸€ä¸ªè§†å›¾ä½œä¸ºå®ƒçš„å‚ç…§è§†å›¾ï¼Œè€Œä¸”è¿™ä¸ªå€¼å°†ä¼šæ˜¯&lt;code&gt;self.view&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨è¿™é…¿é€ äº†ä¸€ä¸ªé¸¡ç”Ÿè›‹çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸ä¼šå…è®¸æ­¤å˜é‡ä¸º&lt;code&gt;nil&lt;/code&gt;ï¼Œå¹¶ä¸”åœ¨&lt;code&gt;viewDidLoad()&lt;/code&gt;æœŸé—´å°†å…¶è®¾å®šå¥½ã€‚è¿™å¼•å…¥äº†ä¸€äº›æ³¢æŠ˜ï¼Œä»»ä½•æ—¶é—´æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;animator&lt;/code&gt;å˜é‡ï¼Œéƒ½å°†å‘ç°æˆ‘ä»¬ä¸å¾—ä¸äº²è‡ªç¡®ä¿åœ¨ä½¿ç”¨ä¹‹å‰å®ƒçš„å€¼ä¸æ˜¯&lt;code&gt;nil&lt;/code&gt;ã€‚è¿™åœ¨Swiftä¸­è¢«å¤„ç†æˆåœ¨&lt;code&gt;animator&lt;/code&gt;åé¢ç”¨ä¸€ä¸ªé—®å·æ ‡è®°ï¼Œæ¯”å¦‚&lt;code&gt;animator?.behaviors()&lt;/code&gt;ã€‚æˆ‘ä»¬å°†ä¼šè®¨è®ºæ›´å¤šäº›è¿™æ–¹é¢çš„å†…å®¹ã€‚æš‚ä¸”è®©æˆ‘ä»¬å‘&lt;code&gt;viewDidLoad&lt;/code&gt;åŠ ç‚¹ä»£ç æ¥è°ƒç”¨æˆ‘ä»¬çš„æ–°æ–¹æ³•â€¦  &lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;addBox(CGRectMake(100, &lt;/span&gt;&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        createAnimatorStuff()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€¦ç¼–è¯‘è¿è¡Œã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.bignerdranch.com/img/blog/2014/07/round1.gif&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;å—¯ï¼ŒçœŸæœ‰è¶£â€¦å°±ä¸€ä¼šå„¿ï¼Œå®ƒç«‹åˆ»è·Œå‡ºäº†åº•éƒ¨ã€‚  &lt;/p&gt;
&lt;h2 id=&quot;åå¼¹çš„å¢™å£ï¼šUICollisionBehavior&quot;&gt;&lt;a href=&quot;#åå¼¹çš„å¢™å£ï¼šUICollisionBehavior&quot; class=&quot;headerlink&quot; title=&quot;åå¼¹çš„å¢™å£ï¼šUICollisionBehavior&quot;&gt;&lt;/a&gt;åå¼¹çš„å¢™å£ï¼šUICollisionBehavior&lt;/h2&gt;&lt;p&gt;&lt;code&gt;UICollisionBehavior&lt;/code&gt;å…³æ³¨æ‹…å¿ƒç‰©ä½“æ˜¯å¦ä¼šåœ¨å®ƒä»¬çš„è½¨è¿¹ä¸Šç¢°æ’ï¼Œå¦‚æœç¢°æ’ï¼Œå®ƒä»¬æ€ä¹ˆç›¸äº’ä½œç”¨ã€‚é™¤äº†è®©ç‰©ä½“äº’ç›¸ç¢°æ’ï¼Œå®ƒä¹Ÿæ¨æ–­è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼ç‰©ä½“è¾¹æ¡†çš„è·¯å¾„ã€‚ï¼ˆä½¿ç”¨&lt;code&gt;let&lt;/code&gt;ï¼‰å£°æ˜ä¸€ä¸ª&lt;code&gt;UICollisionBehavior&lt;/code&gt;å¸¸é‡ï¼Œå¹¶æŠŠå®ƒæ·»åŠ åˆ°è®¾ç½®ä»£ç ä¸­ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight processing&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;collider.addItem(&lt;span class=&quot;built_in&quot;&gt;box&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æˆ‘ä»¬åœ¨åå¼¹å¢™å£&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;collider.translatesReferenceBoundsIntoBoundary = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;animator?.addBehavior(collider)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿è¡Œï¼Œçœ‹çœ‹å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿ  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.bignerdranch.com/img/blog/2014/07/round2.gif&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;æ›´æ£’äº†ï¼ç®±å­æ‰è½å¹¶åœåœ¨â€œåœ°æ¿â€ä¸Šï¼Œç”šè‡³è¿˜æœ‰ç‚¹å¼¹æ€§ï¼  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç¨å¾®é‡æ„ä¸€ä¸‹ï¼Œæˆ‘æƒ³è¦çœ‹åˆ°æ›´å¤šç®±å­ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ç”¨äºæ‰¾åˆ°éšæœºè¾¹æ¡†ä½†åˆä¸å‹åœ¨ä¹‹å‰ç»˜åˆ¶çš„ç®±å­ä¸Šï¼Œè¿˜æœ‰å¦ä¸€ä¸ªäº§ç”Ÿéšæœºé¢œè‰²çš„å‡½æ•°ã€‚æˆ‘ä»¬ä¸€æ—¦æœ‰äº†è¿™äº›ï¼Œå°±èƒ½åœ¨å±å¹•ä¸Šéšæœºåˆ›å»ºåä¸ªç®±å­ã€‚å…¶å®è¦åšçš„è¿˜æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥ç›´æ¥æŸ¥çœ‹&lt;a href=&quot;https://github.com/stevesparks/RockBox/commit/97b87458b5911f880f30179ee0630f933b48bbf5&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™ä¸ªcommit&lt;/a&gt;æ¥çœ‹çœ‹éƒ½åšäº†ä»€ä¹ˆã€‚æ„Ÿå…´è¶£çš„ç»†èŠ‚æ˜¯ï¼Œè°ƒç”¨&lt;code&gt;createAnimatorStuff()&lt;/code&gt;æ—¶æˆ‘ä»¬ä¸å†å°†ç®±å­åŠ åˆ°è¡Œä¸ºä¸­ï¼Œè€Œæ˜¯å•ç‹¬åœ°è°ƒç”¨&lt;code&gt;addBoxToBehaviors(box)&lt;/code&gt;æ¥æ·»åŠ ç®±å­ã€‚  &lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬æœ‰10ä¸ªç®±å­å¹¶èƒ½ç›¸äº’ç¢°æ’ï¼  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.bignerdranch.com/img/blog/2014/07/round3.gif&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å®ƒä»¬åšçš„è¿˜æ˜¯ä¸å¤Ÿå¥½ã€‚æˆ‘ä»¬ä¸ºå•¥ä¸å°†ç¯å¢ƒé‡åŠ›ç»‘å®šåˆ°ä»åŠ é€Ÿè®¡è¯»å–åˆ°çš„é‡åŠ›ä¸Šå‘¢ï¼Ÿ  &lt;/p&gt;
&lt;h2 id=&quot;Core-Motion&quot;&gt;&lt;a href=&quot;#Core-Motion&quot; class=&quot;headerlink&quot; title=&quot;Core Motion&quot;&gt;&lt;/a&gt;Core Motion&lt;/h2&gt;&lt;p&gt;iOSè®¾å¤‡çš„åŠ é€Ÿè®¡èƒ½åšä¸€å †å·§æ´»å„¿ï¼Œè¿™å…¶ä¸­æœ€å¸¸è§çš„å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬é‡åŠ›å‘å“ªä¸ªæ–¹å‘ç‰µå¼•ã€‚&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIAcceleration_Class/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è‹¹æœå…³äº &lt;code&gt;UIAcceleration&lt;/code&gt; çš„æ–‡æ¡£&lt;/a&gt;åœ¨ä¸€å¼€å§‹å°±ç»™å‡ºäº†ä¸€å¼ ç¤ºèŒƒåæ ‡è½´å¦‚ä½•è½¬åŒ–åˆ°è®¾å¤‡ä¸Šçš„å›¾ç‰‡ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIAcceleration_Class/Art/device_axes.jpg&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;è¿™äº›åæ ‡è½´ç›¸å½“äºé‡åŠ›çš„æ–¹å‘â€¦åŸºæœ¬ä¸Šã€‚æˆ‘å·²ç»å‘ç°Yè½´è²Œä¼¼è¢«ç¿»è½¬äº†ã€‚ç…§æ­¤ï¼Œå½“æˆ‘å°†&lt;code&gt;CMAcceleration&lt;/code&gt;å€¼è½¬åŒ–æˆ&lt;code&gt;CGVector&lt;/code&gt;æ—¶ï¼Œæˆ‘éœ€è¦è½¬æ¢å®ƒçš„å€¼ã€‚  &lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ª&lt;code&gt;CMMotionManager&lt;/code&gt;ä½¿æˆ‘ä»¬è·å¾—åŠ é€Ÿè®¡çš„æ•°æ®çš„å…¥å£ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±æŸ¥è¯¢åŠ é€Ÿè®¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¦æ±‚ç®¡ç†è€…é¢‘ç¹åœ°å‘æˆ‘ä»¬å‘é€æ›´æ–°ã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª&lt;code&gt;NSOperationQueue&lt;/code&gt;ï¼Œç„¶åè°ƒç”¨è¿åŠ¨ç®¡ç†è€…çš„æ–¹æ³•ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;motionManager&lt;span class=&quot;selector-class&quot;&gt;.startDeviceMotionUpdatesToQueue&lt;/span&gt;(motionQueue,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 &lt;span class=&quot;attribute&quot;&gt;withHandler&lt;/span&gt;: gravityUpdated)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™åº”è¯¥æ”¾åœ¨&lt;code&gt;viewDidAppear&lt;/code&gt;æ–¹æ³•ï¼Œåœ¨&lt;code&gt;viewWillDisappear&lt;/code&gt;ä¸­æˆ‘ä»¬åº”è¯¥è°ƒç”¨ç›¸åçš„æ“ä½œï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;motionManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.stopDeviceMotionUpdates&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“è§†å›¾å‡ºç°ï¼Œç³»ç»Ÿå¼€å§‹å®šæœŸè°ƒç”¨&lt;code&gt;gravityUpdated&lt;/code&gt;æ–¹æ³•å¹¶ä¼ å…¥æ–°çš„åŠ é€Ÿè®¡æ•°æ®ã€‚è®©æˆ‘ä»¬å®ç°è¿™ä¸ªæ–¹æ³•ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;gravityUpdated&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(motion: CMDeviceMotion!, error: NSError!)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error != &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;type&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;subst&quot;&gt;\(error)&lt;/span&gt;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; grav : &lt;span class=&quot;type&quot;&gt;CMAcceleration&lt;/span&gt; = motion.gravity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; x = &lt;span class=&quot;type&quot;&gt;CGFloat&lt;/span&gt;(grav.x);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; y = &lt;span class=&quot;type&quot;&gt;CGFloat&lt;/span&gt;(grav.y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; v = &lt;span class=&quot;type&quot;&gt;CGVectorMake&lt;/span&gt;(x, y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   gravity.gravityDirection = v;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è®©æˆ‘ä»¬è°ˆä¸€è°ˆæ„Ÿå¹å·ã€‚å®ƒè·Ÿæˆ‘ä»¬å£°æ˜&lt;code&gt;animator&lt;/code&gt;ç”¨åˆ°çš„é—®å·æ— å…³ã€‚é—®å·è¡¨æ˜â€œå˜é‡å¯èƒ½ä¸ºç©ºâ€ï¼Œæ„Ÿå¹å·æ„æ€ç›¸åï¼šâ€œå˜é‡æ°¸è¿œä¸ä¸ºç©ºâ€ï¼Œä½†å®é™…æ„ä¹‰æ›´æ·±ã€‚  &lt;/p&gt;
&lt;p&gt;å½“ä½ å£°æ˜ä¸€ä¸ª&lt;code&gt;animator?&lt;/code&gt;å½¢å¼çš„å˜é‡æ—¶ï¼Œå®ƒè·Ÿ&lt;code&gt;animator&lt;/code&gt;è¿™æ ·çš„å˜é‡æ˜¯ä¸ä¸€æ ·çš„ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹åšæ˜¯ä¸€ç§&lt;code&gt;Optional&lt;/code&gt;ç±»å‹çš„å¯¹è±¡ï¼Œæœ‰å¯èƒ½åŒ…å«&lt;code&gt;animator&lt;/code&gt;ä¹Ÿæœ‰å¯èƒ½ä¸åŒ…å«ã€‚æ‰€ä»¥é—®å·å’Œæ„Ÿå¹å·åªå¯¹&lt;code&gt;Optional&lt;/code&gt;èµ·ä½œç”¨ï¼Œå¯¹&lt;code&gt;animator&lt;/code&gt;ä¸èµ·ä½œç”¨ã€‚é—®å·åœ¨ä»£ç ä¸Šæ„å‘³ç€â€œå¦‚æœä¸ä¸ºç©ºå°±ç»§ç»­â€ï¼Œåƒè¿™æ ·ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;animator&lt;/span&gt;?&lt;span class=&quot;selector-class&quot;&gt;.addBehavior&lt;/span&gt;(&lt;span class=&quot;selector-tag&quot;&gt;collider&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½ å¯ä»¥ç”Ÿæˆç­‰æ•ˆçš„ä»£ç ï¼š  &lt;/p&gt;
&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; let &lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt; = animator &amp;#123; &lt;span class=&quot;keyword&quot;&gt;x&lt;/span&gt;.addBehavior(collider) &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ–è€…ï¼Œä½ å¯ä»¥ç”¨æ„Ÿå¹å·æ¥è§£ææœ¬è´¨çš„å€¼ï¼Œå–å¾—&lt;code&gt;Optional&lt;/code&gt;é‡Œé¢çš„ä¸œä¸œå¹¶ä¼ é€’å®ƒçš„å€¼æ¥ä»£æ›¿æ•´ä¸ªå®¹å™¨ã€‚åœ¨&lt;code&gt;gravityUpdated&lt;/code&gt;çš„å£°æ˜ä¸­ï¼Œæˆ‘ä»¬é¢„ç¤ºæˆ‘ä»¬ä¼šæ”¶åˆ°è§£æå¥½çš„å€¼-å®ƒä¸ä¼šæ˜¯&lt;code&gt;nil&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸ç®¡æ€æ ·ï¼Œè¿™çš„ç¡®å¾ˆé…·ï¼Œä½†æ˜¯æ²¡æœ‰è€ƒè™‘è¯»å–åŠ é€Ÿè®¡æ—¶è®¾å¤‡çš„æœå‘é—®é¢˜ã€‚ç»“æœå°±æ˜¯å¦‚æœä½ é¢ å€’ä½ çš„æ‰‹æœºï¼Œå®ƒä¼šç¿»è½¬æ˜¾ç¤ºï¼Œä½†ä¸æ˜¯åŠ é€Ÿè®¡æ•°æ®ï¼Œä½ çš„ç®±å­ä¼šå¼€å§‹é¬¼ç•œã€‚æ‰€ä»¥æˆ‘ä»¬åŠ äº†äº›ä»£ç æ¥è®©æ•°æ®è§†æœå‘æƒ…å†µè€Œå®šã€‚  &lt;/p&gt;
&lt;figure class=&quot;highlight nix&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;func gravityUpdated(motion: CMDeviceMotion!, error: NSError!) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; error &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  NSLog(&lt;span class=&quot;string&quot;&gt;&quot;\(error)&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; grav : &lt;span class=&quot;attr&quot;&gt;CMAcceleration&lt;/span&gt; = motion.gravity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;x&lt;/span&gt; = CGFloat(grav.x);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;y&lt;/span&gt; = CGFloat(grav.y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	var &lt;span class=&quot;attr&quot;&gt;p&lt;/span&gt; = CGPointMake(x,y)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// Have to correct for orientation.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	var &lt;span class=&quot;attr&quot;&gt;orientation&lt;/span&gt; = UIApplication.sharedApplication().statusBarOrientation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;orientation&lt;/span&gt; == UIInterfaceOrientation.LandscapeLeft &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  var &lt;span class=&quot;attr&quot;&gt;t&lt;/span&gt; = p.x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  p.&lt;span class=&quot;attr&quot;&gt;x&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; - p.y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  p.&lt;span class=&quot;attr&quot;&gt;y&lt;/span&gt; = t&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;orientation&lt;/span&gt; == UIInterfaceOrientation.LandscapeRight &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  var &lt;span class=&quot;attr&quot;&gt;t&lt;/span&gt; = p.x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  p.&lt;span class=&quot;attr&quot;&gt;x&lt;/span&gt; = p.y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  p.&lt;span class=&quot;attr&quot;&gt;y&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; - t&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;orientation&lt;/span&gt; == UIInterfaceOrientation.PortraitUpsideDown &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  p.x *= -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  p.y *= -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	var &lt;span class=&quot;attr&quot;&gt;v&lt;/span&gt; = CGVectorMake(p.x, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; - p.y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	gravity.&lt;span class=&quot;attr&quot;&gt;gravityDirection&lt;/span&gt; = v;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½ æ³¨æ„çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æˆ‘ä»¬ç”¨&lt;code&gt;x&lt;/code&gt;å’Œ&lt;code&gt;y&lt;/code&gt;çš„å€¼åˆ›å»ºäº†ä¸€ä¸ª&lt;code&gt;CGPoint&lt;/code&gt;ã€‚ä½¿ç”¨&lt;code&gt;CGPoint&lt;/code&gt;æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åŸå› ï¼Œåªæ˜¯ä¸ºäº†æŠŠæ•°å€¼æ”¾åœ¨ä¸€èµ·ã€‚  &lt;/p&gt;
&lt;p&gt;å®ƒçœ‹èµ·æ¥åƒä»€ä¹ˆï¼Ÿ  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.bignerdranch.com/img/blog/2014/07/round4.gif&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;å¤ªé…·äº†ï¼  &lt;/p&gt;
&lt;h2 id=&quot;å…¶ä»–çš„è¡Œä¸º&quot;&gt;&lt;a href=&quot;#å…¶ä»–çš„è¡Œä¸º&quot; class=&quot;headerlink&quot; title=&quot;å…¶ä»–çš„è¡Œä¸º&quot;&gt;&lt;/a&gt;å…¶ä»–çš„è¡Œä¸º&lt;/h2&gt;&lt;p&gt;æˆ‘æäº¤äº†ä¸¤ä¸ªcommitå°†äº‹æƒ…æ¨è¿›äº†ä¸€ç‚¹ï¼š&lt;a href=&quot;https://github.com/stevesparks/RockBox/commit/8752153e608e621193742582913e2e3aaba207c9&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å…¶ä¸­ä¸€ä¸ª&lt;/a&gt;æ·»åŠ äº†&lt;code&gt;UIDynamicItemBehavior&lt;/code&gt;ï¼Œå…è®¸æˆ‘ä»¬ä¿®æ”¹ç®±å­çš„æ‘©æ“¦åŠ›å’Œå¼¹æ€§ã€‚æˆ‘è®©ä»–ä»¬è¶…å¼¹(elasticity = 0.9, friction = 0.1)ï¼Œäºæ˜¯é‡åŠ›æ¼”å˜æˆäº†ç®±å­ä»¬ç‹‚èºå¼¹è·³ä¼¼çš„ç–¯ç‹‚æ¼”ç¤ºã€‚  &lt;/p&gt;
&lt;p&gt;è¿™è¯´æ˜äº†UIDynamicsä¸­çš„ä¸€ä¸ªç¼ºç‚¹ã€‚å½“ç®±å­é€Ÿåº¦å¢é•¿ï¼Œæœ€ç»ˆå®ƒä»¬è¾¾åˆ°ä¸€ä¸ªé€Ÿåº¦ä½¿å¾—ç®±å­åœ¨ä¸Šä¸€å¸§è¿˜å®Œå…¨åœ¨è§†å›¾å†…ï¼Œä¸‹ä¸€å¸§å®Œå…¨åœ¨è§†å›¾å¤–ã€‚åœ¨è¿™ç§æƒ…å†µ&lt;code&gt;UICollisionBehavior&lt;/code&gt;å°†ä¸ä¼šè§¦å‘ï¼Œç®±å­å°†ä¼šæ¶ˆå¤±ã€‚å®ƒä»ç„¶å­˜åœ¨ï¼Œå¹¶æŒç»­æ¶ˆè€—è®¡ç®—èµ„æºï¼Œä½†å®ƒæ°¸è¿œä¸ä¼šå†æ¬¡å‡ºç°åœ¨è§†å›¾å†…ã€‚ï¼ˆä¸€ç§è®¾æƒ³æ˜¯ç®±å­æ°¸è¿œå è½ï¼Œé€Ÿåº¦é€’å¢ã€‚ï¼‰  &lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€ä¸ª&lt;a href=&quot;https://github.com/stevesparks/RockBox/commit/ac1a838d2b4ef575f8581f1ff8c9e9433f8362a8&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;commit&lt;/a&gt;æ·»åŠ äº†ä¸€äº›&lt;code&gt;UIAttachmentBehaviors&lt;/code&gt;ä½¿10ä¸ªç®±å­å˜æˆä¸€ä¸²ç®±å­ã€‚å®ƒæœ‰ç‚¹ç ´åäº†åº”ç”¨çš„å¯ç©æ€§ï¼Œä½†æˆ‘æƒ³è®©ä½ çœ‹çœ‹è¿™äº›ç‰©ä½“æ˜¯æ€ä¹ˆç›¸äº’è¿æ¥èµ·æ¥çš„ã€‚  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ€åä¸€èŠ‚æ˜¯ä½œè€…åæ§½Swiftç»å†çš„ï¼Œå› ä¸ºSwiftç‰ˆæœ¬æ›´æ–°äº†ï¼Œè¿™èŠ‚å†…å®¹ä¸æ˜¯å¾ˆé‡è¦æ‰€ä»¥æ²¡ç¿»è¯‘ã€‚åŸä½œè€…ä»£ç é£æ ¼ä¸å¤ŸSwiftè€Œä¸”è¯­æ³•è€æ—§ï¼Œæˆ‘æäº†ä¸ª&lt;a href=&quot;https://github.com/stevesparks/RockBox/pull/2&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PR&lt;/a&gt;ï¼Œå°†è¯­æ³•æ›´æ–°åˆ°æœ€æ–°çš„Swift 1.2ã€‚  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª&lt;a href=&quot;http://www.bignerdranch.com/blog/uidynamics-in-swift/&quot;&gt;BigNerdRanch&lt;/a&gt;ï¼Œä½œè€…&lt;a href=&quot;http://www.bignerdranch.com/about-us/nerds/steve-sparks/&quot;&gt;Steve Sparks&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Swift" scheme="http://yulingtianxia.com/tags/Swift/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yulingtianxia.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="UIKit Dynamics" scheme="http://yulingtianxia.com/tags/UIKit-Dynamics/"/>
    
  </entry>
  
</feed>
